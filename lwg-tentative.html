<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>C++ Standard Library Tentative Issues</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
  @media (prefers-color-scheme: dark) {
     html {
        color: #ddd;
        background-color: black;
     }
     ins {
        background-color: #225522
     }
     del {
        background-color: #662222
     }
     a {
        color: #6af
     }
     a:visited {
        color: #6af
     }
     blockquote.note
     {
        background-color: rgba(255, 255, 255, .10)
     }
  }
</style>
</head>
<body>
<p><p>Revised 2023-01-09 at 15:02:16 UTC</p>
</p><h2>Tentative Issues</h2>
<hr>
<h3><a name="3204" href="#3204">3204</a><sup><a href="https://cplusplus.github.io/LWG/issue3204">(i)</a></sup>. <tt>sub_match::swap</tt> only swaps the base class</h3>
<p><b>Section:</b> 32.8 <a href="https://wg21.link/re.submatch">[re.submatch]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Jonathan Wakely <b>Opened:</b> 2019-05-07 <b>Last modified:</b> 2022-11-30</p>
<p><b>Priority: </b>3
</p>
<p><b>View other</b> <a href="lwg-index-open.html#re.submatch">active issues</a> in [re.submatch].</p>
<p><b>View all other</b> <a href="lwg-index.html#re.submatch">issues</a> in [re.submatch].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
<tt>sub_match&lt;I&gt;</tt> derives publicly from <tt>pair&lt;I,I&gt;</tt>, and so inherits 
<tt>pair::swap(pair&amp;)</tt>. This means that the following program fails:
</p>
<blockquote><pre>
#include &lt;regex&gt;
#include &lt;cassert&gt;

int main()
{
  std::sub_match&lt;const char*&gt; a, b;
  a.matched = true;
  a.swap(b);
  assert(b.matched);
}
</pre></blockquote>
<p>
The <tt>pair::swap(pair&amp;)</tt> member should be hidden by a <tt>sub_match::swap(sub_match&amp;)</tt> 
member that does the right thing.
</p>

<p><i>[2019-06-12 Priority set to 3 after reflector discussion]</i></p>


<p><i>[2020-05-01; Daniel adjusts wording to recent working draft]</i></p>


<p><i>[2022-04-25; Daniel adjusts wording to recent working draft]</i></p>

<p>
In addition the revised wording uses the new standard phrase "The exception specification is equivalent to"
</p>

<p><strong>Previous resolution [SUPERSEDED]:</strong></p>
<blockquote class="note">
<p>
This wording is relative to <a href="https://wg21.link/N4910">N4910</a>.
</p>

<ol>
<li><p>Modify 32.8 <a href="https://wg21.link/re.submatch">[re.submatch]</a>, class template <tt>sub_match</tt> synopsis, as indicated:</p>

<blockquote>
<pre>
template&lt;class BidirectionalIterator&gt;
class sub_match : public pair&lt;BidirectionalIterator, BidirectionalIterator&gt; {
public:
  [&hellip;]
  int compare(const sub_match&amp; s) const;
  int compare(const string_type&amp; s) const;
  int compare(const value_type* s) const;
  
  <ins>void swap(sub_match&amp; s) noexcept(<i>see below</i>);</ins>
};
</pre>
</blockquote>
</li>

<li><p>Modify 32.8.2 <a href="https://wg21.link/re.submatch.members">[re.submatch.members]</a> as indicated:</p>

<blockquote>
<pre>
int compare(const value_type* s) const;
</pre>
<blockquote>
<p>
[&hellip;]
</p>
</blockquote>
<pre>
<ins>void swap(sub_match&amp; s) noexcept(<i>see below</i>);</ins>
</pre>
<blockquote class="note">
[<i>Drafting note:</i> The swappable requirement should really be unnecessary because <i>Cpp17Iterator</i> 
requires it, but there is no wording that requires <tt>BidirectionalIterator</tt> in Clause
32 <a href="https://wg21.link/re">[re]</a> in general meets the bidirectional iterator requirements. Note that the definition found
in 27.2 <a href="https://wg21.link/algorithms.requirements">[algorithms.requirements]</a> does not extend to 32 <a href="https://wg21.link/re">[re]</a> normatively. &mdash; 
<i>end drafting note</i>]
</blockquote>
<blockquote>
<p>
<ins>-?- <i>Preconditions:</i> Lvalues of type <tt>BidirectionalIterator</tt> are swappable 
(16.4.4.3 <a href="https://wg21.link/swappable.requirements">[swappable.requirements]</a>).</ins>
<p/>
<ins>-?- <i>Effects:</i> Equivalent to:</ins>
</p>
<blockquote><pre>
<ins>this-&gt;pair&lt;BidirectionalIterator, BidirectionalIterator&gt;::swap(s);
std::swap(matched, s.matched);</ins>
</pre></blockquote>
<p>
<ins>-?- <i>Remarks:</i> The exception specification is equivalent to 
<tt>is_nothrow_swappable_v&lt;BidirectionalIterator&gt;</tt>.</ins>
</p>
</blockquote>
</blockquote>
</li>
</ol>
</blockquote>

<p><i>[2022-11-06; Daniel comments and improves wording]</i></p>

<p>
With the informal acceptance of <a href="https://isocpp.org/files/papers/P2696R0.html">P2696R0</a> by 
LWG during a pre-Kona telecon, we should use the new requirement set <i>Cpp17Swappable</i> instead of 
the "LValues are swappable" requirements.
</p>


<p><i>[2022-11-30; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after six votes in favour during reflector poll.
</p>



<p id="res-3204"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N4917">N4917</a> <b>and assumes the acceptance of <a href="https://isocpp.org/files/papers/P2696R0.html">P2696R0</a></b>.
</p>

<ol>
<li><p>Modify 32.8 <a href="https://wg21.link/re.submatch">[re.submatch]</a>, class template <tt>sub_match</tt> synopsis, as indicated:</p>

<blockquote>
<pre>
template&lt;class BidirectionalIterator&gt;
class sub_match : public pair&lt;BidirectionalIterator, BidirectionalIterator&gt; {
public:
  [&hellip;]
  int compare(const sub_match&amp; s) const;
  int compare(const string_type&amp; s) const;
  int compare(const value_type* s) const;
  
  <ins>void swap(sub_match&amp; s) noexcept(<i>see below</i>);</ins>
};
</pre>
</blockquote>
</li>

<li><p>Modify 32.8.2 <a href="https://wg21.link/re.submatch.members">[re.submatch.members]</a> as indicated:</p>

<blockquote>
<pre>
int compare(const value_type* s) const;
</pre>
<blockquote>
<p>
[&hellip;]
</p>
</blockquote>
<pre>
<ins>void swap(sub_match&amp; s) noexcept(<i>see below</i>);</ins>
</pre>
<blockquote class="note">
[<i>Drafting note:</i> The <i>Cpp17Swappable</i> requirement should really be unnecessary because <i>Cpp17Iterator</i> 
requires it, but there is no wording that requires <tt>BidirectionalIterator</tt> in Clause
32 <a href="https://wg21.link/re">[re]</a> in general meets the bidirectional iterator requirements. Note that the definition found
in 27.2 <a href="https://wg21.link/algorithms.requirements">[algorithms.requirements]</a> does not extend to 32 <a href="https://wg21.link/re">[re]</a> normatively. &mdash; 
<i>end drafting note</i>]
</blockquote>
<blockquote>
<p>
<ins>-?- <i>Preconditions:</i> <tt>BidirectionalIterator</tt> meets the <i>Cpp17Swappable</i> requirements 
(16.4.4.3 <a href="https://wg21.link/swappable.requirements">[swappable.requirements]</a>).</ins>
<p/>
<ins>-?- <i>Effects:</i> Equivalent to:</ins>
</p>
<blockquote><pre>
<ins>this-&gt;pair&lt;BidirectionalIterator, BidirectionalIterator&gt;::swap(s);
std::swap(matched, s.matched);</ins>
</pre></blockquote>
<p>
<ins>-?- <i>Remarks:</i> The exception specification is equivalent to 
<tt>is_nothrow_swappable_v&lt;BidirectionalIterator&gt;</tt>.</ins>
</p>
</blockquote>
</blockquote>
</li>
</ol>




<hr>
<h3><a name="3742" href="#3742">3742</a><sup><a href="https://cplusplus.github.io/LWG/issue3742">(i)</a></sup>. <tt>deque::prepend_range</tt> needs to permute</h3>
<p><b>Section:</b> 24.2.4 <a href="https://wg21.link/sequence.reqmts">[sequence.reqmts]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Casey Carter <b>Opened:</b> 2022-07-16 <b>Last modified:</b> 2022-11-30</p>
<p><b>Priority: </b>2
</p>
<p><b>View other</b> <a href="lwg-index-open.html#sequence.reqmts">active issues</a> in [sequence.reqmts].</p>
<p><b>View all other</b> <a href="lwg-index.html#sequence.reqmts">issues</a> in [sequence.reqmts].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
When the range to be inserted is neither bidirectional nor sized, it's simpler to prepend 
elements one at a time, and then reverse the prepended elements. When the range to be 
inserted is neither forward nor sized, I believe this approach is necessary to implement 
<tt>prepend_range</tt> at all &mdash; there is no way to determine the length of the range 
modulo the block size of the <tt>deque</tt> ahead of time so as to insert the new elements 
in the proper position.
<p/>
The container requirements do not allow <tt>prepend_range</tt> to permute elements in a 
<tt>deque</tt>. I believe we <em>must</em> allow permutation when the range is neither 
forward nor sized, and we <em>should</em> allow permutation when the range is not bidirectional 
to allow implementations the freedom to make a single pass through the range.
</p>

<p><i>[2022-07-17; Daniel comments]</i></p>

<p>
The below suggested wording follows the existing style used in the specification of <tt>insert</tt>
and <tt>insert_range</tt>, for example. Unfortunately, this existing practice violates the usual
wording style that a <i>Cpp17XXX</i> requirement shall be <em>met</em> and that we should better
say that "lvalues of type <tt>T</tt> are swappable (16.4.4.3 <a href="https://wg21.link/swappable.requirements">[swappable.requirements]</a>)" to 
be clearer about the specific swappable context. A separate editorial issue will be reported to take
care of this problem.
</p>

<p><i>[2022-08-23; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after five votes in favour during reflector poll.
</p>

<p><strong>Previous resolution [SUPERSEDED]:</strong></p>
<blockquote class="note">
<p>
This wording is relative to <a href="https://wg21.link/N4910">N4910</a>.
</p>

<ol>
<li><p>Modify 24.2.4 <a href="https://wg21.link/sequence.reqmts">[sequence.reqmts]</a> as indicated:</p>

<blockquote>
<pre>
a.prepend_range(rg)
</pre>
<blockquote>
<p>
-94- <i>Result:</i> <tt>void</tt>
<p/>
-95- <i>Preconditions:</i> <tt>T</tt> is <i>Cpp17EmplaceConstructible</i> into <tt>X</tt> 
from <tt>*ranges::begin(rg)</tt>. <ins>For <tt>deque</tt>, <tt>T</tt> is also 
<tt>Cpp17MoveInsertable</tt> into <tt>X</tt>, <i>Cpp17MoveConstructible</i>, 
<i>Cpp17MoveAssignable</i>, and swappable (16.4.4.3 <a href="https://wg21.link/swappable.requirements">[swappable.requirements]</a>).</ins>
<p/>
-96- <i>Effects:</i> Inserts copies of elements in <tt>rg</tt> before <tt>begin()</tt>. 
Each iterator in the range <tt>rg</tt> is dereferenced exactly once.
<p/>
[<i>Note 3</i>: The order of elements in <tt>rg</tt> is not reversed. &mdash; <i>end note</i>]
<p/>
-97- <i>Remarks:</i> Required for <tt>deque</tt>, <tt>forward_list</tt>, and <tt>list</tt>.
</p>
</blockquote>
</blockquote>
</li>

</ol>
</blockquote>

<p><i>[2022-11-07; Daniel reopens and comments]</i></p>

<p>
The proposed wording has two problems:
</p>
<ol>
<li><p>It still uses "swappable" instead of "swappable lvalues", which
with the (informal) acceptance of <a href="https://isocpp.org/files/papers/P2696R0.html">P2696R0</a>
should now become <i>Cpp17Swappable</i>.</p></li>
<li><p>It uses an atypical form to say "<tt>T</tt> (is) <i>Cpp17MoveConstructible</i>,
<i>Cpp17MoveAssignable</i>" instead of the more correct form "<tt>T</tt> meets the
<i>Cpp17MoveConstructible</i> and <i>Cpp17MoveAssignable</i> requirements". This
form was also corrected by <a href="https://isocpp.org/files/papers/P2696R0.html">P2696R0</a>.</p></li>
</ol>
<p>
The revised wording uses the <a href="https://isocpp.org/files/papers/P2696R0.html">P2696R0</a>
wording approach to fix both problems.
</p>

<p><i>[Kona 2022-11-12; Set priority to 2]</i></p>



<p><i>[2022-11-30; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after five votes in favour during reflector poll.
</p>



<p id="res-3742"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N4917">N4917</a> <b>assuming that <a href="https://isocpp.org/files/papers/P2696R0.html">P2696R0</a>
has been accepted</b>.
</p>

<ol>
<li><p>Modify 24.2.4 <a href="https://wg21.link/sequence.reqmts">[sequence.reqmts]</a> as indicated:</p>

<blockquote>
<pre>
a.prepend_range(rg)
</pre>
<blockquote>
<p>
-94- <i>Result:</i> <tt>void</tt>
<p/>
-95- <i>Preconditions:</i> <tt>T</tt> is <i>Cpp17EmplaceConstructible</i> into <tt>X</tt> 
from <tt>*ranges::begin(rg)</tt>. <ins>For <tt>deque</tt>, <tt>T</tt> is also 
<tt>Cpp17MoveInsertable</tt> into <tt>X</tt>, and <tt>T</tt> meets the <i>Cpp17MoveConstructible</i>, 
<i>Cpp17MoveAssignable</i>, and <i>Cpp17Swappable</i> (16.4.4.3 <a href="https://wg21.link/swappable.requirements">[swappable.requirements]</a>) requirements.</ins>
<p/>
-96- <i>Effects:</i> Inserts copies of elements in <tt>rg</tt> before <tt>begin()</tt>. 
Each iterator in the range <tt>rg</tt> is dereferenced exactly once.
<p/>
[<i>Note 3</i>: The order of elements in <tt>rg</tt> is not reversed. &mdash; <i>end note</i>]
<p/>
-97- <i>Remarks:</i> Required for <tt>deque</tt>, <tt>forward_list</tt>, and <tt>list</tt>.
</p>
</blockquote>
</blockquote>
</li>

</ol>





<hr>
<h3><a name="3819" href="#3819">3819</a><sup><a href="https://cplusplus.github.io/LWG/issue3819">(i)</a></sup>. <tt>reference_<i>meow</i>s_from_temporary</tt> should not use <tt>is_<i>meow</i>ible</tt></h3>
<p><b>Section:</b> 21.3.5.4 <a href="https://wg21.link/meta.unary.prop">[meta.unary.prop]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Tim Song <b>Opened:</b> 2022-11-08 <b>Last modified:</b> 2022-11-10</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View other</b> <a href="lwg-index-open.html#meta.unary.prop">active issues</a> in [meta.unary.prop].</p>
<p><b>View all other</b> <a href="lwg-index.html#meta.unary.prop">issues</a> in [meta.unary.prop].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
The intent of <a href="https://wg21.link/P2255R2">P2255R2</a> is for the <tt>reference_<i>meow</i>s_from_temporary</tt> traits 
to fully support cases where a prvalue is used as the source. Unfortunately the wording fails 
to do so because it tries to use the <tt>is_<i>meow</i>ible</tt> traits to say 
"the initialization is well-formed", but those traits only consider initialization from xvalues, 
not prvalues. For example, given:
</p>
<blockquote>
<pre>
struct U {
  U();
  U(U&amp;&amp;) = delete;
};

struct T {
  T(U);
};
</pre>
</blockquote>
<p>
<tt>reference_constructs_from_temporary_v&lt;const T&amp;, U&gt;</tt> should be true, but is currently defined as <tt>false</tt>. 
We need to spell out the "is well-formed" condition directly.
</p>

<p><i>[Kona 2022-11-08; Move to Tentatively Ready]</i></p>




<p id="res-3819"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N4917">N4917</a>.
</p>

<blockquote class="note">
<p>
[<i>Drafting note:</i> The note is already repeated every time we talk about "immediate context".]
</p>
</blockquote>

<ol>
<li><p>Modify 21.3.3 <a href="https://wg21.link/meta.type.synop">[meta.type.synop]</a>, Table 46 ([tab:meta.unary.prop]) &mdash; 
"Type property predicates" &mdash; as indicated:</p>

<blockquote>
<table border="1">
<caption>Table 46: Type property predicates [tab:meta.unary.prop]</caption>
<tr>
<th align="center">Template</th>
<th align="center">Condition</th>
<th align="center">Preconditions</th>
</tr>

<tr>
<td colspan="3" align="center">
<tt>&hellip;</tt>
</td>
</tr>

<tr>
<td>
<tt>template&lt;class T, class U&gt;<br/>
struct reference_constructs_from_temporary;</tt>
</td>

<td>
<del><tt>conjunction_v&lt;is_reference&lt;T&gt;, is_constructible&lt;T, U&gt;&gt;</tt> is
<tt>true</tt></del><ins><tt>T</tt> is a reference type</ins>,
and the initialization <tt>T t(<i>VAL</i>&lt;U&gt;);</tt> <ins>is well-formed and</ins> binds <tt>t</tt> to a
temporary object whose lifetime is extended (6.7.7 <a href="https://wg21.link/class.temporary">[class.temporary]</a>).
<ins>Access checking is performed as if in a context unrelated to <tt>T</tt> and <tt>U</tt>. 
Only the validity of the immediate context of the variable initialization is considered. 
[<i>Note ?:</i> The initialization can result in effects such as the instantiation of class template 
specializations and function template specializations, the generation of implicitly-defined functions, 
and so on. Such effects are not in the "immediate context" and can result in the program being ill-formed.
<i>&mdash; end note]</i></ins>
</td>

<td>
<tt>T</tt> and <tt>U</tt> shall be complete types, <i>cv</i> <tt>void</tt>, or arrays of unknown bound.
</td>
</tr>

<tr>
<td>
<tt>template&lt;class T, class U&gt;<br/>
struct reference_converts_from_temporary;</tt>
</td>

<td>
<del><tt>conjunction_v&lt;is_reference&lt;T&gt;, is_convertible&lt;U, T&gt;&gt;</tt> is
<tt>true</tt></del><ins><tt>T</tt> is a reference type</ins>, and the initialization
<tt>T t = <i>VAL</i>&lt;U&gt;;</tt> <ins>is well-formed and</ins> binds <tt>t</tt> to a
temporary object whose lifetime is extended (6.7.7 <a href="https://wg21.link/class.temporary">[class.temporary]</a>).
<ins>Access checking is performed as if in a context unrelated to <tt>T</tt> and <tt>U</tt>. 
Only the validity of the immediate context of the variable initialization is considered. 
[<i>Note ?:</i> The initialization can result in effects such as the instantiation of class template 
specializations and function template specializations, the generation of implicitly-defined functions, 
and so on. Such effects are not in the "immediate context" and can result in the program being ill-formed.
<i>&mdash; end note]</i></ins>
</td>

<td>
<tt>T</tt> and <tt>U</tt> shall be complete types, <i>cv</i> <tt>void</tt>, or arrays of unknown bound.
</td>
</tr>

</table>
</blockquote>

</li>
</ol>





<hr>
<h3><a name="3834" href="#3834">3834</a><sup><a href="https://cplusplus.github.io/LWG/issue3834">(i)</a></sup>. Missing <tt>constexpr</tt> for <tt>std::intmax_t</tt> math functions in <tt>&lt;cinttypes&gt;</tt></h3>
<p><b>Section:</b> 31.13.2 <a href="https://wg21.link/cinttypes.syn">[cinttypes.syn]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> George Tokmaji <b>Opened:</b> 2022-11-27 <b>Last modified:</b> 2023-01-06</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
<a href="https://wg21.link/P0533R9">P0533R9</a> adds <tt>constexpr</tt> to math functions in <tt>&lt;cmath&gt;</tt> 
and <tt>&lt;cstdlib&gt;</tt>, which includes <tt>std::abs</tt> and <tt>std::div</tt>. This 
misses the overloads for <tt>std::intmax_t</tt> in <tt>&lt;cinttypes&gt;</tt>, as well as 
<tt>std::imaxabs</tt> and <tt>std::imaxdiv</tt>, which seems like an oversight.
</p>

<p><i>[2023-01-06; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after six votes in favour during reflector poll.
</p>



<p id="res-3834"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N4917">N4917</a>.
</p>

<ol>
<li><p>Modify 31.13.2 <a href="https://wg21.link/cinttypes.syn">[cinttypes.syn]</a>, header <tt>&lt;cinttypes&gt;</tt> synopsis, as indicated:</p>

<blockquote>
<blockquote><pre>
[&hellip;]
namespace std {
  using imaxdiv_t = <i>see below</i>;
  
  <ins>constexpr</ins> intmax_t imaxabs(intmax_t j);
  <ins>constexpr</ins> imaxdiv_t imaxdiv(intmax_t numer, intmax_t denom);
  intmax_t strtoimax(const char* nptr, char** endptr, int base);
  uintmax_t strtoumax(const char* nptr, char** endptr, int base);
  intmax_t wcstoimax(const wchar_t* nptr, wchar_t** endptr, int base);
  uintmax_t wcstoumax(const wchar_t* nptr, wchar_t** endptr, int base);

  <ins>constexpr</ins> intmax_t abs(intmax_t);            // <i>optional, see below</i>
  <ins>constexpr</ins> imaxdiv_t div(intmax_t, intmax_t); // <i>optional, see below</i>
  [&hellip;]
}
[&hellip;]
</pre></blockquote>
<p>
-1- The contents and meaning of the header <tt>&lt;cinttypes&gt;</tt> are the same as the C standard library header
<tt>&lt;inttypes.h&gt;</tt>, with the following changes:
</p>
<ol style="list-style-type: none">
<li><p>(1.1) &mdash; The header <tt>&lt;cinttypes&gt;</tt> includes the header <tt>&lt;cstdint&gt;</tt> 
(17.4.2 <a href="https://wg21.link/cstdint.syn">[cstdint.syn]</a>) instead of <tt>&lt;stdint.h&gt;</tt>, and</p></li>
<li><p>(1.2) &mdash; if and only if the type <tt>intmax_t</tt> designates an extended integer type 
(6.8.2 <a href="https://wg21.link/basic.fundamental">[basic.fundamental]</a>), the following function signatures are added:</p>
<blockquote><pre>
<ins>constexpr</ins> intmax_t abs(intmax_t);
<ins>constexpr</ins> imaxdiv_t div(intmax_t, intmax_t);
</pre></blockquote>
<p>which shall have the same semantics as the function signatures 
<tt><ins>constexpr</ins> intmax_t imaxabs(intmax_t)</tt> and
<tt><ins>constexpr</ins> imaxdiv_t imaxdiv(intmax_t, intmax_t)</tt>, respectively.</p></li>
</ol>

</blockquote>
</li>
</ol>






<hr>
<h3><a name="3839" href="#3839">3839</a><sup><a href="https://cplusplus.github.io/LWG/issue3839">(i)</a></sup>. <tt>range_formatter</tt>'s <tt>set_separator</tt>, <tt>set_brackets</tt>, and <tt>underlying</tt> functions should be <tt>noexcept</tt></h3>
<p><b>Section:</b> 22.14.7.2 <a href="https://wg21.link/format.range.formatter">[format.range.formatter]</a>, 22.14.7.3 <a href="https://wg21.link/format.range.fmtdef">[format.range.fmtdef]</a>, 22.14.9 <a href="https://wg21.link/format.tuple">[format.tuple]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Hewill Kang <b>Opened:</b> 2022-12-11 <b>Last modified:</b> 2023-01-06</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
The <tt>set_separator</tt> and <tt>set_brackets</tt> of <tt>range_formatter</tt> only invoke 
<tt>basic_string_view</tt>'s assignment operator, which is <tt>noexcept</tt>, we should add <tt>noexcept</tt> 
specifications for them.
<p/>
In addition, its <tt>underlying</tt> function returns a reference to the underlying <tt>formatter</tt>, 
which never throws, they should also be <tt>noexcept</tt>.
<p/>
Similar rules apply to <tt><i>range-default-formatter</i></tt> and <tt>formatter</tt>'s <tt>tuple</tt> specialization.
</p>

<p><i>[2023-01-06; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after eight votes in favour during reflector poll.
</p>



<p id="res-3839"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N4917">N4917</a>.
</p>

<ol>
<li><p>Modify 22.14.7.2 <a href="https://wg21.link/format.range.formatter">[format.range.formatter]</a> as indicated:</p>

<blockquote>
<blockquote>
<pre>
namespace std {
  template&lt;class T, class charT = char&gt;
    requires same_as&lt;remove_cvref_t&lt;T&gt;, T&gt; &amp;&amp; formattable&lt;T, charT&gt;
  class range_formatter {
    formatter&lt;T, charT&gt; <i>underlying_</i>;                                          // <i>exposition only</i>
    basic_string_view&lt;charT> <i>separator_</i> = <i>STATICALLY-WIDEN</i>&lt;charT&gt;(", ");      // <i>exposition only</i>
    basic_string_view&lt;charT> <i>opening-bracket_</i> = <i>STATICALLY-WIDEN</i>&lt;charT&gt;("["); // <i>exposition only</i>
    basic_string_view&lt;charT> <i>closing-bracket_</i> = <i>STATICALLY-WIDEN</i>&lt;charT&gt;("]"); // <i>exposition only</i>

  public:
    constexpr void set_separator(basic_string_view&lt;charT&gt; sep) <ins>noexcept</ins>;
    constexpr void set_brackets(basic_string_view&lt;charT&gt; opening,
                                basic_string_view&lt;charT&gt; closing) <ins>noexcept</ins>;
    constexpr formatter&lt;T, charT&gt;&amp; underlying() <ins>noexcept</ins> { return <i>underlying_</i>; }
    constexpr const formatter&lt;T, charT&gt;&amp; underlying() const <ins>noexcept</ins> { return <i>underlying_</i>; }

    [&hellip;]
  };
}
</pre>
</blockquote>
[&hellip;]
<pre>
constexpr void set_separator(basic_string_view&lt;charT&gt; sep) <ins>noexcept</ins>;
</pre>
<blockquote>
<p>
-7- <i>Effects:</i> Equivalent to: <tt><i>separator_</i> = sep;</tt>
</p>
</blockquote>
<pre>
constexpr void set_brackets(basic_string_view&lt;charT&gt; opening, basic_string_view&lt;charT&gt; closing) <ins>noexcept</ins>;
</pre>
<blockquote>
<p>
-8- <i>Effects:</i> Equivalent to:
<pre>
<i>opening-bracket_</i> = opening;
<i>closing-bracket_</i> = closing;
</pre>
</p>
</blockquote>
</blockquote>
</li>

<li><p>Modify 22.14.7.3 <a href="https://wg21.link/format.range.fmtdef">[format.range.fmtdef]</a> as indicated:</p>
  
<blockquote>
<blockquote>
<pre>
namespace std {
  template&lt;ranges::input_range R, class charT&gt;
  struct <i>range-default-formatter</i>&lt;range_format::sequence, R, charT&gt; {    // <i>exposition only</i>
  private:
    using <i>maybe-const-r</i> = <i>fmt-maybe-const</i>&lt;R, charT&gt;;                    // <i>exposition only</i>
    range_formatter&lt;remove_cvref_t&lt;ranges::range_reference_t&lt;<i>maybe-const-r</i>&gt;&gt;,
                    charT&gt; <i>underlying_</i>;                                 // <i>exposition only</i>

  public:
    constexpr void set_separator(basic_string_view&lt;charT&gt; sep) <ins>noexcept</ins>;
    constexpr void set_brackets(basic_string_view&lt;charT&gt; opening,
                                basic_string_view&lt;charT&gt; closing) <ins>noexcept</ins>;
  
    [&hellip;]
  };
}
</pre>
</blockquote>
<pre>
constexpr void set_separator(basic_string_view&lt;charT&gt; sep) <ins>noexcept</ins>;
</pre>
<blockquote>
<p>
-1- <i>Effects:</i> Equivalent to: <tt><i>underlying_</i>.set_separator(sep);</tt>.
</p>
</blockquote>
<pre>
constexpr void set_brackets(basic_string_view&lt;charT&gt; opening, basic_string_view&lt;charT&gt; closing) <ins>noexcept</ins>;
</pre>
<blockquote>
<p>
-2- <i>Effects:</i> Equivalent to: <tt><i>underlying_</i>.set_brackets(opening, closing);</tt>.
</p>
</blockquote>
</blockquote>
</li>

<li><p>Modify 22.14.9 <a href="https://wg21.link/format.tuple">[format.tuple]</a> as indicated:</p>
<blockquote>
<blockquote>
<pre>
namespace std {
  template&lt;class charT, formattable&lt;charT&gt;... Ts&gt;
  struct formatter&lt;<i>pair-or-tuple</i>&lt;Ts...&gt;, charT&gt; {
  private:
    tuple&lt;formatter&lt;remove_cvref_t&lt;Ts&gt;, charT&gt;...&gt; <i>underlying_</i>;               // <i>exposition only</i>
    basic_string_view&lt;charT> <i>separator_</i> = <i>STATICALLY-WIDEN</i>&lt;charT&gt;(", ");      // <i>exposition only</i>
    basic_string_view&lt;charT> <i>opening-bracket_</i> = <i>STATICALLY-WIDEN</i>&lt;charT&gt;("("); // <i>exposition only</i>
    basic_string_view&lt;charT> <i>closing-bracket_</i> = <i>STATICALLY-WIDEN</i>&lt;charT&gt;(")"); // <i>exposition only</i>

  public:
    constexpr void set_separator(basic_string_view&lt;charT&gt; sep) <ins>noexcept</ins>;
    constexpr void set_brackets(basic_string_view&lt;charT&gt; opening,
                                basic_string_view&lt;charT&gt; closing) <ins>noexcept</ins>;

    [&hellip;]
  };
}
</pre>
</blockquote>
[&hellip;]
<pre>
constexpr void set_separator(basic_string_view&lt;charT&gt; sep) <ins>noexcept</ins>;
</pre>
<blockquote>
<p>
-5- <i>Effects:</i> Equivalent to: <tt><i>separator_</i> = sep;</tt>
</p>
</blockquote>
<pre>
constexpr void set_brackets(basic_string_view&lt;charT&gt; opening, basic_string_view&lt;charT&gt; closing) <ins>noexcept</ins>;
</pre>
<blockquote>
<p>
-6- <i>Effects:</i> Equivalent to:
<pre>
<i>opening-bracket_</i> = opening;
<i>closing-bracket_</i> = closing;
</pre>
</p>
</blockquote>
</blockquote>
</li>
</ol>






<hr>
<h3><a name="3841" href="#3841">3841</a><sup><a href="https://cplusplus.github.io/LWG/issue3841">(i)</a></sup>. <tt>&lt;version&gt;</tt> should not be "<i>all freestanding</i>"</h3>
<p><b>Section:</b> 17.3.2 <a href="https://wg21.link/version.syn">[version.syn]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Jonathan Wakely <b>Opened:</b> 2022-12-14 <b>Last modified:</b> 2023-01-06</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View other</b> <a href="lwg-index-open.html#version.syn">active issues</a> in [version.syn].</p>
<p><b>View all other</b> <a href="lwg-index.html#version.syn">issues</a> in [version.syn].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
It's reasonable for the <tt>&lt;version&gt;</tt> header to be required for freestanding, 
so that users can include it and see the "implementation-dependent information &hellip; 
(e.g. version number and release date)", and also to ask which features are present 
(which is the real intended purpose of <tt>&lt;version&gt;</tt>). 
It seems less reasonable to require every macro to be present on freestanding implementations, 
even the ones that correspond to non-freestanding features.
<p/>
<a href="https://wg21.link/P2198R7">P2198R7</a> will fix this situation for C++26, but we should also do something for 
C++23 before publishing it. 
It seems sensible not to require any of the macros to be present, and then allow implementations 
to define them for the features that they support.
</p>

<p><i>[2023-01-06; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after eight votes in favour during reflector poll.
</p>



<p id="res-3841"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N4917">N4917</a>.
</p>

<ol>
<li><p>Modify 17.3.2 <a href="https://wg21.link/version.syn">[version.syn]</a>, header <tt>&lt;version&gt;</tt> synopsis, as indicated:</p>

<blockquote>
<p>
-2- Each of the macros defined in <tt>&lt;version&gt;</tt> is also defined after inclusion of any member 
of the set of library headers indicated in the corresponding comment in this synopsis.
<p/>
[<i>Note 1</i>: Future revisions of C++ might replace the values of these macros with greater values. &mdash; <i>end note</i>]
</p>
<blockquote><pre>
<del><i>// all freestanding</i></del>
#define __cpp_lib_addressof_constexpr          201603L // also in &lt;memory&gt;
[&hellip;]
</pre></blockquote>
</blockquote>
</li>
</ol>






<hr>
<h3><a name="3842" href="#3842">3842</a><sup><a href="https://cplusplus.github.io/LWG/issue3842">(i)</a></sup>. Unclear wording for <i>precision</i> in <i>chrono-format-spec</i></h3>
<p><b>Section:</b> 29.12 <a href="https://wg21.link/time.format">[time.format]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Jonathan Wakely <b>Opened:</b> 2022-12-14 <b>Last modified:</b> 2023-01-06</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View other</b> <a href="lwg-index-open.html#time.format">active issues</a> in [time.format].</p>
<p><b>View all other</b> <a href="lwg-index.html#time.format">issues</a> in [time.format].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
29.12 <a href="https://wg21.link/time.format">[time.format]</a> says:
</p>
<blockquote><p>
[&hellip;] Giving a <i>precision</i> specification in the <i>chrono-format-spec</i> is valid only for 
<tt>std::chrono::duration</tt> types where the representation type
<tt>Rep</tt> is a floating-point type. 
For all other <tt>Rep</tt> types, an exception of type <tt>format_error</tt> is thrown if the 
<i>chrono-format-spec</i> contains a <i>precision</i> specification. [&hellip;]
</p></blockquote>
<p>
It's unclear whether the restriction in the first sentence applies to all types, or only duration types. 
The second sentence seems to restrict the exceptional case to only types with a non-floating-point <tt>Rep</tt>, 
but what about types with no <tt>Rep</tt> type at all?
<p/>
Can you use a precision with <tt>sys_time&lt;duration&lt;float&gt;&gt;</tt>? That is not a <tt>duration</tt> type at all, 
so does the restriction apply? What about <tt>hh_mm_ss&lt;duration&lt;int&gt;&gt;</tt>? That's not a 
<tt>duration</tt> type, but it uses one, and its <tt>Rep</tt> is not a floating-point type. 
What about <tt>sys_info</tt>? That's not a <tt>duration</tt> and doesn't have any associated <tt>duration</tt>, 
or <tt>Rep</tt> type.
<p/>
What is the intention here?
<p/>
Less importantly, I don't like the use of <tt>Rep</tt> here. That's the template parameter of the 
<tt>duration</tt> class template, but that name isn't in scope here. Why aren't we talking about the 
<tt>duration</tt> type's <tt>rep</tt> type, which is the public name for it? Or about a concrete 
specialization <tt>duration&lt;Rep, Period&gt;</tt>, instead of the class template?
<p/>
The suggested change below would preserve the intended meaning, but with more &hellip; <i>precision</i>.
</p>

<p><i>[2023-01-06; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after eight votes in favour during reflector poll.
</p>



<p id="res-3842"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N4917">N4917</a>.
</p>

<ol>
<li><p>Modify 29.12 <a href="https://wg21.link/time.format">[time.format]</a> as indicated:</p>

<blockquote>
<p>
-1- [&hellip;]
<p/>
The productions <i>fill-and-align</i>, <i>width</i>, and <i>precision</i> are described in 22.14.2 <a href="https://wg21.link/format.string">[format.string]</a>. 
Giving a <i>precision</i> specification in the <i>chrono-format-spec</i> is valid only for 
<ins>types that are specializations of</ins> <tt>std::chrono::duration</tt> <del>types where the representation type
<tt>Rep</tt> is</del><ins>for which the nested <i>typedef-name</i> <tt>rep</tt> denotes</ins> a floating-point type. 
For all other <del><tt>Rep</tt></del> types, an exception of type <tt>format_error</tt> is thrown if the 
<i>chrono-format-spec</i> contains a <i>precision</i> specification. [&hellip;]

</p>
</blockquote>
</li>
</ol>






</body>
</html>
