<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>C++ Standard Library Tentative Issues</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
  @media (prefers-color-scheme: dark) {
     html {
        color: #ddd;
        background-color: black;
     }
     ins {
        background-color: #225522
     }
     del {
        background-color: #662222
     }
     a {
        color: #6af
     }
     a:visited {
        color: #6af
     }
     blockquote.note
     {
        background-color: rgba(255, 255, 255, .10)
     }
  }
</style>
</head>
<body>
<p><p>Revised 2022-05-14 at 12:02:08 UTC</p>
</p><h2>Tentative Issues</h2>
<hr>
<h3><a name="3579" href="#3579">3579</a><sup><a href="https://cplusplus.github.io/LWG/issue3579">(i)</a></sup>. Complexity guarantees for <tt>resize()</tt> and <tt>append()</tt> functions across the library</h3>
<p><b>Section:</b> 23.4.3.5 <a href="https://wg21.link/string.capacity">[string.capacity]</a>, 24.3.8.3 <a href="https://wg21.link/deque.capacity">[deque.capacity]</a>, 24.3.10.3 <a href="https://wg21.link/list.capacity">[list.capacity]</a>, 24.3.11.3 <a href="https://wg21.link/vector.capacity">[vector.capacity]</a>, 24.3.9.5 <a href="https://wg21.link/forward.list.modifiers">[forward.list.modifiers]</a>, 28.6.2.8 <a href="https://wg21.link/valarray.members">[valarray.members]</a>, 23.4.3.7.2 <a href="https://wg21.link/string.append">[string.append]</a>, 31.12.6.5.3 <a href="https://wg21.link/fs.path.append">[fs.path.append]</a> <b>Status:</b> <a href="lwg-active.html#NAD">Tentatively NAD</a>
 <b>Submitter:</b> Louis Dionne <b>Opened:</b> 2021-08-11 <b>Last modified:</b> 2022-02-26</p>
<p><b>Priority: </b>3
</p>
<p><b>View other</b> <a href="lwg-index-open.html#string.capacity">active issues</a> in [string.capacity].</p>
<p><b>View all other</b> <a href="lwg-index.html#string.capacity">issues</a> in [string.capacity].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively NAD">Tentatively NAD</a> status.</p>
<p><b>Discussion:</b></p>
<p>
This issue requests to clarify the complexity requirements for <tt>resize</tt> and <tt>append</tt> 
member functions across the library. Currently, none of them have complexity requirements associated to them, 
which means that implementations are free to use a geometric growth approach or not. A geometric growth 
approach (like what's required by <tt>push_back</tt>) implies that calling <tt>resize/append</tt> with 
successively larger sizes will have amortized <tt>&#x1d4aa;(<i>N</i>)</tt> complexity, whereas using a 
<tt>resize</tt>-exactly approach makes that pattern <tt>&#x1d4aa;(<i>N</i><sup>2</sup>)</tt>.
<p/>
I believe the Standard should either specify that those member functions are required to have behavior that 
is consistent with <tt>push_back</tt>, or explicitly mention that implementations are allowed to use whatever 
growth strategy they want. If we do the former, users could start relying on this guarantee in a portable manner. 
If we do the latter, it would make it clear to users that they should not rely on the amortized 
<tt>&#x1d4aa;(<i>N</i>)</tt> guarantee if they want their code to be portable.
<p/>
The following classes have a <tt>resize()</tt> member function and also a <tt>push_back()</tt> member function:
</p>
<ul>
<li><p>23.4.3.5 <a href="https://wg21.link/string.capacity">[string.capacity]</a></p></li>
<li><p>24.3.8.3 <a href="https://wg21.link/deque.capacity">[deque.capacity]</a></p></li>
<li><p>24.3.10.3 <a href="https://wg21.link/list.capacity">[list.capacity]</a></p></li>
<li><p>24.3.11.3 <a href="https://wg21.link/vector.capacity">[vector.capacity]</a></p></li>
</ul>
<p>
The following classes have a <tt>resize()</tt> member function but do not support <tt>push_back()</tt>:
</p>
<ul>
<li><p>24.3.9.5 <a href="https://wg21.link/forward.list.modifiers">[forward.list.modifiers]</a></p></li>
<li><p>28.6.2.8 <a href="https://wg21.link/valarray.members">[valarray.members]</a></p></li>
</ul>
<p>
The following classes have an <tt>append()</tt> member function:
</p>
<ul>
<li><p>23.4.3.7.2 <a href="https://wg21.link/string.append">[string.append]</a></p></li>
<li><p>31.12.6.5.3 <a href="https://wg21.link/fs.path.append">[fs.path.append]</a></p></li>
</ul>
<p>
None of them specify a complexity requirement. I think we should update all of them to describe 
what is expected or permitted in an implementation.
</p>

<p><i>[2021-08-20; Reflector poll]</i></p>

<p>
Set priority to 3 and status to "LEWG" after reflector poll.
</p>

<p><i>[2022-02-22 LEWG telecon;  Status changed: LEWG &rarr; Tentatively NAD.]</i></p>

<p>
A paper would be needed.
Such a paper would need to include discussion on whether
<code>allocate_at_least</code> (new for C++23) has an impact.
</p>



<p><b>Proposed resolution:</b></p>





<hr>
<h3><a name="3649" href="#3649">3649</a><sup><a href="https://cplusplus.github.io/LWG/issue3649">(i)</a></sup>. [fund.ts.v3] Reinstate and bump <tt>__cpp_lib_experimental_memory_resource</tt> feature test macro</h3>
<p><b>Section:</b> 1.5 [fund.ts.v3::general.feature.test] <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Thomas K&ouml;ppe <b>Opened:</b> 2021-12-03 <b>Last modified:</b> 2022-02-14</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p><b>Addresses: fund.ts.v3</b></p>
<p>
The rebase on C++17 in <a href="https://wg21.link/P0996">P0996</a> had the effect of deleting the feature test macro 
<tt>__cpp_lib_experimental_memory_resource</tt>: the macro was ostensibly tied to the 
<tt>memory_resource</tt> facility that had become part of C++17, but we overlooked that there 
was a residual piece that has not been adopted in the IS, namely the <tt>resource_adaptor</tt> 
class template.
<p/>
It is still useful to be able to detect the presence of <tt>resource_adaptor</tt>, so we should 
reinstate the feature test macro and bump its value.
</p>

<p><i>[2022-01-30; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after six votes in favour during reflector poll.
</p>



<p><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N4853">N4853</a>.
</p>

<ol>

<li><p>Modify 1.5 [fund.ts.v3::general.feature.test], Table 2, as indicated:</p>

<blockquote>
<table border="1">
<caption>Table 2 &mdash; Significant features in this technical specification</caption>
<tr style="text-align:center">
<th>Doc. No.</th>
<th>Title</th>
<th>Primary<br/>Section</th>
<th>Macro Name Suffix</th>
<th>Value</th>
<th>Header</th>
</tr>
<tr>
<td colspan="6" align="center">
<tt>&hellip;</tt>
</td>
</tr>

<tr>
<td>N3916</td>
<td>Type-erased allocator for std::function</td>
<td>4.2</td>
<td><tt>function_erased_allocator</tt></td>
<td><tt>201406</tt></td>
<td><tt>&lt;experimental/functional&gt;</tt></td>
</tr>

<tr>
<td><ins>N3916</ins></td>
<td><ins>Polymorphic Memory Resources</ins></td>
<td><ins>5.4 [fund.ts.v3::memory.resource.syn]</ins></td>
<td><ins><tt>memory_resources</tt></ins></td>
<td><ins><i>[new value]</i></ins></td>
<td><ins><tt>&lt;experimental/memory_resource&gt;</tt></ins></td>
</tr>

<tr>
<td>N4282</td>
<td>The World's Dumbest Smart Pointer</td>
<td>8.12</td>
<td><tt>observer_ptr</tt></td>
<td><tt>201411</tt></td>
<td><tt>&lt;experimental/memory&gt;</tt></td>
</tr>

<tr>
<td colspan="6" align="center">
<tt>&hellip;</tt>
</td>
</tr>
</table>
</blockquote>
</li>

</ol>





<hr>
<h3><a name="3667" href="#3667">3667</a><sup><a href="https://cplusplus.github.io/LWG/issue3667">(i)</a></sup>. <tt>std::cout &lt;&lt; &amp;X::f</tt> prints <tt>1</tt></h3>
<p><b>Section:</b> 31.7.5.3 <a href="https://wg21.link/ostream.formatted">[ostream.formatted]</a> <b>Status:</b> <a href="lwg-active.html#NAD">Tentatively NAD</a>
 <b>Submitter:</b> Peter Dimov <b>Opened:</b> 2022-01-31 <b>Last modified:</b> 2022-03-05</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively NAD">Tentatively NAD</a> status.</p>
<p><b>Discussion:</b></p>
<p>
At present, the program
</p>
<blockquote><pre>
#include &lt;iostream&gt;

struct X
{
  void f() {}
};

int main()
{
  std::cout &lt;&lt; &amp;X::f;
}
</pre></blockquote>
<p>
prints <tt>1</tt>. That's because member pointers implicitly convert
to <tt>bool</tt>, and there's <tt>operator&lt;&lt;</tt> overload for <tt>bool</tt> in
31.7.5.3.2 <a href="https://wg21.link/ostream.inserters.arithmetic">[ostream.inserters.arithmetic]</a>.
<p/>
This behavior is rarely useful. In C++20, we added deleted
overloads to prevent a similar counter-intuitive output for
the case in which e.g. <tt>L"str"</tt> is output to <tt>std::cout</tt>,
which used to print the pointer value using the <tt>operator&lt;&lt;</tt>
overload for <tt>const void*</tt>.
<p/>
We should similarly consider adding a deleted overload for member pointers.
</p>

<p><i>[2022-03-04; Reflector poll; Status changed: New &rarr; Tentatively NAD]</i></p>

<p>
 Needs a paper to LEWG if anything should change here.
</p>


<p><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N4901">N4901</a>.
</p>

<ol>
<li><p>Modify 31.7.5.2.1 <a href="https://wg21.link/ostream.general">[ostream.general]</a>, class template <tt>basic_ostream</tt> synopsis, as indicated:</p>

<blockquote>
<pre>
namespace std {
  [&hellip;]
  
  template&lt;class traits&gt;
    basic_ostream&lt;wchar_t, traits&gt;&amp;
      operator&lt;&lt;(basic_ostream&lt;wchar_t, traits&gt;&amp;, const char16_t*) = delete;
  template&lt;class traits&gt;
    basic_ostream&lt;wchar_t, traits&gt;&amp;
      operator&lt;&lt;(basic_ostream&lt;wchar_t, traits&gt;&amp;, const char32_t*) = delete;
      
  <ins>template&lt;class charT, class traits, class T, class C&gt;
    basic_ostream&lt;charT, traits&gt;&amp; 
      operator&lt;&lt;(basic_ostream&lt;charT, traits&gt;&amp;, T C::*) = delete;</ins>
}
</pre>
</blockquote>
</li>
</ol>





<hr>
<h3><a name="3670" href="#3670">3670</a><sup><a href="https://cplusplus.github.io/LWG/issue3670">(i)</a></sup>. <i>Cpp17InputIterator</i>s don't have integer-class difference types</h3>
<p><b>Section:</b> 26.6.4.3 <a href="https://wg21.link/range.iota.iterator">[range.iota.iterator]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Casey Carter <b>Opened:</b> 2022-02-04 <b>Last modified:</b> 2022-03-05</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all other</b> <a href="lwg-index.html#range.iota.iterator">issues</a> in [range.iota.iterator].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
26.6.4.3 <a href="https://wg21.link/range.iota.iterator">[range.iota.iterator]</a> defines 
</p>
<blockquote><pre>
using iterator_category = input_iterator_tag; <i>// present only if W models incrementable</i>
</pre></blockquote>
<p>
but when <tt>difference_type</tt> is an integer-class type the iterator does not meet the 
<i>Cpp17InputIterator</i> requirements.
</p>

<p><i>[2022-02-07; Daniel comments]</i></p>

<p>
As requested by LWG <a href="lwg-defects.html#3376">3376</a> and wording implemented by <a href="https://wg21.link/P2393R1">P2393R1</a>,
integer-class types are no longer required to have class type.
</p>

<p>
<strong>Previous resolution [SUPERSEDED]:</strong>
</p>
<blockquote class="note">
<p>
This wording is relative to <a href="https://wg21.link/N4901">N4901</a>.
</p>

<ol>
<li><p>Modify 26.6.4.3 <a href="https://wg21.link/range.iota.iterator">[range.iota.iterator]</a>, class <tt>iota_view::<i>iterator</i></tt> synopsis, as indicated:</p>

<blockquote>
<pre>
namespace std::ranges {
  template&lt;weakly_incrementable W, semiregular Bound&gt;
    requires <i>weakly-equality-comparable-with</i>&lt;W, Bound&gt; &amp;&amp; copyable&lt;W&gt;
  struct iota_view&lt;W, Bound&gt;::<i>iterator</i> {
    [&hellip;]
    using iterator_category = input_iterator_tag; <i>// present only if W models incrementable <ins>and</ins></i> 
                                                  <i><ins>// IOTA-DIFF-T(W) is not a class type</ins></i>
    using value_type = W;
    using difference_type = <i>IOTA-DIFF-T</i>(W);
    [&hellip;]
  };
}
</pre>
</blockquote>
</li>
</ol>
</blockquote>

<p><i>[2022-02-07; Casey Carter provides improved wording]</i></p>


<p><i>[2022-03-04; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after seven votes in favour during reflector poll.
</p>



<p><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N4901">N4901</a>.
</p>

<ol>
<li><p>Modify 26.6.4.3 <a href="https://wg21.link/range.iota.iterator">[range.iota.iterator]</a>, class <tt>iota_view::<i>iterator</i></tt> synopsis, as indicated:</p>

<blockquote>
<pre>
namespace std::ranges {
  template&lt;weakly_incrementable W, semiregular Bound&gt;
    requires <i>weakly-equality-comparable-with</i>&lt;W, Bound&gt; &amp;&amp; copyable&lt;W&gt;
  struct iota_view&lt;W, Bound&gt;::<i>iterator</i> {
    [&hellip;]
    using iterator_category = input_iterator_tag; <i>// present only if W models incrementable <ins>and</ins></i> 
                                                  <i><ins>// IOTA-DIFF-T(W) is an integral type</ins></i>
    using value_type = W;
    using difference_type = <i>IOTA-DIFF-T</i>(W);
    [&hellip;]
  };
}
</pre>
</blockquote>
</li>
</ol>





<hr>
<h3><a name="3671" href="#3671">3671</a><sup><a href="https://cplusplus.github.io/LWG/issue3671">(i)</a></sup>. <tt>atomic_fetch_xor</tt> missing from <tt>stdatomic.h</tt></h3>
<p><b>Section:</b> 33.5.12 <a href="https://wg21.link/stdatomic.h.syn">[stdatomic.h.syn]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Hubert Tong <b>Opened:</b> 2022-02-09 <b>Last modified:</b> 2022-03-05</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
<a href="https://web.archive.org/web/20181230041359/http://www.open-std.org/jtc1/sc22/wg14/www/abq/c17_updated_proposed_fdis.pdf#page=208">C17 subclause 7.17.7.5</a> provides <tt>atomic_fetch_xor</tt> and <tt>atomic_fetch_xor_explicit</tt>.
<tt>stdatomic.h</tt> in the working draft (<a href="https://wg21.link/N4901">N4901</a>) does not.
</p>

<p><i>[2022-02-09; Jonathan comments and provides wording]</i></p>

<p>
C++20 33.5.2 <a href="https://wg21.link/atomics.syn">[atomics.syn]</a> has both of them, too, so it should definitely be in the common subset.
</p>

<p><i>[2022-03-04; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after eight votes in favour during reflector poll.
</p>



<p><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N4901">N4901</a>.
</p>

<ol>
<li><p>Modify 33.5.12 <a href="https://wg21.link/stdatomic.h.syn">[stdatomic.h.syn]</a>, header <tt>&lt;stdatomic.h&gt;</tt> synopsis, as indicated:</p>

<blockquote class="note">
<p>
[<i>Drafting Note:</i> The editor is kindly requested to reorder these "<tt>atomic_fetch_<i>KEY</i></tt>" 
declarations to match the other synopses in Clause 33.5 <a href="https://wg21.link/atomics">[atomics]</a>: <tt>add</tt>, <tt>sub</tt>, 
<tt>and</tt>, <tt>or</tt>, <tt>xor</tt>.] 
</p>
</blockquote>

<blockquote>
<pre>
[&hellip;]
using std::atomic_fetch_or;                    <i>// see below</i>
using std::atomic_fetch_or_explicit;           <i>// see below</i>
<ins>using std::atomic_fetch_xor;                   <i>// see below</i>
using std::atomic_fetch_xor_explicit;          <i>// see below</i></ins>
using std::atomic_fetch_and;                   <i>// see below</i>
using std::atomic_fetch_and_explicit;          <i>// see below</i>
[&hellip;]
</pre>
</blockquote>
</li>
</ol>





<hr>
<h3><a name="3672" href="#3672">3672</a><sup><a href="https://cplusplus.github.io/LWG/issue3672">(i)</a></sup>. <tt>common_iterator::operator-&gt;()</tt> should return by value</h3>
<p><b>Section:</b> 25.5.4.4 <a href="https://wg21.link/common.iter.access">[common.iter.access]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Jonathan Wakely <b>Opened:</b> 2022-02-12 <b>Last modified:</b> 2022-03-05</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all other</b> <a href="lwg-index.html#common.iter.access">issues</a> in [common.iter.access].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
25.5.4.4 <a href="https://wg21.link/common.iter.access">[common.iter.access]</a> p5 (5.1) says that <tt>common_iterator&lt;T*, S&gt;::operator-&gt;()</tt> 
returns <tt>std::get&lt;T*&gt;(v_)</tt> which has type <tt>T* const&amp;</tt>. That means that 
<tt>iterator_traits::pointer</tt> is <tt>T* const&amp;</tt> as well (this was recently clarified by LWG 
<a href="lwg-defects.html#3660">3660</a>). We have an actual pointer here, why are we returning it by reference?
<p/>
For the three bullet points in 25.5.4.4 <a href="https://wg21.link/common.iter.access">[common.iter.access]</a> p5, the second and third return by value 
anyway, so <tt>decltype(auto)</tt> is equivalent to <tt>auto</tt>. For the first bullet, it would make a lot 
more sense for raw pointers to be returned by value. That leaves the case where the iterator has an 
<tt>operator-&gt;()</tt> member, which could potentially benefit from returning by reference. But it must 
return something that is iterator-like or pointer-like, which we usually just pass by value. Casey suggested 
we should just change <tt>common_iterator&lt;I, S&gt;::operator-&gt;()</tt> to return by value in all cases.
<p/>
Libstdc++ has always returned by value, as an unintended consequence of using a union instead of 
<tt>std::variant&lt;I, S&gt;</tt>, so that it doesn't use <tt>std::get&lt;I&gt;</tt> to return the member.
</p>

<p><i>[2022-03-04; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after six votes in favour during reflector poll.
</p>



<p><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N4901">N4901</a>.
</p>

<ol>
<li><p>Modify 25.5.4.1 <a href="https://wg21.link/common.iterator">[common.iterator]</a>, class template <tt>common_iterator</tt> synopsis, as indicated:</p>

<blockquote>
<pre>
[&hellip;]
constexpr decltype(auto) operator*();
constexpr decltype(auto) operator*() const
  requires <i>dereferenceable</i>&lt;const I&gt;;
constexpr <del>decltype(</del>auto<del>)</del> operator-&gt;() const
  requires <i>see below</i>;
[&hellip;]
</pre>
</blockquote>
</li>

<li><p>Modify 25.5.4.4 <a href="https://wg21.link/common.iter.access">[common.iter.access]</a> as indicated:</p>

<blockquote>
<pre>
constexpr <del>decltype(</del>auto<del>)</del> operator-&gt;() const
  requires <i>see below</i>;
</pre>
<blockquote>
<p>
-3- The expression in the <i>requires-clause</i> is equivalent to: [&hellip;]
<p/>
-4- <i>Preconditions:</i> <tt>holds_alternative&lt;I&gt;(v_)</tt> is <tt>true</tt>.
<p/>
-5- <i>Effects:</i>
</p>
<ol style="list-style-type:none">
<li><p>(5.1) &mdash; If <tt>I</tt> is a pointer type or if the expression <tt>get&lt;I&gt;(v_).operator-&gt;()</tt> 
is well-formed, equivalent to: <tt>return get&lt;I&gt;(v_);</tt></p></li>
<li><p>(5.2) &mdash; Otherwise, if <tt>iter_reference_t&lt;I&gt;</tt> is a reference type, equivalent to:</p>
<blockquote><pre>
auto&amp;&amp; tmp = *get&lt;I&gt;  (v_);
return addressof(tmp);
</pre></blockquote>
</li>
<li><p>(5.3) &mdash; Otherwise, equivalent to: <tt>return <i>proxy</i>(*get&lt;I&gt;(v_));</tt> where <tt><i>proxy</i></tt> 
is the exposition-only class:</p>
<blockquote><pre>
class <i>proxy</i> {
  iter_value_t&lt;I&gt; keep_;
  constexpr <i>proxy</i>(iter_reference_t&lt;I&gt;&amp;&amp; x)
    : keep_(std::move(x)) {}
public:
  constexpr const iter_value_t&lt;I&gt;* operator-&gt;() const noexcept {
    return addressof(keep_);
  }
};
</pre></blockquote>
</li>
</ol>
</blockquote>
</blockquote>
</li>
</ol>





</body>
</html>
