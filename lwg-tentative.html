<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8">
<title>C++ Standard Library Tentative Issues</title>
<style type="text/css">
  p {text-align:justify}
  li {text-align:justify}
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table {border-collapse: collapse;}
  @media (prefers-color-scheme: dark) {
     html {
        color: #ddd;
        background-color: black;
     }
     ins {
        background-color: #225522
     }
     del {
        background-color: #662222
     }
     a {
        color: #6af
     }
     a:visited {
        color: #6af
     }
     blockquote.note
     {
        background-color: rgba(255, 255, 255, .10)
     }
  }
</style>
</head>
<body>
<p><p>Revised 2022-01-29 at 22:29:44 UTC</p>
</p><h2>Tentative Issues</h2>
<hr>
<h3><a name="3598" href="#3598">3598</a><sup><a href="https://cplusplus.github.io/LWG/issue3598">(i)</a></sup>. <tt>system_category().default_error_condition(0)</tt> is underspecified</h3>
<p><b>Section:</b> 19.5.3.5 <a href="https://wg21.link/syserr.errcat.objects">[syserr.errcat.objects]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Jonathan Wakely <b>Opened:</b> 2021-09-23 <b>Last modified:</b> 2021-10-14</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all other</b> <a href="lwg-index.html#syserr.errcat.objects">issues</a> in [syserr.errcat.objects].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
19.5.3.5 <a href="https://wg21.link/syserr.errcat.objects">[syserr.errcat.objects]</a> says:
</p>
<blockquote><p>
If the argument <tt>ev</tt> corresponds to a POSIX <tt>errno</tt> value <tt>posv</tt>, 
the function shall return <tt>error_condition(posv, generic_category())</tt>. Otherwise, 
the function shall return <tt>error_condition(ev, system_category())</tt>. What constitutes 
correspondence for any given operating system is unspecified.
</p></blockquote>
<p>
What is "a POSIX <tt>errno</tt> value"? Does it mean a value equal to one of the <tt>&lt;cerrno&gt;</tt> 
<tt>Exxx</tt> macros? Because in that case, the value <tt>0</tt> is not "a POSIX <tt>errno</tt> value". 
So arguably <tt>system_category().default_error_condition(0)</tt> is required to return an 
<tt>error_condition</tt> using the "system" category, which means that <tt>error_code{} == error_condition{}</tt> 
is required to be <tt>false</tt>. This seems wrong.
<p/>
For POSIX-based systems the value <tt>0</tt> should definitely correspond to the generic category. 
Arguably that needs to be <tt>true</tt> for all systems, because the <tt>std::error_code</tt> API 
strongly encourages a model where zero means "no error".
<p/>
The proposed resolution has been implemented in libstdc++. Libc++ has always treated system error code 
<tt>0</tt> as corresponding to generic error code <tt>0</tt>.
</p>

<p><i>[2021-10-14; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after six votes in favour during reflector poll.
</p>



<p><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/n4892">N4892</a>.
</p>

<ol>
<li><p>Modify 19.5.3.5 <a href="https://wg21.link/syserr.errcat.objects">[syserr.errcat.objects]</a> as indicated:</p>

<blockquote>
<pre>
const error_category&amp; system_category() noexcept;
</pre>
<blockquote>
<p>
-3- <i>Returns:</i> [&hellip;]
<p/>
-4- <i>Remarks:</i> The object's <tt>equivalent</tt> virtual functions shall behave as specified 
for class <tt>error_category</tt>. The object's <tt>name</tt> virtual function shall return a pointer 
to the string <tt>"system"</tt>. The object's <tt>default_error_condition</tt> virtual function 
shall behave as follows:
<p/>
If the argument <tt>ev</tt> <ins>is equal to <tt>0</tt>, the function returns 
<tt>error_condition(0, generic_category())</tt>. Otherwise, if <tt>ev</tt></ins> corresponds to a POSIX 
<tt>errno</tt> value <tt>posv</tt>, the function <del>shall return</del><ins>returns</ins> 
<tt>error_condition(posv, generic_category())</tt>. Otherwise, the function <del>shall return</del><ins>returns</ins> 
<tt>error_condition(ev, system_category())</tt>. What constitutes correspondence for any given operating 
system is unspecified.
<p/>
[<i>Note 1</i>: The number of potential system error codes is large and unbounded, and some might not 
correspond to any POSIX <tt>errno</tt> value. Thus implementations are given latitude in determining 
correspondence. &mdash; <i>end note</i>]
</p>
</blockquote>
</blockquote>
</li>

</ol>





<hr>
<h3><a name="3601" href="#3601">3601</a><sup><a href="https://cplusplus.github.io/LWG/issue3601">(i)</a></sup>. <tt>common_iterator</tt>'s <tt><i>postfix-proxy</i></tt> needs <tt>indirectly_readable</tt></h3>
<p><b>Section:</b> 23.5.4.5 <a href="https://wg21.link/common.iter.nav">[common.iter.nav]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Casey Carter <b>Opened:</b> 2021-09-24 <b>Last modified:</b> 2021-10-14</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all other</b> <a href="lwg-index.html#common.iter.nav">issues</a> in [common.iter.nav].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
It would appear that when <a href="https://wg21.link/p2259r1">P2259R1</a> added <tt><i>postfix-proxy</i></tt> to 
<tt>common_iterator::operator++(int)</tt> LWG missed a crucial difference between <tt>operator++(int)</tt> and 
<tt>operator-&gt;</tt> which uses a similar proxy: <tt>operator-&gt;</tt> requires the wrapped type to be 
<tt>indirectly_readable</tt>, but <tt>operator++(int)</tt> does not. Consequently, operations that read from the 
wrapped type for the <tt><i>postfix-proxy</i></tt> case in <tt>operator++(int)</tt> are not properly constrained 
to be valid.
</p>

<p><i>[2021-10-14; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after six votes in favour during reflector poll.
</p>



<p><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/n4892">N4892</a>.
</p>

<ol>
<li><p>Modify 23.5.4.5 <a href="https://wg21.link/common.iter.nav">[common.iter.nav]</a> as indicated:</p>

<blockquote>
<pre>
decltype(auto) operator++(int);
</pre>
<blockquote>
<p>
-4- <i>Preconditions:</i> <tt>holds_alternative&lt;I&gt;(v_)</tt> is <tt>true</tt>.
<p/>
-5- <i>Effects:</i> If <tt>I</tt> models <tt>forward_iterator</tt>, equivalent to:
</p>
<blockquote><pre>
common_iterator tmp = *this;
++*this;
return tmp;
</pre></blockquote>
<p>
Otherwise, if <tt>requires (I&amp; i) { { *i++ } -&gt; <i>can-reference</i>; }</tt> is <tt>true</tt> 
or <tt><ins>indirectly_readable&lt;I&gt; &amp;&amp;</ins> constructible_from&lt;iter_value_t&lt;I&gt;, 
iter_reference_t&lt;I&gt;&gt; &amp;&amp; move_constructible&lt;iter_value_t&lt;I&gt;&gt;</tt> is <tt>false</tt>, 
equivalent to:
</p>
<blockquote><pre>
return get&lt;I&gt;(v_)++;
</pre></blockquote>
<p>
Otherwise, equivalent to: [&hellip;]
</p>
</blockquote>
</blockquote>
</li>

</ol>





<hr>
<h3><a name="3607" href="#3607">3607</a><sup><a href="https://cplusplus.github.io/LWG/issue3607">(i)</a></sup>. <tt>contiguous_iterator</tt> should not be allowed to have custom <tt>iter_move</tt> and <tt>iter_swap</tt> behavior</h3>
<p><b>Section:</b> 23.3.4.14 <a href="https://wg21.link/iterator.concept.contiguous">[iterator.concept.contiguous]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Tim Song <b>Opened:</b> 2021-09-28 <b>Last modified:</b> 2021-10-23</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
The <tt>iter_move</tt> and <tt>iter_swap</tt> customization points were introduced
primarily for proxy iterators. Whatever their application to non-proxy
iterators in general, they should not be allowed to have custom
behavior for contiguous iterators &mdash; this new iterator category was
introduced in large part to permit better optimizations, and allowing
custom <tt>iter_move/iter_swap</tt> prevents such optimizations for a wide
variety of algorithms that are specified to call them.
</p>

<p><i>[2021-10-14; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after seven votes in favour during reflector poll.
</p>


<p><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/n4892">N4892</a>.
</p>

<ol>
<li><p>Modify 23.3.4.14 <a href="https://wg21.link/iterator.concept.contiguous">[iterator.concept.contiguous]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class I&gt;
  concept contiguous_iterator =
    random_access_iterator&lt;I&gt; &amp;&amp;
    derived_from&lt;<i>ITER_CONCEPT</i>(I), contiguous_iterator_tag&gt; &amp;&amp;
    is_lvalue_reference_v&lt;iter_reference_t&lt;I&gt;&gt; &amp;&amp;
    same_as&lt;iter_value_t&lt;I&gt;, remove_cvref_t&lt;iter_reference_t&lt;I&gt;&gt;&gt; &amp;&amp;
    requires(const I&amp; i) {
      { to_address(i) } -&gt; same_as&lt;add_pointer_t&lt;iter_reference_t&lt;I&gt;&gt;&gt;;
    };
</pre>
<blockquote>
<p>
-2- Let <tt>a</tt> and <tt>b</tt> be dereferenceable iterators and <tt>c</tt> be a non-dereferenceable 
iterator of type <tt>I</tt> such that <tt>b</tt> is reachable from <tt>a</tt> and <tt>c</tt> is 
reachable from <tt>b</tt>, and let <tt>D</tt> be <tt>iter_difference_t&lt;I&gt;</tt>. The type <tt>I</tt> 
models <tt>contiguous_iterator</tt> only if
</p>
<ol style="list-style-type: none">
<li><p>(2.1) &mdash; <tt>to_address(a) == addressof(*a)</tt>,</p></li>
<li><p>(2.2) &mdash; <tt>to_address(b) == to_address(a) + D(b - a)</tt>, <del>and</del></p></li>
<li><p>(2.3) &mdash; <tt>to_address(c) == to_address(a) + D(c - a)</tt><del>.</del><ins>,</ins></p></li>
<li><p><ins>(2.?) &mdash; <tt>ranges::iter_move(a)</tt> has the same type, value category, and effects as 
<tt>std::move(*a)</tt>, and</ins></p></li>
<li><p><ins>(2.?) &mdash; if <tt>ranges::iter_swap(a, b)</tt> is well-formed, it has effects
equivalent to <tt>ranges::swap(*a, *b)</tt>.</ins></p></li>
</ol>
</blockquote>
</blockquote>
</li>

</ol>





<hr>
<h3><a name="3610" href="#3610">3610</a><sup><a href="https://cplusplus.github.io/LWG/issue3610">(i)</a></sup>. <tt>iota_view::size</tt> sometimes rejects integer-class types</h3>
<p><b>Section:</b> 24.6.4.2 <a href="https://wg21.link/range.iota.view">[range.iota.view]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Jiang An <b>Opened:</b> 2021-09-29 <b>Last modified:</b> 2021-10-14</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View other</b> <a href="lwg-index-open.html#range.iota.view">active issues</a> in [range.iota.view].</p>
<p><b>View all other</b> <a href="lwg-index.html#range.iota.view">issues</a> in [range.iota.view].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
It seems that the <tt>iota_view</tt> tends to accept integer-class types as its value types, by using 
<tt><i>is-integer-like</i></tt> or <tt><i>is-signed-integer-like</i></tt> through the specification, 
although it's unspecified whether any of them satisfies <tt>weakly_incrementable</tt>. However, the 
<i>requires-clause</i> of <tt>iota_view::size</tt> (24.6.4.2 <a href="https://wg21.link/range.iota.view">[range.iota.view]</a> p16) uses 
<tt>(integral&lt;W&gt; &amp;&amp; integral&lt;Bound&gt;)</tt>, which sometimes rejects integer-class types.
<p/>
Should we relax the restrictions by changing this part to <tt>(<i>is-integer-like</i>&lt;W&gt; &amp;&amp; 
<i>is-integer-like</i>&lt;Bound&gt;)</tt>?
</p>

<p><i>[2021-10-14; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after six votes in favour during reflector poll.
</p>



<p><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/n4892">N4892</a>.
</p>

<ol>
<li><p>Modify 24.6.4.2 <a href="https://wg21.link/range.iota.view">[range.iota.view]</a> as indicated:</p>

<blockquote>
<pre>
constexpr auto size() const requires <i>see below</i>;
</pre>
<blockquote>
<p>
-15- <i>Effects:</i> Equivalent to:
</p>
<blockquote><pre>
if constexpr (<i>is-integer-like</i>&lt;W&gt; &amp;&amp; <i>is-integer-like</i>&lt;Bound&gt;)
  return (<i>value_</i> &lt; 0)
    ? ((<i>bound_</i> &lt; 0)
      ? <i>to-unsigned-like</i>(-<i>value_</i>) - <i>to-unsigned-like</i>(-<i>bound_</i>)
      : <i>to-unsigned-like</i>(<i>bound_</i>) + <i>to-unsigned-like</i>(-<i>value_</i>))
    : <i>to-unsigned-like</i>(<i>bound_</i>) - <i>to-unsigned-like</i>(<i>value_</i>);
else
  return <i>to-unsigned-like</i>(<i>bound_</i> - <i>value_</i>);
</pre></blockquote>
<p>
-16- <i>Remarks:</i> The expression in the <i>requires-clause</i> is equivalent to:
</p>
<blockquote><pre>
(same_as&lt;W, Bound&gt; &amp;&amp; <i>advanceable</i>&lt;W&gt;) || (<del>integral</del><ins><i>is-integer-like</i></ins>&lt;W&gt; &amp;&amp; <del>integral</del><ins><i>is-integer-like</i></ins>&lt;Bound&gt;) ||
  sized_sentinel_for&lt;Bound, W&gt;
</pre></blockquote>
</blockquote>
</blockquote>
</li>

</ol>




<hr>
<h3><a name="3612" href="#3612">3612</a><sup><a href="https://cplusplus.github.io/LWG/issue3612">(i)</a></sup>. Inconsistent pointer alignment in <tt>std::format</tt></h3>
<p><b>Section:</b> 20.20.2.2 <a href="https://wg21.link/format.string.std">[format.string.std]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Victor Zverovich <b>Opened:</b> 2021-10-02 <b>Last modified:</b> 2021-10-14</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View other</b> <a href="lwg-index-open.html#format.string.std">active issues</a> in [format.string.std].</p>
<p><b>View all other</b> <a href="lwg-index.html#format.string.std">issues</a> in [format.string.std].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
According to [tab:format.type.ptr] pointers are formatted as hexadecimal integers (at least in the 
common case when <tt>uintptr_t</tt> is available). However, it appears that they have left alignment 
by default according to [tab:format.align]:
</p>
<blockquote><p>
Forces the field to be aligned to the start of the available space. This is the default for non-arithmetic 
types, <tt>charT</tt>, and <tt>bool</tt>, unless an integer presentation type is specified.
</p></blockquote>
<p>
because pointers are not arithmetic types.
<p/>
For example:
</p>
<blockquote><pre>
void* p = &hellip;
std::format("{:#16x}", std::bit_cast&lt;uintptr_t&gt;(p));
std::format("{:16}", p);
</pre></blockquote>
<p>
may produce <tt>"  0x7fff88716c84"</tt> and <tt>"0x7fff88716c84  "</tt> (the actual output depends 
on the value of <tt>p</tt>).
<p/>
This is inconsistent and clearly a bug in specification that should have included pointers together 
with arithmetic types in [tab:format.align].
</p>

<p><i>[2021-10-14; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after seven votes in favour during reflector poll.
</p>



<p><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/n4892">N4892</a>.
</p>

<ol>
<li><p>Modify 20.20.2.2 <a href="https://wg21.link/format.string.std">[format.string.std]</a>, Table [tab:format.align], as indicated:</p>

<blockquote>
<table border="1">
<caption>Table 59 &mdash; Meaning of <i>align</i> options  [tab:format.align]</caption>
<tr style="text-align:center">
<th>Option</th>
<th>Meaning</th>
</tr>
<tr>
<td><tt>&lt;</tt></td>
<td>Forces the field to be aligned to the start of the available space. This is the default for
non-arithmetic <ins>non-pointer</ins> types, <tt>charT</tt>, and <tt>bool</tt>, unless an integer 
presentation type is specified.</td>
</tr>
<tr>
<td><tt>&gt;</tt></td>
<td>Forces the field to be aligned to the end of the available space. This is the default for
arithmetic types other than <tt>charT</tt> and <tt>bool</tt><ins>, pointer types</ins> or when an 
integer presentation type is specified.</td>
</tr>
<tr>
<td colspan="2" align="center">
<tt>[&hellip;]</tt>
</td>
</tr>
</table>
</blockquote>

<blockquote class="note">
<p>
[<i>Drafting note:</i> The wording above touches a similar area as LWG <a href="lwg-active.html#3586">3586</a>. To help solving the
merge conflict the following shows the delta of this proposed wording on top of the LWG <a href="lwg-active.html#3586">3586</a>
merge result]
</p>
</blockquote>

<blockquote>
<table border="1">
<caption>Table 59 &mdash; Meaning of <i>align</i> options  [tab:format.align]</caption>
<tr style="text-align:center">
<th>Option</th>
<th>Meaning</th>
</tr>
<tr>
<td><tt>&lt;</tt></td>
<td>Forces the field to be aligned to the start of the available space. This is the default when 
the presentation type is a non-arithmetic <ins>non-pointer</ins> type.</td>
</tr>
<tr>
<td><tt>&gt;</tt></td>
<td>Forces the field to be aligned to the end of the available space. This is the default when 
the presentation type is an arithmetic <ins>or pointer</ins> type.</td>
</tr>
<tr>
<td colspan="2" align="center">
<tt>[&hellip;]</tt>
</td>
</tr>
</table>
</blockquote>

</li>
</ol>





<hr>
<h3><a name="3616" href="#3616">3616</a><sup><a href="https://cplusplus.github.io/LWG/issue3616">(i)</a></sup>. LWG 3498 seems to miss the non-member <tt>swap</tt> for <tt>basic_syncbuf</tt></h3>
<p><b>Section:</b> 29.11.2.6 <a href="https://wg21.link/syncstream.syncbuf.special">[syncstream.syncbuf.special]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> S. B. Tam <b>Opened:</b> 2021-10-07 <b>Last modified:</b> 2021-10-14</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
LWG <a href="lwg-defects.html#3498">3498</a> fixes the inconsistent <tt>noexcept</tt>-specifiers for member functions of <tt>basic_syncbuf</tt>, 
but the proposed resolution in LWG <a href="lwg-defects.html#3498">3498</a> seems to miss the non-member <tt>swap</tt>, which also has 
inconsistent <tt>noexcept</tt>-specifier: 29.11.2.6 <a href="https://wg21.link/syncstream.syncbuf.special">[syncstream.syncbuf.special]</a> says it's <tt>noexcept</tt>, 
while 29.11.1 <a href="https://wg21.link/syncstream.syn">[syncstream.syn]</a> says it's not.
<p/>
Since the non-member <tt>swap</tt> and the member <tt>swap</tt> have equivalent effect, and LWG 3498 removes 
<tt>noexcept</tt> from the latter, I think it's pretty clear that the former should not be <tt>noexcept</tt>.
</p>

<p><i>[2021-10-14; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after seven votes in favour during reflector poll.
</p>



<p><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/n4892">N4892</a>.
</p>

<ol>
<li><p>Modify 29.11.2.6 <a href="https://wg21.link/syncstream.syncbuf.special">[syncstream.syncbuf.special]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class charT, class traits, class Allocator&gt;
  void swap(basic_syncbuf&lt;charT, traits, Allocator&gt;&amp; a,
            basic_syncbuf&lt;charT, traits, Allocator&gt;&amp; b) <del>noexcept</del>;
</pre>
<blockquote>
<p>
-1- <i>Effects:</i> Equivalent to <tt>a.swap(b)</tt>.
</p>
</blockquote>
</blockquote>
</li>
</ol>




<hr>
<h3><a name="3618" href="#3618">3618</a><sup><a href="https://cplusplus.github.io/LWG/issue3618">(i)</a></sup>. Unnecessary <tt>iter_move</tt> for <tt>transform_view::iterator</tt></h3>
<p><b>Section:</b> 24.7.7.3 <a href="https://wg21.link/range.transform.iterator">[range.transform.iterator]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Barry Revzin <b>Opened:</b> 2021-10-12 <b>Last modified:</b> 2021-10-17</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View other</b> <a href="lwg-index-open.html#range.transform.iterator">active issues</a> in [range.transform.iterator].</p>
<p><b>View all other</b> <a href="lwg-index.html#range.transform.iterator">issues</a> in [range.transform.iterator].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
 <tt>transform_view</tt>'s iterator currently specifies a customization point for <tt>iter_move</tt>. 
 This customization point does the same thing that the default implementation would do &mdash; 
 <tt>std::move(*E)</tt> if <tt>*E</tt> is an lvalue, else <tt>*E</tt> &mdash; except that it is only 
 there to provide the correct conditional <tt>noexcept</tt> specification. But for <tt>iota_view</tt>, 
 we instead provide a <tt>noexcept</tt>-specifier on the iterator's <tt>operator*</tt>. We should do 
 the same thing for both, and the simplest thing would be:
<p/>
Change 24.7.7.3 <a href="https://wg21.link/range.transform.iterator">[range.transform.iterator]</a> to put the whole body into <tt>noexcept</tt>:
</p>
<blockquote><pre>
constexpr decltype(auto) operator*() const <ins>noexcept(noexcept(invoke(*<i>parent_</i>-&gt;<i>fun_</i>, *<i>current_</i>)))</ins> {
  return invoke(*<i>parent_</i>-&gt;<i>fun_</i>, *<i>current_</i>);
} 
</pre></blockquote>
<p>
And to remove this:
</p>
<blockquote><pre>
friend constexpr decltype(auto) iter_move(const <i>iterator</i>&amp; i)
  noexcept(noexcept(invoke(*i.<i>parent_</i>-&gt;<i>fun_</i>, *i.<i>current_</i>))) {
  if constexpr (is_lvalue_reference_v&lt;decltype(*i)&gt;)
    return std::move(*i);
  else
    return *i;
}
</pre></blockquote>

<p><i>[2022-01-29; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after seven votes in favour during reflector poll.
</p>



<p><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/n4892">N4892</a>.
</p>

<ol>
<li><p>Modify 24.7.7.3 <a href="https://wg21.link/range.transform.iterator">[range.transform.iterator]</a>, class template <tt>transform_view::<i>iterator</i></tt>, 
as indicated:</p>

<blockquote>
<pre>
[&hellip;]
constexpr decltype(auto) operator*() const <ins>noexcept(noexcept(invoke(*<i>parent_</i>-&gt;<i>fun_</i>, *<i>current_</i>)))</ins> {
  return invoke(*<i>parent_</i>-&gt;<i>fun_</i>, *<i>current_</i>);
}
[&hellip;]
<del>friend constexpr decltype(auto) iter_move(const <i>iterator</i>&amp; i)
  noexcept(noexcept(invoke(*i.<i>parent_</i>-&gt;<i>fun_</i>, *i.<i>current_</i>))) {
  if constexpr (is_lvalue_reference_v&lt;decltype(*i)&gt;)
    return std::move(*i);
  else
    return *i;
}</del>
[&hellip;]
</pre>
</blockquote>
</li>
</ol>





<hr>
<h3><a name="3619" href="#3619">3619</a><sup><a href="https://cplusplus.github.io/LWG/issue3619">(i)</a></sup>. Specification of <tt>vformat_to</tt> contains ill-formed <tt>formatted_size</tt> calls</h3>
<p><b>Section:</b> 20.20.5 <a href="https://wg21.link/format.functions">[format.functions]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Tim Song <b>Opened:</b> 2021-10-17 <b>Last modified:</b> 2021-10-17</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all other</b> <a href="lwg-index.html#format.functions">issues</a> in [format.functions].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
The specification of <tt>vformat_to</tt> says that it formats "into the range
<tt>[out, out + N)</tt>, where <tt>N</tt> is <tt>formatted_size(fmt, args...)</tt> for the
functions without a <tt>loc</tt> parameter and <tt>formatted_size(loc, fmt, args...)</tt> 
for the functions with a <tt>loc</tt> parameter".
<p/>
This is wrong in at least two ways:
</p>
<ul>
<li><p>First, <tt>args</tt> is a <tt>(w)format_args</tt>, not a pack, so it doesn't make
sense to use <tt>...</tt> to expand it.</p></li>
<li><p>Second, <tt>fmt</tt> is a <tt>(w)string_view</tt> parameter, and it is never a
constant expression, and so the call is ill-formed after <a href="https://wg21.link/P2216">P2216</a> added 
compile-time format string checking.</p></li>
</ul>

<p><i>[2022-01-29; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after six votes in favour during reflector poll.
</p>



<p><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/n4892">N4892</a>.
</p>

<ol>
<li><p>Modify 20.20.5 <a href="https://wg21.link/format.functions">[format.functions]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class Out&gt;
  Out vformat_to(Out out, string_view fmt, format_args args);
template&lt;class Out&gt;
  Out vformat_to(Out out, wstring_view fmt, wformat_args args);
template&lt;class Out&gt;
  Out vformat_to(Out out, const locale&amp; loc, string_view fmt, format_args args);
template&lt;class Out&gt;
  Out vformat_to(Out out, const locale&amp; loc, wstring_view fmt, wformat_args args);
</pre>
<blockquote>
<p>
-12- Let <tt>charT</tt> be <tt>decltype(fmt)::value_type</tt>.
<p/>
-13- <i>Constraints:</i> <tt>Out</tt> satisfies <tt>output_iterator&lt;const charT&amp;&gt;</tt>.
<p/>
-14- <i>Preconditions:</i> <tt>Out</tt> models <tt>output_iterator&lt;const charT&amp;&gt;</tt>.
<p/>
-15- <i>Effects:</i> Places the character representation of formatting the arguments provided by 
<tt>args</tt>, formatted according to the specifications given in <tt>fmt</tt>, into the range 
<tt>[out, out + N)</tt>, where <tt>N</tt> is <del><tt>formatted_size(fmt, args...)</tt> for the 
functions without a <tt>loc</tt> parameter and <tt>formatted_size(loc, fmt, args...)</tt> for 
the functions with a <tt>loc</tt> parameter</del><ins>the number of characters in that
character representation</ins>. If present, <tt>loc</tt> is used for locale-specific formatting.
<p/>
-16- <i>Returns:</i> <tt>out + N</tt>.
<p/>
-17- [&hellip;]
</p>
</blockquote>
</blockquote>
</li>
</ol>





<hr>
<h3><a name="3621" href="#3621">3621</a><sup><a href="https://cplusplus.github.io/LWG/issue3621">(i)</a></sup>. Remove feature-test macro <tt>__cpp_lib_monadic_optional</tt></h3>
<p><b>Section:</b> 17.3.2 <a href="https://wg21.link/version.syn">[version.syn]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Jens Maurer <b>Opened:</b> 2021-10-18 <b>Last modified:</b> 2021-10-23</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View other</b> <a href="lwg-index-open.html#version.syn">active issues</a> in [version.syn].</p>
<p><b>View all other</b> <a href="lwg-index.html#version.syn">issues</a> in [version.syn].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
<a href="https://wg21.link/P0798R8">P0798R8</a> "Monadic operations for <tt>std::optional</tt>"
created a new feature-test macro <tt>__cpp_lib_monadic_optional</tt>
for a relatively minor enhancement.
<p/>
We should instead increment the value of the existing
feature-test macro <tt>__cpp_lib_optional</tt>.
</p>

<p><i>[2022-01-29; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after eight votes in favour during reflector poll.
</p>



<p><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/n4901">N4901</a>.
</p>

<ol>
<li><p>Modify 17.3.2 <a href="https://wg21.link/version.syn">[version.syn]</a> as indicated:</p>

<blockquote>
<pre>
[&hellip;]
<del>#define __cpp_lib_monadic_optional 202110L <i>// also in &lt;optional&gt;</i></del>
[&hellip;]
#define __cpp_lib_optional <del>202106L</del><ins>202110L</ins> <i>// also in &lt;optional&gt;</i>
[&hellip;]
</pre>
</blockquote>
</li>
</ol>





<hr>
<h3><a name="3632" href="#3632">3632</a><sup><a href="https://cplusplus.github.io/LWG/issue3632">(i)</a></sup>. <tt>unique_ptr</tt> "<i>Mandates:</i> This constructor is not selected by class template argument deduction"</h3>
<p><b>Section:</b> 20.11.1.3.2 <a href="https://wg21.link/unique.ptr.single.ctor">[unique.ptr.single.ctor]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Arthur O'Dwyer <b>Opened:</b> 2021-11-03 <b>Last modified:</b> 2021-11-06</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all other</b> <a href="lwg-index.html#unique.ptr.single.ctor">issues</a> in [unique.ptr.single.ctor].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
<a href="https://wg21.link/P1460R1">P1460R1</a> changed the wording for <tt>unique_ptr</tt>'s constructor <tt>unique_ptr(pointer)</tt>.
In C++17, it said in [unique.ptr.single.ctor] p5:
</p>
<blockquote>
<pre>
explicit unique_ptr(pointer p) noexcept;
</pre>
<blockquote>
<p>
<i>Preconditions:</i> [&hellip;]
<p/>
<i>Effects:</i> [&hellip;]
<p/>
<i>Postconditions:</i> [&hellip;]
<p/>
<b><i>Remarks:</i></b> If <tt>is_pointer_v&lt;deleter_type&gt;</tt> is <tt>true</tt> or 
<tt>is_default_constructible_v&lt;deleter_type&gt;</tt> is <tt>false</tt>, this constructor shall not 
participate in overload resolution. <b>If class template argument deduction would select the function 
template corresponding to this constructor, then the program is ill-formed</b>.
</p>
</blockquote>
</blockquote>
<p>
In C++20, it says in [unique.ptr.single.ctor] p5:
</p>
<blockquote>
<pre>
explicit unique_ptr(pointer p) noexcept;
</pre>
<blockquote>
<p>
<i>Constraints:</i> <tt>is_pointer_v&lt;deleter_type&gt;</tt> is <tt>false</tt> and 
<tt>is_default_constructible_v&lt;deleter_type&gt;</tt> is <tt>true</tt>.
<p/>
<b><i>Mandates:</i> This constructor is not selected by class template argument deduction.</b>
<p/>
<i>Preconditions:</i> [&hellip;]
<p/>
<i>Effects:</i> [&hellip;]
<p/>
<i>Postconditions:</i> [&hellip;]
</p>
</blockquote>
</blockquote>
<p>
Normally, we use "<i>Mandates:</i>" for <tt>static_assert</tt>-like stuff, not just to indicate that 
some constructor doesn't contribute to CTAD. Both libstdc++ and Microsoft (and soon libc++, see 
<a href="https://reviews.llvm.org/D112904">LLVM issue</a>) seem to agree about the intent of this wording: 
It's basically asking for the constructor to be implemented with a CTAD firewall, as
</p>
<blockquote>
<pre>
explicit unique_ptr(type_identity_t&lt;pointer&gt; p) noexcept;
</pre>
</blockquote>
<p>
and there is no actual <tt>static_assert</tt> corresponding to this "<i>Mandates:</i>" element. In particular, 
the following program is well-formed on all vendors:
</p>
<blockquote>
<pre>
// <a href="https://godbolt.org/z/h5bb1WbTz">godbolt link</a>
template&lt;class T&gt; auto f(T p) -&gt; decltype(std::unique_ptr(p));
template&lt;class T&gt; constexpr bool f(T p) { return true; }  
static_assert(f((int*)nullptr));
</pre>
</blockquote>
<p>
I claim that this is a confusing and/or wrong use of "<i>Mandates:</i>". My proposed resolution is 
simply to respecify the constructor as
</p>
<blockquote>
<pre>
explicit unique_ptr(<b>type_identity_t&lt;pointer&gt;</b> p) noexcept;
</pre>
<blockquote>
<p>
<i>Constraints:</i> <tt>is_pointer_v&lt;deleter_type&gt;</tt> is <tt>false</tt> and 
<tt>is_default_constructible_v&lt;deleter_type&gt;</tt> is <tt>true</tt>.
<p/>
<i>Preconditions:</i> [&hellip;]
<p/>
<i>Effects:</i> [&hellip;]
<p/>
<i>Postconditions:</i> [&hellip;]
</p>
</blockquote>
</blockquote>
<p>
with no <i>Mandates:</i> or <i>Remarks:</i> elements at all.
</p>

<p><i>[2022-01-29; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after five votes in favour during reflector poll.
</p>



<p><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N4901">N4901</a>.
</p>

<ol>

<li><p>Modify 20.11.1.3.1 <a href="https://wg21.link/unique.ptr.single.general">[unique.ptr.single.general]</a>, class template <tt>unique_ptr</tt> synopsis, as indicated:</p>

<blockquote>
<pre>
[&hellip;]
<i>// 20.11.1.3.2 <a href="https://wg21.link/unique.ptr.single.ctor">[unique.ptr.single.ctor]</a>, constructors</i>
constexpr unique_ptr() noexcept;
explicit unique_ptr(<ins>type_identity_t&lt;</ins>pointer<ins>&gt;</ins> p) noexcept;
unique_ptr(<ins>type_identity_t&lt;</ins>pointer<ins>&gt;</ins> p, <i>see below</i> d1) noexcept;
unique_ptr(<ins>type_identity_t&lt;</ins>pointer<ins>&gt;</ins> p, <i>see below</i> d2) noexcept;
[&hellip;]
</pre>
</blockquote>
</li>

<li><p>Modify 20.11.1.3.2 <a href="https://wg21.link/unique.ptr.single.ctor">[unique.ptr.single.ctor]</a> as indicated:</p>

<blockquote>
<pre>
explicit unique_ptr(<ins>type_identity_t&lt;</ins>pointer<ins>&gt;</ins> p) noexcept;
</pre>
<blockquote>
<p>
-5- <i>Constraints:</i> <tt>is_pointer_v&lt;deleter_type&gt;</tt> is <tt>false</tt> and 
<tt>is_default_constructible_v&lt;deleter_type&gt;</tt> is <tt>true</tt>.
<p/>
<del>-6- <i>Mandates:</i> This constructor is not selected by class template argument 
deduction (12.2.2.9 <a href="https://wg21.link/over.match.class.deduct">[over.match.class.deduct]</a>).</del>
<p/>
-7- <i>Preconditions:</i> [&hellip;]
<p/>
-8- <i>Effects:</i> [&hellip;]
<p/>
-9- <i>Postconditions:</i> [&hellip;]
</p>
</blockquote>
<pre>
unique_ptr(<ins>type_identity_t&lt;</ins>pointer<ins>&gt;</ins> p, const D&amp; d) noexcept;
unique_ptr(<ins>type_identity_t&lt;</ins>pointer<ins>&gt;</ins> p, remove_reference_t&lt;D&gt;&amp;&amp; d) noexcept;
</pre>
<blockquote>
<p>
-10- <i>Constraints:</i> <tt>is_constructible_v&lt;D, decltype(d)&gt;</tt> is <tt>true</tt>.
<p/>
<del>-11- <i>Mandates:</i> These constructors are not selected by class template argument 
deduction (12.2.2.9 <a href="https://wg21.link/over.match.class.deduct">[over.match.class.deduct]</a>).</del>
<p/>
-12- <i>Preconditions:</i> [&hellip;]
<p/>
-13- <i>Effects:</i> [&hellip;]
<p/>
-14- <i>Postconditions:</i> [&hellip;]
<p/>
-15- <i>Remarks:</i> If <tt>D</tt> is a reference type, the second constructor is defined as deleted.
<p/>
-16- [<i>Example 1</i>: [&hellip;] &mdash; <i>end example</i>]
</p>
</blockquote>
</blockquote>
</li>

</ol>





</body>
</html>
