<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>C++ Standard Library Issues to be moved in [INSERT CURRENT MEETING HERE]</title>
<style>
  p {text-align:justify}
  li {text-align:justify}
  pre code.backtick::before { content: "`" }
  pre code.backtick::after { content: "`" }
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table.issues-index { border: 1px solid; border-collapse: collapse; }
  table.issues-index th { text-align: center; padding: 4px; border: 1px solid; }
  table.issues-index td { padding: 4px; border: 1px solid; }
  table.issues-index td:nth-child(1) { text-align: right; }
  table.issues-index td:nth-child(2) { text-align: left; }
  table.issues-index td:nth-child(3) { text-align: left; }
  table.issues-index td:nth-child(4) { text-align: left; }
  table.issues-index td:nth-child(5) { text-align: center; }
  table.issues-index td:nth-child(6) { text-align: center; }
  table.issues-index td:nth-child(7) { text-align: left; }
  table.issues-index td:nth-child(5) span.no-pr { color: red; }
  @media (prefers-color-scheme: dark) {
     html {
        color: #ddd;
        background-color: black;
     }
     ins {
        background-color: #225522
     }
     del {
        background-color: #662222
     }
     a {
        color: #6af
     }
     a:visited {
        color: #6af
     }
     blockquote.note
     {
        background-color: rgba(255, 255, 255, .10)
     }
  }
</style>
</head>
<body>
<h1>C++ Standard Library Issues to be moved in [INSERT CURRENT MEETING HERE]</h1>
<table>
<tr>
<td align="left">Doc. no.</td>
<td align="left">R0165???</td>
</tr>
<tr>
<td align="left">Date:</td>
<td align="left">Revised 2025-08-23 at 12:11:21 UTC
</td>
</tr>
<tr>
<td align="left">Project:</td>
<td align="left">Programming Language C++</td>
</tr>
<tr>
<td align="left">Reply to:</td>
<td align="left">Jonathan Wakely &lt;<a href="mailto:lwgchair@gmail.com">lwgchair@gmail.com</a>&gt;</td>
</tr>
</table>
<h2>Ready Issues</h2>
<hr>
<h3 id="4243"><a href="#4243">4243</a><sup><a href="https://cplusplus.github.io/LWG/issue4243">(i)</a></sup>. <code class='backtick'>as_bytes</code>/<code class='backtick'>as_writable_bytes</code> is broken with <code>span&lt;volatile T&gt;</code></h3>
<p><b>Section:</b> 23.7.2.3 <a href="https://wg21.link/span.objectrep">[span.objectrep]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Ready</a>
 <b>Submitter:</b> Hewill Kang <b>Opened:</b> 2025-04-12 <b>Last modified:</b> 2025-08-23</p>
<p><b>Priority: </b>4
</p>
<p><b>Discussion:</b></p>
<p>
They both use <code class='backtick'>reinterpret_cast</code> to cast the underlying pointer type of <code class='backtick'>span</code> to <code class='backtick'>const byte*</code> 
and <code class='backtick'>byte*</code> respectively, which leads to a hard error when the element type is <code class='backtick'>volatile</code>-qualified
(<a href="https://godbolt.org/z/Eq4ovzTEK">demo</a>):
</p>
<blockquote><pre>
#include &lt;span&gt;

int main() {
  std::span&lt;volatile int&gt; span;
  auto bytes = as_bytes(span);                   // <span  style="color:#C80000;font-weight:bold">hard error</span>
  auto writable_bytes = as_writable_bytes(span); // <span  style="color:#C80000;font-weight:bold">hard error</span>
}
</pre></blockquote>

<p><strong>Previous resolution [SUPERSEDED]:</strong></p>
<blockquote class="note">

<p>
This wording is relative to <a href="https://wg21.link/N5008" title=" Working Draft, Programming Languages — C++">N5008</a>.
</p>

<ol>

<li><p>Modify 23.7.2.1 <a href="https://wg21.link/span.syn">[span.syn]</a>, header <code>&lt;span&gt;</code> synopsis, as indicated:</p>

<blockquote>
<pre>
[&hellip;]
namespace std {
  [&hellip;]
  <i>// 23.7.2.3 <a href="https://wg21.link/span.objectrep">[span.objectrep]</a>, views of object representation</i>
  template&lt;class ElementType, size_t Extent&gt;
    span&lt;const <ins>conditional_t&lt;is_volatile_v&lt;ElementType&gt;, volatile byte, </ins>byte<ins>&gt;</ins>, 
         Extent == dynamic_extent ? dynamic_extent : sizeof(ElementType) * Extent&gt;
      as_bytes(span&lt;ElementType, Extent&gt; s) noexcept;

  template&lt;class ElementType, size_t Extent&gt;
    span&lt;<ins>conditional_t&lt;is_volatile_v&lt;ElementType&gt;, volatile byte, </ins>byte<ins>&gt;</ins>, 
         Extent == dynamic_extent ? dynamic_extent : sizeof(ElementType) * Extent&gt;
      as_writable_bytes(span&lt;ElementType, Extent&gt; s) noexcept;
}
</pre>
</blockquote>

</li>

<li><p>Modify 23.7.2.3 <a href="https://wg21.link/span.objectrep">[span.objectrep]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class ElementType, size_t Extent&gt;
  span&lt;const <ins>conditional_t&lt;is_volatile_v&lt;ElementType&gt;, volatile byte, </ins>byte<ins>&gt;</ins>,
       Extent == dynamic_extent ? dynamic_extent : sizeof(ElementType) * Extent&gt;
    as_bytes(span&lt;ElementType, Extent&gt; s) noexcept;
</pre>
<blockquote>
<p>
-1- <i>Effects</i>: Equivalent to:
<code>return R{reinterpret_cast&lt;<ins>R::pointer</ins><del>const byte*</del>&gt;(s.data()), s.size_bytes()};</code><br/>
where <code class='backtick'>R</code> is the return type.
</p>
</blockquote>
<pre>
template&lt;class ElementType, size_t Extent&gt;
  span&lt;<ins>conditional_t&lt;is_volatile_v&lt;ElementType&gt;, volatile byte, </ins>byte<ins>&gt;</ins>,
       Extent == dynamic_extent ? dynamic_extent : sizeof(ElementType) * Extent&gt;
    as_writable_bytes(span&lt;ElementType, Extent&gt; s) noexcept;
</pre>
<blockquote>
<p>
-2- <i>Constraints</i>: <code>is_const_v&lt;ElementType&gt;</code> is <code class='backtick'>false</code>.
</p>
</blockquote>
<blockquote>
<p>
-3- <i>Effects</i>: Equivalent to:
<code>return R{reinterpret_cast&lt;<ins>R::pointer</ins><del>byte*</del>&gt;(s.data()), s.size_bytes()};</code><br/>
where <code class='backtick'>R</code> is the return type.
</p>
</blockquote>
</blockquote>

</li>

</ol>
</blockquote>

<p><i>[2025-04-16; Hewill Kang provides alternative wording]</i></p>

<p>
Based on reflector feedback, the revised wording just improves the current state of not supporting
support for <code class='backtick'>volatile</code>.
</p>

<p><i>[2025-06-12; Reflector poll]</i></p>

<p>
Set priority to 4 after reflector poll.
</p>

<p><i>[Sofia 2025-06-17; Move to Ready]</i></p>




<p id="res-4243"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5008" title=" Working Draft, Programming Languages — C++">N5008</a>.
</p>

<ol>

<li><p>Modify 23.7.2.3 <a href="https://wg21.link/span.objectrep">[span.objectrep]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class ElementType, size_t Extent&gt;
  span&lt;const byte, Extent == dynamic_extent ? dynamic_extent : sizeof(ElementType) * Extent&gt;
    as_bytes(span&lt;ElementType, Extent&gt; s) noexcept;
</pre>
<blockquote>
<p>
<ins>-?- <i>Constraints</i>: <code>is_volatile_v&lt;ElementType&gt;</code> is <code class='backtick'>false</code>.</ins>
</p>
<p>
-1- <i>Effects</i>: Equivalent to: <code>return R{reinterpret_cast&lt;const byte*&gt;(s.data()), s.size_bytes()};</code><br/> 
where <code>R</code> is the return type.
</p>
</blockquote>
<pre>
template&lt;class ElementType, size_t Extent&gt;
  span&lt;byte, Extent == dynamic_extent ? dynamic_extent : sizeof(ElementType) * Extent&gt;
    as_writable_bytes(span&lt;ElementType, Extent&gt; s) noexcept;
</pre>
<blockquote>
<p>
-2- <i>Constraints</i>: <code>is_const_v&lt;ElementType&gt;</code> is <code class='backtick'>false</code> <ins>and
<code>is_volatile_v&lt;ElementType&gt;</code> is <code class='backtick'>false</code></ins>.
</p>
<p>
-3- <i>Effects</i>: Equivalent to: <code>return R{reinterpret_cast&lt;byte*&gt;(s.data()), s.size_bytes()};</code><br/> 
where <code class='backtick'>R</code> is the return type.
</p>
</blockquote>
</blockquote>

</li>

</ol>





<hr>
<h3 id="4253"><a href="#4253">4253</a><sup><a href="https://cplusplus.github.io/LWG/issue4253">(i)</a></sup>. <code class='backtick'>basic_const_iterator</code> should provide <code class='backtick'>iterator_type</code></h3>
<p><b>Section:</b> 24.5.3.3 <a href="https://wg21.link/const.iterators.iterator">[const.iterators.iterator]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Hewill Kang <b>Opened:</b> 2025-04-29 <b>Last modified:</b> 2025-08-23</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View other</b> <a href="lwg-index-open.html#const.iterators.iterator">active issues</a> in [const.iterators.iterator].</p>
<p><b>View all other</b> <a href="lwg-index.html#const.iterators.iterator">issues</a> in [const.iterators.iterator].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
Currently, iterator adaptors in <code>&lt;iterator&gt;</code> that wrap a single iterator
such as <code class='backtick'>reverse_iterator</code>, <code class='backtick'>move_iterator</code>, and <code class='backtick'>counted_iterator</code> all provide a
public <code class='backtick'>iterator_type</code> member for users to access the underlying iterator type, except for
<code class='backtick'>basic_const_iterator</code> (<a href="https://godbolt.org/z/4hY4qhnPG">demo</a>):
</p>
<blockquote><pre>
#include &lt;iterator&gt;

using I  = int*;
using RI = std::reverse_iterator&lt;I&gt;;
using MI = std::move_iterator&lt;I&gt;;
using CI = std::counted_iterator&lt;I&gt;;
using BI = std::basic_const_iterator&lt;I&gt;;

static_assert(std::same_as&lt;RI::iterator_type, I&gt;);
static_assert(std::same_as&lt;MI::iterator_type, I&gt;);
static_assert(std::same_as&lt;CI::iterator_type, I&gt;);
static_assert(std::same_as&lt;BI::iterator_type, I&gt;); // <span  style="color:#C80000;font-weight:bold">error</span>
</pre></blockquote>
<p>
It seems reasonable to add one for <code class='backtick'>basic_const_iterator</code> for consistency.
</p>

<p><i>[2025-06-12; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after eight votes in favour during reflector poll.
</p>



<p id="res-4253"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5008" title=" Working Draft, Programming Languages — C++">N5008</a>.
</p>
<ol>

<li><p>Modify 24.5.3.3 <a href="https://wg21.link/const.iterators.iterator">[const.iterators.iterator]</a> as indicated:</p>

<blockquote>
<pre>
namespace std {
  [&hellip;]
  template&lt;input_iterator Iterator&gt;
  class basic_const_iterator {
    Iterator <i>current_</i> = Iterator();                             // <i>exposition only</i>
    using <i>reference</i> = iter_const_reference_t&lt;Iterator&gt;;         // <i>exposition only</i>
    using <i>rvalue-reference</i> =                                    // <i>exposition only</i>
      <i>iter-const-rvalue-reference-t</i>&lt;Iterator&gt;;
          
    public:
      <ins>using iterator_type = Iterator;</ins>
      using iterator_concept = <i>see below</i>;
      using iterator_category = <i>see below</i>;  // <i>not always present</i>
      using value_type = iter_value_t&lt;Iterator&gt;;
      using difference_type = iter_difference_t&lt;Iterator&gt;;
      [&hellip;]
  };
}
</pre>
</blockquote>
</li>
</ol>





<hr>
<h3 id="4266"><a href="#4266">4266</a><sup><a href="https://cplusplus.github.io/LWG/issue4266">(i)</a></sup>. <code class='backtick'>layout_stride::mapping</code> should treat empty mappings as exhaustive</h3>
<p><b>Section:</b> 23.7.3.4.7 <a href="https://wg21.link/mdspan.layout.stride">[mdspan.layout.stride]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Tomasz Kamiński <b>Opened:</b> 2025-05-22 <b>Last modified:</b> 2025-08-23</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all other</b> <a href="lwg-index.html#mdspan.layout.stride">issues</a> in [mdspan.layout.stride].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
Mapping over an empty multidimensional index space is always exhaustive according to the 
corresponding definitions from 23.7.3.4.2 <a href="https://wg21.link/mdspan.layout.reqmts">[mdspan.layout.reqmts]</a> p16.
<p/>
However, the current specification of <code class='backtick'>layout_stride::mapping</code> does not consider whether 
some of the empty multidimensional index spaces are unique or exhaustive. For illustration, 
the mapping with the following configuration is not considered exhaustive according to the 
current specification of 23.7.3.4.7.4 <a href="https://wg21.link/mdspan.layout.stride.obs">[mdspan.layout.stride.obs]</a> bullet 5.2:
</p>
<blockquote><pre>
extents: 2, 2, 0
strides: 2, 6, 20
</pre></blockquote>
<p>
This prevents the implementation from implementing <code class='backtick'>sm.is_exhaustive()</code> as 
<code>sm.<i>fwd-prod-of-extents</i>(sm::extents_type::rank()) == sm.required_span_size()</code>. 
For all mappings with size greater than zero, such an expression provides an answer consistent 
with the standard. However, it always returns <code class='backtick'>true</code> for an empty mapping, such as shown 
in the example.
<p/>
We should make such implementation conforming, and require <code class='backtick'>is_exhaustive()</code> to return 
<code class='backtick'>true</code> for empty mappings.
<p/>
For consistency, we could update <code class='backtick'>is_always_exhaustive()</code> to recognize mapping with 
<code class='backtick'>rank() == 0</code>, and one for which at least one of the static extents is equal to zero 
(i.e., they always represent a multidimensional index space).
</p>

<p><i>[2025-06-12; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after six votes in favour during reflector poll.
</p>



<p id="res-4266"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5008" title=" Working Draft, Programming Languages — C++">N5008</a>.
</p>
<ol>

<li><p>Modify 23.7.3.4.7.1 <a href="https://wg21.link/mdspan.layout.stride.overview">[mdspan.layout.stride.overview]</a> as indicated:</p>

<blockquote>
<pre>
namespace std {
  template&lt;class Extents&gt;
  class layout_stride::mapping {
    [&hellip;]
    static constexpr bool is_always_unique() noexcept { return true; }
    static constexpr bool is_always_exhaustive() noexcept<ins>;</ins> <del>{ return false; }</del>
    static constexpr bool is_always_strided() noexcept { return true; }
    [&hellip;]
  };
}
</pre>
</blockquote>

</li>

<li><p>Modify 23.7.3.4.7.4 <a href="https://wg21.link/mdspan.layout.stride.obs">[mdspan.layout.stride.obs]</a> as indicated:</p>

<blockquote>
<p>
[&hellip;]
</p>
<pre>
<ins>static constexpr bool is_always_exhaustive() noexcept;</ins>
</pre>
<blockquote>
<p>
<ins>-?- <i>Returns</i>: <code class='backtick'>true</code> if <code><i>rank_</i></code> is <code class='backtick'>0</code> or if there is a rank index 
<code class='backtick'>r</code> of <code class='backtick'>extents()</code> such that <code class='backtick'>extents_type::static_extent(r)</code> is <code class='backtick'>0</code>, otherwise <code class='backtick'>false</code>.</ins>
</p>
</blockquote>
<pre>
constexpr bool is_exhaustive() const noexcept;
</pre>
<blockquote>
<p>
-5- <i>Returns</i>:
</p>
<ol style="list-style-type: none">
<li><p>(5.1) &mdash; <code class='backtick'>true</code> if <code><i>rank_</i></code> <ins>or the size of the multidimensional 
index space <code class='backtick'>m.extents()</code></ins> is <code class='backtick'>0</code>.</p></li>
<li><p>(5.2) &mdash; [&hellip;]</p></li>
<li><p>(5.3) &mdash; [&hellip;]</p></li>
</ol>
</blockquote>
</blockquote>

</li>

</ol>






<hr>
<h3 id="4274"><a href="#4274">4274</a><sup><a href="https://cplusplus.github.io/LWG/issue4274">(i)</a></sup>. The <code class='backtick'>chrono::hh_mm_ss</code> constructor is ill-formed for unsigned durations</h3>
<p><b>Section:</b> 30.9.2 <a href="https://wg21.link/time.hms.members">[time.hms.members]</a> <b>Status:</b> <a href="lwg-active.html#Ready">Tentatively Ready</a>
 <b>Submitter:</b> Michael Welsh Duggan <b>Opened:</b> 2025-06-04 <b>Last modified:</b> 2025-08-23</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Tentatively Ready">Tentatively Ready</a> status.</p>
<p><b>Discussion:</b></p>
<p>
In 30.9.2 <a href="https://wg21.link/time.hms.members">[time.hms.members]</a>, paragraph 3, the current wording for the
constructor of <code class='backtick'>hh_mm_ss</code> expresses some of its requirements in terms of
<code class='backtick'>abs(d)</code>, which is assumed to be <code class='backtick'>chrono::abs(chrono::duration)</code>.
<code class='backtick'>chrono::abs</code> is not defined, however, for durations with an unsigned
representation. I believe that not being able to create <code class='backtick'>hh_mm_ss</code>
objects from unsigned durations is unintentional.
<p/>
Moreover, <code>is_constructible_v&lt;hh_mm_ss&lt;ud&gt;, ud&gt;</code> is required 
to be true by the standard for any duration, so making it actually work makes 
a lot of sense.
</p>

<p><i>[2025-06-13; Reflector poll]</i></p>

<p>
Set status to Tentatively Ready after five votes in favour during reflector poll.
</p>



<p id="res-4274"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5008" title=" Working Draft, Programming Languages — C++">N5008</a>.
</p>

<ol>
<li><p>Modify 30.9.2 <a href="https://wg21.link/time.hms.members">[time.hms.members]</a> as indicated:</p>

<blockquote>
<pre>
constexpr explicit hh_mm_ss(Duration d);
</pre>
<blockquote>
<p>
-3- <i>Effects</i>: Constructs an object of type <code class='backtick'>hh_mm_ss</code> which represents the <code class='backtick'>Duration d</code> 
with precision <code class='backtick'>precision</code>.
</p>
<ol style="list-style-type: none">
<li><p>(3.1) &mdash; Initializes <code class='backtick'>is_neg</code> with <code>d &lt; Duration::zero()</code>. <ins>Let 
<code><i>ABS_D</i></code> represent <code class='backtick'>-d</code> if <code class='backtick'>is_neg</code> is <code class='backtick'>true</code> and <code class='backtick'>d</code> otherwise.</ins></p></li>
<li><p>(3.2) &mdash; Initializes <code class='backtick'>h</code> with <code>duration_cast&lt;chrono::hours&gt;(<del>abs(d)</del><ins><i>ABS_D</i></ins>)</code>.</p></li>
<li><p>(3.3) &mdash; Initializes <code class='backtick'>m</code> with <code>duration_cast&lt;chrono::minutes&gt;(<del>abs(d)</del><ins><i>ABS_D</i></ins> - hours())</code>.</p></li>
<li><p>(3.4) &mdash; Initializes <code class='backtick'>s</code> with <code>duration_cast&lt;chrono::seconds&gt;(<del>abs(d)</del><ins><i>ABS_D</i></ins> - hours() - minutes())</code>.</p></li>
<li><p>(3.5) &mdash; If <code>treat_as_floating_point_v&lt;precision::rep&gt;</code> is <code class='backtick'>true</code>, initializes 
<code class='backtick'>ss</code> with <code><del>abs(d)</del><ins><i>ABS_D</i></ins> - hours() - minutes() - seconds()</code>. Otherwise, initializes <code class='backtick'>ss</code> with 
<code>duration_cast&lt;precision&gt;(<del>abs(d)</del><ins><i>ABS_D</i></ins> - hours() - minutes() - seconds())</code>.</p></li>
</ol>
</blockquote>
</blockquote>
</li>

</ol>





</body>
</html>
