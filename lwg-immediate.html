<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>C++ Standard Library Issues Resolved Directly In [INSERT CURRENT MEETING HERE]</title>
<style>
  p {text-align:justify}
  li {text-align:justify}
  pre code.backtick::before { content: "`" }
  pre code.backtick::after { content: "`" }
  blockquote.note
  {
    background-color:#E0E0E0;
    padding-left: 15px;
    padding-right: 15px;
    padding-top: 1px;
    padding-bottom: 1px;
  }
  ins {background-color:#A0FFA0}
  del {background-color:#FFA0A0}
  table.issues-index { border: 1px solid; border-collapse: collapse; }
  table.issues-index th { text-align: center; padding: 4px; border: 1px solid; }
  table.issues-index td { padding: 4px; border: 1px solid; }
  table.issues-index td:nth-child(1) { text-align: right; }
  table.issues-index td:nth-child(2) { text-align: left; }
  table.issues-index td:nth-child(3) { text-align: left; }
  table.issues-index td:nth-child(4) { text-align: left; }
  table.issues-index td:nth-child(5) { text-align: center; }
  table.issues-index td:nth-child(6) { text-align: center; }
  table.issues-index td:nth-child(7) { text-align: left; }
  table.issues-index td:nth-child(5) span.no-pr { color: red; }
  @media (prefers-color-scheme: dark) {
     html {
        color: #ddd;
        background-color: black;
     }
     ins {
        background-color: #225522
     }
     del {
        background-color: #662222
     }
     a {
        color: #6af
     }
     a:visited {
        color: #6af
     }
     blockquote.note
     {
        background-color: rgba(255, 255, 255, .10)
     }
  }
</style>
</head>
<body>
<h1>C++ Standard Library Issues Resolved Directly In [INSERT CURRENT MEETING HERE]</h1>
<table>
<tr>
<td align="left">Doc. no.</td>
<td align="left">N4???</td>
</tr>
<tr>
<td align="left">Date:</td>
<td align="left">Revised 2025-11-06 at 03:03:43 UTC
</td>
</tr>
<tr>
<td align="left">Project:</td>
<td align="left">Programming Language C++</td>
</tr>
<tr>
<td align="left">Reply to:</td>
<td align="left">Jonathan Wakely &lt;<a href="mailto:lwgchair@gmail.com">lwgchair@gmail.com</a>&gt;</td>
</tr>
</table>
<h2>Immediate Issues</h2>
<hr>
<h3 id="3343"><a href="#3343">3343</a><sup><a href="https://cplusplus.github.io/LWG/issue3343">(i)</a></sup>. Ordering of calls to <code>unlock()</code> and <code>notify_all()</code> in <i>Effects</i> element of <code>notify_all_at_thread_exit()</code> should be reversed</h3>
<p><b>Section:</b> 32.7.3 <a href="https://wg21.link/thread.condition.nonmember">[thread.condition.nonmember]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Lewis Baker <b>Opened:</b> 2019-11-21 <b>Last modified:</b> 2025-11-06</p>
<p><b>Priority: </b>3
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
32.7.3 <a href="https://wg21.link/thread.condition.nonmember">[thread.condition.nonmember]</a> p2 states:
</p>
<blockquote>
<p>
<i>Effects:</i> Transfers ownership of the lock associated with <code>lk</code> into internal storage 
and schedules <code>cond</code> to be notified when the current thread exits, after all objects of 
thread storage duration associated with the current thread have been destroyed. This notification 
shall be as if:
</p>
<blockquote><pre>
lk.unlock();
cond.notify_all();
</pre></blockquote>
</blockquote>
<p>
One common use-cases for the <code>notify_all_at_thread_exit()</code> is in conjunction with
<code>thread::detach()</code> to allow detached threads to signal when they complete and to allow 
another thread to wait for them to complete using the <code>condition_variable/mutex</code> pair.
<p/>
However, the current wording for <code>notify_all_at_thread_exit(condition_variable&amp; cond, 
unique_lock&lt;mutex&gt; lk)</code> makes it impossible to know when it is safe to destroy the 
<code>condition_variable</code> in the presence of spurious wake-ups and detached threads.
<p/>
For example: Consider the following code-snippet:
</p>
<blockquote><pre>
#include &lt;condition_variable&gt;
#include &lt;mutex&gt;
#include &lt;thread&gt;

int main() {
  std::condition_variable cv;
  std::mutex mut;
  bool complete = false;

  std::thread{[&amp;] {
    <i>// do work here</i>

    <i>// Signal thread completion</i>
    std::unique_lock lk{mut};
    complete = true;
    std::notify_all_at_thread_exit(cv, std::move(lk));
  }}.detach();

  <i>// Wait until thread completes</i>
  std::unique_lock lk{mut};
  cv.wait(lk, [&amp;] { return complete; });

  <i>// condition_variable destroyed on scope exit</i>
  return 0;
}
</pre></blockquote>
<p>
This seems to an intended usage of <code>thread::detach()</code> and <code>std::notify_all_at_thread_exit()</code> 
and yet this code contains a race involving the call to <code>cv.notify_all()</code> on the created thread, 
and the destructor of the <code>condition_variable</code>.
<p/>
To highlight the issue, consider the following case:
<p/>
Let <code>T0</code> be the thread that executes <code>main()</code> and <code>T1</code> be the thread created 
by the <code>std::thread</code> construction.
</p> 
<blockquote>
<p>
<code>T0</code>: creates thread <code>T1</code><br/>
<code>T0</code>: context-switched out by OS<br/>
<code>T1</code>: starts running<br/>
<p/>
<code>T1</code>: acquires mutex lock<br/>
<code>T1</code>: sets <code>complete = true</code><br/>
<p/>
<code>T1</code>: calls <code>notify_all_at_thread_exit()</code><br/>
<code>T1</code>: returns from thread-main function and runs all thread-local destructors<br/>
<code>T1</code>: calls <code>lk.unlock()</code><br/>
<code>T1</code>: context-switched out by OS<br/>
<code>T0</code>: resumes execution<br/>
<code>T0</code>: acquires mutex lock<br/>
<code>T0</code>: calls <code>cv.wait()</code> which returns immediately as <code>complete</code> is <code>true</code><br/>
<p/>
<code>T0</code>: returns from <code>main()</code>, destroying <code>condition_variable</code><br/>
<code>T1</code>: resumes execution<br/>
<p/>
<code>T1</code>: calls <code>cv.notify_all()</code> on a dangling <code>cv</code> reference (undefined behaviour)<br/>
</p>
</blockquote>
<p>
Other sequencings are possible involving spurious wake-ups of the <code>cv.wait()</code> call.
<p/>
A proof-of-concept showing this issue can be found <a href="https://wandbox.org/permlink/eUu3eiQbLl7JQKMm">here</a>.
<p/>
The current wording requires releasing the mutex lock before calling <code>cv.notify_all()</code>. In the 
presence of spurious wake-ups of a <code>condition_variable::wait()</code>, there is no way to know whether 
or not a detached thread that called <code>std::notify_all_at_thread_exit()</code> has finished calling 
<code>cv.notify_all()</code>. This means there is no portable way to know when it will be safe for the 
waiting thread to destroy that <code>condition_variable</code>.
<p/>
However, if we were to reverse the order of the calls to <code>lk.unlock()</code> and <code>cond.notify_all()</code> 
then the thread waiting for the detached thread to exit would not be able to observe the completion of the 
thread (in the above case, this would be observing the assignment of <code>true</code> to the <code>complete</code> 
variable) until the mutex lock was released by that thread and subsequently acquired by the waiting thread 
which would only happen after the completion of the call to <code>cv.notify_all()</code>. This would allow the 
above code example to eliminate the race between a subsequent destruction of the condition-variable and 
the call to <code>cv.notify_all()</code>.
</p>

<p><i>[2019-12-08 Issue Prioritization]</i></p>

<p>Priority to 3 after reflector discussion.</p>

<p><i>[2019-12-15; Daniel synchronizes wording with <a href="https://wg21.link/n4842">N4842</a>]</i></p>


<p><i>[2020-02, Prague]</i></p>

<p>Response from SG1: "We discussed it in Prague. We agree it’s an error and SG1 agreed with the PR."</p>
<p><strong>Previous resolution [SUPERSEDED]:</strong></p>
<blockquote class="note">

<p>This wording is relative to <a href="https://wg21.link/n4842">N4842</a>.</p>

<ol>
<li><p>Change 32.7.3 <a href="https://wg21.link/thread.condition.nonmember">[thread.condition.nonmember]</a> as indicated:</p>

<blockquote>
<pre>
void notify_all_at_thread_exit(condition_variable&amp; cond, unique_lock&lt;mutex&gt; lk);
</pre>
<blockquote>
<p>
[&hellip;]
<p/>
-2- <i>Effects:</i> Transfers ownership of the lock associated with <code>lk</code> into internal 
storage and schedules <code>cond</code> to be notified when the current thread exits, after all 
objects of thread storage duration associated with the current thread have been destroyed. 
This notification is equivalent to:
</p>
<blockquote><pre>
<del>lk.unlock();</del>
cond.notify_all();
<ins>lk.unlock();</ins>
</pre></blockquote>
</blockquote>
</blockquote>
</li>
</ol>
</blockquote>

<p><i>[2023-06-13, Varna; Tim provides improved wording]</i></p>

<p>Addressed mailing list comments. Ask SG1 to check.</p>

<p><i>[Kona 2025-11-05; SG1 unanimously approved the proposed resolution.]</i></p>


<p><i>[Kona 2025-11-06; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>



<p id="res-3343"><b>Proposed resolution:</b></p>

<p>This wording is relative to <a href="https://wg21.link/N4950" title=" Working Draft, Standard for Programming Language C++">N4950</a>.</p>

<ol>
<li><p>Change 32.7.3 <a href="https://wg21.link/thread.condition.nonmember">[thread.condition.nonmember]</a> as indicated:</p>

<blockquote>
<pre>
void notify_all_at_thread_exit(condition_variable&amp; cond, unique_lock&lt;mutex&gt; lk);
</pre>
<blockquote>
<p>
[&hellip;]
<p/>
-2- <i>Effects:</i> Transfers ownership of the lock associated with <code>lk</code> into internal
storage and schedules <code>cond</code> to be notified when the current thread
exits<del>,</del><ins>.  This notification is sequenced</ins> after all
objects of thread storage duration associated with the current thread have been
destroyed<del>.  This notification</del> <ins>and</ins> is equivalent to:
</p>
<blockquote><pre>
<del>lk.unlock();</del>
cond.notify_all();
<ins>lk.unlock();</ins>
</pre></blockquote>
</blockquote>
</blockquote>
</li>
</ol>





<hr>
<h3 id="3454"><a href="#3454">3454</a><sup><a href="https://cplusplus.github.io/LWG/issue3454">(i)</a></sup>. <code>pointer_traits::pointer_to</code> should be <code>constexpr</code></h3>
<p><b>Section:</b> 20.2.3 <a href="https://wg21.link/pointer.traits">[pointer.traits]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Alisdair Meredith <b>Opened:</b> 2020-06-21 <b>Last modified:</b> 2025-11-05</p>
<p><b>Priority: </b>4
</p>
<p><b>View all other</b> <a href="lwg-index.html#pointer.traits">issues</a> in [pointer.traits].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
Trying to implement a <code>constexpr std::list</code> (inspired by Tim Song's
note on using variant members in the node) as part of evaluating
the <code>constexpr</code> container and adapters proposals, I hit problems
I could not code around in <code>pointer_traits</code>, as only the specialization
for native pointers has a <code>constexpr pointer_to</code> function.
<p/>
This means that containers of my custom allocator, that delegates
all allocation behavior to <code>std::allocator&lt;T&gt;</code> but adds extra
telemetry and uses a fancy pointer, does not work with the approach
I tried for implementing <code>list</code> (common link type, shared between
nodes, and stored as <code>end</code> sentinel directly in the <code>list</code> object).
</p>

<p><i>[2020-07-17; Forwarded to LEWG after review in telecon]</i></p>


<p><i>[2022-07-19; Casey Carter comments]</i></p>

<p>
 This is no longer simply a theoretical problem that impedes implementing 
 <code>constexpr std::list</code>, but an actual defect affecting current 
 implementations of <code>constexpr std::string</code>. More specifically, it 
 makes it impossible to  support so-called "fancy pointers" in a <code>constexpr 
 basic_string</code> that performs the small string optimization (SSO). 
 (<code>pointer_traits::pointer_to</code> is critically necessary to get a 
 pointer that designates the SSO buffer.) As things currently stand, 
 <code>constexpr basic_string</code> can support fancy pointers <em>or</em> SSO, 
 but not both.
</p>
<p><i>[Wrocław 2024-11-18; LEWG approves the direction]</i></p>

<p>
Should there be an Annex C entry noting that program-defined specializations
need to add <code class='backtick'>constexpr</code> to be conforming?
</p>

<p><i>[2025-10-20; Set priority to 4 based on age of issue and lack of recent interest.]</i></p>


<p><i>[Kona 2025-11-05; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>



<p id="res-3454"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/n4861">N4861</a>. 
</p>

<ol>
<li><p>Modify 20.2.3 <a href="https://wg21.link/pointer.traits">[pointer.traits]</a> as indicated:</p>

<blockquote>
<p>
-1- The class template <code>pointer_traits</code> supplies a uniform interface to certain attributes of pointer-like types.
</p>
<blockquote>
<pre>
namespace std {
  template&lt;class Ptr&gt; struct pointer_traits {
    using pointer         = Ptr;
    using element_type    = <i>see below</i>;
    using difference_type = <i>see below</i>;
    
    template&lt;class U&gt; using rebind = <i>see below</i>;
    
    static <ins>constexpr</ins> pointer pointer_to(<i>see below</i> r);
  };
  [&hellip;]
}
</pre>
</blockquote>
</blockquote>
</li>

<li><p>Modify 20.2.3.3 <a href="https://wg21.link/pointer.traits.functions">[pointer.traits.functions]</a> as indicated:</p>

<blockquote>
<pre>
static <ins>constexpr</ins> pointer pointer_traits::pointer_to(<i>see below</i> r);
static constexpr pointer pointer_traits&lt;T*&gt;::pointer_to(<i>see below</i> r) noexcept;
</pre>
<blockquote>
<p>
-1- <i>Mandates:</i> For the first member function, <code>Ptr::pointer_to(r)</code> is well-formed.
<p/>
-2- <i>Preconditions:</i> For the first member function, <code>Ptr::pointer_to(r)</code> returns a pointer 
to <code>r</code> through which indirection is valid.
<p/>
-3- <i>Returns:</i> The first member function returns <code>Ptr::pointer_to(r)</code>. The second member function
returns <code>addressof(r)</code>.
<p/>
-4- <i>Remarks:</i> If <code>element_type</code> is <i>cv</i> <code>void</code>, the type of <code>r</code> is unspecified; 
otherwise, it is <code>element_type&amp;</code>.
</p>
</blockquote>
</blockquote>
</li>
</ol>






<hr>
<h3 id="4015"><a href="#4015">4015</a><sup><a href="https://cplusplus.github.io/LWG/issue4015">(i)</a></sup>. LWG 3973 broke <code>const</code> overloads of <code>std::optional</code> monadic operations</h3>
<p><b>Section:</b> 22.5.3.8 <a href="https://wg21.link/optional.monadic">[optional.monadic]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Jonathan Wakely <b>Opened:</b> 2023-11-24 <b>Last modified:</b> 2025-11-05</p>
<p><b>Priority: </b>1
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
The resolution of LWG <a href="lwg-defects.html#3973" title="Monadic operations should be ADL-proof (Status: WP)">3973</a><sup><a href="https://cplusplus.github.io/LWG/issue3973" title="Latest snapshot">(i)</a></sup> (adopted in Kona) changed all
occurrences of <code>value()</code> to <code>*val</code>.
The intention was not to change the meaning, just avoid the non-freestanding
<code>value()</code> function, and avoid ADL that would be caused by using
<code>**this</code>.
However, in the <code>const</code> overloads such as
<code>and_then(F&amp;&amp;) const</code> the type of <code>value()</code>
was <code>const T&amp;</code>, but the type of <code>*val</code> is always
<code>T&amp;</code>. This implies that the const overloads invoke the callable
with a non-const argument, which is incorrect (and would be undefined
behaviour for a <code>const std::optional&lt;T&gt;</code>).

</p>
<p>
On the LWG reflector it was suggested that we should rewrite the specification
of <code>std::optional</code> to stop using an exposition-only data member
of type <code>T*</code>. No such member ever exists in real implemetations,
so it is misleading and leads to specification bugs of this sort.
</p>
<p>
Change the class definition in 22.5.3.1 <a href="https://wg21.link/optional.optional.general">[optional.optional.general]</a>
to use a union, and update every use of <code>val</code> accordingly
throughout 22.5.3 <a href="https://wg21.link/optional.optional">[optional.optional]</a>.
For consistency with 22.8.6.1 <a href="https://wg21.link/expected.object.general">[expected.object.general]</a> we might
also want to introduce a <code>bool has_val</code> member and refer to
that in the specification.
</p>
<blockquote>
<pre><code>
  private:
    <del>T *val;         <em>// exposition only</em></del>
    <ins>bool has_val;   <em>// exposition only</em></ins>
    <ins>union {</ins>
      <ins>T val;        <em>// exposition only</em></ins>
    <ins>};</ins>
  };
</code></pre>
</blockquote>
<p>For example, in 22.5.3.9 <a href="https://wg21.link/optional.mod">[optional.mod]</a>:</p>
<blockquote>
<p>
-1- <i>Effects</i>:
If <code>*this</code> contains a value, calls
<code>val<del>-&gt;</del><ins>.</ins>T::~T()</code> to destroy the contained
value<ins> and sets <code>has_val</code> to <code>false</code></ins>;
otherwise no effect.
</p>
</blockquote>

<p><i>[2023-11-26; Daniel provides wording]</i></p>

<p>
The proposed wording is considerably influenced by that of the specification of <code>expected</code>, but
attempts to reduce the amount of changes to not perfectly mimic it. Although "the contained value" is
a magic word of power it seemed feasible and simpler to use the new exposition-only member <code><i>val</i></code>
directly in some (but not all) places, usually involved with initializations.
<p/>
Furthermore, I have only added "and sets <code><i>has_val</i></code> to <code>true/false</code>"
where either the <i>Effects</i> wording says "otherwise no effect" or in other cases if the postconditions
did not already say that indirectly. I also added extra mentioning of <code><i>has_val</i></code> changes in tables
where different cells had very different effects on that member (unless these cells specify postconditions),
to prevent misunderstanding.
</p>

<p><i>[2024-03-11; Reflector poll]</i></p>

<p>
Set priority to 1 after reflector poll in November 2023.
Six votes for 'Tentatively Ready' but enough uncertainty to deserve
discussion at a meeting.
</p>

<p><strong>Previous resolution [SUPERSEDED]:</strong></p>
<blockquote class="note">

<p>
This wording is relative to <a href="https://wg21.link/N4964" title=" Working Draft, Programming Languages — C++">N4964</a> <em>after</em> application of the wording of LWG <a href="lwg-defects.html#3973" title="Monadic operations should be ADL-proof (Status: WP)">3973</a><sup><a href="https://cplusplus.github.io/LWG/issue3973" title="Latest snapshot">(i)</a></sup>.
</p>

<ol>

<li><p>Modify 22.5.3.1 <a href="https://wg21.link/optional.optional.general">[optional.optional.general]</a>, class template <code>optional</code> synopsis, as indicated:</p>

<blockquote>
<pre>
namespace std {
  template&lt;class T&gt;
  class optional {
  public:
    using value_type = T;
    [&hellip;]
  private:
    <ins>bool <i>has_val</i>; // <i>exposition only</i>
    union {</ins>
      T <ins><i>val</i></ins><del>*val</del>; // <i>exposition only</i>
    <ins>};</ins>
  };

  [&hellip;]
}
</pre>
</blockquote>
</li>

<li><p>Modify 22.5.3.1 <a href="https://wg21.link/optional.optional.general">[optional.optional.general]</a> as indicated:</p>

<blockquote>
<p>
-2- <ins>Member <code><i>has_val</i></code> indicates whether an <code>optional&lt;T&gt;</code> object contains a
value</ins><del>When an <code>optional&lt;T&gt;</code> object contains a value, member <code>val</code> points to
the contained value</del>.
</p>
</blockquote>
</li>

<li><p>Modify 22.5.3.2 <a href="https://wg21.link/optional.ctor">[optional.ctor]</a> as indicated:</p>

<blockquote class="note">
<p>
[<i>Drafting note</i>: Normatively, this subclause doesn't require any changes, but I'm suggesting to replace
phrases of the form "[&hellip;]initializes the contained value with"] by "[&hellip;]initializes <code><i>val</i></code> with"
as we do in 22.8.6.2 <a href="https://wg21.link/expected.object.cons">[expected.object.cons]</a>. I intentionally did not add extra
"and sets <code><i>has_val</i></code> to <code>true/false</code>" since those effects are already guaranteed by the postconditions]
</p>
</blockquote>

<blockquote>
<pre>
constexpr optional(const optional&amp; rhs);
</pre>
<blockquote>
<p>
-4- <i>Effects</i>: If <code>rhs</code> contains a value, direct-non-list-initializes
<ins><code><i>val</i></code></ins><del>the contained value</del> with <code><del>*</del>rhs<ins>.<i>val</i></ins></code>.
<p/>
-5- <i>Postconditions</i>: <code>rhs.has_value() == this-&gt;has_value()</code>.
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
constexpr optional(optional&amp;&amp; rhs) noexcept(<i>see below</i>);
</pre>
<blockquote>
<p>
-8- <i>Constraints</i>: [&hellip;]
<p/>
-9- <i>Effects</i>: If <code>rhs</code> contains a value, direct-non-list-initializes
<ins><code><i>val</i></code></ins><del>the contained value</del> with <code>std::move(<del>*</del>rhs<ins>.<i>val</i></ins>)</code>.
<code>rhs.has_value()</code> is unchanged.
<p/>
-10- <i>Postconditions</i>: <code>rhs.has_value() == this-&gt;has_value()</code>.
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
template&lt;class... Args&gt; constexpr explicit optional(in_place_t, Args&amp;&amp;... args);
</pre>
<blockquote>
<p>
-13- <i>Constraints</i>: [&hellip;]
<p/>
-14- <i>Effects</i>: Direct-non-list-initializes <ins><code><i>val</i></code></ins><del>the contained value</del>
with <code>std::forward&lt;Args&gt;(args)...</code>.
<p/>
-15- <i>Postconditions</i>: <code>*this</code> contains a value.
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
template&lt;class U, class... Args&gt;
  constexpr explicit optional(in_place_t, initializer_list&lt;U&gt; il, Args&amp;&amp;... args);
</pre>
<blockquote>
<p>
-18- <i>Constraints</i>: [&hellip;]
<p/>
-19- <i>Effects</i>: Direct-non-list-initializes <ins><code><i>val</i></code></ins><del>the contained value</del>
with <code>il, std::forward&lt;Args&gt;(args)...</code>.
<p/>
-20- <i>Postconditions</i>: <code>*this</code> contains a value.
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
template&lt;class U = T&gt; constexpr explicit(<i>see below</i>) optional(U&amp;&amp; v);
</pre>
<blockquote>
<p>
-23- <i>Constraints</i>: [&hellip;]
<p/>
-24- <i>Effects</i>: Direct-non-list-initializes <ins><code><i>val</i></code></ins><del>the contained value</del>
with <code>std::forward&lt;U&gt;(v)</code>.
<p/>
-25- <i>Postconditions</i>: <code>*this</code> contains a value.
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
template&lt;class U&gt; constexpr explicit(<i>see below</i>) optional(const optional&lt;U&gt;&amp; rhs);
</pre>
<blockquote>
<p>
-28- <i>Constraints</i>: [&hellip;]
<p/>
-29- <i>Effects</i>: If <code>rhs</code> contains a value, direct-non-list-initializes
<ins><code><i>val</i></code></ins><del>the contained value</del> with <code><del>*</del>rhs<ins>.<i>val</i></ins></code>.
<p/>
-30- <i>Postconditions</i>: <code>rhs.has_value() == this-&gt;has_value()</code>.
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
template&lt;class U&gt; constexpr explicit(<i>see below</i>) optional(optional&lt;U&gt;&amp;&amp; rhs);
</pre>
<blockquote>
<p>
-33- <i>Constraints</i>: [&hellip;]
<p/>
-34- <i>Effects</i>: If <code>rhs</code> contains a value, direct-non-list-initializes
<ins><code><i>val</i></code></ins><del>the contained value</del> with
<code>std::move(<del>*</del>rhs<ins>.<i>val</i></ins>)</code>. <code>rhs.has_value()</code> is unchanged.
<p/>
-35- <i>Postconditions</i>: <code>rhs.has_value() == this-&gt;has_value()</code>.
<p/>
[&hellip;]
</p>
</blockquote>
</blockquote>
</li>

<li><p>Modify 22.5.3.3 <a href="https://wg21.link/optional.dtor">[optional.dtor]</a> as indicated:</p>

<blockquote>
<pre>
constexpr ~optional();
</pre>
<blockquote>
<p>
-1- <i>Effects</i>: If <code>is_trivially_destructible_v&lt;T&gt; != true</code> and <code>*this</code> contains a value,
calls <code><del>val-&gt;</del><ins><i>val</i>.</ins>T::~T()</code><ins>.</ins>
</p>
</blockquote>
</blockquote>
</li>

<li><p>Modify 22.5.3.4 <a href="https://wg21.link/optional.assign">[optional.assign]</a> as indicated:</p>

<blockquote>
<pre>
constexpr optional&lt;T&gt;&amp; operator=(nullopt_t) noexcept;
</pre>
<blockquote>
<p>
-1- <i>Effects</i>: If <code>*this</code> contains a value, calls
<code><del>val-&gt;</del><ins><i>val</i>.</ins>T::~T()</code> to destroy the contained
value <ins>and sets <code><i>has_val</i></code> to <code>false</code></ins>; otherwise no effect.
<p/>
-2- <i>Postconditions</i>: <code>*this</code> does not contain a value.
</p>
</blockquote>
<pre>
constexpr optional&lt;T&gt;&amp; operator=(const optional&amp; rhs);
</pre>
<blockquote>
<p>
-4- <i>Effects</i>: See Table 58.
</p>
<table border="1">
<caption>Table 58 &mdash; <code>optional::operator=(const optional&amp;)</code> effects [tab:optional.assign.copy]</caption>

<tr>
<th></th>
<th><b><code>*this</code> contains a value</b></th>
<th><b><code>*this</code> does not contain a value</b></th>
</tr>

<tr>
<td><b><code>rhs</code> contains a value</b></td>
<td>assigns <code><del>*</del>rhs<ins>.<i>val</i></ins></code> to <ins><code><i>val</i></code></ins><del>the contained value</del></td>
<td>direct-non-list-initializes <ins><code><i>val</i></code></ins><del>the contained value</del>
with <code><del>*</del>rhs<ins>.<i>val</i></ins></code><br/>
<ins>and sets <code><i>has_val</i></code> to <code>true</code></ins>
</td>
</tr>

<tr>
<td><b><code>rhs</code> does not contain a value</b></td>
<td>destroys the contained value by calling <code><del>val-&gt;</del><ins><i>val</i>.</ins>T::~T()</code><br/>
<ins>and sets <code><i>has_val</i></code> to <code>false</code></ins>
</td>
<td>no effect</td>
</tr>
</table>
<p>
-5- <i>Postconditions</i>: <code>rhs.has_value() == this-&gt;has_value()</code>.
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
constexpr optional&lt;T&gt;&amp; operator=(optional&amp;&amp; rhs) noexcept(<i>see below</i>);
</pre>
<blockquote>
<p>
-8- <i>Constraints</i>: [&hellip;]
<p/>
-9- <i>Effects</i>: See Table 59. The result of the expression <code>rhs.has_value()</code> remains unchanged.
<p/>
-10- <i>Postconditions</i>: <code>rhs.has_value() == this-&gt;has_value()</code>.
<p/>
-11- <i>Returns</i>: <code>*this</code>.
</p>
<table border="1">
<caption>Table 59 &mdash; <code>optional::operator=(optional&amp;&amp;)</code> effects [tab:optional.assign.move]</caption>

<tr>
<th></th>
<th><b><code>*this</code> contains a value</b></th>
<th><b><code>*this</code> does not contain a value</b></th>
</tr>

<tr>
<td><b><code>rhs</code> contains a value</b></td>
<td>assigns <code>std::move(<del>*</del>rhs<ins>.<i>val</i></ins>)</code> to <ins><code><i>val</i></code></ins><del>the contained value</del></td>
<td>direct-non-list-initializes <ins><code><i>val</i></code></ins><del>the contained value</del> with
<code>std::move(<del>*</del>rhs<ins>.<i>val</i></ins>)</code> <ins>and sets <code><i>has_val</i></code> to <code>true</code></ins></td>
</tr>

<tr>
<td><b><code>rhs</code> does not contain a value</b></td>
<td>destroys the contained value by calling<br/>
<code><del>val-&gt;</del><ins><i>val</i>.</ins>T::~T()</code><ins>and sets <code><i>has_val</i></code> to <code>false</code></ins></td>
<td>no effect</td>
</tr>
</table>
<p>
-12- <i>Remarks</i>: [&hellip;]
<p/>
-13- If any exception is thrown, the result of the expression <code>this-&gt;has_value()</code> remains
unchanged. If an exception is thrown during the call to <code>T</code>'s move constructor, the state
of <code><del>*</del>rhs.<ins><i>val</i></ins><del>val</del></code> is determined by the exception
safety guarantee of <code>T</code>'s move constructor. If an exception is thrown during the call to
<code>T</code>'s move assignment, the state of <code><del>*</del><ins><i>val</i></ins><del>val</del></code>
and <code><del>*</del>rhs.<ins><i>val</i></ins><del>val</del></code> is determined by the exception
safety guarantee of <code>T</code>'s move assignment.
</p>
</blockquote>
<pre>
template&lt;class U = T&gt; constexpr optional&lt;T&gt;&amp; operator=(U&amp;&amp; v);
</pre>
<blockquote>
<p>
-14- <i>Constraints</i>: [&hellip;]
<p/>
-15- <i>Effects</i>: If <code>*this</code> contains a value, assigns <code>std::forward&lt;U&gt;(v)</code>
to <ins><code><i>val</i></code></ins><del>the contained value</del>; otherwise direct-non-list-initializes
<ins><code><i>val</i></code></ins><del>the contained value</del> with <code>std::forward&lt;U&gt;(v)</code>.
<p/>
-16- <i>Postconditions</i>: <code>*this</code> contains a value.
<p/>
-17- <i>Returns</i>: <code>*this</code>.
<p/>
-18- <i>Remarks</i>: If any exception is thrown, the result of the expression <code>this-&gt;has_value()</code>
remains unchanged. If an exception is thrown during the call to <code>T</code>'s constructor, the state of
<code>v</code> is determined by the exception safety guarantee of <code>T</code>'s constructor. If an exception
is thrown during the call to <code>T</code>'s assignment, the state of <code><ins><i>val</i></ins><del>*val</del></code>
and <code>v</code> is determined by the exception safety guarantee of <code>T</code>'s assignment.
</p>
</blockquote>
<pre>
template&lt;class U&gt; constexpr optional&lt;T&gt;&amp; operator=(const optional&lt;U&gt;&amp; rhs);
</pre>
<blockquote>
<p>
-19- <i>Constraints</i>: [&hellip;]
<p/>
-20- <i>Effects</i>: See Table 60.
</p>
<table border="1">
<caption>Table 60 &mdash; <code>optional::operator=(const optional&lt;U&gt;&amp;)</code> effects [tab:optional.assign.copy.templ]</caption>

<tr>
<th></th>
<th><b><code>*this</code> contains a value</b></th>
<th><b><code>*this</code> does not contain a value</b></th>
</tr>

<tr>
<td><b><code>rhs</code> contains a value</b></td>
<td>assigns <code><del>*</del>rhs<ins>.<i>val</i></ins></code> to <ins><code><i>val</i></code></ins><del>the contained value</del></td>
<td>direct-non-list-initializes <ins><code><i>val</i></code></ins><del>the contained value</del>
with <code><del>*</del>rhs<ins>.<i>val</i></ins></code> <ins>and sets <code><i>has_val</i></code> to <code>true</code></ins></td>
</tr>

<tr>
<td><b><code>rhs</code> does not contain a value</b></td>
<td>destroys the contained value by calling<br/>
<code><del>val-&gt;</del><ins><i>val</i>.</ins>T::~T()</code> <ins>and sets <code><i>has_val</i></code> to <code>false</code></ins></td>
<td>no effect</td>
</tr>
</table>
<p>
-21- <i>Postconditions</i>: <code>rhs.has_value() == this-&gt;has_value()</code>.
<p/>
-22- <i>Returns</i>: <code>*this</code>.
<p/>
-23- If any exception is thrown, the result of the expression <code>this-&gt;has_value()</code> remains
unchanged. If an exception is thrown during the call to <code>T</code>'s constructor, the state of
<code><del>*</del>rhs.<ins><i>val</i></ins><del>val</del></code> is determined by the exception safety
guarantee of <code>T</code>'s constructor. If an exception is thrown during the call to <code>T</code>'s
assignment, the state of <code><ins><i>val</i></ins><del>*val</del></code> and
<code><del>*</del>rhs.<ins><i>val</i></ins><del>val</del></code> is determined by the exception safety
guarantee of <code>T</code>'s assignment.
</p>
</blockquote>
<pre>
template&lt;class U&gt; constexpr optional&lt;T&gt;&amp; operator=(optional&lt;U&gt;&amp;&amp; rhs);
</pre>
<blockquote>
<p>
-24- <i>Constraints</i>: [&hellip;]
<p/>
-25- <i>Effects</i>: See Table 61. The result of the expression <code>rhs.has_value()</code> remains unchanged.
</p>
<table border="1">
<caption>Table 61 &mdash; <code>optional::operator=(optional&lt;U&gt;&amp;&amp;)</code> effects [tab:optional.assign.move.templ]</caption>

<tr>
<th></th>
<th><b><code>*this</code> contains a value</b></th>
<th><b><code>*this</code> does not contain a value</b></th>
</tr>

<tr>
<td><b><code>rhs</code> contains a value</b></td>
<td>assigns <code>std::move(<del>*</del>rhs<ins>.<i>val</i></ins>)</code> to <ins><code><i>val</i></code></ins><del>the contained value</del></td>
<td>direct-non-list-initializes <ins><code><i>val</i></code></ins><del>the contained value</del> with<br/>
<code>std::move(<del>*</del>rhs<ins>.<i>val</i></ins>)</code> <ins>and sets <code><i>has_val</i></code> to <code>true</code></ins></td>
</tr>

<tr>
<td><b><code>rhs</code> does not contain a value</b></td>
<td>destroys the contained value by calling<br/>
<code><del>val-&gt;</del><ins><i>val</i>.</ins>T::~T()</code> <ins>and sets <code><i>has_val</i></code> to <code>false</code></ins></td>
<td>no effect</td>
</tr>
</table>
<p>
-26- <i>Postconditions</i>: <code>rhs.has_value() == this-&gt;has_value()</code>.
<p/>
-27- <i>Returns</i>: <code>*this</code>.
<p/>
-28- If any exception is thrown, the result of the expression <code>this-&gt;has_value()</code> remains
unchanged. If an exception is thrown during the call to <code>T</code>'s constructor, the state of
<code><del>*</del>rhs.<ins><i>val</i></ins><del>val</del></code> is determined by the exception safety
guarantee of <code>T</code>'s constructor. If an exception is thrown during the call to <code>T</code>'s
assignment, the state of <code><ins><i>val</i></ins><del>*val</del></code> and
<code><del>*</del>rhs.<ins><i>val</i></ins><del>val</del></code> is determined by the exception safety
guarantee of <code>T</code>'s assignment.
</p>
</blockquote>
<pre>
template&lt;class... Args&gt; constexpr T&amp; emplace(Args&amp;&amp;... args);
</pre>
<blockquote>
<p>
-29- <i>Mandates</i>: [&hellip;]
<p/>
-30- <i>Effects</i>: Calls <code>*this = nullopt</code>. Then direct-non-list-initializes
<ins><code><i>val</i></code></ins><del>the contained value</del> with <code>std::forward&lt;Args&gt;(args)...</code>.
<p/>
-31- <i>Postconditions</i>: <code>*this</code> contains a value.
<p/>
-32- <i>Returns</i>: <ins><code><i>val</i></code></ins><del>A reference to the new contained value</del>.
<p/>
[&hellip;]
<p/>
-34- <i>Remarks</i>: If an exception is thrown during the call to <code>T</code>'s constructor, <code>*this</code>
does not contain a value, and the previous <code><ins><i>val</i></ins><del>*val</del></code> (if any)
has been destroyed.
</p>
</blockquote>
<pre>
template&lt;class U, class... Args&gt; constexpr T&amp; emplace(initializer_list&lt;U&gt; il, Args&amp;&amp;... args);
</pre>
<blockquote>
<p>
-35- <i>Constraints</i>: [&hellip;]
<p/>
-36- <i>Effects</i>: Calls <code>*this = nullopt</code>. Then direct-non-list-initializes
<ins><code><i>val</i></code></ins><del>the contained value</del> with <code>il, std::forward&lt;Args&gt;(args)...</code>.
<p/>
-37- <i>Postconditions</i>: <code>*this</code> contains a value.
<p/>
-38- <i>Returns</i>: <ins><code><i>val</i></code></ins><del>A reference to the new contained value</del>.
<p/>
[&hellip;]
<p/>
-40- <i>Remarks</i>: If an exception is thrown during the call to <code>T</code>'s constructor, <code>*this</code>
does not contain a value, and the previous <code><ins><i>val</i></ins><del>*val</del></code> (if any)
has been destroyed.
</p>
</blockquote>
</blockquote>
</li>

<li><p>Modify 22.5.3.5 <a href="https://wg21.link/optional.swap">[optional.swap]</a> as indicated:</p>

<blockquote>
<pre>
constexpr void swap(optional&amp; rhs) noexcept(<i>see below</i>);
</pre>
<blockquote>
<p>
-1- <i>Mandates</i>: [&hellip;]
<p/>
-2- <i>Preconditions</i>: [&hellip;]
<p/>
-3- <i>Effects</i>: See Table 62.
</p>
<table border="1">
<caption>Table 62 &mdash; <code>optional::swap(optional&amp;)</code> effects [tab:optional.swap]</caption>

<tr>
<th></th>
<th><b><code>*this</code> contains a value</b></th>
<th><b><code>*this</code> does not contain a value</b></th>
</tr>

<tr>
<td><b><code>rhs</code> contains a value</b></td>
<td>calls <code>swap(<ins><i>val</i></ins><del>*(*this)</del>, <del>*</del>rhs<ins>.<i>val</i></ins>)</code></td>
<td>direct-non-list-initializes <ins><code><i>val</i></code></ins><del>the contained value of <code>*this</code></del><br/>
with <code>std::move(<del>*</del>rhs<ins>.<i>val</i></ins>)</code>, followed by <code>rhs.<ins><i>val</i>.</ins><del>val-&gt;</del>T::~T()</code>;<br/>
postcondition is that <code>*this</code> contains a value and <code>rhs</code> does<br/>
not contain a value</td>
</tr>

<tr>
<td><b><code>rhs</code> does not contain a value</b></td>
<td>direct-non-list-initializes <del>the contained value of</del> <code>rhs<ins>.<i>val</i></ins></code><br/>
with <code>std::move(<ins><i>val</i></ins><del>*(*this)</del>)</code>, followed by <code><ins><i>val</i>.</ins><del>val-&gt;</del>T::~T()</code>;<br/>
postcondition is that <code>*this</code> does not contain a value and <code>rhs</code><br/>
contains a value</td>
<td>no effect</td>
</tr>
</table>
<p>
-4- <i>Throws</i>: [&hellip;]
<p/>
-5- <i>Remarks</i>: [&hellip;]
<p/>
-6- If any exception is thrown, the results of the expressions <code>this-&gt;has_value()</code> and
<code>rhs.has_value()</code> remain unchanged. If an exception is thrown during the call to function <code>swap</code>,
the state of <code><ins><i>val</i></ins><del>*val</del></code> and
<code><del>*</del>rhs.<ins><i>val</i></ins><del>val</del></code> is determined by the exception safety
guarantee of <code>swap</code> for lvalues of <code>T</code>. If an exception is thrown during the call to
<code>T</code>'s move constructor, the state of <code><ins><i>val</i></ins><del>*val</del></code> and
<code><del>*</del>rhs.<ins><i>val</i></ins><del>val</del></code> is determined by the exception safety
guarantee of <code>T</code>'s move constructor.
<p/>
</p>
</blockquote>
</blockquote>
</li>

<li><p>Modify 22.5.3.7 <a href="https://wg21.link/optional.observe">[optional.observe]</a> as indicated:</p>

<blockquote>
<pre>
constexpr const T* operator-&gt;() const noexcept;
constexpr T* operator-&gt;() noexcept;
</pre>
<blockquote>
<p>
-1- <i>Preconditions</i>: <code>*this</code> contains a value.
<p/>
-2- <i>Returns</i>: <code><ins>addressof(<i>val</i>)</ins><del>val</del></code>.
<p/>
-3- [&hellip;]
</p>
</blockquote>
<pre>
constexpr const T&amp; operator*() const &amp; noexcept;
constexpr T&amp; operator*() &amp; noexcept;
</pre>
<blockquote>
<p>
-4- <i>Preconditions</i>: <code>*this</code> contains a value.
<p/>
-5- <i>Returns</i>: <code><ins><i>val</i></ins><del>*val</del></code>.
<p/>
-6- [&hellip;]
</p>
</blockquote>
<pre>
constexpr T&amp;&amp; operator*() &amp;&amp; noexcept;
constexpr const T&amp;&amp; operator*() const &amp;&amp; noexcept;
</pre>
<blockquote>
<p>
-7- <i>Preconditions</i>: <code>*this</code> contains a value.
<p/>
-8- <i>Effects</i>: Equivalent to: <code>return std::move(<ins><i>val</i></ins><del>*val</del>);</code>
</p>
</blockquote>
<pre>
constexpr explicit operator bool() const noexcept;
</pre>
<blockquote>
<p>
<del>-9- <i>Returns</i>: <code>true</code> if and only if <code>*this</code> contains a value.</del>
<p/>
<del>-10- <i>Remarks</i>: This function is a constexpr function.</del>
</p>
</blockquote>
<pre>
constexpr bool has_value() const noexcept;
</pre>
<blockquote>
<p>
-11- <i>Returns</i>: <ins><code><i>has_val</i></code></ins><del><code>true</code> if and only if <code>*this</code> contains a value</del>.
<p/>
-12- <i>Remarks</i>: <ins>These functions are</ins><del>This function is a</del> constexpr function<ins>s</ins>.
</p>
</blockquote>
<pre>
constexpr const T&amp; value() const &amp;;
constexpr T&amp; value() &amp;;
</pre>
<blockquote>
<p>
-13- <i>Effects</i>: Equivalent to:
</p>
<blockquote><pre>
return has_value() ? <ins><i>val</i></ins><del>*val</del> : throw bad_optional_access();
</pre></blockquote>
</blockquote>
<pre>
constexpr T&amp;&amp; value() &amp;&amp;;
constexpr const T&amp;&amp; value() const &amp;&amp;;
</pre>
<blockquote>
<p>
-14- <i>Effects</i>: Equivalent to:
</p>
<blockquote><pre>
return has_value() ? std::move(<ins><i>val</i></ins><del>*val</del>) : throw bad_optional_access();
</pre></blockquote>
</blockquote>
<pre>
template&lt;class U&gt; constexpr T value_or(U&amp;&amp; v) const &amp;;
</pre>
<blockquote>
<p>
-15- <i>Mandates</i>: [&hellip;]
<p/>
-16- <i>Effects</i>: Equivalent to:
</p>
<blockquote><pre>
return has_value() ? <ins><i>val</i></ins><del>**this</del> : static_cast&lt;T&gt;(std::forward&lt;U&gt;(v));
</pre></blockquote>
</blockquote>
<pre>
template&lt;class U&gt; constexpr T value_or(U&amp;&amp; v) &amp;&amp;;
</pre>
<blockquote>
<p>
-17- <i>Mandates</i>: [&hellip;]
<p/>
-18- <i>Effects</i>: Equivalent to:
</p>
<blockquote><pre>
return has_value() ? std::move(<ins><i>val</i></ins><del>**this</del>) : static_cast&lt;T&gt;(std::forward&lt;U&gt;(v));
</pre></blockquote>
</blockquote>
</blockquote>
</li>

<li><p>Modify 22.5.3.8 <a href="https://wg21.link/optional.monadic">[optional.monadic]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class F&gt; constexpr auto and_then(F&amp;&amp; f) &amp;;
template&lt;class F&gt; constexpr auto and_then(F&amp;&amp; f) const &amp;;
</pre>
<blockquote>
<p>
-1- Let <code>U</code> be <code>invoke_result_t&lt;F, decltype(<ins>(<i>val</i>)</ins><del>*val</del>)&gt;</code>.
<p/>
-2- <i>Mandates</i>: [&hellip;]
<p/>
-3- <i>Effects</i>: Equivalent to:
</p>
<blockquote><pre>
if (*this) {
  return invoke(std::forward&lt;F&gt;(f), <ins><i>val</i></ins><del>*val</del>);
} else {
  return remove_cvref_t&lt;U&gt;();
}
</pre></blockquote>
</blockquote>
<pre>
template&lt;class F&gt; constexpr auto and_then(F&amp;&amp; f) &amp;&amp;;
template&lt;class F&gt; constexpr auto and_then(F&amp;&amp; f) const &amp;&amp;;
</pre>
<blockquote>
<p>
-4- Let <code>U</code> be <code>invoke_result_t&lt;F, decltype(std::move(<ins><i>val</i></ins><del>*val</del>))&gt;</code>.
<p/>
-5- <i>Mandates</i>: [&hellip;]
<p/>
-6- <i>Effects</i>: Equivalent to:
</p>
<blockquote><pre>
if (*this) {
  return invoke(std::forward&lt;F&gt;(f), std::move(<ins><i>val</i></ins><del>*val</del>));
} else {
  return remove_cvref_t&lt;U&gt;();
}
</pre></blockquote>
</blockquote>
<pre>
template&lt;class F&gt; constexpr auto transform(F&amp;&amp; f) &amp;;
template&lt;class F&gt; constexpr auto transform(F&amp;&amp; f) const &amp;;
</pre>
<blockquote>
<p>
-7- Let <code>U</code> be <code>remove_cv_t&lt;invoke_result_t&lt;F, decltype(<ins>(<i>val</i>)</ins><del>*val</del>)&gt;&gt;</code>.
<p/>
-8- <i>Mandates</i>: <code>U</code> is a non-array object type other than <code>in_place_t</code> or <code>nullopt_t</code>. The declaration
</p>
<blockquote><pre>
U u(invoke(std::forward&lt;F&gt;(f), <ins><i>val</i></ins><del>*val</del>));
</pre></blockquote>
<p>
is well-formed for some invented variable <code>u</code>.
<p/>
[&hellip;]
<p/>
-9- <i>Returns</i>: If <code>*this</code> contains a value, an <code>optional&lt;U&gt;</code> object whose contained value is
direct-non-list-initialized with <code>invoke(std::forward&lt;F&gt;(f), <ins><i>val</i></ins><del>*val</del>)</code>; otherwise,
<code>optional&lt;U&gt;()</code>.
</p>
</blockquote>
<pre>
template&lt;class F&gt; constexpr auto transform(F&amp;&amp; f) &amp;&amp;;
template&lt;class F&gt; constexpr auto transform(F&amp;&amp; f) const &amp;&amp;;
</pre>
<blockquote>
<p>
-10- Let <code>U</code> be <code>remove_cv_t&lt;invoke_result_t&lt;F, decltype(std::move(<ins><i>val</i></ins><del>*val</del>))&gt;&gt;</code>.
<p/>
-11- <i>Mandates</i>: <code>U</code> is a non-array object type other than <code>in_place_t</code> or <code>nullopt_t</code>. The declaration
</p>
<blockquote><pre>
U u(invoke(std::forward&lt;F&gt;(f), std::move(<ins><i>val</i></ins><del>*val</del>)));
</pre></blockquote>
<p>
is well-formed for some invented variable <code>u</code>.
<p/>
[&hellip;]
<p/>
-12- <i>Returns</i>: If <code>*this</code> contains a value, an <code>optional&lt;U&gt;</code> object whose contained value is
direct-non-list-initialized with <code>invoke(std::forward&lt;F&gt;(f), std::move(<ins><i>val</i></ins><del>*val</del>))</code>; otherwise,
<code>optional&lt;U&gt;()</code>.
</p>
</blockquote>
</blockquote>
</li>

<li><p>Modify 22.5.3.9 <a href="https://wg21.link/optional.mod">[optional.mod]</a> as indicated:</p>

<blockquote>
<pre>
constexpr void reset() noexcept;
</pre>
<blockquote>
<p>
-1- <i>Effects</i>: If <code>*this</code> contains a value, calls <code><del>val-&gt;</del><ins><i>val</i>.</ins>T::~T()</code>
to destroy the contained value <ins>and sets <code><i>has_val</i></code> to <code>false</code></ins>; otherwise no effect.
<p/>
-2- <i>Postconditions</i>: <code>*this</code> does not contain a value.
</p>
</blockquote>
</blockquote>
</li>

</ol>
</blockquote>

<p><i>[St. Louis 2024-06-24; Jonathan provides improved wording]</i></p>

<p><i>[2024-08-21; LWG telecon]</i></p>

<p>
During telecon review it was suggested to replace
22.5.3.1 <a href="https://wg21.link/optional.optional.general">[optional.optional.general]</a> p1 and p2.
On the reflector Daniel requested to keep the "additional storage" prohibition,
so that will be addressed by issue <a href="lwg-defects.html#4141" title="Improve prohibitions on &quot;additional storage&quot; (Status: WP)">4141</a><sup><a href="https://cplusplus.github.io/LWG/issue4141" title="Latest snapshot">(i)</a></sup> instead.
</p>

<p><i>[2024-10-02; Jonathan tweaks proposed resolution]</i></p>

<p>
On the reflector we decided that the union member should use <code class='backtick'>remove_cv_t</code>,
as proposed for <code class='backtick'>expected</code> by issue <a href="lwg-active.html#3891" title="LWG 3870 breaks std::expected&lt;cv T, E&gt; (Status: New)">3891</a><sup><a href="https://cplusplus.github.io/LWG/issue3891" title="Latest snapshot">(i)</a></sup>.
The rest of the proposed resolution is unchanged, so that edit was made
in-place below, instead of as a new resolution that supersedes the old one.
</p>

<p><strong>Previous resolution [SUPERSEDED]:</strong></p>
<blockquote class="note">

<p>
This wording is relative to <a href="https://wg21.link/N4988" title=" Working Draft, Programming Languages — C++">N4988</a>.
</p>

<ol>

<li><p>Modify 22.5.3.1 <a href="https://wg21.link/optional.optional.general">[optional.optional.general]</a>, class template <code>optional</code> synopsis, as indicated:</p>

<blockquote>
<pre>
namespace std {
  template&lt;class T&gt;
  class optional {
  public:
    using value_type = T;
    [&hellip;]
  private:
    <del>*val // <i>exposition only</i></del>;
    <ins>union {</ins>
      <ins>remove_cv_t&lt;T&gt; <i>val</i>; // <i>exposition only</i></ins>
    <ins>};</ins>
  };

  [&hellip;]
}
</pre>
</blockquote>
</li>

<li><p>Modify 22.5.3.1 <a href="https://wg21.link/optional.optional.general">[optional.optional.general]</a> as indicated:</p>

<blockquote>
<p>
-1-
<ins>
When its member <code><i>val</i></code> is active
(11.5.1 <a href="https://wg21.link/class.union.general">[class.union.general]</a>),
an instance of <code>optional&lt;T&gt;</code> is said to
<i>contain a value</i>, and <code><i>val</i></code> is referred to as its
<i>contained value</i>.
</ins>
<del>
Any instance of <code>optional&lt;T&gt;</code> at any given time either
contains a value or does not contain a value.
When an instance of <code>optional&lt;T&gt;</code> <i>contains a value</i>,
it means that an object of type <code>T</code>,
referred to as the</del>
<ins>An</ins>
optional object's
<ins>contained value</ins>
<del><i>contained value</i>, </del>
is allocated within the storage of the optional object.
Implementations are not permitted to use additional storage,
such as dynamic memory, to allocate its contained value.
<del>
When an object of type <code>optional&lt;T&gt;</code>
is contextually converted to <code>bool</code>,
the conversion returns <code class='backtick'>true</code> if the object contains a value;
otherwise the conversion returns <code class='backtick'>false</code>.
</del>
</p>
<p>
<del>
-2- When an <code>optional&lt;T&gt;</code> object contains a value,
member <code>val</code>
points to the contained value.
</del>
</p>
</blockquote>
</li>

<li><p>Modify 22.5.3.2 <a href="https://wg21.link/optional.ctor">[optional.ctor]</a> as indicated:</p>

<blockquote>
<pre>
constexpr optional(const optional&amp; rhs);
</pre>
<blockquote>
<p>
-4- <i>Effects</i>: If <code>rhs</code> contains a value, direct-non-list-initializes
<ins><code><i>val</i></code></ins><del>the contained value</del> with <code><del>*</del>rhs<ins>.<i>val</i></ins></code>.
<p/>
-5- <i>Postconditions</i>: <code>rhs.has_value() == this-&gt;has_value()</code>.
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
constexpr optional(optional&amp;&amp; rhs) noexcept(<i>see below</i>);
</pre>
<blockquote>
<p>
-8- <i>Constraints</i>: [&hellip;]
<p/>
-9- <i>Effects</i>: If <code>rhs</code> contains a value, direct-non-list-initializes
<ins><code><i>val</i></code></ins><del>the contained value</del> with <code>std::move(<del>*</del>rhs<ins>.<i>val</i></ins>)</code>.
<code>rhs.has_value()</code> is unchanged.
<p/>
-10- <i>Postconditions</i>: <code>rhs.has_value() == this-&gt;has_value()</code>.
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
template&lt;class... Args&gt; constexpr explicit optional(in_place_t, Args&amp;&amp;... args);
</pre>
<blockquote>
<p>
-13- <i>Constraints</i>: [&hellip;]
<p/>
-14- <i>Effects</i>: Direct-non-list-initializes <ins><code><i>val</i></code></ins><del>the contained value</del>
with <code>std::forward&lt;Args&gt;(args)...</code>.
<p/>
-15- <i>Postconditions</i>: <code>*this</code> contains a value.
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
template&lt;class U, class... Args&gt;
  constexpr explicit optional(in_place_t, initializer_list&lt;U&gt; il, Args&amp;&amp;... args);
</pre>
<blockquote>
<p>
-18- <i>Constraints</i>: [&hellip;]
<p/>
-19- <i>Effects</i>: Direct-non-list-initializes <ins><code><i>val</i></code></ins><del>the contained value</del>
with <code>il, std::forward&lt;Args&gt;(args)...</code>.
<p/>
-20- <i>Postconditions</i>: <code>*this</code> contains a value.
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
template&lt;class U = T&gt; constexpr explicit(<i>see below</i>) optional(U&amp;&amp; v);
</pre>
<blockquote>
<p>
-23- <i>Constraints</i>: [&hellip;]
<p/>
-24- <i>Effects</i>: Direct-non-list-initializes <ins><code><i>val</i></code></ins><del>the contained value</del>
with <code>std::forward&lt;U&gt;(v)</code>.
<p/>
-25- <i>Postconditions</i>: <code>*this</code> contains a value.
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
template&lt;class U&gt; constexpr explicit(<i>see below</i>) optional(const optional&lt;U&gt;&amp; rhs);
</pre>
<blockquote>
<p>
-28- <i>Constraints</i>: [&hellip;]
<p/>
-29- <i>Effects</i>: If <code>rhs</code> contains a value, direct-non-list-initializes
<ins><code><i>val</i></code></ins><del>the contained value</del> with <code><del>*</del>rhs<ins>.<i>val</i></ins></code>.
<p/>
-30- <i>Postconditions</i>: <code>rhs.has_value() == this-&gt;has_value()</code>.
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
template&lt;class U&gt; constexpr explicit(<i>see below</i>) optional(optional&lt;U&gt;&amp;&amp; rhs);
</pre>
<blockquote>
<p>
-33- <i>Constraints</i>: [&hellip;]
<p/>
-34- <i>Effects</i>: If <code>rhs</code> contains a value, direct-non-list-initializes
<ins><code><i>val</i></code></ins><del>the contained value</del> with
<code>std::move(<del>*</del>rhs<ins>.<i>val</i></ins>)</code>. <code>rhs.has_value()</code> is unchanged.
<p/>
-35- <i>Postconditions</i>: <code>rhs.has_value() == this-&gt;has_value()</code>.
<p/>
[&hellip;]
</p>
</blockquote>
</blockquote>
</li>

<li><p>Modify 22.5.3.3 <a href="https://wg21.link/optional.dtor">[optional.dtor]</a> as indicated:</p>

<blockquote>
<pre>
constexpr ~optional();
</pre>
<blockquote>
<p>
-1- <i>Effects</i>: If <code>is_trivially_destructible_v&lt;T&gt; != true</code> and <code>*this</code> contains a value,
calls <code><del>val-&gt;</del><ins><i>val</i>.</ins>T::~T()</code><ins>.</ins>
</p>
</blockquote>
</blockquote>
</li>

<li><p>Modify 22.5.3.4 <a href="https://wg21.link/optional.assign">[optional.assign]</a> as indicated:</p>

<blockquote>
<pre>
constexpr optional&lt;T&gt;&amp; operator=(nullopt_t) noexcept;
</pre>
<blockquote>
<p>
-1- <i>Effects</i>: If <code>*this</code> contains a value, calls
<code><del>val-&gt;</del><ins><i>val</i>.</ins>T::~T()</code> to destroy the contained
value; otherwise no effect.
<p/>
-2- <i>Postconditions</i>: <code>*this</code> does not contain a value.
</p>
</blockquote>
<pre>
constexpr optional&lt;T&gt;&amp; operator=(const optional&amp; rhs);
</pre>
<blockquote>
<p>
-4- <i>Effects</i>: See Table 58.
</p>
<table border="1">
<caption>Table 58 &mdash; <code>optional::operator=(const optional&amp;)</code> effects [tab:optional.assign.copy]</caption>

<tr>
<th></th>
<th><b><code>*this</code> contains a value</b></th>
<th><b><code>*this</code> does not contain a value</b></th>
</tr>

<tr>
<td><b><code>rhs</code> contains a value</b></td>
<td>assigns <code><del>*</del>rhs<ins>.<i>val</i></ins></code> to <ins><code><i>val</i></code></ins><del>the contained value</del></td>
<td>direct-non-list-initializes <ins><code><i>val</i></code></ins><del>the contained value</del>
with <code><del>*</del>rhs<ins>.<i>val</i></ins></code><br/>
</td>
</tr>

<tr>
<td><b><code>rhs</code> does not contain a value</b></td>
<td>destroys the contained value by calling <code><del>val-&gt;</del><ins><i>val</i>.</ins>T::~T()</code><br/>
</td>
<td>no effect</td>
</tr>
</table>
<p>
-5- <i>Postconditions</i>: <code>rhs.has_value() == this-&gt;has_value()</code>.
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
constexpr optional&lt;T&gt;&amp; operator=(optional&amp;&amp; rhs) noexcept(<i>see below</i>);
</pre>
<blockquote>
<p>
-8- <i>Constraints</i>: [&hellip;]
<p/>
-9- <i>Effects</i>: See Table 59. The result of the expression <code>rhs.has_value()</code> remains unchanged.
<p/>
-10- <i>Postconditions</i>: <code>rhs.has_value() == this-&gt;has_value()</code>.
<p/>
-11- <i>Returns</i>: <code>*this</code>.
</p>
<table border="1">
<caption>Table 59 &mdash; <code>optional::operator=(optional&amp;&amp;)</code> effects [tab:optional.assign.move]</caption>

<tr>
<th></th>
<th><b><code>*this</code> contains a value</b></th>
<th><b><code>*this</code> does not contain a value</b></th>
</tr>

<tr>
<td><b><code>rhs</code> contains a value</b></td>
<td>assigns <code>std::move(<del>*</del>rhs<ins>.<i>val</i></ins>)</code> to <ins><code><i>val</i></code></ins><del>the contained value</del></td>
<td>direct-non-list-initializes <ins><code><i>val</i></code></ins><del>the contained value</del> with
<code>std::move(<del>*</del>rhs<ins>.<i>val</i></ins>)</code></td>
</tr>

<tr>
<td><b><code>rhs</code> does not contain a value</b></td>
<td>destroys the contained value by calling<br/>
<code><del>val-&gt;</del><ins><i>val</i>.</ins>T::~T()</code></td>
<td>no effect</td>
</tr>
</table>
<p>
-12- <i>Remarks</i>: [&hellip;]
<p/>
-13- If any exception is thrown, the result of the expression <code>this-&gt;has_value()</code> remains
unchanged. If an exception is thrown during the call to <code>T</code>'s move constructor, the state
of <code><del>*</del>rhs.<ins><i>val</i></ins><del>val</del></code> is determined by the exception
safety guarantee of <code>T</code>'s move constructor. If an exception is thrown during the call to
<code>T</code>'s move assignment, the <ins>states</ins> <del>state</del> of <code><del>*</del><ins><i>val</i></ins><del>val</del></code>
and <code><del>*</del>rhs.<ins><i>val</i></ins><del>val</del></code> <ins>are</ins> <del>is</del> determined by the exception
safety guarantee of <code>T</code>'s move assignment.
</p>
</blockquote>
<pre>
template&lt;class U = T&gt; constexpr optional&lt;T&gt;&amp; operator=(U&amp;&amp; v);
</pre>
<blockquote>
<p>
-14- <i>Constraints</i>: [&hellip;]
<p/>
-15- <i>Effects</i>: If <code>*this</code> contains a value, assigns <code>std::forward&lt;U&gt;(v)</code>
to <ins><code><i>val</i></code></ins><del>the contained value</del>; otherwise direct-non-list-initializes
<ins><code><i>val</i></code></ins><del>the contained value</del> with <code>std::forward&lt;U&gt;(v)</code>.
<p/>
-16- <i>Postconditions</i>: <code>*this</code> contains a value.
<p/>
-17- <i>Returns</i>: <code>*this</code>.
<p/>
-18- <i>Remarks</i>: If any exception is thrown, the result of the expression <code>this-&gt;has_value()</code>
remains unchanged. If an exception is thrown during the call to <code>T</code>'s constructor, the state of
<code>v</code> is determined by the exception safety guarantee of <code>T</code>'s constructor. If an exception
is thrown during the call to <code>T</code>'s assignment, the <ins>states</ins> <del>state</del> of <code><ins><i>val</i></ins><del>*val</del></code>
and <code>v</code> <ins>are</ins> <del>is</del> determined by the exception safety guarantee of <code>T</code>'s assignment.
</p>
</blockquote>
<pre>
template&lt;class U&gt; constexpr optional&lt;T&gt;&amp; operator=(const optional&lt;U&gt;&amp; rhs);
</pre>
<blockquote>
<p>
-19- <i>Constraints</i>: [&hellip;]
<p/>
-20- <i>Effects</i>: See Table 60.
</p>
<table border="1">
<caption>Table 60 &mdash; <code>optional::operator=(const optional&lt;U&gt;&amp;)</code> effects [tab:optional.assign.copy.templ]</caption>

<tr>
<th></th>
<th><b><code>*this</code> contains a value</b></th>
<th><b><code>*this</code> does not contain a value</b></th>
</tr>

<tr>
<td><b><code>rhs</code> contains a value</b></td>
<td>assigns <code><del>*</del>rhs<ins>.<i>val</i></ins></code> to <ins><code><i>val</i></code></ins><del>the contained value</del></td>
<td>direct-non-list-initializes <ins><code><i>val</i></code></ins><del>the contained value</del>
with <code><del>*</del>rhs<ins>.<i>val</i></ins></code> </td>
</tr>

<tr>
<td><b><code>rhs</code> does not contain a value</b></td>
<td>destroys the contained value by calling<br/>
<code><del>val-&gt;</del><ins><i>val</i>.</ins>T::~T()</code> </td>
<td>no effect</td>
</tr>
</table>
<p>
-21- <i>Postconditions</i>: <code>rhs.has_value() == this-&gt;has_value()</code>.
<p/>
-22- <i>Returns</i>: <code>*this</code>.
<p/>
-23- If any exception is thrown, the result of the expression <code>this-&gt;has_value()</code> remains
unchanged. If an exception is thrown during the call to <code>T</code>'s constructor, the state of
<code><del>*</del>rhs.<ins><i>val</i></ins><del>val</del></code> is determined by the exception safety
guarantee of <code>T</code>'s constructor. If an exception is thrown during the call to <code>T</code>'s
assignment, the <ins>states</ins> <del>state</del> of <code><ins><i>val</i></ins><del>*val</del></code> and
<code><del>*</del>rhs.<ins><i>val</i></ins><del>val</del></code> <ins>are</ins> <del>is</del> determined by the exception safety
guarantee of <code>T</code>'s assignment.
</p>
</blockquote>
<pre>
template&lt;class U&gt; constexpr optional&lt;T&gt;&amp; operator=(optional&lt;U&gt;&amp;&amp; rhs);
</pre>
<blockquote>
<p>
-24- <i>Constraints</i>: [&hellip;]
<p/>
-25- <i>Effects</i>: See Table 61. The result of the expression <code>rhs.has_value()</code> remains unchanged.
</p>
<table border="1">
<caption>Table 61 &mdash; <code>optional::operator=(optional&lt;U&gt;&amp;&amp;)</code> effects [tab:optional.assign.move.templ]</caption>

<tr>
<th></th>
<th><b><code>*this</code> contains a value</b></th>
<th><b><code>*this</code> does not contain a value</b></th>
</tr>

<tr>
<td><b><code>rhs</code> contains a value</b></td>
<td>assigns <code>std::move(<del>*</del>rhs<ins>.<i>val</i></ins>)</code> to <ins><code><i>val</i></code></ins><del>the contained value</del></td>
<td>direct-non-list-initializes <ins><code><i>val</i></code></ins><del>the contained value</del> with<br/>
<code>std::move(<del>*</del>rhs<ins>.<i>val</i></ins>)</code> </td>
</tr>

<tr>
<td><b><code>rhs</code> does not contain a value</b></td>
<td>destroys the contained value by calling<br/>
<code><del>val-&gt;</del><ins><i>val</i>.</ins>T::~T()</code> </td>
<td>no effect</td>
</tr>
</table>
<p>
-26- <i>Postconditions</i>: <code>rhs.has_value() == this-&gt;has_value()</code>.
<p/>
-27- <i>Returns</i>: <code>*this</code>.
<p/>
-28- If any exception is thrown, the result of the expression <code>this-&gt;has_value()</code> remains
unchanged. If an exception is thrown during the call to <code>T</code>'s constructor, the state of
<code><del>*</del>rhs.<ins><i>val</i></ins><del>val</del></code> is determined by the exception safety
guarantee of <code>T</code>'s constructor. If an exception is thrown during the call to <code>T</code>'s
assignment, the <ins>states</ins> <del>state</del> of <code><ins><i>val</i></ins><del>*val</del></code> and
<code><del>*</del>rhs.<ins><i>val</i></ins><del>val</del></code> <ins>are</ins> <del>is</del> determined by the exception safety
guarantee of <code>T</code>'s assignment.
</p>
</blockquote>
<pre>
template&lt;class... Args&gt; constexpr T&amp; emplace(Args&amp;&amp;... args);
</pre>
<blockquote>
<p>
-29- <i>Mandates</i>: [&hellip;]
<p/>
-30- <i>Effects</i>: Calls <code>*this = nullopt</code>. Then direct-non-list-initializes
<ins><code><i>val</i></code></ins><del>the contained value</del> with <code>std::forward&lt;Args&gt;(args)...</code>.
<p/>
-31- <i>Postconditions</i>: <code>*this</code> contains a value.
<p/>
-32- <i>Returns</i>: <ins><code><i>val</i></code></ins><del>A reference to the new contained value</del>.
<p/>
[&hellip;]
<p/>
-34- <i>Remarks</i>: If an exception is thrown during the call to <code>T</code>'s constructor, <code>*this</code>
does not contain a value, and the previous <code><ins><i>val</i></ins><del>*val</del></code> (if any)
has been destroyed.
</p>
</blockquote>
<pre>
template&lt;class U, class... Args&gt; constexpr T&amp; emplace(initializer_list&lt;U&gt; il, Args&amp;&amp;... args);
</pre>
<blockquote>
<p>
-35- <i>Constraints</i>: [&hellip;]
<p/>
-36- <i>Effects</i>: Calls <code>*this = nullopt</code>. Then direct-non-list-initializes
<ins><code><i>val</i></code></ins><del>the contained value</del> with <code>il, std::forward&lt;Args&gt;(args)...</code>.
<p/>
-37- <i>Postconditions</i>: <code>*this</code> contains a value.
<p/>
-38- <i>Returns</i>: <ins><code><i>val</i></code></ins><del>A reference to the new contained value</del>.
<p/>
[&hellip;]
<p/>
-40- <i>Remarks</i>: If an exception is thrown during the call to <code>T</code>'s constructor, <code>*this</code>
does not contain a value, and the previous <code><ins><i>val</i></ins><del>*val</del></code> (if any)
has been destroyed.
</p>
</blockquote>
</blockquote>
</li>

<li><p>Modify 22.5.3.5 <a href="https://wg21.link/optional.swap">[optional.swap]</a> as indicated:</p>

<blockquote>
<pre>
constexpr void swap(optional&amp; rhs) noexcept(<i>see below</i>);
</pre>
<blockquote>
<p>
-1- <i>Mandates</i>: [&hellip;]
<p/>
-2- <i>Preconditions</i>: [&hellip;]
<p/>
-3- <i>Effects</i>: See Table 62.
</p>
<table border="1">
<caption>Table 62 &mdash; <code>optional::swap(optional&amp;)</code> effects [tab:optional.swap]</caption>

<tr>
<th></th>
<th><b><code>*this</code> contains a value</b></th>
<th><b><code>*this</code> does not contain a value</b></th>
</tr>

<tr>
<td><b><code>rhs</code> contains a value</b></td>
<td>calls <code>swap(<ins><i>val</i></ins><del>*(*this)</del>, <del>*</del>rhs<ins>.<i>val</i></ins>)</code></td>
<td>direct-non-list-initializes <ins><code><i>val</i></code></ins><del>the contained value of <code>*this</code></del><br/>
with <code>std::move(<del>*</del>rhs<ins>.<i>val</i></ins>)</code>, followed by <code>rhs.<ins><i>val</i>.</ins><del>val-&gt;</del>T::~T()</code>;<br/>
postcondition is that <code>*this</code> contains a value and <code>rhs</code> does<br/>
not contain a value</td>
</tr>

<tr>
<td><b><code>rhs</code> does not contain a value</b></td>
<td>direct-non-list-initializes <del>the contained value of</del> <code>rhs<ins>.<i>val</i></ins></code><br/>
with <code>std::move(<ins><i>val</i></ins><del>*(*this)</del>)</code>, followed by <code><ins><i>val</i>.</ins><del>val-&gt;</del>T::~T()</code>;<br/>
postcondition is that <code>*this</code> does not contain a value and <code>rhs</code><br/>
contains a value</td>
<td>no effect</td>
</tr>
</table>
<p>
-4- <i>Throws</i>: [&hellip;]
<p/>
-5- <i>Remarks</i>: [&hellip;]
<p/>
-6- If any exception is thrown, the results of the expressions <code>this-&gt;has_value()</code> and
<code>rhs.has_value()</code> remain unchanged. If an exception is thrown during the call to function <code>swap</code>,
the state of <code><ins><i>val</i></ins><del>*val</del></code> and
<code><del>*</del>rhs.<ins><i>val</i></ins><del>val</del></code> is determined by the exception safety
guarantee of <code>swap</code> for lvalues of <code>T</code>. If an exception is thrown during the call to
<code>T</code>'s move constructor, the <ins>states</ins> <del>state</del> of <code><ins><i>val</i></ins><del>*val</del></code> and
<code><del>*</del>rhs.<ins><i>val</i></ins><del>val</del></code> <ins>are</ins> <del>is</del> determined by the exception safety
guarantee of <code>T</code>'s move constructor.
<p/>
</p>
</blockquote>
</blockquote>
</li>

<li><p>Modify 22.5.3.7 <a href="https://wg21.link/optional.observe">[optional.observe]</a> as indicated:</p>

<blockquote>
<pre>
constexpr const T* operator-&gt;() const noexcept;
constexpr T* operator-&gt;() noexcept;
</pre>
<blockquote>
<p>
-1- <i>Preconditions</i>: <code>*this</code> contains a value.
<p/>
-2- <i>Returns</i>: <code><ins>addressof(<i>val</i>)</ins><del>val</del></code>.
<p/>
-3- [&hellip;]
</p>
</blockquote>
<pre>
constexpr const T&amp; operator*() const &amp; noexcept;
constexpr T&amp; operator*() &amp; noexcept;
</pre>
<blockquote>
<p>
-4- <i>Preconditions</i>: <code>*this</code> contains a value.
<p/>
-5- <i>Returns</i>: <code><ins><i>val</i></ins><del>*val</del></code>.
<p/>
-6- [&hellip;]
</p>
</blockquote>
<pre>
constexpr T&amp;&amp; operator*() &amp;&amp; noexcept;
constexpr const T&amp;&amp; operator*() const &amp;&amp; noexcept;
</pre>
<blockquote>
<p>
-7- <i>Preconditions</i>: <code>*this</code> contains a value.
<p/>
-8- <i>Effects</i>: Equivalent to: <code>return std::move(<ins><i>val</i></ins><del>*val</del>);</code>
</p>
</blockquote>
<pre>
constexpr explicit operator bool() const noexcept;
</pre>
<blockquote>
<p>
-9- <i>Returns</i>: <code>true</code> if and only if <code>*this</code> contains a value.
<p/>
-10- <i>Remarks</i>: This function is a constexpr function.
</p>
</blockquote>
<pre>
constexpr bool has_value() const noexcept;
</pre>
<blockquote>
<p>
-11- <i>Returns</i>: <code>true</code> if and only if <code>*this</code> contains a value.
<p/>
-12- <i>Remarks</i>: This function is a constexpr function.
</p>
</blockquote>
<pre>
constexpr const T&amp; value() const &amp;;
constexpr T&amp; value() &amp;;
</pre>
<blockquote>
<p>
-13- <i>Effects</i>: Equivalent to:
</p>
<blockquote><pre>
return has_value() ? <ins><i>val</i></ins><del>*val</del> : throw bad_optional_access();
</pre></blockquote>
</blockquote>
<pre>
constexpr T&amp;&amp; value() &amp;&amp;;
constexpr const T&amp;&amp; value() const &amp;&amp;;
</pre>
<blockquote>
<p>
-14- <i>Effects</i>: Equivalent to:
</p>
<blockquote><pre>
return has_value() ? std::move(<ins><i>val</i></ins><del>*val</del>) : throw bad_optional_access();
</pre></blockquote>
</blockquote>
<pre>
template&lt;class U&gt; constexpr T value_or(U&amp;&amp; v) const &amp;;
</pre>
<blockquote>
<p>
-15- <i>Mandates</i>: [&hellip;]
<p/>
-16- <i>Effects</i>: Equivalent to:
</p>
<blockquote><pre>
return has_value() ? <ins><i>val</i></ins><del>**this</del> : static_cast&lt;T&gt;(std::forward&lt;U&gt;(v));
</pre></blockquote>
</blockquote>
<pre>
template&lt;class U&gt; constexpr T value_or(U&amp;&amp; v) &amp;&amp;;
</pre>
<blockquote>
<p>
-17- <i>Mandates</i>: [&hellip;]
<p/>
-18- <i>Effects</i>: Equivalent to:
</p>
<blockquote><pre>
return has_value() ? std::move(<ins><i>val</i></ins><del>**this</del>) : static_cast&lt;T&gt;(std::forward&lt;U&gt;(v));
</pre></blockquote>
</blockquote>
</blockquote>
</li>

<li><p>Modify 22.5.3.8 <a href="https://wg21.link/optional.monadic">[optional.monadic]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class F&gt; constexpr auto and_then(F&amp;&amp; f) &amp;;
template&lt;class F&gt; constexpr auto and_then(F&amp;&amp; f) const &amp;;
</pre>
<blockquote>
<p>
-1- Let <code>U</code> be <code>invoke_result_t&lt;F, decltype(<ins>(<i>val</i>)</ins><del>*val</del>)&gt;</code>.
<p/>
-2- <i>Mandates</i>: [&hellip;]
<p/>
-3- <i>Effects</i>: Equivalent to:
</p>
<blockquote><pre>
if (*this) {
  return invoke(std::forward&lt;F&gt;(f), <ins><i>val</i></ins><del>*val</del>);
} else {
  return remove_cvref_t&lt;U&gt;();
}
</pre></blockquote>
</blockquote>
<pre>
template&lt;class F&gt; constexpr auto and_then(F&amp;&amp; f) &amp;&amp;;
template&lt;class F&gt; constexpr auto and_then(F&amp;&amp; f) const &amp;&amp;;
</pre>
<blockquote>
<p>
-4- Let <code>U</code> be <code>invoke_result_t&lt;F, decltype(std::move(<ins><i>val</i></ins><del>*val</del>))&gt;</code>.
<p/>
-5- <i>Mandates</i>: [&hellip;]
<p/>
-6- <i>Effects</i>: Equivalent to:
</p>
<blockquote><pre>
if (*this) {
  return invoke(std::forward&lt;F&gt;(f), std::move(<ins><i>val</i></ins><del>*val</del>));
} else {
  return remove_cvref_t&lt;U&gt;();
}
</pre></blockquote>
</blockquote>
<pre>
template&lt;class F&gt; constexpr auto transform(F&amp;&amp; f) &amp;;
template&lt;class F&gt; constexpr auto transform(F&amp;&amp; f) const &amp;;
</pre>
<blockquote>
<p>
-7- Let <code>U</code> be <code>remove_cv_t&lt;invoke_result_t&lt;F, decltype(<ins>(<i>val</i>)</ins><del>*val</del>)&gt;&gt;</code>.
<p/>
-8- <i>Mandates</i>: <code>U</code> is a non-array object type other than <code>in_place_t</code> or <code>nullopt_t</code>. The declaration
</p>
<blockquote><pre>
U u(invoke(std::forward&lt;F&gt;(f), <ins><i>val</i></ins><del>*val</del>));
</pre></blockquote>
<p>
is well-formed for some invented variable <code>u</code>.
<p/>
[&hellip;]
<p/>
-9- <i>Returns</i>: If <code>*this</code> contains a value, an <code>optional&lt;U&gt;</code> object whose contained value is
direct-non-list-initialized with <code>invoke(std::forward&lt;F&gt;(f), <ins><i>val</i></ins><del>*val</del>)</code>; otherwise,
<code>optional&lt;U&gt;()</code>.
</p>
</blockquote>
<pre>
template&lt;class F&gt; constexpr auto transform(F&amp;&amp; f) &amp;&amp;;
template&lt;class F&gt; constexpr auto transform(F&amp;&amp; f) const &amp;&amp;;
</pre>
<blockquote>
<p>
-10- Let <code>U</code> be <code>remove_cv_t&lt;invoke_result_t&lt;F, decltype(std::move(<ins><i>val</i></ins><del>*val</del>))&gt;&gt;</code>.
<p/>
-11- <i>Mandates</i>: <code>U</code> is a non-array object type other than <code>in_place_t</code> or <code>nullopt_t</code>. The declaration
</p>
<blockquote><pre>
U u(invoke(std::forward&lt;F&gt;(f), std::move(<ins><i>val</i></ins><del>*val</del>)));
</pre></blockquote>
<p>
is well-formed for some invented variable <code>u</code>.
<p/>
[&hellip;]
<p/>
-12- <i>Returns</i>: If <code>*this</code> contains a value, an <code>optional&lt;U&gt;</code> object whose contained value is
direct-non-list-initialized with <code>invoke(std::forward&lt;F&gt;(f), std::move(<ins><i>val</i></ins><del>*val</del>))</code>; otherwise,
<code>optional&lt;U&gt;()</code>.
</p>
</blockquote>
</blockquote>
</li>

<li><p>Modify 22.5.3.9 <a href="https://wg21.link/optional.mod">[optional.mod]</a> as indicated:</p>

<blockquote>
<pre>
constexpr void reset() noexcept;
</pre>
<blockquote>
<p>
-1- <i>Effects</i>: If <code>*this</code> contains a value, calls <code><del>val-&gt;</del><ins><i>val</i>.</ins>T::~T()</code>
to destroy the contained value; otherwise no effect.
<p/>
-2- <i>Postconditions</i>: <code>*this</code> does not contain a value.
</p>
</blockquote>
</blockquote>
</li>

</ol>

</blockquote>

<p><i>[2025-11-03; Tomasz tweaks proposed resolution]</i></p>

<p>
Updated converting constructor and assignments to use <code class='backtick'>operator*()</code>
directly, required to correctly support <code>optional&lt;T&amp;&gt;</code>.
Also update corresponding constructor in specialization.
</p>


<p><i>[Kona 2025-11-05; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>



<p id="res-4015"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<ol>

<li><p>Modify 22.5.3.1 <a href="https://wg21.link/optional.optional.general">[optional.optional.general]</a>, class template <code>optional</code> synopsis, as indicated:</p>

<blockquote>
<pre>
namespace std {
  template&lt;class T&gt;
  class optional {
  public:
    using value_type = T;
    [&hellip;]
  private:
    <del>T* val; // <i>exposition only</i></del>
    <ins>union {</ins>
      <ins>remove_cv_t&lt;T&gt; <i>val</i>; // <i>exposition only</i></ins>
    <ins>};</ins>
  };

  [&hellip;]
}
</pre>
</blockquote>
</li>

<li><p>Modify 22.5.3.1 <a href="https://wg21.link/optional.optional.general">[optional.optional.general]</a> as indicated:</p>

<blockquote>
<p>
-1-
<ins>
An instance of <code>optional&lt;T&gt;</code> is said to
<i>contain a value</i> when and only when its member <code><i>val</i></code> is active
(11.5.1 <a href="https://wg21.link/class.union.general">[class.union.general]</a>);
<code><i>val</i></code> is referred to as its <i>contained value</i>.
</ins>
<del>
An object of type <code>optional&lt;T&gt;</code> at any given time either
contains a value or does not contain a value.
When an object of type <code>optional&lt;T&gt;</code> <i>contains a value</i>,
it means that an object of type <code>T</code>,
referred to as the</del>
<ins>An</ins>
optional object's
<ins>contained value</ins>
<del><i>contained value</i>, </del>
is nested within (6.8.2 <a href="https://wg21.link/intro.object">[intro.object]</a>) the optional object.
<del>
When an object of type <code>optional&lt;T&gt;</code>
is contextually converted to <code>bool</code>,
the conversion returns <code class='backtick'>true</code> if the object contains a value;
otherwise the conversion returns <code class='backtick'>false</code>.
</del>
</p>
<p>
<del>
-2- When an <code>optional&lt;T&gt;</code> object contains a value,
member <code>val</code>
points to the contained value.
</del>
</p>
</blockquote>
</li>

<li><p>Modify 22.5.3.2 <a href="https://wg21.link/optional.ctor">[optional.ctor]</a> as indicated:</p>

<blockquote>
<pre>
constexpr optional(const optional&amp; rhs);
</pre>
<blockquote>
<p>
-4- <i>Effects</i>: If <code>rhs</code> contains a value, direct-non-list-initializes
<ins><code><i>val</i></code></ins><del>the contained value</del> with <code><del>*</del>rhs<ins>.<i>val</i></ins></code>.
<p/>
-5- <i>Postconditions</i>: <code>rhs.has_value() == this-&gt;has_value()</code>.
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
constexpr optional(optional&amp;&amp; rhs) noexcept(<i>see below</i>);
</pre>
<blockquote>
<p>
-8- <i>Constraints</i>: [&hellip;]
<p/>
-9- <i>Effects</i>: If <code>rhs</code> contains a value, direct-non-list-initializes
<ins><code><i>val</i></code></ins><del>the contained value</del> with <code>std::move(<del>*</del>rhs<ins>.<i>val</i></ins>)</code>.
<code>rhs.has_value()</code> is unchanged.
<p/>
-10- <i>Postconditions</i>: <code>rhs.has_value() == this-&gt;has_value()</code>.
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
template&lt;class... Args&gt; constexpr explicit optional(in_place_t, Args&amp;&amp;... args);
</pre>
<blockquote>
<p>
-13- <i>Constraints</i>: [&hellip;]
<p/>
-14- <i>Effects</i>: Direct-non-list-initializes <ins><code><i>val</i></code></ins><del>the contained value</del>
with <code>std::forward&lt;Args&gt;(args)...</code>.
<p/>
-15- <i>Postconditions</i>: <code>*this</code> contains a value.
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
template&lt;class U, class... Args&gt;
  constexpr explicit optional(in_place_t, initializer_list&lt;U&gt; il, Args&amp;&amp;... args);
</pre>
<blockquote>
<p>
-18- <i>Constraints</i>: [&hellip;]
<p/>
-19- <i>Effects</i>: Direct-non-list-initializes <ins><code><i>val</i></code></ins><del>the contained value</del>
with <code>il, std::forward&lt;Args&gt;(args)...</code>.
<p/>
-20- <i>Postconditions</i>: <code>*this</code> contains a value.
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
template&lt;class U = T&gt; constexpr explicit(<i>see below</i>) optional(U&amp;&amp; v);
</pre>
<blockquote>
<p>
-23- <i>Constraints</i>: [&hellip;]
<p/>
-24- <i>Effects</i>: Direct-non-list-initializes <ins><code><i>val</i></code></ins><del>the contained value</del>
with <code>std::forward&lt;U&gt;(v)</code>.
<p/>
-25- <i>Postconditions</i>: <code>*this</code> contains a value.
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
template&lt;class U&gt; constexpr explicit(<i>see below</i>) optional(const optional&lt;U&gt;&amp; rhs);
</pre>
<blockquote>
<p>
-28- <i>Constraints</i>: [&hellip;]
<p/>
-29- <i>Effects</i>: If <code>rhs</code> contains a value, direct-non-list-initializes
<ins><code><i>val</i></code></ins><del>the contained value</del> with <code><del>*</del>rhs<ins>.operator*()</ins></code>.
<p/>
-30- <i>Postconditions</i>: <code>rhs.has_value() == this-&gt;has_value()</code>.
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
template&lt;class U&gt; constexpr explicit(<i>see below</i>) optional(optional&lt;U&gt;&amp;&amp; rhs);
</pre>
<blockquote>
<p>
-33- <i>Constraints</i>: [&hellip;]
<p/>
-34- <i>Effects</i>: If <code>rhs</code> contains a value, direct-non-list-initializes
<ins><code><i>val</i></code></ins><del>the contained value</del> with
<code><del>*</del>std::move(rhs)<ins>.operator*()</ins></code>. <code>rhs.has_value()</code> is unchanged.
<p/>
-35- <i>Postconditions</i>: <code>rhs.has_value() == this-&gt;has_value()</code>.
<p/>
[&hellip;]
</p>
</blockquote>
</blockquote>
</li>

<li><p>Modify 22.5.3.3 <a href="https://wg21.link/optional.dtor">[optional.dtor]</a> as indicated:</p>

<blockquote>
<pre>
constexpr ~optional();
</pre>
<blockquote>
<p>
-1- <i>Effects</i>: If <code>is_trivially_destructible_v&lt;T&gt; != true</code> and <code>*this</code> contains a value,
calls <code><del>val-&gt;</del><ins><i>val</i>.</ins>T::~T()</code><ins>.</ins>
</p>
</blockquote>
</blockquote>
</li>

<li><p>Modify 22.5.3.4 <a href="https://wg21.link/optional.assign">[optional.assign]</a> as indicated:</p>

<blockquote>
<pre>
constexpr optional&lt;T&gt;&amp; operator=(nullopt_t) noexcept;
</pre>
<blockquote>
<p>
-1- <i>Effects</i>: If <code>*this</code> contains a value, calls
<code><del>val-&gt;</del><ins><i>val</i>.</ins>T::~T()</code> to destroy the contained
value; otherwise no effect.
<p/>
-2- <i>Postconditions</i>: <code>*this</code> does not contain a value.
</p>
</blockquote>
<pre>
constexpr optional&lt;T&gt;&amp; operator=(const optional&amp; rhs);
</pre>
<blockquote>
<p>
-4- <i>Effects</i>: See Table 58.
</p>
<table border="1">
<caption>Table 58 &mdash; <code>optional::operator=(const optional&amp;)</code> effects [tab:optional.assign.copy]</caption>

<tr>
<th></th>
<th><b><code>*this</code> contains a value</b></th>
<th><b><code>*this</code> does not contain a value</b></th>
</tr>

<tr>
<td><b><code>rhs</code> contains a value</b></td>
<td>assigns <code><del>*</del>rhs<ins>.<i>val</i></ins></code> to <ins><code><i>val</i></code></ins><del>the contained value</del></td>
<td>direct-non-list-initializes <ins><code><i>val</i></code></ins><del>the contained value</del>
with <code><del>*</del>rhs<ins>.<i>val</i></ins></code><br/>
</td>
</tr>

<tr>
<td><b><code>rhs</code> does not contain a value</b></td>
<td>destroys the contained value by calling <code><del>val-&gt;</del><ins><i>val</i>.</ins>T::~T()</code><br/>
</td>
<td>no effect</td>
</tr>
</table>
<p>
-5- <i>Postconditions</i>: <code>rhs.has_value() == this-&gt;has_value()</code>.
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
constexpr optional&lt;T&gt;&amp; operator=(optional&amp;&amp; rhs) noexcept(<i>see below</i>);
</pre>
<blockquote>
<p>
-8- <i>Constraints</i>: [&hellip;]
<p/>
-9- <i>Effects</i>: See Table 59. The result of the expression <code>rhs.has_value()</code> remains unchanged.
<p/>
-10- <i>Postconditions</i>: <code>rhs.has_value() == this-&gt;has_value()</code>.
<p/>
-11- <i>Returns</i>: <code>*this</code>.
</p>
<table border="1">
<caption>Table 59 &mdash; <code>optional::operator=(optional&amp;&amp;)</code> effects [tab:optional.assign.move]</caption>

<tr>
<th></th>
<th><b><code>*this</code> contains a value</b></th>
<th><b><code>*this</code> does not contain a value</b></th>
</tr>

<tr>
<td><b><code>rhs</code> contains a value</b></td>
<td>assigns <code>std::move(<del>*</del>rhs<ins>.<i>val</i></ins>)</code> to <ins><code><i>val</i></code></ins><del>the contained value</del></td>
<td>direct-non-list-initializes <ins><code><i>val</i></code></ins><del>the contained value</del> with
<code>std::move(<del>*</del>rhs<ins>.<i>val</i></ins>)</code></td>
</tr>

<tr>
<td><b><code>rhs</code> does not contain a value</b></td>
<td>destroys the contained value by calling<br/>
<code><del>val-&gt;</del><ins><i>val</i>.</ins>T::~T()</code></td>
<td>no effect</td>
</tr>
</table>
<p>
-12- <i>Remarks</i>: [&hellip;]
<p/>
-13- If any exception is thrown, the result of the expression <code>this-&gt;has_value()</code> remains
unchanged. If an exception is thrown during the call to <code>T</code>'s move constructor, the state
of <code><del>*</del>rhs.<ins><i>val</i></ins><del>val</del></code> is determined by the exception
safety guarantee of <code>T</code>'s move constructor. If an exception is thrown during the call to
<code>T</code>'s move assignment, the <ins>states</ins> <del>state</del> of <code><del>*</del><ins><i>val</i></ins><del>val</del></code>
and <code><del>*</del>rhs.<ins><i>val</i></ins><del>val</del></code> <ins>are</ins> <del>is</del> determined by the exception
safety guarantee of <code>T</code>'s move assignment.
</p>
</blockquote>
<pre>
template&lt;class U = T&gt; constexpr optional&lt;T&gt;&amp; operator=(U&amp;&amp; v);
</pre>
<blockquote>
<p>
-14- <i>Constraints</i>: [&hellip;]
<p/>
-15- <i>Effects</i>: If <code>*this</code> contains a value, assigns <code>std::forward&lt;U&gt;(v)</code>
to <ins><code><i>val</i></code></ins><del>the contained value</del>; otherwise direct-non-list-initializes
<ins><code><i>val</i></code></ins><del>the contained value</del> with <code>std::forward&lt;U&gt;(v)</code>.
<p/>
-16- <i>Postconditions</i>: <code>*this</code> contains a value.
<p/>
-17- <i>Returns</i>: <code>*this</code>.
<p/>
-18- <i>Remarks</i>: If any exception is thrown, the result of the expression <code>this-&gt;has_value()</code>
remains unchanged. If an exception is thrown during the call to <code>T</code>'s constructor, the state of
<code>v</code> is determined by the exception safety guarantee of <code>T</code>'s constructor. If an exception
is thrown during the call to <code>T</code>'s assignment, the <ins>states</ins> <del>state</del> of <code><ins><i>val</i></ins><del>*val</del></code>
and <code>v</code> <ins>are</ins> <del>is</del> determined by the exception safety guarantee of <code>T</code>'s assignment.
</p>
</blockquote>
<pre>
template&lt;class U&gt; constexpr optional&lt;T&gt;&amp; operator=(const optional&lt;U&gt;&amp; rhs);
</pre>
<blockquote>
<p>
-19- <i>Constraints</i>: [&hellip;]
<p/>
-20- <i>Effects</i>: See Table 60.
</p>
<table border="1">
<caption>Table 60 &mdash; <code>optional::operator=(const optional&lt;U&gt;&amp;)</code> effects [tab:optional.assign.copy.templ]</caption>

<tr>
<th></th>
<th><b><code>*this</code> contains a value</b></th>
<th><b><code>*this</code> does not contain a value</b></th>
</tr>

<tr>
<td><b><code>rhs</code> contains a value</b></td>
<td>assigns <code><del>*</del>rhs<ins>.operator*()</ins></code> to <ins><code><i>val</i></code></ins><del>the contained value</del></td>
<td>direct-non-list-initializes <ins><code><i>val</i></code></ins><del>the contained value</del>
with <code><del>*</del>rhs<ins>.operator*()</ins></code> </td>
</tr>

<tr>
<td><b><code>rhs</code> does not contain a value</b></td>
<td>destroys the contained value by calling<br/>
<code><del>val-&gt;</del><ins><i>val</i>.</ins>T::~T()</code> </td>
<td>no effect</td>
</tr>
</table>
<p>
-21- <i>Postconditions</i>: <code>rhs.has_value() == this-&gt;has_value()</code>.
<p/>
-22- <i>Returns</i>: <code>*this</code>.
<p/>
-23- If any exception is thrown, the result of the expression <code>this-&gt;has_value()</code> remains
unchanged. If an exception is thrown during the call to <code>T</code>'s constructor, the state of
<code><del>*</del>rhs.<ins><i>val</i></ins><del>val</del></code> is determined by the exception safety
guarantee of <code>T</code>'s constructor. If an exception is thrown during the call to <code>T</code>'s
assignment, the <ins>states</ins> <del>state</del> of <code><ins><i>val</i></ins><del>*val</del></code> and
<code><del>*</del>rhs.<ins><i>val</i></ins><del>val</del></code> <ins>are</ins> <del>is</del> determined by the exception safety
guarantee of <code>T</code>'s assignment.
</p>
</blockquote>
<pre>
template&lt;class U&gt; constexpr optional&lt;T&gt;&amp; operator=(optional&lt;U&gt;&amp;&amp; rhs);
</pre>
<blockquote>
<p>
-24- <i>Constraints</i>: [&hellip;]
<p/>
-25- <i>Effects</i>: See Table 61. The result of the expression <code>rhs.has_value()</code> remains unchanged.
</p>
<table border="1">
<caption>Table 61 &mdash; <code>optional::operator=(optional&lt;U&gt;&amp;&amp;)</code> effects [tab:optional.assign.move.templ]</caption>

<tr>
<th></th>
<th><b><code>*this</code> contains a value</b></th>
<th><b><code>*this</code> does not contain a value</b></th>
</tr>

<tr>
<td><b><code>rhs</code> contains a value</b></td>
<td>assigns <code><del>*</del>std::move(rhs)<ins>.operator*()</ins></code> to <ins><code><i>val</i></code></ins><del>the contained value</del></td>
<td>direct-non-list-initializes <ins><code><i>val</i></code></ins><del>the contained value</del> with<br/>
<code><del>*</del>std::move(rhs)<ins>.operator*()</ins></code> </td>
</tr>

<tr>
<td><b><code>rhs</code> does not contain a value</b></td>
<td>destroys the contained value by calling<br/>
<code><del>val-&gt;</del><ins><i>val</i>.</ins>T::~T()</code> </td>
<td>no effect</td>
</tr>
</table>
<p>
-26- <i>Postconditions</i>: <code>rhs.has_value() == this-&gt;has_value()</code>.
<p/>
-27- <i>Returns</i>: <code>*this</code>.
<p/>
-28- If any exception is thrown, the result of the expression <code>this-&gt;has_value()</code> remains
unchanged. If an exception is thrown during the call to <code>T</code>'s constructor, the state of
<code><del>*</del>rhs.<ins><i>val</i></ins><del>val</del></code> is determined by the exception safety
guarantee of <code>T</code>'s constructor. If an exception is thrown during the call to <code>T</code>'s
assignment, the <ins>states</ins> <del>state</del> of <code><ins><i>val</i></ins><del>*val</del></code> and
<code><del>*</del>rhs.<ins><i>val</i></ins><del>val</del></code> <ins>are</ins> <del>is</del> determined by the exception safety
guarantee of <code>T</code>'s assignment.
</p>
</blockquote>
<pre>
template&lt;class... Args&gt; constexpr T&amp; emplace(Args&amp;&amp;... args);
</pre>
<blockquote>
<p>
-29- <i>Mandates</i>: [&hellip;]
<p/>
-30- <i>Effects</i>: Calls <code>*this = nullopt</code>. Then direct-non-list-initializes
<ins><code><i>val</i></code></ins><del>the contained value</del> with <code>std::forward&lt;Args&gt;(args)...</code>.
<p/>
-31- <i>Postconditions</i>: <code>*this</code> contains a value.
<p/>
-32- <i>Returns</i>: <ins><code><i>val</i></code></ins><del>A reference to the new contained value</del>.
<p/>
[&hellip;]
<p/>
-34- <i>Remarks</i>: If an exception is thrown during the call to <code>T</code>'s constructor, <code>*this</code>
does not contain a value, and the previous <code><ins><i>val</i></ins><del>*val</del></code> (if any)
has been destroyed.
</p>
</blockquote>
<pre>
template&lt;class U, class... Args&gt; constexpr T&amp; emplace(initializer_list&lt;U&gt; il, Args&amp;&amp;... args);
</pre>
<blockquote>
<p>
-35- <i>Constraints</i>: [&hellip;]
<p/>
-36- <i>Effects</i>: Calls <code>*this = nullopt</code>. Then direct-non-list-initializes
<ins><code><i>val</i></code></ins><del>the contained value</del> with <code>il, std::forward&lt;Args&gt;(args)...</code>.
<p/>
-37- <i>Postconditions</i>: <code>*this</code> contains a value.
<p/>
-38- <i>Returns</i>: <ins><code><i>val</i></code></ins><del>A reference to the new contained value</del>.
<p/>
[&hellip;]
<p/>
-40- <i>Remarks</i>: If an exception is thrown during the call to <code>T</code>'s constructor, <code>*this</code>
does not contain a value, and the previous <code><ins><i>val</i></ins><del>*val</del></code> (if any)
has been destroyed.
</p>
</blockquote>
</blockquote>
</li>

<li><p>Modify 22.5.3.5 <a href="https://wg21.link/optional.swap">[optional.swap]</a> as indicated:</p>

<blockquote>
<pre>
constexpr void swap(optional&amp; rhs) noexcept(<i>see below</i>);
</pre>
<blockquote>
<p>
-1- <i>Mandates</i>: [&hellip;]
<p/>
-2- <i>Preconditions</i>: [&hellip;]
<p/>
-3- <i>Effects</i>: See Table 62.
</p>
<table border="1">
<caption>Table 62 &mdash; <code>optional::swap(optional&amp;)</code> effects [tab:optional.swap]</caption>

<tr>
<th></th>
<th><b><code>*this</code> contains a value</b></th>
<th><b><code>*this</code> does not contain a value</b></th>
</tr>

<tr>
<td><b><code>rhs</code> contains a value</b></td>
<td>calls <code>swap(<ins><i>val</i></ins><del>*(*this)</del>, <del>*</del>rhs<ins>.<i>val</i></ins>)</code></td>
<td>direct-non-list-initializes <ins><code><i>val</i></code></ins><del>the contained value of <code>*this</code></del><br/>
with <code>std::move(<del>*</del>rhs<ins>.<i>val</i></ins>)</code>, followed by <code>rhs.<ins><i>val</i>.</ins><del>val-&gt;</del>T::~T()</code>;<br/>
postcondition is that <code>*this</code> contains a value and <code>rhs</code> does<br/>
not contain a value</td>
</tr>

<tr>
<td><b><code>rhs</code> does not contain a value</b></td>
<td>direct-non-list-initializes <del>the contained value of</del> <code>rhs<ins>.<i>val</i></ins></code><br/>
with <code>std::move(<ins><i>val</i></ins><del>*(*this)</del>)</code>, followed by <code><ins><i>val</i>.</ins><del>val-&gt;</del>T::~T()</code>;<br/>
postcondition is that <code>*this</code> does not contain a value and <code>rhs</code><br/>
contains a value</td>
<td>no effect</td>
</tr>
</table>
<p>
-4- <i>Throws</i>: [&hellip;]
<p/>
-5- <i>Remarks</i>: [&hellip;]
<p/>
-6- If any exception is thrown, the results of the expressions <code>this-&gt;has_value()</code> and
<code>rhs.has_value()</code> remain unchanged. If an exception is thrown during the call to function <code>swap</code>,
the state of <code><ins><i>val</i></ins><del>*val</del></code> and
<code><del>*</del>rhs.<ins><i>val</i></ins><del>val</del></code> is determined by the exception safety
guarantee of <code>swap</code> for lvalues of <code>T</code>. If an exception is thrown during the call to
<code>T</code>'s move constructor, the <ins>states</ins> <del>state</del> of <code><ins><i>val</i></ins><del>*val</del></code> and
<code><del>*</del>rhs.<ins><i>val</i></ins><del>val</del></code> <ins>are</ins> <del>is</del> determined by the exception safety
guarantee of <code>T</code>'s move constructor.
<p/>
</p>
</blockquote>
</blockquote>
</li>

<li><p>Modify 22.5.3.7 <a href="https://wg21.link/optional.observe">[optional.observe]</a> as indicated:</p>

<blockquote>
<pre>
constexpr const T* operator-&gt;() const noexcept;
constexpr T* operator-&gt;() noexcept;
</pre>
<blockquote>
<p>
-1- <i>Preconditions</i>: <code>*this</code> contains a value.
<p/>
-2- <i>Returns</i>: <code><ins>addressof(<i>val</i>)</ins><del>val</del></code>.
<p/>
-3- [&hellip;]
</p>
</blockquote>
<pre>
constexpr const T&amp; operator*() const &amp; noexcept;
constexpr T&amp; operator*() &amp; noexcept;
</pre>
<blockquote>
<p>
-4- <i>Preconditions</i>: <code>*this</code> contains a value.
<p/>
-5- <i>Returns</i>: <code><ins><i>val</i></ins><del>*val</del></code>.
<p/>
-6- [&hellip;]
</p>
</blockquote>
<pre>
constexpr T&amp;&amp; operator*() &amp;&amp; noexcept;
constexpr const T&amp;&amp; operator*() const &amp;&amp; noexcept;
</pre>
<blockquote>
<p>
-7- <i>Preconditions</i>: <code>*this</code> contains a value.
<p/>
-8- <i>Effects</i>: Equivalent to: <code>return std::move(<ins><i>val</i></ins><del>*val</del>);</code>
</p>
</blockquote>
<pre>
constexpr explicit operator bool() const noexcept;
</pre>
<blockquote>
<p>
-9- <i>Returns</i>: <code>true</code> if and only if <code>*this</code> contains a value.
<p/>
-10- <i>Remarks</i>: This function is a constexpr function.
</p>
</blockquote>
<pre>
constexpr bool has_value() const noexcept;
</pre>
<blockquote>
<p>
-11- <i>Returns</i>: <code>true</code> if and only if <code>*this</code> contains a value.
<p/>
-12- <i>Remarks</i>: This function is a constexpr function.
</p>
</blockquote>
<pre>
constexpr const T&amp; value() const &amp;;
constexpr T&amp; value() &amp;;
</pre>
<blockquote>
<p>
-13- <i>Effects</i>: Equivalent to:
</p>
<blockquote><pre>
return has_value() ? <ins><i>val</i></ins><del>*val</del> : throw bad_optional_access();
</pre></blockquote>
</blockquote>
<pre>
constexpr T&amp;&amp; value() &amp;&amp;;
constexpr const T&amp;&amp; value() const &amp;&amp;;
</pre>
<blockquote>
<p>
-14- <i>Effects</i>: Equivalent to:
</p>
<blockquote><pre>
return has_value() ? std::move(<ins><i>val</i></ins><del>*val</del>) : throw bad_optional_access();
</pre></blockquote>
</blockquote>
<pre>
template&lt;class U&gt; constexpr T value_or(U&amp;&amp; v) const &amp;;
</pre>
<blockquote>
<p>
-15- <i>Mandates</i>: [&hellip;]
<p/>
-16- <i>Effects</i>: Equivalent to:
</p>
<blockquote><pre>
return has_value() ? <ins><i>val</i></ins><del>**this</del> : static_cast&lt;T&gt;(std::forward&lt;U&gt;(v));
</pre></blockquote>
</blockquote>
<pre>
template&lt;class U&gt; constexpr T value_or(U&amp;&amp; v) &amp;&amp;;
</pre>
<blockquote>
<p>
-17- <i>Mandates</i>: [&hellip;]
<p/>
-18- <i>Effects</i>: Equivalent to:
</p>
<blockquote><pre>
return has_value() ? std::move(<ins><i>val</i></ins><del>**this</del>) : static_cast&lt;T&gt;(std::forward&lt;U&gt;(v));
</pre></blockquote>
</blockquote>
</blockquote>
</li>

<li><p>Modify 22.5.3.8 <a href="https://wg21.link/optional.monadic">[optional.monadic]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class F&gt; constexpr auto and_then(F&amp;&amp; f) &amp;;
template&lt;class F&gt; constexpr auto and_then(F&amp;&amp; f) const &amp;;
</pre>
<blockquote>
<p>
-1- Let <code>U</code> be <code>invoke_result_t&lt;F, decltype(<ins>(<i>val</i>)</ins><del>*val</del>)&gt;</code>.
<p/>
-2- <i>Mandates</i>: [&hellip;]
<p/>
-3- <i>Effects</i>: Equivalent to:
</p>
<blockquote><pre>
if (*this) {
  return invoke(std::forward&lt;F&gt;(f), <ins><i>val</i></ins><del>*val</del>);
} else {
  return remove_cvref_t&lt;U&gt;();
}
</pre></blockquote>
</blockquote>
<pre>
template&lt;class F&gt; constexpr auto and_then(F&amp;&amp; f) &amp;&amp;;
template&lt;class F&gt; constexpr auto and_then(F&amp;&amp; f) const &amp;&amp;;
</pre>
<blockquote>
<p>
-4- Let <code>U</code> be <code>invoke_result_t&lt;F, decltype(std::move(<ins><i>val</i></ins><del>*val</del>))&gt;</code>.
<p/>
-5- <i>Mandates</i>: [&hellip;]
<p/>
-6- <i>Effects</i>: Equivalent to:
</p>
<blockquote><pre>
if (*this) {
  return invoke(std::forward&lt;F&gt;(f), std::move(<ins><i>val</i></ins><del>*val</del>));
} else {
  return remove_cvref_t&lt;U&gt;();
}
</pre></blockquote>
</blockquote>
<pre>
template&lt;class F&gt; constexpr auto transform(F&amp;&amp; f) &amp;;
template&lt;class F&gt; constexpr auto transform(F&amp;&amp; f) const &amp;;
</pre>
<blockquote>
<p>
-7- Let <code>U</code> be <code>remove_cv_t&lt;invoke_result_t&lt;F, decltype(<ins>(<i>val</i>)</ins><del>*val</del>)&gt;&gt;</code>.
<p/>
-8- <i>Mandates</i>: <code>U</code> is a non-array object type other than <code>in_place_t</code> or <code>nullopt_t</code>. The declaration
</p>
<blockquote><pre>
U u(invoke(std::forward&lt;F&gt;(f), <ins><i>val</i></ins><del>*val</del>));
</pre></blockquote>
<p>
is well-formed for some invented variable <code>u</code>.
<p/>
[&hellip;]
<p/>
-9- <i>Returns</i>: If <code>*this</code> contains a value, an <code>optional&lt;U&gt;</code> object whose contained value is
direct-non-list-initialized with <code>invoke(std::forward&lt;F&gt;(f), <ins><i>val</i></ins><del>*val</del>)</code>; otherwise,
<code>optional&lt;U&gt;()</code>.
</p>
</blockquote>
<pre>
template&lt;class F&gt; constexpr auto transform(F&amp;&amp; f) &amp;&amp;;
template&lt;class F&gt; constexpr auto transform(F&amp;&amp; f) const &amp;&amp;;
</pre>
<blockquote>
<p>
-10- Let <code>U</code> be <code>remove_cv_t&lt;invoke_result_t&lt;F, decltype(std::move(<ins><i>val</i></ins><del>*val</del>))&gt;&gt;</code>.
<p/>
-11- <i>Mandates</i>: <code>U</code> is a non-array object type other than <code>in_place_t</code> or <code>nullopt_t</code>. The declaration
</p>
<blockquote><pre>
U u(invoke(std::forward&lt;F&gt;(f), std::move(<ins><i>val</i></ins><del>*val</del>)));
</pre></blockquote>
<p>
is well-formed for some invented variable <code>u</code>.
<p/>
[&hellip;]
<p/>
-12- <i>Returns</i>: If <code>*this</code> contains a value, an <code>optional&lt;U&gt;</code> object whose contained value is
direct-non-list-initialized with <code>invoke(std::forward&lt;F&gt;(f), std::move(<ins><i>val</i></ins><del>*val</del>))</code>; otherwise,
<code>optional&lt;U&gt;()</code>.
</p>
</blockquote>
</blockquote>
</li>

<li><p>Modify 22.5.3.9 <a href="https://wg21.link/optional.mod">[optional.mod]</a> as indicated:</p>

<blockquote>
<pre>
constexpr void reset() noexcept;
</pre>
<blockquote>
<p>
-1- <i>Effects</i>: If <code>*this</code> contains a value, calls <code><del>val-&gt;</del><ins><i>val</i>.</ins>T::~T()</code>
to destroy the contained value; otherwise no effect.
<p/>
-2- <i>Postconditions</i>: <code>*this</code> does not contain a value.
</p>
</blockquote>
</blockquote>
</li>

<li><p>Modify 22.5.4.2 <a href="https://wg21.link/optional.ref.ctor">[optional.ref.ctor]</a> as indicated:</p>

<pre>
template&lt;class U&gt;
  constexpr explicit(!is_convertible_v&lt;U&amp;, T&amp;&gt;)
  optional(optional&lt;U&gt;&amp; rhs) noexcept(is_nothrow_constructible_v&lt;T&amp;, U&amp;&gt;);
</pre>
<blockquote>
<p/>
-8- <i>Constraints</i>: [&hellip;]
<p/>
-9- <i>Effects</i>: Equivalent to:
<pre>
  if (rhs.has_value()) convert-ref-init-val(<del>*</del>rhs<ins>.operator*()</ins>);
</pre>
<p/>
-10- <i>Remarks</i>: [&hellip;]
</blockquote>

<pre>
template&lt;class U&gt;
  constexpr explicit(!is_convertible_v&lt;const U&amp;, T&amp;&gt;)
  optional(const optional&lt;U&gt;&amp; rhs) noexcept(is_nothrow_constructible_v&lt;T&amp;, const U&amp;&gt;);
</pre>
<blockquote>
<p/>
-11- <i>Constraints</i>: [&hellip;]
<p/>
-12- <i>Effects</i>: Equivalent to:
<pre>
  if (rhs.has_value()) convert-ref-init-val(<del>*</del>rhs<ins>.operator*()</ins>);
</pre>
<p/>
-13- <i>Remarks</i>: [&hellip;]
</blockquote>

<pre>
template&lt;class U&gt;
  constexpr explicit(!is_convertible_v&lt;U, T&amp;&gt;)
  optional(optional&lt;U&gt;&amp;&amp; rhs) noexcept(is_nothrow_constructible_v&lt;T&amp;, U&gt;);
</pre>
<blockquote>
<p/>
-14- <i>Constraints</i>: [&hellip;]
<p/>
-15- <i>Effects</i>: Equivalent to:
<pre>
  if (rhs.has_value()) convert-ref-init-val(<del>*</del>std::move(rhs)<ins>.operator*()</ins>);
</pre>
<p/>
-16- <i>Remarks</i>: [&hellip;]
</blockquote>

<pre>
template&lt;class U&gt;
  constexpr explicit(!is_convertible_v&lt;const U, T&amp;&gt;)
  optional(const optional&lt;U&gt;&amp;&amp; rhs) noexcept(is_nothrow_constructible_v&lt;T&amp;, const U&gt;);
</pre>
<blockquote>
<p/>
-17- <i>Constraints</i>: [&hellip;]
<p/>
-18- <i>Effects</i>: Equivalent to:
<pre>
  if (rhs.has_value()) convert-ref-init-val(<del>*</del>std::move(rhs)<ins>.operator*()</ins>);
</pre>
<p/>
-19- <i>Remarks</i>: [&hellip;]
</blockquote>
</li>

</ol>





<hr>
<h3 id="4230"><a href="#4230">4230</a><sup><a href="https://cplusplus.github.io/LWG/issue4230">(i)</a></sup>. <code>simd&lt;complex&gt;::real/imag</code> is overconstrained</h3>
<p><b>Section:</b> 29.10.8.4 <a href="https://wg21.link/simd.complex.access">[simd.complex.access]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Matthias Kretz <b>Opened:</b> 2025-03-18 <b>Last modified:</b> 2025-11-04</p>
<p><b>Priority: </b>2
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
29.10.8.4 <a href="https://wg21.link/simd.complex.access">[simd.complex.access]</a> overconstrains the arguments to <code class='backtick'>real</code> and <code class='backtick'>imag</code>.
<code>complex&lt;T&gt;::real/imag</code> allows conversions to <code class='backtick'>T</code> whereas <code>simd&lt;complex&lt;T&gt;&gt;</code>
requires basically an exact match (<code>same_as&lt;simd&lt;T&gt;&gt;</code> modulo ABI tag differences).
</p>
<blockquote><pre>
complex&lt;double&gt; c = {};
c.real(1.f); // OK

simd&lt;complex&lt;double&gt;&gt; sc = {};
sc.real(simd&lt;float&gt;(1.f)); // <span style="color:red;font-weight:bolder">ill-formed, should be allowed</span>
</pre></blockquote>
<p>
The design intent was to match the <code>std::complex&lt;T&gt;</code> interface. In which case
the current wording doesn't match that intent. <code class='backtick'>complex</code> doesn't say <code>real(same_as&lt;T&gt; auto)</code> 
but 'real(T)', which allows conversions.
<p/>
This issue is also present in the <code class='backtick'>basic_simd(real, imag)</code> constructor. It deduces the type for the 
real/imag arguments instead of using a dependent type derived from <code class='backtick'>value_type</code> and ABI tag.
</p>
<blockquote><pre>
// OK:
complex&lt;double&gt; c{1., 1.f};

// <span style="color:red;font-weight:bolder">Ill-formed, should be allowed</span>:
simd&lt;complex&lt;double&gt;&gt; sc0(1., 1.);
simd&lt;complex&lt;double&gt;, 4&gt; sc1(simd&lt;double, 4&gt;(1.), simd&lt;float, 4&gt;(1.f));
</pre></blockquote>

<p><i>[2025-06-13; Reflector poll]</i></p>

<p>
Set priority to 2 after reflector poll.
</p>

<p><strong>Previous resolution [SUPERSEDED]:</strong></p>
<blockquote class="note">

<p>
This wording is relative to <a href="https://wg21.link/N5008" title=" Working Draft, Programming Languages — C++">N5008</a>.
</p>

<ol>

<li><p>Modify 29.10.7.1 <a href="https://wg21.link/simd.overview">[simd.overview]</a>, class template <code class='backtick'>basic_simd</code> synopsis, as indicated:</p>

<blockquote>
<pre>
namespace std::datapar {
  template&lt;class T, class Abi&gt; class basic_simd {
  public:
    using value_type = T;
    using mask_type = basic_simd_mask&lt;sizeof(T), Abi&gt;;
    using abi_type = Abi;
    
    <ins>using <i>real-type</i> = rebind_t&lt;typename T::value_type, basic_simd&gt; <i>// exposition-only</i></ins>
    
    <i>// 29.10.7.2 <a href="https://wg21.link/simd.ctor">[simd.ctor]</a>, basic_simd constructors</i>   
    [&hellip;]
    <del>template&lt;<i>simd-floating-point</i> V&gt;</del>
      constexpr explicit(<i>see below</i>) basic_simd(const <ins><i>real-type</i></ins><del>V</del>&amp; reals, const <ins><i>real-type</i></ins><del>V</del>&amp; imags = {}) noexcept;
    [&hellip;]
    <i>// 29.10.8.4 <a href="https://wg21.link/simd.complex.access">[simd.complex.access]</a>, basic_simd complex-value accessors</i>
    constexpr <ins><i>real-type</i></ins><del>auto</del> real() const noexcept;
    constexpr <ins><i>real-type</i></ins><del>auto</del> imag() const noexcept;
    <del>template&lt;<i>simd-floating-point</i> V&gt;</del>
      constexpr void real(const <ins><i>real-type</i></ins><del>V</del>&amp; v) noexcept;
    <del>template&lt;<i>simd-floating-point</i> V&gt;</del>
      constexpr void imag(const <ins><i>real-type</i></ins><del>V</del>&amp; v) noexcept;
    [&hellip;]
  };
  [&hellip;]
}
</pre>
</blockquote>
</li>

<li><p>Modify 29.10.7.2 <a href="https://wg21.link/simd.ctor">[simd.ctor]</a> as indicated:</p>

<blockquote>
<pre>
<del>template&lt;<i>simd-floating-point</i> V&gt;</del>
  constexpr explicit(<i>see below</i>) basic_simd(const <ins><i>real-type</i></ins><del>V</del>&amp; reals, const <ins><i>real-type</i></ins><del>V</del>&amp; imags = {}) noexcept;
</pre>
<blockquote>
<p>
-19- <i>Constraints</i>:
</p>
<ol style="list-style-type: none">
<li><p><del>(19.1) &mdash;</del> <code><i>simd-complex</i>&lt;basic_simd&gt;</code> is modeled<ins>.</ins><del>, and</del></p></li>
<li><p><del>(19.2) &mdash; <code class='backtick'>V::size() == size()</code> is <code class='backtick'>true</code>.</del></p></li>
</ol>
<p>
[&hellip;]
<p/>
-21- <i>Remarks</i>: The expression inside <code class='backtick'>explicit</code> evaluates to <code class='backtick'>false</code> if and only if the 
floating-point conversion rank of <code class='backtick'>T::value_type</code> is greater than or equal to the floating-point 
conversion rank of <code><ins><i>real-type</i></ins><del>V</del>::value_type</code>.
</p>
</blockquote>
</blockquote>
</li>

<li><p>Modify 29.10.8.4 <a href="https://wg21.link/simd.complex.access">[simd.complex.access]</a> as indicated:</p>

<blockquote>
<pre>
constexpr <ins><i>real-type</i></ins><del>auto</del> real() const noexcept;
constexpr <ins><i>real-type</i></ins><del>auto</del> imag() const noexcept;
</pre>
<blockquote>
<p>
-1- <i>Constraints</i>: <code><i>simd-complex</i>&lt;basic_simd&gt;</code> is modeled.
<p/>
-2- <i>Returns</i>: An object of type <code><ins><i>real-type</i></ins><del>rebind_t&lt;typename T::value_type, basic_simd&gt;</del></code> 
where the <code><i>i</i></code><sup>th</sup> element is initialized to the result of 
<code><i>cmplx-func</i>(operator[](<i>i</i>))</code> for all <code><i>i</i></code> in the range 
<code class='backtick'>[0, size())</code>, where <code><i>cmplx-func</i></code> is the corresponding function from 
<code>&lt;complex&gt;</code>.
</p>
</blockquote>
<pre>
<del>template&lt;<i>simd-floating-point</i> V&gt;</del>
  constexpr void real(const <ins><i>real-type</i></ins><del>V</del>&amp; v) noexcept;
<del>template&lt;<i>simd-floating-point</i> V&gt;</del>
  constexpr void imag(const <ins><i>real-type</i></ins><del>V</del>&amp; v) noexcept;
</pre>
<blockquote>
<p>
-3- <i>Constraints</i>:
</p>
<ol style="list-style-type: none">
<li><p><del>(3.1) &mdash;</del> <code><i>simd-complex</i>&lt;basic_simd&gt;</code> is modeled<ins>.</ins><del>,</del></p></li>
<li><p><del>(3.2) &mdash; <code>same_as&lt;typename V::value_type, typename T::value_type&gt;</code> is modeled, and</del></p></li>
<li><p><del>(3.3) &mdash; <code class='backtick'>V::size() == size()</code> is <code class='backtick'>true</code>.</del></p></li>
</ol>
<p>
[&hellip;]
</p>
</blockquote>
</blockquote>
</li>

</ol>
</blockquote>

<p><i>[2025-07-21; Matthias Kretz comments]</i></p>

<p>
The currently shown P/R says:
</p>
<blockquote><p>
<i>Remarks</i>: The expression inside <code class='backtick'>explicit</code> evaluates to <code class='backtick'>false</code> if and only if
the floating-point conversion rank of <code class='backtick'>T::value_type</code> is greater than or equal
to the floating-point conversion rank of <code><i>real-type</i>::value_type</code>.
</p></blockquote>
<p>
But, by construction, <code><i>real-type</i>::value_type</code> is the same as <code class='backtick'>T::value_type</code>. 
So we get an elaborately worded <code class='backtick'>explicit(false)</code> here (which is correct).
Consequently, the proposed resolution needs to strike <code class='backtick'>explicit(&lt;i&gt;see below&lt;/i&gt;)</code>
from 29.10.7.1 <a href="https://wg21.link/simd.overview">[simd.overview]</a> and 29.10.7.2 <a href="https://wg21.link/simd.ctor">[simd.ctor]</a> and drop the Remarks paragraph (21).
</p>

<p><i>[Kona 2025-11-04; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>



<p id="res-4230"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>


<ol>

<li><p>Modify 29.10.7.1 <a href="https://wg21.link/simd.overview">[simd.overview]</a>, class template <code class='backtick'>basic_vec</code> synopsis, as indicated:</p>

<blockquote>
<pre>
namespace std::simd {
  template&lt;class T, class Abi&gt; class basic_vec {
    <ins>using <i>real-type</i> = <i>see below</i>; <i>// exposition-only</i></ins>
  public:
    using value_type = T;
    using mask_type = basic_mask&lt;sizeof(T), Abi&gt;;
    using abi_type = Abi;
    using iterator = <i>simd-iterator</i>&lt;basic_vec&gt;;
    using const_iterator = <i>simd-iterator</i>&lt;const basic_vec&gt;;
    
    <i>// 29.10.7.2 <a href="https://wg21.link/simd.ctor">[simd.ctor]</a>, basic_vec constructors</i>   
    [&hellip;]
    <del>template&lt;<i>simd-floating-point</i> V&gt;</del>
      constexpr <del>explicit(<i>see below</i>)</del> basic_vec(const <ins><i>real-type</i></ins><del>V</del>&amp; reals, const <ins><i>real-type</i></ins><del>V</del>&amp; imags = {}) noexcept;
    [&hellip;]
    <i>// 29.10.8.4 <a href="https://wg21.link/simd.complex.access">[simd.complex.access]</a>, basic_vec complex-value accessors</i>
    constexpr <ins><i>real-type</i></ins><del>auto</del> real() const noexcept;
    constexpr <ins><i>real-type</i></ins><del>auto</del> imag() const noexcept;
    <del>template&lt;<i>simd-floating-point</i> V&gt;</del>
      constexpr void real(const <ins><i>real-type</i></ins><del>V</del>&amp; v) noexcept;
    <del>template&lt;<i>simd-floating-point</i> V&gt;</del>
      constexpr void imag(const <ins><i>real-type</i></ins><del>V</del>&amp; v) noexcept;
    [&hellip;]
  };
  [&hellip;]
}
</pre>
<p>-2- <i>Recommended practice</i>: [&hellip;]</p>
<blockquote>[<i>Note 1</i>: &hellip;]</blockquote>
<p>-?- <ins>
If <code class='backtick'>T</code> is a specialization of <code class='backtick'>complex</code>, <i><code class='backtick'>real-type</code></i> denotes the same type
as <code>rebind_t&lt;typename T::value_type, basic_vec&lt;T, Abi&gt;&gt;</code>,
otherwise an unspecified non-array object type.
</ins>
</p>
</blockquote>
</li>

<li><p>Modify 29.10.7.2 <a href="https://wg21.link/simd.ctor">[simd.ctor]</a> as indicated:</p>

<blockquote>
<pre>
<del>template&lt;<i>simd-floating-point</i> V&gt;</del>
  constexpr <del>explicit(<i>see below</i>)</del> 
    basic_vec(const <ins><i>real-type</i></ins><del>V</del>&amp; reals, const <ins><i>real-type</i></ins><del>V</del>&amp; imags = {}) noexcept;
</pre>
<blockquote>
<p>
-19- <i>Constraints</i>:
</p>
<ol style="list-style-type: none">
<li><p><del>(19.1) &mdash;</del> <code><i>simd-complex</i>&lt;basic_vec&gt;</code> is modeled<ins>.</ins><del>, and</del></p></li>
<li><p><del>(19.2) &mdash; <code class='backtick'>V::size() == size()</code> is <code class='backtick'>true</code>.</del></p></li>
</ol>
<p>
[&hellip;]
<p/>
<del>-21- <i>Remarks</i>: The expression inside <code class='backtick'>explicit</code> evaluates to <code class='backtick'>false</code> if and only if the 
floating-point conversion rank of <code class='backtick'>T::value_type</code> is greater than or equal to the floating-point 
conversion rank of <code>V::value_type</code>.</del>
</p>
</blockquote>
</blockquote>
</li>

<li><p>Modify 29.10.8.4 <a href="https://wg21.link/simd.complex.access">[simd.complex.access]</a> as indicated:</p>

<blockquote>
<pre>
constexpr <ins><i>real-type</i></ins><del>auto</del> real() const noexcept;
constexpr <ins><i>real-type</i></ins><del>auto</del> imag() const noexcept;
</pre>
<blockquote>
<p>
-1- <i>Constraints</i>: <code><i>simd-complex</i>&lt;basic_vec&gt;</code> is modeled.
<p/>
-2- <i>Returns</i>: An object of type <code><ins><i>real-type</i></ins><del>rebind_t&lt;typename T::value_type, basic_vec&gt;</del></code> 
where the <code><i>i</i></code><sup>th</sup> element is initialized to the result of 
<code><i>cmplx-func</i>(operator[](<i>i</i>))</code> for all <code><i>i</i></code> in the range 
<code class='backtick'>[0, size())</code>, where <code><i>cmplx-func</i></code> is the corresponding function from 
<code>&lt;complex&gt;</code>.
</p>
</blockquote>
<pre>
<del>template&lt;<i>simd-floating-point</i> V&gt;</del>
  constexpr void real(const <ins><i>real-type</i></ins><del>V</del>&amp; v) noexcept;
<del>template&lt;<i>simd-floating-point</i> V&gt;</del>
  constexpr void imag(const <ins><i>real-type</i></ins><del>V</del>&amp; v) noexcept;
</pre>
<blockquote>
<p>
-3- <i>Constraints</i>:
</p>
<ol style="list-style-type: none">
<li><p><del>(3.1) &mdash;</del> <code><i>simd-complex</i>&lt;basic_vec&gt;</code> is modeled<ins>.</ins><del>,</del></p></li>
<li><p><del>(3.2) &mdash; <code>same_as&lt;typename V::value_type, typename T::value_type&gt;</code> is modeled, and</del></p></li>
<li><p><del>(3.3) &mdash; <code class='backtick'>V::size() == size()</code> is <code class='backtick'>true</code>.</del></p></li>
</ol>
<p>
[&hellip;]
</p>
</blockquote>
</blockquote>
</li>

</ol>





<hr>
<h3 id="4251"><a href="#4251">4251</a><sup><a href="https://cplusplus.github.io/LWG/issue4251">(i)</a></sup>. Move assignment for <code class='backtick'>indirect</code> unnecessarily requires copy construction</h3>
<p><b>Section:</b> 20.4.1.5 <a href="https://wg21.link/indirect.assign">[indirect.assign]</a>, 20.4.2.5 <a href="https://wg21.link/polymorphic.assign">[polymorphic.assign]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Jonathan Wakely <b>Opened:</b> 2025-05-01 <b>Last modified:</b> 2025-11-04</p>
<p><b>Priority: </b>1
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
The move assignment operator for <code class='backtick'>indirect</code> says:
<blockquote>
<i>Mandates</i>: <code>is_copy_constructible_t&lt;T&gt;</code> is <code class='backtick'>true</code>.
</blockquote>

However, the only way it ever construct an object is:
<blockquote>
constructs a new owned object with the owned object of <code class='backtick'>other</code> as the argument
as an rvalue
</blockquote>
and that only ever happens when <code><i>alloc</i> == other.<i>alloc</i></code>
is false.
</p>
<p>
It seems like we should require <code class='backtick'>is_move_constructible_v</code> instead,
and only if the allocator traits mean we need to construct an object.
(Technically move-constructible might not be correct, because the allocator's
<code class='backtick'>construct</code> member might use a different constructor).
</p>
<p>
Additionally, the noexcept-specifier for the move assignment doesn't match
the effects. The noexcept-specifier says it can't throw if POCMA is true,
but nothing in the effects says that ownership can be transferred in that case;
we only do a non-throwing transfer when the allocators are equal.
I think we <i>should</i> transfer ownership when POCMA is true,
which would make the noexcept-specifier correct.
</p>

<p><i>[2025-06-12; Reflector poll]</i></p>

<p>
Set priority to 1 after reflector poll.
</p>
<p>
Similar change needed for <code class='backtick'>std::polymorphic</code>.
</p>


<p><strong>Previous resolution [SUPERSEDED]:</strong></p>
<blockquote class="note">

<p>
This wording is relative to <a href="https://wg21.link/N5008" title=" Working Draft, Programming Languages — C++">N5008</a>.
</p>
<ol>

<li><p>Modify 20.4.1.5 <a href="https://wg21.link/indirect.assign">[indirect.assign]</a> as indicated:</p>
<blockquote>
<pre><code>
constexpr indirect&amp; operator=(indirect&amp;&amp; other)
  noexcept(allocator_traits&lt;Allocator&gt;::propagate_on_container_move_assignment::value ||
           allocator_traits&lt;Allocator&gt;::is_always_equal::value);
</code></pre>
<blockquote>
<p>
-5- <i>Mandates</i>:
<ins>
If
<code>allocator_traits&lt;Allocator&gt;::propagate_on_container_move_assignment::value</code>
is <code class='backtick'>false</code>
and
<code>allocator_traits&lt;Allocator&gt;::is_always_equal::value</code>
is <code class='backtick'>false</code>,
</ins>
<code>is_<del>copy</del><ins>move</ins>_constructible_t&lt;T&gt;</code> is <code class='backtick'>true</code>.
</p>
<p>
-6- <i>Effects</i>:
If <code class='backtick'>addressof(other) == this</code> is <code class='backtick'>true</code>, there are no effects.
Otherwise:
<ol style="list-style-type:none">
<li>(6.1) &mdash;
The allocator needs updating if
<code>allocator_traits&lt;Allocator&gt;::propagate_on_container_move_assignment::value</code>
is <code class='backtick'>true</code>.
</li>
<li>(6.2) &mdash;
If <code class='backtick'>other</code> is valueless, <code class='backtick'>*this</code> becomes valueless<del> and the owned object
in <code class='backtick'>*this</code>, if any, is destroyed using
<code>allocator_traits&lt;Allocator&gt;::destroy</code>
and then the storage is deallocated</del>.
</li>
<li>(6.3) &mdash;
Otherwise,
<ins>if the allocator needs updating or</ins>
if <code><i>alloc</i> == other.<i>alloc</i></code> is <code class='backtick'>true</code>,
<del>
swaps the owned objects in <code class='backtick'>*this</code> and <code class='backtick'>other</code>;
the owned object in <code class='backtick'>other</code>, if any, is then destroyed using
<code>allocator_traits&lt;Allocator&gt;::destroy</code>
and then the storage is deallocated
</del>
<ins><code class='backtick'>*this</code> takes ownership of the owned object of <code class='backtick'>other</code></ins>.
</li>
<li>(6.4) &mdash;
Otherwise, constructs a new owned object with the owned object of <code class='backtick'>other</code>
as the argument as an rvalue, using either the allocator in <code class='backtick'>*this</code>
or the allocator in <code class='backtick'>other</code> if the allocator needs updating.
</li>
<li>(6.5) &mdash;
The previously owned object in <code class='backtick'>*this</code>, if any, is destroyed using
<code>allocator_traits&lt;Allocator&gt;::destroy</code>
and then the storage is deallocated.
</li>
<li>(6.6) &mdash;
If the allocator needs updating,
the allocator in <code class='backtick'>*this</code> is replaced with a copy of the allocator in <code class='backtick'>other</code>.
</li>
</ol>
</p>
<p>-7- <i>Postcondition</i>: <code class='backtick'>other</code> is valueless.</p>
</blockquote>
</blockquote>
</li>
</ol>
</blockquote>

<p><i>[2025-11-03; Tomasz provides wording.]</i></p>


<p><i>[Kona 2025-11-03; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>



<p id="res-4251"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>
<ol>

<li><p>Modify 20.4.1.5 <a href="https://wg21.link/indirect.assign">[indirect.assign]</a> as indicated:</p>
<blockquote>
<pre><code>
constexpr indirect&amp; operator=(indirect&amp;&amp; other)
  noexcept(allocator_traits&lt;Allocator&gt;::propagate_on_container_move_assignment::value ||
           allocator_traits&lt;Allocator&gt;::is_always_equal::value);
</code></pre>
<blockquote>
<p>
-5- <i>Mandates</i>:
<ins>
If
<code>allocator_traits&lt;Allocator&gt;::propagate_on_container_move_assignment::value</code>
is <code class='backtick'>false</code>
and
<code>allocator_traits&lt;Allocator&gt;::is_always_equal::value</code>
is <code class='backtick'>false</code>,
</ins>
<code>is_<del>copy</del><ins>move</ins>_constructible_t&lt;T&gt;</code> is <code class='backtick'>true</code>.
</p>
<p>
-6- <i>Effects</i>:
If <code class='backtick'>addressof(other) == this</code> is <code class='backtick'>true</code>, there are no effects.
Otherwise:
<ol style="list-style-type:none">
<li>(6.1) &mdash;
The allocator needs updating if
<code>allocator_traits&lt;Allocator&gt;::propagate_on_container_move_assignment::value</code>
is <code class='backtick'>true</code>.
</li>
<li>(6.2) &mdash;
If <code class='backtick'>other</code> is valueless, <code class='backtick'>*this</code> becomes valueless<del> and the owned object
in <code class='backtick'>*this</code>, if any, is destroyed using
<code>allocator_traits&lt;Allocator&gt;::destroy</code>
and then the storage is deallocated</del>.
</li>
<li>(6.3) &mdash;
Otherwise,
<ins>if the allocator needs updating or</ins>
if <code><i>alloc</i> == other.<i>alloc</i></code> is <code class='backtick'>true</code>,
<del>
swaps the owned objects in <code class='backtick'>*this</code> and <code class='backtick'>other</code>;
the owned object in <code class='backtick'>other</code>, if any, is then destroyed using
<code>allocator_traits&lt;Allocator&gt;::destroy</code>
and then the storage is deallocated
</del>
<ins><code class='backtick'>*this</code> takes ownership of the owned object of <code class='backtick'>other</code></ins>.
</li>
<li>(6.4) &mdash;
Otherwise, constructs a new owned object with the owned object of <code class='backtick'>other</code>
as the argument as an rvalue, using <del>either</del> the allocator in <code class='backtick'>*this</code>
<del>or the allocator in <code class='backtick'>other</code> if the allocator needs updating</del>.
</li>
<li>(6.5) &mdash;
The previously owned object in <code class='backtick'>*this</code>, if any, is destroyed using
<code>allocator_traits&lt;Allocator&gt;::destroy</code>
and then the storage is deallocated.
</li>
<li>(6.6) &mdash;
If the allocator needs updating,
the allocator in <code class='backtick'>*this</code> is replaced with a copy of the allocator in <code class='backtick'>other</code>.
</li>
</ol>
</p>
<p>-7- <i>Postcondition</i>: <code class='backtick'>other</code> is valueless.</p>
</blockquote>
</blockquote>
</li>

<li><p>Modify 20.4.2.5 <a href="https://wg21.link/polymorphic.assign">[polymorphic.assign]</a> as indicated:</p>
<blockquote>
<pre><code>
constexpr polymorphic&amp; operator=(polymorphic&amp;&amp; other)
  noexcept(allocator_traits&lt;Allocator&gt;::propagate_on_container_move_assignment::value ||
           allocator_traits&lt;Allocator&gt;::is_always_equal::value);
</code></pre>
<blockquote>
<p>
-5- <i>Mandates</i>:
If
<ins>
<code>allocator_traits&lt;Allocator&gt;::propagate_on_container_move_assignment::value</code>
is <code class='backtick'>false</code>
and
</ins>
<code>allocator_traits&lt;Allocator&gt;::is_always_equal::value</code>
is <code class='backtick'>false</code>,
<code class='backtick'>T</code> is complete type.
</p>
<p>
-6- <i>Effects</i>:
If <code class='backtick'>addressof(other) == this</code> is <code class='backtick'>true</code>, there are no effects.
Otherwise:
<ol style="list-style-type:none">
<li>(6.1) &mdash;
The allocator needs updating if
<code>allocator_traits&lt;Allocator&gt;::propagate_on_container_move_assignment::value</code>
is <code class='backtick'>true</code>.
</li>
<li><ins>(6.?) &mdash; If <code class='backtick'>other</code> is valueless, <code class='backtick'>*this</code> becomes valueless.</ins></li>
<li>(6.2) &mdash;
<ins>Otherwise, if the allocator needs updating or</ins><del>If</del>
<code><i>alloc</i> == other.<i>alloc</i></code> is <code class='backtick'>true</code>,
<del>
swaps the owned objects in <code class='backtick'>*this</code> and <code class='backtick'>other</code>;
the owned object in <code class='backtick'>other</code>, if any, is then destroyed using
<code>allocator_traits&lt;Allocator&gt;::destroy</code>
and then the storage is deallocated
</del>
<ins><code class='backtick'>*this</code> takes ownership of the owned object of <code class='backtick'>other</code></ins>.
</li>
<li>(6.3) &mdash;
<del>Otherwise, if <code class='backtick'>alloc != other.alloc</code> is <code class='backtick'>true</code>; if <code class='backtick'>other</code> is not valueless, 
a new owned object is constructed in <code class='backtick'>*this</code> using <code>allocator_traits::construct</code>
with the owned object from</del>
<ins>Otherwise, constructs a new owned object with the owned object of</ins>
<code class='backtick'>other</code> as the argument as an rvalue, using <del>either</del> the allocator in <code class='backtick'>*this</code>
<del>or the allocator in <code class='backtick'>other</code> if the allocator needs updating</del>.
</li>
<li>(6.4) &mdash;
The previously owned object in <code class='backtick'>*this</code>, if any, is destroyed using
<code>allocator_traits&lt;Allocator&gt;::destroy</code>
and then the storage is deallocated.
</li>
<li>(6.5) &mdash;
If the allocator needs updating,
the allocator in <code class='backtick'>*this</code> is replaced with a copy of the allocator in <code class='backtick'>other</code>.
</li>
</ol>
</p>
[&hellip;]
</blockquote>
</blockquote>
</li>

</ol>





<hr>
<h3 id="4272"><a href="#4272">4272</a><sup><a href="https://cplusplus.github.io/LWG/issue4272">(i)</a></sup>. For <code class='backtick'>rank == 0</code>, <code class='backtick'>layout_stride</code> is atypically convertible</h3>
<p><b>Section:</b> 23.7.3.4 <a href="https://wg21.link/mdspan.layout">[mdspan.layout]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Luc Grosheintz <b>Opened:</b> 2025-06-02 <b>Last modified:</b> 2025-11-05</p>
<p><b>Priority: </b>2
</p>
<p><b>View other</b> <a href="lwg-index-open.html#mdspan.layout">active issues</a> in [mdspan.layout].</p>
<p><b>View all other</b> <a href="lwg-index.html#mdspan.layout">issues</a> in [mdspan.layout].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
Commonly, two layouts are considered convertible, if the underlying
<code class='backtick'>extent_types</code> are convertible.
<p/>
However, for the two ctors <code class='backtick'>layout_left::mapping(layout_stride::mapping)</code> and
<code class='backtick'>layout_right::mapping(layout_stride::mapping)</code>, the condition is <code>rank &gt; 0</code>. 
Therefore,
</p>
<blockquote><pre>
using E1 = std::extents&lt;int&gt;;
using E2 = std::extents&lt;unsigned int&gt;;

static_assert(std::is_convertible_v&lt;
    std::layout_stride::mapping&lt;E2&gt;,
    std::layout_right::mapping&lt;E1&gt;
  &gt;);
</pre></blockquote>
<p>
even though:
</p>
<blockquote><pre>
static_assert(!std::is_convertible_v&lt;E2, E1&gt;);
</pre></blockquote>
<p>
Moreover, for rank 0 <code class='backtick'>layout_stride</code> can be converted to any
specialization of <code class='backtick'>layout_left</code> or <code class='backtick'>layout_right</code>; but not to every
specialization of <code class='backtick'>layout_stride</code>.
</p>

<p><i>[2025-06-12; Reflector poll]</i></p>

<p>
Set priority to 2 after reflector poll.
</p>

<p><strong>Previous resolution [SUPERSEDED]:</strong></p>
<blockquote class="note">

<p>
This wording is relative to <a href="https://wg21.link/N5008" title=" Working Draft, Programming Languages — C++">N5008</a>.
</p>

<blockquote class="note">
<p>
[<i>Drafting note</i>: As drive-by fixes the edits for <code>layout_left_padded&lt;&gt;::mapping</code> and
<code>layout_right_padded&lt;&gt;::mapping</code> also correct an editorial asymmetry between class
header synopsis declaration form and prototype specification form of the corresponding
constructors and adjust to the correct formatting of the exposition-only data member <code><i>rank_</i></code>.]
</p>
</blockquote>

<ol>
<li><p>Modify 23.7.3.4.5.1 <a href="https://wg21.link/mdspan.layout.left.overview">[mdspan.layout.left.overview]</a> as indicated:</p>

<blockquote>
<pre>
namespace std {
  template&lt;class Extents&gt;
  class layout_left::mapping {
    [&hellip;]
    <i>// 23.7.3.4.5.2 <a href="https://wg21.link/mdspan.layout.left.cons">[mdspan.layout.left.cons]</a>, constructors</i>
    [&hellip;]
    template&lt;class OtherExtents&gt;
      constexpr explicit(<del>extents_type::rank() &gt; 0</del><ins><i>see below</i></ins>)
        mapping(const layout_stride::mapping&lt;OtherExtents&gt;&amp;);
    
    constexpr mapping&amp; operator=(const mapping&amp;) noexcept = default;
    [&hellip;]
  };
}
</pre>
</blockquote>
</li>

<li><p>Modify 23.7.3.4.5.2 <a href="https://wg21.link/mdspan.layout.left.cons">[mdspan.layout.left.cons]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class OtherExtents&gt;
  constexpr explicit(<del>extents_type::rank() &gt; 0</del><ins><i>see below</i></ins>)
    mapping(const layout_stride::mapping&lt;OtherExtents&gt;&amp; other);
</pre>
<blockquote>
<p>
-13- <i>Constraints</i>: [&hellip;]
<p/>
-14- <i>Preconditions</i>: [&hellip;]
<p/>
-15- <i>Effects</i>: [&hellip;]
<p/>
<ins>-?- <i>Remarks</i>: The expression inside <code class='backtick'>explicit</code> is equivalent to:</ins>
</p>
<blockquote><pre>
<ins>!(extents_type::rank() == 0 &amp;&amp; is_convertible_v&lt;OtherExtents, extents_type&gt;)</ins>
</pre></blockquote>
</blockquote>
</blockquote>
</li>

<li><p>Modify 23.7.3.4.6.1 <a href="https://wg21.link/mdspan.layout.right.overview">[mdspan.layout.right.overview]</a> as indicated:</p>

<blockquote>
<pre>
namespace std {
  template&lt;class Extents&gt;
  class layout_right::mapping {
    [&hellip;]
    <i>// 23.7.3.4.6.2 <a href="https://wg21.link/mdspan.layout.right.cons">[mdspan.layout.right.cons]</a>, constructors</i>
    [&hellip;]
    template&lt;class OtherExtents&gt;
      constexpr explicit(<del>extents_type::rank() &gt; 0</del><ins><i>see below</i></ins>)
        mapping(const layout_stride::mapping&lt;OtherExtents&gt;&amp;);
    
    constexpr mapping&amp; operator=(const mapping&amp;) noexcept = default;
    [&hellip;]
  };
}
</pre>
</blockquote>
</li>

<li><p>Modify 23.7.3.4.6.2 <a href="https://wg21.link/mdspan.layout.right.cons">[mdspan.layout.right.cons]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class OtherExtents&gt;
  constexpr explicit(<del>extents_type::rank() &gt; 0</del><ins><i>see below</i></ins>)
    mapping(const layout_stride::mapping&lt;OtherExtents&gt;&amp; other);
</pre>
<blockquote>
<p>
-13- <i>Constraints</i>: [&hellip;]
<p/>
-14- <i>Preconditions</i>: [&hellip;]
<p/>
-15- <i>Effects</i>: [&hellip;]
<p/>
<ins>-?- <i>Remarks</i>: The expression inside <code class='backtick'>explicit</code> is equivalent to:</ins>
</p>
<blockquote><pre>
<ins>!(extents_type::rank() == 0 &amp;&amp; is_convertible_v&lt;OtherExtents, extents_type&gt;)</ins>
</pre></blockquote>
</blockquote>
</blockquote>
</li>

<li><p>Modify 23.7.3.4.8.1 <a href="https://wg21.link/mdspan.layout.leftpad.overview">[mdspan.layout.leftpad.overview]</a> as indicated:</p>

<blockquote>
<pre>
namespace std {
  template&lt;size_t PaddingValue&gt;
  template&lt;class Extents&gt;
  class layout_left_padded&lt;PaddingValue&gt;::mapping {
    [&hellip;]
    <i>// 23.7.3.4.8.3 <a href="https://wg21.link/mdspan.layout.leftpad.cons">[mdspan.layout.leftpad.cons]</a>, constructors</i>
    [&hellip;]
    template&lt;class OtherExtents&gt;
      constexpr explicit(<del>extents_type::rank() &gt; 0</del><ins><i>see below</i></ins>)
        mapping(const layout_stride::mapping&lt;OtherExtents&gt;&amp;);
    [&hellip;]
  };
}
</pre>
</blockquote>
</li>

<li><p>Modify 23.7.3.4.8.3 <a href="https://wg21.link/mdspan.layout.leftpad.cons">[mdspan.layout.leftpad.cons]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class OtherExtents&gt;
  constexpr explicit(<del>rank_ &gt; 0</del><ins><i>see below</i></ins>)
    mapping(const layout_stride::mapping&lt;OtherExtents&gt;&amp; other);
</pre>
<blockquote>
<p>
-10- <i>Constraints</i>: [&hellip;]
<p/>
-11- <i>Preconditions</i>: [&hellip;]
<p/>
-12- <i>Effects</i>: [&hellip;]
<p/>
<ins>-?- <i>Remarks</i>: The expression inside <code class='backtick'>explicit</code> is equivalent to:</ins>
</p>
<blockquote><pre>
<ins>!(<i>rank_</i> == 0 &amp;&amp; is_convertible_v&lt;OtherExtents, extents_type&gt;)</ins>
</pre></blockquote>
</blockquote>
</blockquote>
</li>

<li><p>Modify 23.7.3.4.9.1 <a href="https://wg21.link/mdspan.layout.rightpad.overview">[mdspan.layout.rightpad.overview]</a> as indicated:</p>

<blockquote>
<pre>
namespace std {
  template&lt;size_t PaddingValue&gt;
  template&lt;class Extents&gt;
  class layout_right_padded&lt;PaddingValue&gt;::mapping {
    [&hellip;]
    <i>// 23.7.3.4.9.3 <a href="https://wg21.link/mdspan.layout.rightpad.cons">[mdspan.layout.rightpad.cons]</a>, constructors</i>
    [&hellip;]
    template&lt;class OtherExtents&gt;
      constexpr explicit(<del>rank_ &gt; 0</del><ins><i>see below</i></ins>)
        mapping(const layout_stride::mapping&lt;OtherExtents&gt;&amp;);
    [&hellip;]
  };
}
</pre>
</blockquote>
</li>

<li><p>Modify 23.7.3.4.9.3 <a href="https://wg21.link/mdspan.layout.rightpad.cons">[mdspan.layout.rightpad.cons]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class OtherExtents&gt;
  constexpr explicit(<del>rank_ &gt; 0</del><ins><i>see below</i></ins>)
    mapping(const layout_stride::mapping&lt;OtherExtents&gt;&amp; other);
</pre>
<blockquote>
<p>
-10- <i>Constraints</i>: [&hellip;]
<p/>
-11- <i>Preconditions</i>: [&hellip;]
<p/>
-12- <i>Effects</i>: [&hellip;]
<p/>
<ins>-?- <i>Remarks</i>: The expression inside <code class='backtick'>explicit</code> is equivalent to:</ins>
</p>
<blockquote><pre>
<ins>!(<i>rank_</i> == 0 &amp;&amp; is_convertible_v&lt;OtherExtents, extents_type&gt;)</ins>
</pre></blockquote>
</blockquote>
</blockquote>
</li>

</ol>
</blockquote>

<p><i>[2025-06-20, Luc Grosheintz provides further wording improvements]</i></p>


<p><strong>Previous resolution [SUPERSEDED]:</strong></p>
<blockquote class="note">

<p>
This wording is relative to <a href="https://wg21.link/N5008" title=" Working Draft, Programming Languages — C++">N5008</a>.
</p>

<blockquote class="note">
<p>
[<i>Drafting note</i>: As drive-by fixes the edits for <code>layout_left_padded&lt;&gt;::mapping</code> and
<code>layout_right_padded&lt;&gt;::mapping</code> also correct an editorial asymmetry between class
header synopsis declaration form and prototype specification form of the corresponding
constructors and adjust to the correct formatting of the exposition-only data member <code><i>rank_</i></code>.]
</p>
</blockquote>

<ol>
<li><p>Modify 23.7.3.4.5.1 <a href="https://wg21.link/mdspan.layout.left.overview">[mdspan.layout.left.overview]</a> as indicated:</p>

<blockquote>
<pre>
namespace std {
  template&lt;class Extents&gt;
  class layout_left::mapping {
    [&hellip;]
    <i>// 23.7.3.4.5.2 <a href="https://wg21.link/mdspan.layout.left.cons">[mdspan.layout.left.cons]</a>, constructors</i>
    [&hellip;]
    template&lt;class OtherExtents&gt;
      constexpr explicit(<del>extents_type::rank() &gt; 0</del><ins><i>see below</i></ins>)
        mapping(const layout_stride::mapping&lt;OtherExtents&gt;&amp;);
    
    constexpr mapping&amp; operator=(const mapping&amp;) noexcept = default;
    [&hellip;]
  };
}
</pre>
</blockquote>
</li>

<li><p>Modify 23.7.3.4.5.2 <a href="https://wg21.link/mdspan.layout.left.cons">[mdspan.layout.left.cons]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class OtherExtents&gt;
  constexpr explicit(<del>extents_type::rank() &gt; 0</del><ins><i>see below</i></ins>)
    mapping(const layout_stride::mapping&lt;OtherExtents&gt;&amp; other);
</pre>
<blockquote>
<p>
-13- <i>Constraints</i>: [&hellip;]
<p/>
-14- <i>Preconditions</i>: [&hellip;]
<p/>
-15- <i>Effects</i>: [&hellip;]
<p/>
<ins>-?- <i>Remarks</i>: The expression inside <code class='backtick'>explicit</code> is equivalent to:</ins>
</p>
<blockquote><pre>
<ins>!(extents_type::rank() == 0 &amp;&amp; is_convertible_v&lt;OtherExtents, extents_type&gt;)</ins>
</pre></blockquote>
</blockquote>
</blockquote>
</li>

<li><p>Modify 23.7.3.4.6.1 <a href="https://wg21.link/mdspan.layout.right.overview">[mdspan.layout.right.overview]</a> as indicated:</p>

<blockquote>
<pre>
namespace std {
  template&lt;class Extents&gt;
  class layout_right::mapping {
    [&hellip;]
    <i>// 23.7.3.4.6.2 <a href="https://wg21.link/mdspan.layout.right.cons">[mdspan.layout.right.cons]</a>, constructors</i>
    [&hellip;]
    template&lt;class OtherExtents&gt;
      constexpr explicit(<del>extents_type::rank() &gt; 0</del><ins><i>see below</i></ins>)
        mapping(const layout_stride::mapping&lt;OtherExtents&gt;&amp;);
    
    constexpr mapping&amp; operator=(const mapping&amp;) noexcept = default;
    [&hellip;]
  };
}
</pre>
</blockquote>
</li>

<li><p>Modify 23.7.3.4.6.2 <a href="https://wg21.link/mdspan.layout.right.cons">[mdspan.layout.right.cons]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class OtherExtents&gt;
  constexpr explicit(<del>extents_type::rank() &gt; 0</del><ins><i>see below</i></ins>)
    mapping(const layout_stride::mapping&lt;OtherExtents&gt;&amp; other);
</pre>
<blockquote>
<p>
-13- <i>Constraints</i>: [&hellip;]
<p/>
-14- <i>Preconditions</i>: [&hellip;]
<p/>
-15- <i>Effects</i>: [&hellip;]
<p/>
<ins>-?- <i>Remarks</i>: The expression inside <code class='backtick'>explicit</code> is equivalent to:</ins>
</p>
<blockquote><pre>
<ins>!(extents_type::rank() == 0 &amp;&amp; is_convertible_v&lt;OtherExtents, extents_type&gt;)</ins>
</pre></blockquote>
</blockquote>
</blockquote>
</li>

<li><p>Modify 23.7.3.4.8.1 <a href="https://wg21.link/mdspan.layout.leftpad.overview">[mdspan.layout.leftpad.overview]</a> as indicated:</p>

<blockquote>
<pre>
namespace std {
  template&lt;size_t PaddingValue&gt;
  template&lt;class Extents&gt;
  class layout_left_padded&lt;PaddingValue&gt;::mapping {
    [&hellip;]
    <i>// 23.7.3.4.8.3 <a href="https://wg21.link/mdspan.layout.leftpad.cons">[mdspan.layout.leftpad.cons]</a>, constructors</i>
    [&hellip;]
    template&lt;class OtherExtents&gt;
      constexpr explicit(<del>extents_type::rank() &gt; 0</del><ins><i>see below</i></ins>)
        mapping(const layout_stride::mapping&lt;OtherExtents&gt;&amp;);
    [&hellip;]
  };
}
</pre>
</blockquote>
</li>

<li><p>Modify 23.7.3.4.8.3 <a href="https://wg21.link/mdspan.layout.leftpad.cons">[mdspan.layout.leftpad.cons]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class OtherExtents&gt;
  constexpr explicit(<del>rank_ &gt; 0</del><ins><i>see below</i></ins>)
    mapping(const layout_stride::mapping&lt;OtherExtents&gt;&amp; other);
</pre>
<blockquote>
<p>
-10- <i>Constraints</i>: [&hellip;]
<p/>
-11- <i>Preconditions</i>: [&hellip;]
<p/>
-12- <i>Effects</i>: [&hellip;]
<p/>
<ins>-?- <i>Remarks</i>: The expression inside <code class='backtick'>explicit</code> is equivalent to:</ins>
</p>
<blockquote><pre>
<ins>!(<i>rank_</i> == 0 &amp;&amp; is_convertible_v&lt;OtherExtents, extents_type&gt;)</ins>
</pre></blockquote>
</blockquote>
<pre>
template&lt;class LayoutLeftPaddedMapping&gt;
  constexpr explicit(<i>see below</i>)
    mapping(const LayoutLeftPaddedMapping&amp; other);
</pre>
<blockquote>
<p>
-13- <i>Constraints</i>: [&hellip;]
<p/>
[&hellip;]
<p/>
-16- <i>Remarks</i>: The expression inside <code class='backtick'>explicit</code> is equivalent to:
</p>
<blockquote><pre>
<ins>!is_convertible_v&lt;typename LayoutLeftPaddedMapping::extents_type, extents_type&gt; &amp;&amp;</ins>
rank_&gt; 1 &amp;&amp;
(padding_value != dynamic_extent ||
 LayoutLeftPaddedMapping::padding_value == dynamic_extent)
</pre></blockquote>
</blockquote>
</blockquote>
</li>

<li><p>Modify 23.7.3.4.9.1 <a href="https://wg21.link/mdspan.layout.rightpad.overview">[mdspan.layout.rightpad.overview]</a> as indicated:</p>

<blockquote>
<pre>
namespace std {
  template&lt;size_t PaddingValue&gt;
  template&lt;class Extents&gt;
  class layout_right_padded&lt;PaddingValue&gt;::mapping {
    [&hellip;]
    <i>// 23.7.3.4.9.3 <a href="https://wg21.link/mdspan.layout.rightpad.cons">[mdspan.layout.rightpad.cons]</a>, constructors</i>
    [&hellip;]
    template&lt;class OtherExtents&gt;
      constexpr explicit(<del>rank_ &gt; 0</del><ins><i>see below</i></ins>)
        mapping(const layout_stride::mapping&lt;OtherExtents&gt;&amp;);
    [&hellip;]
  };
}
</pre>
</blockquote>
</li>

<li><p>Modify 23.7.3.4.9.3 <a href="https://wg21.link/mdspan.layout.rightpad.cons">[mdspan.layout.rightpad.cons]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class OtherExtents&gt;
  constexpr explicit(<del>rank_ &gt; 0</del><ins><i>see below</i></ins>)
    mapping(const layout_stride::mapping&lt;OtherExtents&gt;&amp; other);
</pre>
<blockquote>
<p>
-10- <i>Constraints</i>: [&hellip;]
<p/>
-11- <i>Preconditions</i>: [&hellip;]
<p/>
-12- <i>Effects</i>: [&hellip;]
<p/>
<ins>-?- <i>Remarks</i>: The expression inside <code class='backtick'>explicit</code> is equivalent to:</ins>
</p>
<blockquote><pre>
<ins>!(<i>rank_</i> == 0 &amp;&amp; is_convertible_v&lt;OtherExtents, extents_type&gt;)</ins>
</pre></blockquote>
</blockquote>
<pre>
template&lt;class LayoutRightPaddedMapping&gt;
  constexpr explicit(<i>see below</i>)
    mapping(const LayoutRightPaddedMapping&amp; other);
</pre>
<blockquote>
<p>
-13- <i>Constraints</i>: [&hellip;]
<p/>
[&hellip;]
<p/>
-17- <i>Remarks</i>: The expression inside <code class='backtick'>explicit</code> is equivalent to:
</p>
<blockquote><pre>
<ins>!is_convertible_v&lt;typename LayoutRightPaddedMapping::extents_type, extents_type&gt; &amp;&amp;</ins>
<i>rank_</i> &gt; 1 &amp;&amp;
(padding_value != dynamic_extent ||
LayoutRightPaddedMapping::padding_value == dynamic_extent)
</pre></blockquote>
</blockquote>
</blockquote>
</li>

</ol>
</blockquote>

<p><i>[2025-09-27, Tomasz Kamiński fixes constraints in constructors from padded layouts]</i></p>


<p><i>[Kona 2025-11-05; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>



<p id="res-4272"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5008" title=" Working Draft, Programming Languages — C++">N5008</a>.
</p>

<blockquote class="note">
<p>
[<i>Drafting note</i>: As drive-by fixes the edits for <code>layout_left_padded&lt;&gt;::mapping</code> and
<code>layout_right_padded&lt;&gt;::mapping</code> also correct an editorial asymmetry between class
header synopsis declaration form and prototype specification form of the corresponding
constructors and adjust to the correct formatting of the exposition-only data member <code><i>rank_</i></code>.]
</p>
</blockquote>

<ol>
<li><p>Modify 23.7.3.4.5.1 <a href="https://wg21.link/mdspan.layout.left.overview">[mdspan.layout.left.overview]</a> as indicated:</p>

<blockquote>
<pre>
namespace std {
  template&lt;class Extents&gt;
  class layout_left::mapping {
    [&hellip;]
    <i>// 23.7.3.4.5.2 <a href="https://wg21.link/mdspan.layout.left.cons">[mdspan.layout.left.cons]</a>, constructors</i>
    [&hellip;]
    template&lt;class OtherExtents&gt;
      constexpr explicit(<del>extents_type::rank() &gt; 0</del><ins><i>see below</i></ins>)
        mapping(const layout_stride::mapping&lt;OtherExtents&gt;&amp;);
    
    constexpr mapping&amp; operator=(const mapping&amp;) noexcept = default;
    [&hellip;]
  };
}
</pre>
</blockquote>
</li>

<li><p>Modify 23.7.3.4.5.2 <a href="https://wg21.link/mdspan.layout.left.cons">[mdspan.layout.left.cons]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class OtherExtents&gt;
  constexpr explicit(<del>extents_type::rank() &gt; 0</del><ins><i>see below</i></ins>)
    mapping(const layout_stride::mapping&lt;OtherExtents&gt;&amp; other);
</pre>
<blockquote>
<p>
-13- <i>Constraints</i>: [&hellip;]
<p/>
-14- <i>Preconditions</i>: [&hellip;]
<p/>
-15- <i>Effects</i>: [&hellip;]
<p/>
<ins>-?- <i>Remarks</i>: The expression inside <code class='backtick'>explicit</code> is equivalent to:</ins>
</p>
<blockquote><pre>
<ins>!(extents_type::rank() == 0 &amp;&amp; is_convertible_v&lt;OtherExtents, extents_type&gt;)</ins>
</pre></blockquote>
</blockquote>
</blockquote>
</li>

<li><p>Modify 23.7.3.4.6.1 <a href="https://wg21.link/mdspan.layout.right.overview">[mdspan.layout.right.overview]</a> as indicated:</p>

<blockquote>
<pre>
namespace std {
  template&lt;class Extents&gt;
  class layout_right::mapping {
    [&hellip;]
    <i>// 23.7.3.4.6.2 <a href="https://wg21.link/mdspan.layout.right.cons">[mdspan.layout.right.cons]</a>, constructors</i>
    [&hellip;]
    template&lt;class OtherExtents&gt;
      constexpr explicit(<del>extents_type::rank() &gt; 0</del><ins><i>see below</i></ins>)
        mapping(const layout_stride::mapping&lt;OtherExtents&gt;&amp;);
    
    constexpr mapping&amp; operator=(const mapping&amp;) noexcept = default;
    [&hellip;]
  };
}
</pre>
</blockquote>
</li>

<li><p>Modify 23.7.3.4.6.2 <a href="https://wg21.link/mdspan.layout.right.cons">[mdspan.layout.right.cons]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class OtherExtents&gt;
  constexpr explicit(<del>extents_type::rank() &gt; 0</del><ins><i>see below</i></ins>)
    mapping(const layout_stride::mapping&lt;OtherExtents&gt;&amp; other);
</pre>
<blockquote>
<p>
-13- <i>Constraints</i>: [&hellip;]
<p/>
-14- <i>Preconditions</i>: [&hellip;]
<p/>
-15- <i>Effects</i>: [&hellip;]
<p/>
<ins>-?- <i>Remarks</i>: The expression inside <code class='backtick'>explicit</code> is equivalent to:</ins>
</p>
<blockquote><pre>
<ins>!(extents_type::rank() == 0 &amp;&amp; is_convertible_v&lt;OtherExtents, extents_type&gt;)</ins>
</pre></blockquote>
</blockquote>
</blockquote>
</li>

<li><p>Modify 23.7.3.4.8.1 <a href="https://wg21.link/mdspan.layout.leftpad.overview">[mdspan.layout.leftpad.overview]</a> as indicated:</p>

<blockquote>
<pre>
namespace std {
  template&lt;size_t PaddingValue&gt;
  template&lt;class Extents&gt;
  class layout_left_padded&lt;PaddingValue&gt;::mapping {
    [&hellip;]
    <i>// 23.7.3.4.8.3 <a href="https://wg21.link/mdspan.layout.leftpad.cons">[mdspan.layout.leftpad.cons]</a>, constructors</i>
    [&hellip;]
    template&lt;class OtherExtents&gt;
      constexpr explicit(<del>extents_type::rank() &gt; 0</del><ins><i>see below</i></ins>)
        mapping(const layout_stride::mapping&lt;OtherExtents&gt;&amp;);
    [&hellip;]
  };
}
</pre>
</blockquote>
</li>

<li><p>Modify 23.7.3.4.8.3 <a href="https://wg21.link/mdspan.layout.leftpad.cons">[mdspan.layout.leftpad.cons]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class OtherExtents&gt;
  constexpr explicit(<del>rank_ &gt; 0</del><ins><i>see below</i></ins>)
    mapping(const layout_stride::mapping&lt;OtherExtents&gt;&amp; other);
</pre>
<blockquote>
<p>
-10- <i>Constraints</i>: [&hellip;]
<p/>
-11- <i>Preconditions</i>: [&hellip;]
<p/>
-12- <i>Effects</i>: [&hellip;]
<p/>
<ins>-?- <i>Remarks</i>: The expression inside <code class='backtick'>explicit</code> is equivalent to:</ins>
</p>
<blockquote><pre>
<ins>!(<i>rank_</i> == 0 &amp;&amp; is_convertible_v&lt;OtherExtents, extents_type&gt;)</ins>
</pre></blockquote>
</blockquote>
<pre>
template&lt;class LayoutLeftPaddedMapping&gt;
  constexpr explicit(<i>see below</i>)
    mapping(const LayoutLeftPaddedMapping&amp; other);
</pre>
<blockquote>
<p>
-13- <i>Constraints</i>: [&hellip;]
<p/>
[&hellip;]
<p/>
-16- <i>Remarks</i>: The expression inside <code class='backtick'>explicit</code> is equivalent to:
</p>
<blockquote><pre>
<ins>!is_convertible_v&lt;typename LayoutLeftPaddedMapping::extents_type, extents_type&gt; ||</ins>
rank_&gt; 1 &amp;&amp;
(padding_value != dynamic_extent ||
 LayoutLeftPaddedMapping::padding_value == dynamic_extent)
</pre></blockquote>
</blockquote>
</blockquote>
</li>

<li><p>Modify 23.7.3.4.9.1 <a href="https://wg21.link/mdspan.layout.rightpad.overview">[mdspan.layout.rightpad.overview]</a> as indicated:</p>

<blockquote>
<pre>
namespace std {
  template&lt;size_t PaddingValue&gt;
  template&lt;class Extents&gt;
  class layout_right_padded&lt;PaddingValue&gt;::mapping {
    [&hellip;]
    <i>// 23.7.3.4.9.3 <a href="https://wg21.link/mdspan.layout.rightpad.cons">[mdspan.layout.rightpad.cons]</a>, constructors</i>
    [&hellip;]
    template&lt;class OtherExtents&gt;
      constexpr explicit(<del>rank_ &gt; 0</del><ins><i>see below</i></ins>)
        mapping(const layout_stride::mapping&lt;OtherExtents&gt;&amp;);
    [&hellip;]
  };
}
</pre>
</blockquote>
</li>

<li><p>Modify 23.7.3.4.9.3 <a href="https://wg21.link/mdspan.layout.rightpad.cons">[mdspan.layout.rightpad.cons]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class OtherExtents&gt;
  constexpr explicit(<del>rank_ &gt; 0</del><ins><i>see below</i></ins>)
    mapping(const layout_stride::mapping&lt;OtherExtents&gt;&amp; other);
</pre>
<blockquote>
<p>
-10- <i>Constraints</i>: [&hellip;]
<p/>
-11- <i>Preconditions</i>: [&hellip;]
<p/>
-12- <i>Effects</i>: [&hellip;]
<p/>
<ins>-?- <i>Remarks</i>: The expression inside <code class='backtick'>explicit</code> is equivalent to:</ins>
</p>
<blockquote><pre>
<ins>!(<i>rank_</i> == 0 &amp;&amp; is_convertible_v&lt;OtherExtents, extents_type&gt;)</ins>
</pre></blockquote>
</blockquote>
<pre>
template&lt;class LayoutRightPaddedMapping&gt;
  constexpr explicit(<i>see below</i>)
    mapping(const LayoutRightPaddedMapping&amp; other);
</pre>
<blockquote>
<p>
-13- <i>Constraints</i>: [&hellip;]
<p/>
[&hellip;]
<p/>
-17- <i>Remarks</i>: The expression inside <code class='backtick'>explicit</code> is equivalent to:
</p>
<blockquote><pre>
<ins>!is_convertible_v&lt;typename LayoutRightPaddedMapping::extents_type, extents_type&gt; ||</ins>
<i>rank_</i> &gt; 1 &amp;&amp;
(padding_value != dynamic_extent ||
LayoutRightPaddedMapping::padding_value == dynamic_extent)
</pre></blockquote>
</blockquote>
</blockquote>
</li>

</ol>






<hr>
<h3 id="4302"><a href="#4302">4302</a><sup><a href="https://cplusplus.github.io/LWG/issue4302">(i)</a></sup>. Problematic <code class='backtick'>vector_sum_of_squares</code> wording</h3>
<p><b>Section:</b> 29.9.13.8 <a href="https://wg21.link/linalg.algs.blas1.ssq">[linalg.algs.blas1.ssq]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Mark Hoemmen <b>Opened:</b> 2025-07-23 <b>Last modified:</b> 2025-11-05</p>
<p><b>Priority: </b>1
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<b>Addresses <a href="https://github.com/cplusplus/nbballot/issues/851">US 169-276</a></b>
<p>
The current wording for <code class='backtick'>vector_sum_of_squares</code>
29.9.13.8 <a href="https://wg21.link/linalg.algs.blas1.ssq">[linalg.algs.blas1.ssq]</a> has three problems with its specification of the
value of <code class='backtick'>result.scaling_factor</code>.
</p>
<ol>
<li><p>The function permits <code class='backtick'>InVec::value_type</code> and <code class='backtick'>Scalar</code> to be any
linear algebra value types. However, computing
<code class='backtick'>result.scaling_factor</code> that satisfies both (3.1) and (3.2) requires
more operations, such as division. Even if those operations are
defined, they might not make <code class='backtick'>result.scaling_factor</code> satisfy the
required properties. For example, integers have division, but integer
division won't help here.</p></li>
<li><p>LAPACK's xLASSQ (the algorithm to which Note 1 in
29.9.13.8 <a href="https://wg21.link/linalg.algs.blas1.ssq">[linalg.algs.blas1.ssq]</a> refers) changed its algorithm recently 
(see <a href="https://github.com/Reference-LAPACK/lapack/pull/494">Reference-LAPACK/lapack/pull/#494</a>) 
so that the scaling factor is no longer necessarily the maximum of the input
scaling factor and the absolute value of all the input elements. It's
a better algorithm and we would like to be able to use it.</p></li>
<li><p>
Both members of <code>sum_of_squares_result&lt;Scalar&gt;</code> have the same type,
<code class='backtick'>Scalar</code>. If the input <code class='backtick'>mdspan</code>'s <code class='backtick'>value_type</code> represents a quantity
with units, this would not be correct. For example, if <code class='backtick'>value_type</code>
has units of distance (say <code>[m]</code>), the sum of squares should have units
of area (<code>[m<sup>2</sup>]</code>), while the scaling factor should have units of
distance (<code>[m]</code>).
</p></li>
</ol>
<p>
Problem (1) means that the current wording is broken. I suggest two
different ways to fix this.
</p>
<ol>
<li><p>Remove <code class='backtick'>vector_sum_of_squares</code> entirely (both overloads from
29.9.2 <a href="https://wg21.link/linalg.syn">[linalg.syn]</a>, and the entire 
29.9.13.8 <a href="https://wg21.link/linalg.algs.blas1.ssq">[linalg.algs.blas1.ssq]</a>). That way, we
won't be baking an old, less good algorithm into the Standard. Remove
Note 3 from 29.9.13.9 <a href="https://wg21.link/linalg.algs.blas1.nrm2">[linalg.algs.blas1.nrm2]</a>, which is the only 
other reference to <code class='backtick'>vector_sum_of_squares</code> in the Standard.</p></li>
<li><p>Fix 29.9.13.8 <a href="https://wg21.link/linalg.algs.blas1.ssq">[linalg.algs.blas1.ssq]</a> by adding to the 
<i>Mandates</i> element (para 2) that <code class='backtick'>InVec::value_type</code> and <code class='backtick'>Scalar</code> 
are both floating-point types (so that we could fix this later if 
we want), and remove 29.9.13.8 <a href="https://wg21.link/linalg.algs.blas1.ssq">[linalg.algs.blas1.ssq]</a> 3.1. 
Optionally add <i>Recommended Practice</i>, though Note 1 already 
suggests the intent.</p></li>
</ol>
<p>
I prefer just removing <code class='backtick'>vector_sum_of_squares</code>. Implementers who care
about QoI of <code class='backtick'>vector_two_norm</code> should already know what to do. If
somebody cares sufficiently, they can propose it back for C++29 and
think about how to make it work for generic number types.
</p>

<p><i>[2025-10-17; Reflector poll. Status changed: New &rarr; LEWG.]</i></p>

<p>
Set priority to 1 after reflector poll. Send to LEWG.
</p>
<p>
This is the subject of NB comment 169-276.
LWG took a poll in the 2025-10-10 telecon and recommends that LEWG confirms
this resolution.
</p>

<p><i>[Kona 2025-11-05; approved by LEWG to resolve US 169-276.]</i></p>

<p><i>[Kona 2025-11-05; approved by LWG. Status changed: LEWG &rarr; Immediate.]</i></p>



<p id="res-4302"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<blockquote class="note">
<p>
[<i>Drafting note:</i> The wording below implements option 1 of the issue discussion]
</p>
</blockquote>

<ol>

<li><p>Modify 29.9.2 <a href="https://wg21.link/linalg.syn">[linalg.syn]</a>, header <code>&lt;linalg&gt;</code> synopsis, as indicated:</p>

<blockquote>
<pre>
namespace std::linalg {
  [&hellip;]
  <del>// <i>29.9.13.8 <a href="https://wg21.link/linalg.algs.blas1.ssq">[linalg.algs.blas1.ssq]</a>, scaled sum of squares of a vector's elements</i>
  template&lt;class Scalar&gt;
    struct sum_of_squares_result {
      Scalar scaling_factor;
    };
  template&lt;<i>in-vector</i> InVec, class Scalar&gt;
    sum_of_squares_result&lt;Scalar&gt;
      vector_sum_of_squares(InVec v, sum_of_squares_result&lt;Scalar&gt; init);
  template&lt;class ExecutionPolicy, <i>in-vector</i> InVec, class Scalar&gt;
    sum_of_squares_result&lt;Scalar&gt;
      vector_sum_of_squares(ExecutionPolicy&amp;&amp; exec,
                            InVec v, sum_of_squares_result&lt;Scalar&gt; init);</del> 
  [&hellip;]
}
</pre>
</blockquote>
</li>

<li><p>Delete the entire 29.9.13.8 <a href="https://wg21.link/linalg.algs.blas1.ssq">[linalg.algs.blas1.ssq]</a> as indicated:</p>

<blockquote>
<p>
<del><b>29.9.13.8 Scaled sum of squares of a vector's elements [linalg.algs.blas1.ssq]</b></del>
</p>
<pre>
<del>template&lt;<i>in-vector</i> InVec, class Scalar&gt;
  sum_of_squares_result&lt;Scalar&gt; vector_sum_of_squares(InVec v, sum_of_squares_result&lt;Scalar&gt; init);
template&lt;class ExecutionPolicy, <i>in-vector</i> InVec, class Scalar&gt;
  sum_of_squares_result&lt;Scalar&gt; vector_sum_of_squares(ExecutionPolicy&amp;&amp; exec,
                                                            InVec v, sum_of_squares_result&lt;Scalar&gt; init);</del>
</pre>
<blockquote>
<p>
<del>-1- [<i>Note 1</i>: These functions correspond to the LAPACK function xLASSQ[20]. &mdash; <i>end note</i>]</del>
<p/>
<del>-2- <i>Mandates</i>: <code>decltype(<i>abs-if-needed</i>(declval&lt;typename InVec::value_type&gt;()))</code> is convertible
to <code class='backtick'>Scalar</code>.</del>
<p/>
<del>-3- <i>Effects</i>: Returns a value <code class='backtick'>result</code> such that</del>
</p>
<ol style="list-style-type: none">
<li><p><del>(3.1) &mdash; <code class='backtick'>result.scaling_factor</code> is the maximum of <code class='backtick'>init.scaling_factor</code> and 
<code><i>abs-if-needed</i>(x[i])</code> for all <code class='backtick'>i</code> in the domain of <code class='backtick'>v</code>; and</del></p></li>
<li><p><del>(3.2) &mdash; let <code class='backtick'>s2init</code> be</del></p>
<blockquote><pre>
<del>init.scaling_factor * init.scaling_factor * init.scaled_sum_of_squares</del>
</pre></blockquote>
<p>
<del>then <code class='backtick'>result.scaling_factor * result.scaling_factor * result.scaled_sum_of_squares</code>
equals the sum of <code class='backtick'>s2init</code> and the squares of <code><i>abs-if-needed</i>(x[i])</code> for all <code class='backtick'>i</code> 
in the domain of <code class='backtick'>v</code>.</del></p></li>
</ol>
<p>
<del>-4- <i>Remarks</i>: If <code class='backtick'>InVec::value_type</code>, and <code class='backtick'>Scalar</code> are all floating-point types or specializations of 
<code class='backtick'>complex</code>, and if <code class='backtick'>Scalar</code> has higher precision than <code class='backtick'>InVec::value_type</code>, then intermediate terms in the sum 
use <code class='backtick'>Scalar</code>'s precision or greater.</del>
</p>
</blockquote>
</blockquote>
</li>

<li><p>Modify 29.9.13.9 <a href="https://wg21.link/linalg.algs.blas1.nrm2">[linalg.algs.blas1.nrm2]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;<i>in-vector</i> InVec, class Scalar&gt;
  Scalar vector_two_norm(InVec v, Scalar init);
template&lt;class ExecutionPolicy, <i>in-vector</i> InVec, class Scalar&gt;
  Scalar vector_two_norm(ExecutionPolicy&amp;&amp; exec, InVec v, Scalar init);
</pre>
<blockquote>
<p>
-1- [<i>Note 1</i>: [&hellip;] ]
<p/>
-2- <i>Mandates</i>: [&hellip;]
<p/>
-3- <i>Returns</i>: [&hellip;]
<p/>
[<i>Note 2</i>: [&hellip;] ]
<p/>
-4- <i>Remarks</i>: [&hellip;]
<p/>
<del>[<i>Note 3</i>: An implementation of this function for floating-point types <code class='backtick'>T</code> 
can use the <code class='backtick'>scaled_sum_of_squares</code> result from 
<code class='backtick'>vector_sum_of_squares(x, {.scaling_factor=1.0, .scaled_sum_of_squares=init})</code>. 
&mdash; <i>end note</i>]</del>
</p>
</blockquote>
</blockquote>
</li>

</ol>





<hr>
<h3 id="4304"><a href="#4304">4304</a><sup><a href="https://cplusplus.github.io/LWG/issue4304">(i)</a></sup>. <code>std::optional&lt;<i>NonReturnable</i>&amp;&gt;</code> is ill-formed due to <code class='backtick'>value_or</code></h3>
<p><b>Section:</b> 22.5.4.6 <a href="https://wg21.link/optional.ref.observe">[optional.ref.observe]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Jiang An <b>Opened:</b> 2025-07-25 <b>Last modified:</b> 2025-11-04</p>
<p><b>Priority: </b>1
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
Currently, if <code class='backtick'>T</code> is an array type or a function type, instantiation of <code>std::optional&lt;T&amp;&gt;</code> 
is still ill-formed, because the return type of its <code class='backtick'>value_or</code> member function is specified as 
<code>remove_cv_t&lt;T&gt;</code>, which is invalid as a return type.
<p/>
However, we don't exclude such <code>T&amp;</code> from valid contained types. Given only <code class='backtick'>value_or</code> is 
problematic here, perhaps we can avoid providing it if <code class='backtick'>T</code> is not returnable.
</p>

<p><i>[2025-10-16; Reflector poll]</i></p>

<p>
Set priority to 1 after reflector poll.
</p>
<p>
Why not just add <i>Constraints</i>: and use <code>decay_t&lt;T&gt;</code>
for the return type, instead of "not always present" which is currently
only used for member types, not member functions.
</p>

<p><strong>Previous resolution [SUPERSEDED]:</strong></p>
<blockquote class="note">

<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<ol>

<li><p>Modify 22.5.4.1 <a href="https://wg21.link/optional.optional.ref.general">[optional.optional.ref.general]</a>, header <code>&lt;iterator&gt;</code> synopsis, as indicated:</p>

<blockquote>
<pre>
namespace std {
  template&lt;class T&gt;
  class optional&lt;T&amp;&gt; {
    [&hellip;]
    constexpr T&amp; value() const; // freestanding-deleted
    template&lt;class U = remove_cv_t&lt;T&gt;&gt;
      constexpr remove_cv_t&lt;T&gt; value_or(U&amp;&amp; u) const; <ins>// <i>not always present</i></ins>
    [&hellip;]
  };
}
</pre>
</blockquote>
</li>

<li><p>Modify 22.5.4.6 <a href="https://wg21.link/optional.ref.observe">[optional.ref.observe]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class U = remove_cv_t&lt;T&gt;&gt; constexpr remove_cv_t&lt;T&gt; value_or(U&amp;&amp; u) const;
</pre>
<blockquote>
<p>
-8- Let <code class='backtick'>X</code> be <code>remove_cv_t&lt;T&gt;</code>.
<p/>
-9- <i>Mandates</i>: <code>is_constructible_v&lt;X, T&amp;&gt; &amp;&amp; is_convertible_v&lt;U, X&gt;</code> is <code class='backtick'>true</code>.
<p/>
-10- <i>Effects</i>: Equivalent to:
</p>
<blockquote><pre>
return has_value() ? *<i>val</i> : static_cast&lt;X&gt;(std::forward&lt;U&gt;(u));
</pre></blockquote>
<p>
<ins>-?- <i>Remarks</i>: This function template is present if and only if <code class='backtick'>T</code> is a non-array object type.</ins>
</p>
</blockquote>
</blockquote>
</li>
</ol>
</blockquote>

<p><i>[2025-10-16; Jonathan provides new wording]</i></p>



<p><i>[Kona 2025-11-03; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>



<p id="res-4304"><b>Proposed resolution:</b></p>

<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<ol>

<li><p>Modify 22.5.4.6 <a href="https://wg21.link/optional.ref.observe">[optional.ref.observe]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class U = remove_cv_t&lt;T&gt;&gt; constexpr remove_cv_t&lt;T&gt; value_or(U&amp;&amp; u) const;
</pre>
<blockquote>
<p>
<ins>
-?- <i>Constraints</i>:
<code class='backtick'>T</code> is a non-array object type.
</ins>
</p>
<p>
-8- Let <code class='backtick'>X</code> be <code>remove_cv_t&lt;T&gt;</code>.
<p/>
-9- <i>Mandates</i>: <code>is_constructible_v&lt;X, T&amp;&gt; &amp;&amp; is_convertible_v&lt;U, X&gt;</code> is <code class='backtick'>true</code>.
<p/>
-10- <i>Effects</i>: Equivalent to:
</p>
<blockquote><pre>
return has_value() ? *<i>val</i> : static_cast&lt;X&gt;(std::forward&lt;U&gt;(u));
</pre></blockquote>
<p>
<ins>
-?- <i>Remarks</i>:
The return type is unspecified if <code class='backtick'>T</code> is an array type or a non-object type.
[<i>Note ?</i>: This is to avoid the declaration being ill-formed.
<i>&mdash; end note</i>]
</ins>
</p>
</blockquote>
</blockquote>
</li>
</ol>






<hr>
<h3 id="4316"><a href="#4316">4316</a><sup><a href="https://cplusplus.github.io/LWG/issue4316">(i)</a></sup>. <code>{can_}substitute</code> specification is ill-formed</h3>
<p><b>Section:</b> 21.4.13 <a href="https://wg21.link/meta.reflection.substitute">[meta.reflection.substitute]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Matthias Wippich <b>Opened:</b> 2025-08-15 <b>Last modified:</b> 2025-11-05</p>
<p><b>Priority: </b>1
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<b>Addresses <a href="https://github.com/cplusplus/nbballot/issues/993">US 114-175</a></b>
<p>
<code class='backtick'>can_substitute</code> and <code class='backtick'>substitute</code> are currently specified in terms of splices in a template argument list:
<p/>
21.4.13 <a href="https://wg21.link/meta.reflection.substitute">[meta.reflection.substitute]</a> p3:
</p>
<blockquote><p>
<i>Returns</i>: <code class='backtick'>true</code> if <code>Z&lt;[:Args:]...&gt;</code> is a valid <i>template-id</i> (13.3 <a href="https://wg21.link/temp.names">[temp.names]</a>) 
that does not name a function whose type contains an undeduced placeholder type. Otherwise, <code class='backtick'>false</code>.
</p></blockquote>
<p>
21.4.13 <a href="https://wg21.link/meta.reflection.substitute">[meta.reflection.substitute]</a> p7:
</p>
<blockquote><p>
<i>Returns</i>: <code>^^Z&lt;[:Args:]...&gt;</code>.
</p></blockquote>
<p>
This wording was introduced in <a href="https://wg21.link/P2996R11" title=" Reflection for C++26">P2996R11</a>. However, merging in changes from 
<a href="https://wg21.link/P3687" title=" Final Adjustments to C++26 Reflection">P3687</a> "Final Adjustments to C++26 Reflection" in <a href="https://wg21.link/P2996R13" title=" Reflection for C++26">P2996R13</a> changed 
the rules for splices in this context. This makes <code class='backtick'>can_substitute</code> and <code class='backtick'>substitute</code> as specified 
currently ill-formed. We cannot use the given syntax to splice an arbitrary choice of values, 
types and templates anymore.
<p/>
While the intent seems clear, this should be rephrased to be more technically correct.
</p>

<p><i>[2025-10-22; Reflector poll.]</i></p>

<p>
Set priority to 1 after reflector poll.
</p>

<p><i>[2025-10-27; Tomasz provides wording.]</i></p>

<p><strong>Previous resolution [SUPERSEDED]:</strong></p>
<blockquote class="note">


<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<ol>

<li><p>Modify 21.4.13 <a href="https://wg21.link/meta.reflection.substitute">[meta.reflection.substitute]</a> as indicated:</p>

<blockquote>
<blockquote>
<p>
<ins>-1- For value <code class='backtick'>x</code> of type <code class='backtick'>info</code>, and prvalue constant expression <code class='backtick'>X</code> that computes the
reflection held by <code class='backtick'>x</code>, let <code><i>TARG-SPLICE</i>(x)</code> be:</ins>
<ul>
<li><ins>-1.1- <code>template [: X :]</code> if <code class='backtick'>is_template(x)</code> is <code class='backtick'>true</code>, otherwise</ins></li>
<li><ins>-1.2- <code>typename [: X :]</code> if <code class='backtick'>is_type(x)</code> is <code class='backtick'>true</code>, otherwise</ins></li>
<li><ins>-1.3- <code>([: X :])</code></ins></li>
</ul>
</p>
</blockquote>

<pre>
template&lt;reflection_range R = initializer_list&lt;info&gt;&gt;
  consteval bool can_substitute(info templ, R&amp;&amp; arguments);
</pre>
<blockquote>
<p>
-1- <del>Let <code class='backtick'>Z</code> be the template represented by <code class='backtick'>templ</code> and let <code class='backtick'>Args...</code> be a
sequence of prvalue constant expressions that compute the reflections held by
the elements of <code class='backtick'>arguments</code>, in order.</del>
<ins>Let <i>n</i> be the number of elements in <code class='backtick'>arguments</code>, and <i>e<sub>i</sub></i>
be the i<sup>th</sup> element of <code class='backtick'>arguments</code>.</ins>
</p>
<p>
-2- <i>Returns</i>: <code class='backtick'>true</code> if <code>Z&lt;<del>[:Args:]...</del><ins><i>TARG-SPLICE</i>(<i>e<sub>0</sub></i>),
..., <i>TARG-SPLICE</i>(<i>e<sub>n-1</sub></i>)</ins>&gt;</code> is a valid <i>template-id</i>
(13.3 <a href="https://wg21.link/temp.names">[temp.names]</a>) that does not name a function whose type contains an undeduced placeholder type.
Otherwise, <code class='backtick'>false</code>.
</p>
<p>
-3- <i>Throws</i>: <code class='backtick'>meta::exception</code> unless <code class='backtick'>templ</code> represents a template, and every reflection
in <code class='backtick'>arguments</code> represents a construct usable as a template argument (13.4 <a href="https://wg21.link/temp.arg">[temp.arg]</a>).
</p>
<p>
-4- [<i>Note</i>: If forming <code>Z&lt;<del>[:Args:]...</del><ins><i>TARG-SPLICE</i>(<i>e<sub>0</sub></i>),
..., <i>TARG-SPLICE</i>(<i>e<sub>n-1</sub></i>)</ins>&gt;</code> leads to a failure outside of the immediate
context, the program is ill-formed. &mdash; <i>end note</i>]
</p>
</blockquote>

<pre>
template&lt;reflection_range R = initializer_list&lt;info&gt;&gt;
  consteval info substitute(info templ, R&amp;&amp; arguments);
</pre>
<blockquote>
<p>
-5- <del>Let <code class='backtick'>Z</code> be the template represented by <code class='backtick'>templ</code> and let <code class='backtick'>Args...</code> be a
sequence of prvalue constant expressions that compute the reflections held by
the elements of <code class='backtick'>arguments</code>, in order.</del>
<ins>Let <i>n</i> be the number of elements in <code class='backtick'>arguments</code>, and <i>e<sub>i</sub></i>
be the i<sup>th</sup> element of <code class='backtick'>arguments</code>.</ins>
</p>
<p>
-6- <i>Returns</i>: <code>^^Z&lt;<del>[:Args:]...</del><ins><i>TARG-SPLICE</i>(<i>e<sub>0</sub></i>)
..., <i>TARG-SPLICE</i>(<i>e<sub>n-1</sub></i>)</ins>&gt;</code>.</p>
<p>
-7- <i>Throws</i>: <code class='backtick'>meta::exception</code> unless <code class='backtick'>can_substitute(templ, arguments)</code> is <code class='backtick'>true</code>.
</p>
<p>
-8- [<i>Note</i>: If forming <code>Z&lt;<del>[:Args:]...</del><ins><i>TARG-SPLICE</i>(<i>e<sub>0</sub></i>),
..., <i>TARG-SPLICE</i>(<i>e<sub>n-1</sub></i>)</ins>&gt;</code> leads to a failure outside of the immediate
context, the program is ill-formed. &mdash; <i>end note</i>]
</p>
</blockquote>

</blockquote>
</li>
</ol>

</blockquote>

<p><i>[2025-10-27; Reflector comments.]</i></p>

<p>
We lost definition of <code class='backtick'>Z</code>. Use <code><i>TARG-SPLICE</i>([:Args:])...</code>.
</p>

<p><i>[2025-11-03; Tomasz provides wording.]</i></p>


<p><i>[Kona 2025-11-05; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>



<p id="res-4316"><b>Proposed resolution:</b></p>

<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<ol>

<li><p>Modify 21.4.13 <a href="https://wg21.link/meta.reflection.substitute">[meta.reflection.substitute]</a> as indicated:</p>

<blockquote>
<blockquote>
<p>
<ins>-1- Let <code><i>TARG-SPLICE</i>(x)</code> be:</ins>
<ul>
<li><ins>-1.1- <code>template [: x :]</code> if <code class='backtick'>is_template(x)</code> is <code class='backtick'>true</code>, otherwise</ins></li>
<li><ins>-1.2- <code>typename [: x :]</code> if <code class='backtick'>is_type(x)</code> is <code class='backtick'>true</code>, otherwise</ins></li>
<li><ins>-1.3- <code>([: x :])</code></ins></li>
</ul>
</p>
</blockquote>

<pre>
template&lt;reflection_range R = initializer_list&lt;info&gt;&gt;
  consteval bool can_substitute(info templ, R&amp;&amp; arguments);
</pre>
<blockquote>
<p>
-1- Let <code class='backtick'>Z</code> be the template represented by <code class='backtick'>templ</code> and let <code class='backtick'>Args...</code> be a
sequence of prvalue constant expressions that compute the reflections held by
the elements of <code class='backtick'>arguments</code>, in order.
</p>
<p>
-2- <i>Returns</i>: <code class='backtick'>true</code> if <code>Z&lt;<ins><i>TARG-SPLICE</i>(</ins><del>[:</del>Args<del>:]</del><ins>)</ins>...&gt;</code> is a valid <i>template-id</i>
(13.3 <a href="https://wg21.link/temp.names">[temp.names]</a>) that does not name a function whose type contains an undeduced placeholder type.
Otherwise, <code class='backtick'>false</code>.
</p>
<p>
-3- <i>Throws</i>: <code class='backtick'>meta::exception</code> unless <code class='backtick'>templ</code> represents a template, and every reflection
in <code class='backtick'>arguments</code> represents a construct usable as a template argument (13.4 <a href="https://wg21.link/temp.arg">[temp.arg]</a>).
</p>
<p>
-4- [<i>Note</i>: If forming <code>Z&lt;<ins><i>TARG-SPLICE</i>(</ins><del>[:</del>Args<del>:]</del><ins>)</ins>...&gt;</code>
leads to a failure outside of the immediate context, the program is ill-formed. &mdash; <i>end note</i>]
</p>
</blockquote>

<pre>
template&lt;reflection_range R = initializer_list&lt;info&gt;&gt;
  consteval info substitute(info templ, R&amp;&amp; arguments);
</pre>
<blockquote>
<p>
-5- Let <code class='backtick'>Z</code> be the template represented by <code class='backtick'>templ</code> and let <code class='backtick'>Args...</code> be a
sequence of prvalue constant expressions that compute the reflections held by
the elements of <code class='backtick'>arguments</code>, in order.
</p>
<p>
-6- <i>Returns</i>: <code>Z&lt;<ins><i>TARG-SPLICE</i>(</ins><del>[:</del>Args<del>:]</del><ins>)</ins>...&gt;</code>.</p>
<p>
-7- <i>Throws</i>: <code class='backtick'>meta::exception</code> unless <code class='backtick'>can_substitute(templ, arguments)</code> is <code class='backtick'>true</code>.
</p>
<p>
-8- [<i>Note</i>: If forming <code>Z&lt;<ins><i>TARG-SPLICE</i>(</ins><del>[:</del>Args<del>:]</del><ins>)</ins>...&gt;</code>
leads to a failure outside of the immediate context, the program is ill-formed. &mdash; <i>end note</i>]
</p>
</blockquote>

</blockquote>
</li>
</ol>






<hr>
<h3 id="4358"><a href="#4358">4358</a><sup><a href="https://cplusplus.github.io/LWG/issue4358">(i)</a></sup>. &sect;[exec.as.awaitable] is using "Preconditions:" when it should probably be described in the constraint</h3>
<p><b>Section:</b> 33.13.1 <a href="https://wg21.link/exec.as.awaitable">[exec.as.awaitable]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Lewis Baker <b>Opened:</b> 2025-08-27 <b>Last modified:</b> 2025-11-06</p>
<p><b>Priority: </b>2
</p>
<p><b>View other</b> <a href="lwg-index-open.html#exec.as.awaitable">active issues</a> in [exec.as.awaitable].</p>
<p><b>View all other</b> <a href="lwg-index.html#exec.as.awaitable">issues</a> in [exec.as.awaitable].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
In 33.13.1 <a href="https://wg21.link/exec.as.awaitable">[exec.as.awaitable]</a> bullet 7.2 it states:
</p>
<blockquote>
<ol style="list-style-type: none">
<li><p>(7.2) &mdash; Otherwise, <code>(void(p), expr)</code> if <code><i>is-awaitable</i>&lt;Expr, U&gt;</code> is <code class='backtick'>true</code>, 
where <code class='backtick'>U</code> is an unspecified class type that is not <code class='backtick'>Promise</code> and that lacks a member named <code class='backtick'>await_transform</code>.
<p/>
<i>Preconditions</i>: <code><i>is-awaitable</i>&lt;Expr, Promise&gt;</code> is <code class='backtick'>true</code> and the expression 
<code class='backtick'>co_await expr</code> in a coroutine with promise type <code class='backtick'>U</code> is expression-equivalent to the same expression 
in a coroutine with promise type <code class='backtick'>Promise</code>.</p></li>
</ol>
</blockquote>
<p>
The "<i>Preconditions</i>:" sentence there refers to static properties of the program and so seems like a 
better fit for a <i>Mandates</i>: element or for folding into the constraint.
<p/>
Also, in the part of the precondition above which says "&hellip; and the expression <code class='backtick'>co_await expr</code> in a 
coroutine with promise type <code class='backtick'>U</code> is expression-equivalent to the same expression in a coroutine with promise 
type <code class='backtick'>Promise</code>" it is unclear how this can be satisfied, as the types involved are different and therefore 
the expression cannot be expression-equivalent.
<p/>
I think perhaps what is intended here is something along the lines of the first expression having 
"effects equivalent to" the second expression, instead of "expression-equivalent to"?
<p/>
However, I think there is a more direct way to express the intent here, by instead just requiring that 
<code>decltype(<i>GET-AWAITER</i>(expr))</code> satisfies <code><i>is-awaiter</i>&lt;Promise&gt;</code>.
This checks whether <code class='backtick'>expr</code> would be a valid type to return from a <code class='backtick'>Promise::await_transform()</code> function.
</p>


<p><i>[2025-10-23; Reflector poll.]</i></p>

<p>
Set priority to 2 after reflector poll.
</p>
<p>
"Intent of the original wording seems to be that GET-AWAITER(expr) should
be the same as GET-AWAITER(expr, p) and this rewording loses that.
Don't understand the rationale for the new wording either."
(More details in the reflector thread in Sept. 2025)
</p>

<p><i>[Kona 2025-11-06; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>



<p id="res-4358"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<ol>

<li><p>Modify 33.13.1 <a href="https://wg21.link/exec.as.awaitable">[exec.as.awaitable]</a> as indicated:</p>

<blockquote>
<p>
-7- <code class='backtick'>as_awaitable</code> is a customization point object. For subexpressions <code class='backtick'>expr</code> and <code class='backtick'>p</code> where <code class='backtick'>p</code> 
is an lvalue, <code class='backtick'>Expr</code> names the type <code class='backtick'>decltype((expr))</code> and <code class='backtick'>Promise</code> names the type 
<code>decay_t&lt;decltype((p))&gt;</code>, <code class='backtick'>as_awaitable(expr, p)</code> is expression-equivalent to, 
except that the evaluations of <code class='backtick'>expr</code> and <code class='backtick'>p</code> are indeterminately sequenced:
</p>
<ol style="list-style-type: none">
<li><p>(7.1) &mdash; <code class='backtick'>expr.as_awaitable(p)</code> if that expression is well-formed.
<p/>
<i>Mandates</i>: <code><i>is-awaitable</i>&lt;A, Promise&gt;</code> is <code class='backtick'>true</code>, where <code class='backtick'>A</code> is the type of 
the expression above.</p></li>
<li><p>(7.2) &mdash; Otherwise, <code>(void(p), expr)</code> if <ins><code>decltype(<i>GET-AWAITER</i>(expr))</code> 
satisfies <code><i>is-awaiter</i>&lt;Promise&gt;</code>.</ins><del><code><i>is-awaitable</i>&lt;Expr, U&gt;</code> is <code class='backtick'>true</code>, 
where <code class='backtick'>U</code> is an unspecified class type that is not <code class='backtick'>Promise</code> and that lacks a member named <code class='backtick'>await_transform</code>.</del>
<p/>
<del><i>Preconditions</i>: <code><i>is-awaitable</i>&lt;Expr, Promise&gt;</code> is <code class='backtick'>true</code> and the expression 
<code class='backtick'>co_await expr</code> in a coroutine with promise type <code class='backtick'>U</code> is expression-equivalent to the same expression 
in a coroutine with promise type <code class='backtick'>Promise</code>.</del></p></li>
<li><p>(7.3) &mdash; [&hellip;]</p></li>
<li><p>(7.4) &mdash; [&hellip;]</p></li>
<li><p>(7.5) &mdash; [&hellip;]</p></li>
</ol>
</blockquote>

</li>

</ol>





<hr>
<h3 id="4360"><a href="#4360">4360</a><sup><a href="https://cplusplus.github.io/LWG/issue4360">(i)</a></sup>. <code><i>awaitable-sender</i></code> concept should qualify use of <code><i>awaitable-receiver</i></code> type</h3>
<p><b>Section:</b> 33.13.1 <a href="https://wg21.link/exec.as.awaitable">[exec.as.awaitable]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Lewis Baker <b>Opened:</b> 2025-08-27 <b>Last modified:</b> 2025-11-06</p>
<p><b>Priority: </b>2
</p>
<p><b>View other</b> <a href="lwg-index-open.html#exec.as.awaitable">active issues</a> in [exec.as.awaitable].</p>
<p><b>View all other</b> <a href="lwg-index.html#exec.as.awaitable">issues</a> in [exec.as.awaitable].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
In 33.13.1 <a href="https://wg21.link/exec.as.awaitable">[exec.as.awaitable]</a> p1 there is an exposition-only helper concept 
<code><i>awaitable-sender</i></code> defined as follows:
</p>
<blockquote><pre>
namespace std::execution {
  template&lt;class Sndr, class Promise&gt;
    concept <i>awaitable-sender</i> =
      <i>single-sender</i>&lt;Sndr, env_of_t&lt;Promise&gt;&gt; &amp;&amp;
      sender_to&lt;Sndr, <i>awaitable-receiver</i>&gt; &amp;&amp; // <i>see below</i>
      requires (Promise&amp; p) {
        { p.unhandled_stopped() } -> convertible_to&lt;coroutine_handle&lt;&gt;&gt;;
      };
}
</pre></blockquote>
<p>
The mention of the type <code><i>awaitable-receiver</i></code> here does not refer to any exposition-only type 
defined at namespace-scope. It seems to, instead, be referring to the nested member-type 
<code><i>sender-awaitable</i>&lt;Sndr, Promise&gt;::<i>awaitable-receiver</i></code> and so should be 
qualified as such.
</p>

<p><i>[2025-10-23; Reflector poll.]</i></p>

<p>
Set priority to 2 after reflector poll.
</p>
<p>
"We should move the declaration of <i><code class='backtick'>sender-awaitable</code></i> before the concept."
</p>

<p><i>[Kona 2025-11-06; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>



<p id="res-4360"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<ol>

<li><p>Modify 33.13.1 <a href="https://wg21.link/exec.as.awaitable">[exec.as.awaitable]</a> as indicated:</p>

<blockquote>
<p>
-1- <code class='backtick'>as_awaitable</code> transforms an object into one that is awaitable within a particular coroutine. 
Subclause 33.13 <a href="https://wg21.link/exec.coro.util">[exec.coro.util]</a> makes use of the following exposition-only entities:
</p>
<blockquote><pre>
namespace std::execution {
  template&lt;class Sndr, class Promise&gt;
    concept <i>awaitable-sender</i> =
      <i>single-sender</i>&lt;Sndr, env_of_t&lt;Promise&gt;&gt; &amp;&amp;
      sender_to&lt;Sndr, <ins>typename <i>sender-awaitable</i>&lt;Sndr, Promise&gt;::</ins><i>awaitable-receiver</i>&gt; &amp;&amp; // <i>see below</i>
      requires (Promise&amp; p) {
        { p.unhandled_stopped() } -> convertible_to&lt;coroutine_handle&lt;&gt;&gt;;
      };
  [&hellip;]
}
</pre></blockquote>
</blockquote>

</li>

</ol>





<hr>
<h3 id="4369"><a href="#4369">4369</a><sup><a href="https://cplusplus.github.io/LWG/issue4369">(i)</a></sup>. <code><i>check-types</i></code> function for <code class='backtick'>upon_error</code> and <code class='backtick'>upon_stopped</code> is wrong</h3>
<p><b>Section:</b> 33.9.12.9 <a href="https://wg21.link/exec.then">[exec.then]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Eric Niebler <b>Opened:</b> 2025-08-31 <b>Last modified:</b> 2025-11-06</p>
<p><b>Priority: </b>2
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<b>Addresses <a href="https://github.com/cplusplus/nbballot/issues/925">US 219-350</a></b>
<p>
The following has been reported by Trevor Gray:
</p>
<p>
In 33.9.12.9 <a href="https://wg21.link/exec.then">[exec.then]</a> p5, the <code><i>impls-for</i>&lt;<i>decayed-typeof</i>&lt;<i>then-cpo</i>&gt;&gt;::<i>check-types</i></code> 
unction is specified as follows:
</p>
<blockquote style="border-left: 3px solid #ccc;padding-left: 15px;">
<pre>
template&lt;class Sndr, class... Env&gt;
  static consteval void <i>check-types</i>();
</pre>
<blockquote>
<p>
<i>Effects</i>: Equivalent to:
</p>
<blockquote><pre>
auto cs = get_completion_signatures&lt;<i>child-type</i>&lt;Sndr&gt;, <i>FWD-ENV-T</i>(Env)...&gt;();
auto fn = []&lt;class... Ts&gt;(set_value_t(*)(Ts...)) {
  if constexpr (!invocable&lt;remove_cvref_t&lt;<i>data-type</i>&lt;Sndr&gt;&gt;, Ts...&gt;)
    throw <i>unspecified-exception</i>();
};
cs.<i>for-each</i>(<i>overload-set</i>{fn, [](auto){}});
</pre></blockquote>
<p>
where <code><i>unspecified-exception</i></code> is a type derived from <code class='backtick'>exception</code>.
</p>
</blockquote>
</blockquote>
<p>
The line <code>auto fn = []&lt;class... Ts&gt;(set_value_t(*)(Ts...)) {</code> 
is correct when <code><i>then-cpo</i></code> is <code class='backtick'>then</code> but not when it is <code class='backtick'>upon_error</code> or <code class='backtick'>upon_stopped</code>.
<p/>
For <code class='backtick'>upon_error</code> it should be:
</p>
<blockquote><pre>
auto fn = []&lt;class... Ts&gt;(set_error_t(*)(Ts...)) {
</pre></blockquote>
<p>
and for <code class='backtick'>upon_stopped</code> it should be:
</p>
<blockquote><pre>
auto fn = []&lt;class... Ts&gt;(set_stopped_t(*)(Ts...)) {
</pre></blockquote>
<p>
We can achieve that by replacing <code class='backtick'>set_value_t</code> in the problematic line with <code><i>decayed-typeof</i>&lt;<i>set-cpo</i>&gt;</code>.
</p>

<p><i>[2025-10-23; Reflector poll.]</i></p>

<p>
Set priority to 2 after reflector poll.
</p>

<p><i>[Kona 2025-11-06; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>



<p id="res-4369"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<ol>

<li><p>Modify 33.9.12.9 <a href="https://wg21.link/exec.then">[exec.then]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class Sndr, class... Env&gt;
  static consteval void <i>check-types</i>();
</pre>
<blockquote>
<p>
-5- <i>Effects:</i> Equivalent to:
</p>
<blockquote><pre>
auto cs = get_completion_signatures&lt;<i>child-type</i>&lt;Sndr&gt;, <i>FWD-ENV-T</i>(Env)...&gt;();
auto fn = []&lt;class... Ts&gt;(<del>set_value_t</del><ins><i>decayed-typeof</i>&lt;<i>set-cpo</i>&gt;</ins>(*)(Ts...)) {
  if constexpr (!invocable&lt;remove_cvref_t&lt;<i>data-type</i>&lt;Sndr&gt;&gt;, Ts...&gt;)
    throw <i>unspecified-exception</i>();
};
cs.<i>for-each</i>(<i>overload-set</i>{fn, [](auto){}});
</pre></blockquote>
<p>
where <code><i>unspecified-exception</i></code> is a type derived from <code class='backtick'>exception</code>.
</p>
</blockquote>
</blockquote>

</li>

</ol>




<hr>
<h3 id="4376"><a href="#4376">4376</a><sup><a href="https://cplusplus.github.io/LWG/issue4376">(i)</a></sup>. ABI tag in return type of [simd.mask.unary] is overconstrained</h3>
<p><b>Section:</b> 29.10.9.4 <a href="https://wg21.link/simd.mask.unary">[simd.mask.unary]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Matthias Kretz <b>Opened:</b> 2025-09-15 <b>Last modified:</b> 2025-11-04</p>
<p><b>Priority: </b>1
</p>
<p><b>View other</b> <a href="lwg-index-open.html#simd.mask.unary">active issues</a> in [simd.mask.unary].</p>
<p><b>View all other</b> <a href="lwg-index.html#simd.mask.unary">issues</a> in [simd.mask.unary].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<b>Addresses <a href="https://github.com/cplusplus/nbballot/issues/873">DE 298</a></b>
<p>
29.10.9.4 <a href="https://wg21.link/simd.mask.unary">[simd.mask.unary]</a> spells out the return type with the ABI tag of 
the <code class='backtick'>basic_mask</code> specialization. That's problematic / overconstrained.
</p>
<ol>
<li><p>Consider Intel SandyBridge/IvyBridge-like targets:
</p>
<blockquote><pre>
vec&lt;float&gt;::size() -&gt; 8
vec&lt;int&gt;::size() -&gt; 4
mask&lt;float&gt;::size() -&gt; 8
</pre></blockquote>
<p>
The ABI tag in this case encodes for <code>vec&lt;float&gt;</code> that one object holds 8
elements and is passed via <em>one</em> register. <code>vec&lt;int&gt;</code> uses a 
different ABI tag that says 4 elements passed via <em>one</em> register. 
<code>vec&lt;int, 8&gt;</code>'s ABI tag says 8 elements passed via <em>two</em> registers.
<p/>
Now what should <code>+mask&lt;float&gt;()</code> return? The working draft says it must 
return a <code>basic_vec&lt;int, mask&lt;float&gt;::abi_type&gt;</code>. And 
<code>mask&lt;float&gt;::abi_type</code> is constrained to be the same as 
<code>vec&lt;float&gt;::abi_type</code>. The working draft thus makes it
impossible to implement ABI tags that encode number of elements + number of
registers (+ bit-masks vs. vector-masks, but that's irrelevant for this
issue). Instead, an ABI tag would have to encode the native SIMD width of all
vectorizable types. And that's unnecessarily making compatible types
incompatible. Also we make it harder to add to the set of vectorizable types
in the future.</p></li>
<li><p>The issue is even worse for an implementation that implements
<code>vec&lt;complex&lt;T&gt;&gt;</code> using different ABI tags. Encoding 
whether the value-type is complex into the ABI is useful because it impacts 
how the mask is stored (<code>mask&lt;complex&lt;float&gt;, 8&gt;</code> is 
internally stored as a 16-element bit-mask (for interleaved <code class='backtick'>complex</code>), while 
<code>mask&lt;double, 8&gt;</code> is stored as an 8-element bit-mask). The ABI 
tag can also be used to implement interleaved vs. contiguous storage, which 
is useful for different architectures. If we require 
<code>+mask&lt;complex&lt;float&gt;&gt;()</code> to be of a different type than 
any <code>vec&lt;long long&gt;</code> would ever be, that's just brittle and 
unnecessary template bloat.</p></li>
</ol>

<p><i>[2025-10-17; Reflector poll.]</i></p>

<p>
Set priority to 1 after reflector poll.
</p>
<p>
"Should be addressed together with <a href="lwg-active.html#4238" title="simd_mask&lt;complex&lt;double&gt;&gt;::operator+/-/~ return a disabled simd specialization (Status: New)">4238</a><sup><a href="https://cplusplus.github.io/LWG/issue4238" title="Latest snapshot">(i)</a></sup>."
</p>

<p><strong>Previous resolution [SUPERSEDED]:</strong></p>
<blockquote class="note">

<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<blockquote class="note">
<p>
[<i>Drafting note:</i> LWG <a href="lwg-active.html#4238" title="simd_mask&lt;complex&lt;double&gt;&gt;::operator+/-/~ return a disabled simd specialization (Status: New)">4238</a><sup><a href="https://cplusplus.github.io/LWG/issue4238" title="Latest snapshot">(i)</a></sup> is closely related.]
</p>
</blockquote>

<ol>

<li><p>Modify 29.10.2 <a href="https://wg21.link/simd.expos">[simd.expos]</a> as indicated:</p>

<blockquote>
<pre>
using <i>simd-size-type</i> = <i>see below</i>;                      // <i>exposition only</i>
template&lt;size_t Bytes&gt; using <i>integer-from</i> = <i>see below</i>; // <i>exposition only</i>

template&lt;class T, class Abi&gt;
  constexpr <i>simd-size-type</i> <i>simd-size-v</i> = <i>see below</i>;               // <i>exposition only</i>
template&lt;class T&gt; constexpr size_t <i>mask-element-size</i> = <i>see below</i>; // <i>exposition only</i>

<ins>template &lt;size_t Bytes, class Abi&gt;
  using <i>simd-vec-from-mask-t</i> = <i>see below</i>;                         // <i>exposition only</i></ins>
[&hellip;]
</pre>
</blockquote>

</li>

<li><p>Modify 29.10.2.1 <a href="https://wg21.link/simd.expos.defn">[simd.expos.defn]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class T&gt; constexpr size_t <i>mask-element-size</i> = <i>see below</i>; // <i>exposition only</i>
</pre>
<blockquote>
<p>
-4- <code><i>mask-element-size</i>&lt;basic_mask&lt;Bytes, Abi&gt;&gt;</code> has the value <code class='backtick'>Bytes</code>.
</p>
</blockquote>
<pre>
<ins>template &lt;size_t Bytes, class Abi&gt;
  using <i>simd-vec-from-mask-t</i> = <i>see below</i>;</ins>
</pre>
<blockquote>
<p>
<ins>-?- <code><i>simd-vec-from-mask-t</i>&lt;Bytes, Abi&gt;</code> is an alias for an enabled 
specialization of <code class='backtick'>basic_vec</code> if and only if <code>basic_mask&lt;Bytes, Abi&gt;</code> is a 
data-parallel type and <code><i>integer-from</i>&lt;Bytes&gt;</code> is valid and a vectorizable type.</ins>
<p/>
<ins>-?- <code><i>simd-vec-from-mask-t</i>&lt;Bytes, Abi&gt;::size() == basic_mask&lt;Bytes, Abi&gt;::size()</code>
is <code class='backtick'>true</code>.</ins>
<p/>
<ins>-?- <code>typename <i>simd-vec-from-mask-t</i>&lt;Bytes, Abi&gt;::value_type</code> is 
<code><i>integer-from</i>&lt;Bytes&gt;</code></ins>
</p>
</blockquote>
</blockquote>

</li>

<li><p>Modify 29.10.9.1 <a href="https://wg21.link/simd.mask.overview">[simd.mask.overview]</a>, class template <code class='backtick'>basic_mask overview</code> synopsis, as indicated:</p>

<blockquote>
<pre>
namespace std::simd {
  template&lt;size_t Bytes, class Abi&gt; class basic_mask {
  public:
    [&hellip;]
    // <i>29.10.9.4 <a href="https://wg21.link/simd.mask.unary">[simd.mask.unary]</a>, basic_mask unary operators</i>
    constexpr basic_mask operator!() const noexcept;
    constexpr <del>basic_vec&lt;<i>integer-from</i>&lt;Bytes&gt;, Abi&gt;</del><ins><i>simd-vec-from-mask-t</i>&lt;Bytes, Abi&gt;</ins> operator+() const noexcept;
    constexpr <del>basic_vec&lt;<i>integer-from</i>&lt;Bytes&gt;, Abi&gt;</del><ins><i>simd-vec-from-mask-t</i>&lt;Bytes, Abi&gt;</ins> operator-() const noexcept;
    constexpr <del>basic_vec&lt;<i>integer-from</i>&lt;Bytes&gt;, Abi&gt;</del><ins><i>simd-vec-from-mask-t</i>&lt;Bytes, Abi&gt;</ins> operator~() const noexcept;    
    [&hellip;]
}
</pre>
</blockquote>

</li>

<li><p>Modify 29.10.9.4 <a href="https://wg21.link/simd.mask.unary">[simd.mask.unary]</a> as indicated:</p>

<blockquote>
<pre>
constexpr basic_mask operator!() const noexcept;
constexpr <del>basic_vec&lt;<i>integer-from</i>&lt;Bytes&gt;, Abi&gt;</del><ins><i>simd-vec-from-mask-t</i>&lt;Bytes, Abi&gt;</ins> operator+() const noexcept;
constexpr <del>basic_vec&lt;<i>integer-from</i>&lt;Bytes&gt;, Abi&gt;</del><ins><i>simd-vec-from-mask-t</i>&lt;Bytes, Abi&gt;</ins> operator-() const noexcept;
constexpr <del>basic_vec&lt;<i>integer-from</i>&lt;Bytes&gt;, Abi&gt;</del><ins><i>simd-vec-from-mask-t</i>&lt;Bytes, Abi&gt;</ins> operator~() const noexcept;    
</pre>
<blockquote>
<p>
-1- Let <code><i>op</i></code> be the operator.
<p/>
-2- <i>Returns</i>: [&hellip;]
</p>
</blockquote>
</blockquote>

</li>

</ol></blockquote>

<p><i>[2025-11-04; Matthias Kretz provides new wording]</i></p>

<p>
This also resolves <a href="lwg-active.html#4238" title="simd_mask&lt;complex&lt;double&gt;&gt;::operator+/-/~ return a disabled simd specialization (Status: New)">4238</a><sup><a href="https://cplusplus.github.io/LWG/issue4238" title="Latest snapshot">(i)</a></sup> and addresses 
<a href="https://github.com/cplusplus/nbballot/issues/872">DE 297</a>.
</p>

<p><i>[Kona 2025-11-04; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>



<p id="res-4376"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<ol>

<li><p>Modify 29.10.9.1 <a href="https://wg21.link/simd.mask.overview">[simd.mask.overview]</a>, class template <code class='backtick'>basic_mask overview</code> synopsis, as indicated:</p>

<blockquote>
<pre>
namespace std::simd {
  template&lt;size_t Bytes, class Abi&gt; class basic_mask {
  public:
    [&hellip;]
    // <i>29.10.9.4 <a href="https://wg21.link/simd.mask.unary">[simd.mask.unary]</a>, basic_mask unary operators</i>
    constexpr basic_mask operator!() const noexcept;
    constexpr <del>basic_vec&lt;<i>integer-from</i>&lt;Bytes&gt;, Abi&gt;</del><ins><i>see below</i></ins> operator+() const noexcept;
    constexpr <del>basic_vec&lt;<i>integer-from</i>&lt;Bytes&gt;, Abi&gt;</del><ins><i>see below</i></ins> operator-() const noexcept;
    constexpr <del>basic_vec&lt;<i>integer-from</i>&lt;Bytes&gt;, Abi&gt;</del><ins><i>see below</i></ins> operator~() const noexcept;
    [&hellip;]
}
</pre>
</blockquote>

</li>

<li><p>Modify 29.10.9.4 <a href="https://wg21.link/simd.mask.unary">[simd.mask.unary]</a> as indicated:</p>

<blockquote>
<pre>
constexpr basic_mask operator!() const noexcept;
constexpr <del>basic_vec&lt;<i>integer-from</i>&lt;Bytes&gt;, Abi&gt;</del><ins><i>see below</i></ins> operator+() const noexcept;
constexpr <del>basic_vec&lt;<i>integer-from</i>&lt;Bytes&gt;, Abi&gt;</del><ins><i>see below</i></ins> operator-() const noexcept;
constexpr <del>basic_vec&lt;<i>integer-from</i>&lt;Bytes&gt;, Abi&gt;</del><ins><i>see below</i></ins> operator~() const noexcept;
</pre>
<blockquote>
<p>
-1- Let <code><i>op</i></code> be the operator.
<p/>
-2- <i>Returns</i>: A data-parallel object where the <i>i</i>-th element is initialized to the
results of applying <code><i>op</i></code> to <code>operator[](<i>i</i>)</code> for all <i>i</i> in the
range of [0, <code>size()</code>).
<p/>
<ins>-?- <i>Remarks</i>: If there exists a vectorizable signed integer type <code>I</code> such that
<code>sizeof(I) == Bytes</code> is <code class='backtick'>true</code>, <code>operator+</code>, <code>operator-</code>, and <code>operator~</code>
return an enabled specialization <code>R</code> of <code>basic_vec</code> such that <code>R::value_type</code>
denotes <code><i>integer-from</i>&lt;Bytes&gt;</code> and <code>R::size() == size()</code> is <code>true</code>.
Otherwise, these operators are defined as deleted and their return types are unspecified.</ins>
</p>
</blockquote>
</blockquote>
</li>
</ol>






<hr>
<h3 id="4388"><a href="#4388">4388</a><sup><a href="https://cplusplus.github.io/LWG/issue4388">(i)</a></sup>. Align new definition of <code class='backtick'>va_start</code> with C23</h3>
<p><b>Section:</b> 17.14.2 <a href="https://wg21.link/cstdarg.syn">[cstdarg.syn]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Jakub Jelinek <b>Opened:</b> 2025-10-01 <b>Last modified:</b> 2025-11-06</p>
<p><b>Priority: </b>1
</p>
<p><b>View other</b> <a href="lwg-index-open.html#cstdarg.syn">active issues</a> in [cstdarg.syn].</p>
<p><b>View all other</b> <a href="lwg-index.html#cstdarg.syn">issues</a> in [cstdarg.syn].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
<a href="https://wg21.link/P3348R4" title=" C++26 should refer to C23 not C17">P3348R4</a> changed the <code class='backtick'>va_start</code> macro to match C23,
but the following wording from C is not present in C++:
<blockquote>
If any additional arguments expand to include unbalanced parentheses,
or a preprocessing token that does not convert to a token,
the behavior is undefined.
</blockquote>
</p>
<p>
The importance of that wording was not realized during review of P3348R4.
The wording is intended to ensure that any discarded arguments to
<code class='backtick'>va_start</code> are actually lexable by the compiler,
rather than containing unbalanced parentheses or brackets.
It also makes the following undefined:
</p>
<pre><code>#define BAD ); format_disk(
va_start(ap, BAD);
</code></pre>

<p><i>[2025-10-14; Reflector poll]</i></p>

<p>
Set priority to 1 after reflector poll.
</p>


<p><i>[Kona 2025-11-05; LWG had questions about <i>requiring</i> some cases to be ill-formed.]</i></p>

<p>
The submitter clarified that it would constrain implementations
(effectively requiring <code class='backtick'>va_start</code> to be implemented as a magic
keyword in the preprocessor, in order to be able to diagnose
misuses when preprocessing separately from compilation).
</p>
<p>
Core approved the new wording.
</p>

<p><i>[Kona 2025-11-05; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>



<p id="res-4388"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<ol>
<li><p>Modify 17.14.2 <a href="https://wg21.link/cstdarg.syn">[cstdarg.syn]</a> as indicated:</p>

<blockquote>
<p>
(1.2) &mdash;
<ins>
If more than one argument is present for <code class='backtick'>va_start</code>
and any of the second or subsequent arguments expands
to include unbalanced parentheses,
or a preprocessing token that does not convert to a token,
the program is ill-formed, no diagnostic required.
</ins>
The preprocessing tokens comprising the second and subsequent arguments to
<code class='backtick'>va_start</code> (if any) are discarded.
[<i>Note 1</i>: <code class='backtick'>va_start</code> accepts a second argument for compatibility with prior revisions of C++.
&mdash; <i>end note</i>]
</p>
</blockquote>
</li>
</ol>






<hr>
<h3 id="4396"><a href="#4396">4396</a><sup><a href="https://cplusplus.github.io/LWG/issue4396">(i)</a></sup>. Improve <code>inplace_vector(from_range_t, R&amp;&amp; rg)</code></h3>
<p><b>Section:</b> 23.2.4 <a href="https://wg21.link/sequence.reqmts">[sequence.reqmts]</a>, 23.3.16.2 <a href="https://wg21.link/inplace.vector.cons">[inplace.vector.cons]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Hewill Kang <b>Opened:</b> 2025-10-01 <b>Last modified:</b> 2025-11-06</p>
<p><b>Priority: </b>3
</p>
<p><b>View other</b> <a href="lwg-index-open.html#sequence.reqmts">active issues</a> in [sequence.reqmts].</p>
<p><b>View all other</b> <a href="lwg-index.html#sequence.reqmts">issues</a> in [sequence.reqmts].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
Consider:
</p>
<blockquote><pre>
std::array&lt;int, 42&gt; a;
std::inplace_vector&lt;int, 5&gt; v(std::from_range, a);
</pre></blockquote>
<p>
The above throws <code class='backtick'>std::bad_alloc</code> at runtime because the size of <code class='backtick'>array</code> is larger than
capacity of <code class='backtick'>inplace_vector</code>. However, we should reject it at compile time since the 
<code class='backtick'>array</code> size is a constant expression.
<p/>
Given that we do a lot of compile-time size checking in <code>&lt;simd&gt;</code>,
it's worth applying that here as well. Compile-time errors are better than runtime ones.
</p>

<p><i>[2025-10-22; Reflector poll. Status changed: New &rarr; LEWG and P3.]</i></p>

<p>
General support for change, after LEWG approval.
</p>
<p>
Suggestion was made that this could be extended to all containers,
but is unlikely to be triggred in real word, as it requires ranges
with static size greater than <code class='backtick'>size_t(-1)</code>.
</p>

<p><i>[Kona 2025-11-06; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>



<p id="res-4396"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<ol>

<li><p>Modify 23.2.4 <a href="https://wg21.link/sequence.reqmts">[sequence.reqmts]</a> as indicated:</p>

<blockquote>
<pre>
a.assign_range(rg)
</pre>
<blockquote>
<p>
-60- <i>Result</i>: <code>void</code>
<p/>
-61- <i>Mandates</i>: <code>assignable_from&lt;T&amp;, ranges::range_reference_t&lt;R&gt;&gt;</code> is modeled.
<ins>For <code class='backtick'>inplace_vector</code>, if <code class='backtick'>ranges::size(rg)</code> is a constant expression then <code class='backtick'>ranges::size(rg)</code> ≤ <code class='backtick'>a.max_size()</code></ins>.
</p>
</blockquote>
</blockquote>
</li>

<li><p>Modify 23.3.16.2 <a href="https://wg21.link/inplace.vector.cons">[inplace.vector.cons]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;<i>container-compatible-range</i>&lt;T&gt; R&gt;
  constexpr inplace_vector(from_range_t, R&amp;&amp; rg);
</pre>
<blockquote>
<p>
<ins>-?- <i>Mandates</i>: If <code class='backtick'>ranges::size(rg)</code> is a constant expression then <code class='backtick'>ranges::size(rg)</code> ≤ <code class='backtick'>N</code>.</ins>
<p/>
-9- <i>Effects</i>: Constructs an <code class='backtick'>inplace_vector</code> with the elements of the range <code class='backtick'>rg</code>.
<p/>
-10- <i>Complexity</i>: Linear in <code class='backtick'>ranges::distance(rg)</code>.
</p>
</blockquote>
</blockquote>
</li>
</ol>






<hr>
<h3 id="4420"><a href="#4420">4420</a><sup><a href="https://cplusplus.github.io/LWG/issue4420">(i)</a></sup>. &sect;[simd] conversions (constructor, load, stores, gather, and scatter) are
incorrectly constrained for <code>&lt;stdfloat&gt;</code> types</h3>
<p><b>Section:</b> 29.10 <a href="https://wg21.link/simd">[simd]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Matthias Kretz <b>Opened:</b> 2025-10-15 <b>Last modified:</b> 2025-11-04</p>
<p><b>Priority: </b>1
</p>
<p><b>View other</b> <a href="lwg-index-open.html#simd">active issues</a> in [simd].</p>
<p><b>View all other</b> <a href="lwg-index.html#simd">issues</a> in [simd].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
<b>Addresses DE-288 and DE-285</b>
<p/>
29.10.8.7 <a href="https://wg21.link/simd.loadstore">[simd.loadstore]</a> <code class='backtick'>unchecked_store</code> and <code class='backtick'>partial_store</code> are constrained with
<code class='backtick'>indirectly_writable</code> in such a way that <code class='backtick'>basic_vec</code>'s <code class='backtick'>value_type</code> must satisfy
<code>convertible_to&lt;<i>range value-type</i>&gt;</code>. But that is not the case, 
e.g. for <code>float &rarr; float16_t</code> or <code>double &rarr; float32_t</code>. However, 
if <code class='backtick'>simd::flag_convert</code> is passed, these conversions were intended to work. The 
implementation thus must <code class='backtick'>static_cast</code> the <code class='backtick'>basic_vec</code> values to the range's value-type 
before storing to the range.
<p/>
<code>unchecked_store(vec&lt;float&gt;, span&lt;complex&lt;float16_t&gt;&gt;, flag_convert)</code> 
does not work for a different reason. The <code>complex(const float16_t&amp;, const float16_t&amp;)</code>
constructor simply does not allow construction from <code class='backtick'>float</code>, irrespective of
using implicit or explicit conversion. The only valid conversion from <code>float &rarr;
complex&lt;float16_t&gt;</code> is via an extra step through <code>complex&lt;float16_t&gt;::value_type</code>. 
This issue considers it a defect of <code class='backtick'>complex</code> that an explicit conversion from 
<code>float &rarr; complex&lt;float16_t&gt;</code> is ill-formed and therefore no workaround/special 
case is introduced.
<p/>
Conversely, the conversion constructor in 29.10.7.2 <a href="https://wg21.link/simd.ctor">[simd.ctor]</a> does not reject
conversion from <code>vec&lt;complex&lt;float&gt;, 4&gt;</code> to <code>vec&lt;float, 4&gt;</code>. 
I.e. <code>convertible_to&lt;vec&lt;complex&lt;float&gt;, 4&gt;, vec&lt;float, 4&gt;&gt;</code> 
is <code class='backtick'>true</code>, which is a lie. This is NB comment DE-288. However, the NB comment's proposed 
resolution is too strict, in that it would disallow conversion from <code class='backtick'>float</code> to <code class='backtick'>float16_t</code>.
<p/>
The conversion/load from static-sized range constructor in 29.10.7.2 <a href="https://wg21.link/simd.ctor">[simd.ctor]</a> has a
similar problem:
</p>
<blockquote><p>
<code>convertible_to&lt;array&lt;std::string, 4&gt;, vec&lt;int, 4&gt;&gt;</code> is <code class='backtick'>true</code>
</p></blockquote>
<p>
but when fixing this
</p>
<blockquote><pre>
vec&lt;float16_t, 4&gt;(array&lt;float, 4&gt;, flag_convert)
</pre></blockquote>
<p>
must continue to be valid.
<p/>
<code class='backtick'>unchecked_load</code> and <code class='backtick'>partial_load</code> in 29.10.8.7 <a href="https://wg21.link/simd.loadstore">[simd.loadstore]</a> currently <i>Mandate</i> 
the range's value-type to be vectorizable, but converting loads from <code>complex&lt;float&gt;</code> 
to <code class='backtick'>float</code> are not covered. It is unclear what a conversion from <code>complex&lt;float&gt;</code> 
to <code class='backtick'>float</code> should do, so it needs to be added (again without breaking <code>float &rarr; float16_t</code>).
<p/>
29.10.8.11 <a href="https://wg21.link/simd.permute.memory">[simd.permute.memory]</a> is analogous to 29.10.8.7 <a href="https://wg21.link/simd.loadstore">[simd.loadstore]</a> and needs 
equivalent constraints.
<p/>
29.10.7.2 <a href="https://wg21.link/simd.ctor">[simd.ctor]</a> p2 requires <code>constructible_from&lt;U&gt;</code>, which makes explicit
construction of <code>vec&lt;float16_t&gt;</code> from <code class='backtick'>float</code> ill-formed. For consistency this
should also be constrained with <code><i>explicitly-convertible-to</i></code>.
</p>

<p><i>[2025-10-22; Reflector poll.]</i></p>

<p>
Set priority to 1 after reflector poll.
</p>
<p>
We also need to update <i>Effects</i>. There are more places in 29.10 <a href="https://wg21.link/simd">[simd]</a>
where <code>float</code> to <code>float16_t</code> and similar conversion are not supported.
</p>
<p>
It was pointed out that similar issues happen for <code>complex&lt;float16_t&gt;</code>.
There seem to be mismatch between language initialization rules and the intended
usage based on library API.
</p>

<p><strong>Previous resolution [SUPERSEDED]:</strong></p>
<blockquote class="note">

<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<ol>
<li><p>In 29.10.3 <a href="https://wg21.link/simd.syn">[simd.syn]</a> and 29.10.8.7 <a href="https://wg21.link/simd.loadstore">[simd.loadstore]</a> replace all occurrences of</p>
<blockquote><pre>
indirectly_writable&lt;ranges::iterator_t&lt;R&gt;, T&gt;
</pre></blockquote>
<p>
with
</p>
<blockquote><pre>
indirectly_writable&lt;ranges::iterator_t&lt;R&gt;, <del>T</del><ins>ranges::range_value_t&lt;R&gt;</ins>&gt;
</pre></blockquote>
<p>
and all occurrences of
</p>
<blockquote><pre>
indirectly_writable&lt;I, T&gt;
</pre></blockquote>
<p>
with
</p>
<blockquote><pre>
indirectly_writable&lt;I, <del>T</del><ins>iter_value_t&lt;I&gt;</ins>&gt;
</pre></blockquote>

</li>

<li><p>Modify 29.10.8.7 <a href="https://wg21.link/simd.loadstore">[simd.loadstore]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class T, class Abi, ranges::contiguous_range R, class... Flags&gt;
  requires ranges::sized_range&lt;R&gt; &amp;&amp; indirectly_writable&lt;ranges::iterator_t&lt;R&gt;, T&gt;
  constexpr void unchecked_store(const basic_vec&lt;T, Abi&gt;&amp; v, R&amp;&amp; r, flags&lt;Flags...&gt; f = {});
[&hellip;]
template&lt;class T, class Abi, contiguous_iterator I, sized_sentinel_for&lt;I&gt; S, class... Flags&gt;
  requires indirectly_writable&lt;I, T&gt;
  constexpr void unchecked_store(const basic_vec&lt;T, Abi&gt;&amp; v, I first, S last,
    const typename basic_vec&lt;T, Abi&gt;::mask_type&amp; mask, flags&lt;Flags...&gt; f = {});
</pre>
<blockquote>
<p>
-11- Let [&hellip;]
<p/>
<ins>-?- <i>Constraints</i>: The expression <code>static_cast&lt;ranges::range_value_t&lt;R&gt;&gt;(x)</code>
where <code class='backtick'>x</code> is an object of type <code class='backtick'>T</code> is well-formed.</ins>
<p/>
-12- <i>Mandates</i>: If <code class='backtick'>ranges::size(r)</code> is a constant expression then 
<code>ranges::size(r) &ge; <i>simd-size-v</i>&lt;T, Abi&gt;</code>.
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
template&lt;class T, class Abi, ranges::contiguous_range R, class... Flags&gt;
  requires ranges::sized_range&lt;R&gt; &amp;&amp; indirectly_writable&lt;ranges::iterator_t&lt;R&gt;, T&gt;
  constexpr void partial_store(const basic_vec&lt;T, Abi&gt;&amp; v, R&amp;&amp; r, flags&lt;Flags...&gt; f = {});
[&hellip;]
template&lt;class T, class Abi, contiguous_iterator I, sized_sentinel_for&lt;I&gt; S, class... Flags&gt;
  requires indirectly_writable&lt;I, T&gt;
  constexpr void partial_store(const basic_vec&lt;T, Abi&gt;&amp; v, I first, S last,
    const typename basic_vec&lt;T, Abi&gt;::mask_type&amp; mask, flags&lt;Flags...&gt; f = {});
</pre>
<blockquote>
<p>
-15- Let [&hellip;]
<p/>
<ins>-?- <i>Constraints</i>: The expression <code>static_cast&lt;iter_value_t&lt;I&gt;&gt;(x)</code>
where <code class='backtick'>x</code> is an object of type <code class='backtick'>T</code> is well-formed.</ins>
<p/>
-16- <i>Mandates</i>: [&hellip;]
</p>
</blockquote>
</blockquote>
</li>
</ol>
</blockquote>

<p><i>[2025-10-22; Matthias Kretz improves discussion and provides new wording]</i></p>


<p><i>[Kona 2025-11-04; Also resolves LWG <a href="lwg-active.html#4393" title="simd::unchecked_scatter_to is underconstrained (Status: New)">4393</a><sup><a href="https://cplusplus.github.io/LWG/issue4393" title="Latest snapshot">(i)</a></sup>.]</i></p>

<p><i>[Kona 2025-11-04; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>




<p id="res-4420"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<ol>
<li><p>Modify 29.10.2 <a href="https://wg21.link/simd.expos">[simd.expos]</a> as indicated:</p>

<blockquote>
<pre>
[&hellip;]

template&lt;class T&gt;
  concept <i>constexpr-wrapper-like</i> =                   <i>// exposition only</i>
    [&hellip;]
    bool_constant&lt;static_cast&lt;decltype(T::value)&gt;(T()) == T::value&gt;::value;
    
<ins>template&lt;class From, class To&gt;
  concept <i>explicitly-convertible-to</i> =                <i>// exposition-only</i>
    requires {
      static_cast&lt;To&gt;(declval&lt;From&gt;());
    };</ins>

template&lt;class T&gt; using <i>deduced-vec-t</i> = <i>see below</i>; <i>// exposition only</i>
[&hellip;]
</pre>
</blockquote>
</li>

<li><p>Modify 29.10.3 <a href="https://wg21.link/simd.syn">[simd.syn]</a> as indicated:</p>

<blockquote>
<pre>
[&hellip;]
template&lt;class T, class Abi, ranges::contiguous_range R, class... Flags&gt;
  requires ranges::sized_range&lt;R&gt; <del>&amp;&amp; indirectly_writable&lt;ranges::iterator_t&lt;R&gt;, T&gt;</del>
  constexpr void unchecked_store(const basic_vec&lt;T, Abi&gt;&amp; v, R&amp;&amp; r,
                                 flags&lt;Flags...&gt; f = {});
template&lt;class T, class Abi, ranges::contiguous_range R, class... Flags&gt;
  requires ranges::sized_range&lt;R&gt; <del>&amp;&amp; indirectly_writable&lt;ranges::iterator_t&lt;R&gt;, T&gt;</del>
  constexpr void unchecked_store(const basic_vec&lt;T, Abi&gt;&amp; v, R&amp;&amp; r,
                                 const typename basic_vec&lt;T, Abi&gt;::mask_type&amp; mask, flags&lt;Flags...&gt; f = {});
template&lt;class T, class Abi, contiguous_iterator I, class... Flags&gt;
  <del>requires indirectly_writable&lt;I, T&gt;</del>
  constexpr void unchecked_store(const basic_vec&lt;T, Abi&gt;&amp; v, I first,
                                 iter_difference_t&lt;I&gt; n, flags&lt;Flags...&gt; f = {});
template&lt;class T, class Abi, contiguous_iterator I, class... Flags&gt;
  <del>requires indirectly_writable&lt;I, T&gt;</del>
  constexpr void unchecked_store(const basic_vec&lt;T, Abi&gt;&amp; v, I first,
                                 iter_difference_t&lt;I&gt; n, const typename basic_vec&lt;T, Abi&gt;::mask_type&amp; mask,
                                 flags&lt;Flags...&gt; f = {});
template&lt;class T, class Abi, contiguous_iterator I, sized_sentinel_for&lt;I&gt; S, class... Flags&gt;
  <del>requires indirectly_writable&lt;I, T&gt;</del>
  constexpr void unchecked_store(const basic_vec&lt;T, Abi&gt;&amp; v, I first, S last,
                                 flags&lt;Flags...&gt; f = {});
template&lt;class T, class Abi, contiguous_iterator I, sized_sentinel_for&lt;I&gt; S, class... Flags&gt;
  <del>requires indirectly_writable&lt;I, T&gt;</del>
  constexpr void unchecked_store(const basic_vec&lt;T, Abi&gt;&amp; v, I first, S last,
                                 const typename basic_vec&lt;T, Abi&gt;::mask_type&amp; mask, flags&lt;Flags...&gt; f = {});

template&lt;class T, class Abi, ranges::contiguous_range R, class... Flags&gt;
  requires ranges::sized_range&lt;R&gt; <del>&amp;&amp; indirectly_writable&lt;ranges::iterator_t&lt;R&gt;, T&gt;</del>
  constexpr void partial_store(const basic_vec&lt;T, Abi&gt;&amp; v, R&amp;&amp; r,
                               flags&lt;Flags...&gt; f = {});
template&lt;class T, class Abi, ranges::contiguous_range R, class... Flags&gt;
  requires ranges::sized_range&lt;R&gt; <del>&amp;&amp; indirectly_writable&lt;ranges::iterator_t&lt;R&gt;, T&gt;</del>
  constexpr void partial_store(const basic_vec&lt;T, Abi&gt;&amp; v, R&amp;&amp; r,
    const typename basic_vec&lt;T, Abi&gt;::mask_type&amp; mask, flags&lt;Flags...&gt; f = {});
template&lt;class T, class Abi, contiguous_iterator I, class... Flags&gt;
  <del>requires indirectly_writable&lt;I, T&gt;</del>
  constexpr void partial_store(
    const basic_vec&lt;T, Abi&gt;&amp; v, I first, iter_difference_t&lt;I&gt; n, flags&lt;Flags...&gt; f = {});
template&lt;class T, class Abi, contiguous_iterator I, class... Flags&gt;
  <del>requires indirectly_writable&lt;I, T&gt;</del>
  constexpr void partial_store(
    const basic_vec&lt;T, Abi&gt;&amp; v, I first, iter_difference_t&lt;I&gt; n,
    const typename basic_vec&lt;T, Abi&gt;::mask_type&amp; mask, flags&lt;Flags...&gt; f = {});
template&lt;class T, class Abi, contiguous_iterator I, sized_sentinel_for&lt;I&gt; S, class... Flags&gt;
  <del>requires indirectly_writable&lt;I, T&gt;</del>
  constexpr void partial_store(const basic_vec&lt;T, Abi&gt;&amp; v, I first, S last,
                               flags&lt;Flags...&gt; f = {});
template&lt;class T, class Abi, contiguous_iterator I, sized_sentinel_for&lt;I&gt; S, class... Flags&gt;
  <del>requires indirectly_writable&lt;I, T&gt;</del>
  constexpr void partial_store(const basic_vec&lt;T, Abi&gt;&amp; v, I first, S last,
    const typename basic_vec&lt;T, Abi&gt;::mask_type&amp; mask, flags&lt;Flags...&gt; f = {});
[&hellip;]
</pre>
</blockquote>
</li>

<li><p>Modify 29.10.7.2 <a href="https://wg21.link/simd.ctor">[simd.ctor]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class U&gt; constexpr explicit(<i>see below</i>) basic_vec(U&amp;&amp; value) noexcept;
</pre>
<blockquote>
<p>
-1- Let <code class='backtick'>From</code> denote the type <code>remove_cvref_t&lt;U&gt;</code>.
<p/>
-2- <i>Constraints</i>: <code><del>value_type</del><ins>U</ins></code> satisfies 
<code><del>constructible_from&lt;U&gt;</del><ins><i>explicitly-convertible-to</i>&lt;value_type&gt;</ins></code>.
</p>
[&hellip;]
</blockquote>
<pre>
template&lt;class U, class UAbi&gt;
  constexpr explicit(<i>see below</i>) basic_vec(const basic_vec&lt;U, UAbi&gt;&amp; x) noexcept;
</pre>
<blockquote>
<p>
-5- <i>Constraints</i>: 
</p>
<ol style="list-style-type: none">
<li><p>
<ins>(5.1) &mdash;</ins> <code><i>simd-size-v</i>&lt;U, UAbi&gt; == size()</code> is <code class='backtick'>true</code><ins>, and</ins>
</p></li>
<li><p>
<ins>(5.2) &mdash; <code class='backtick'>U</code> satisfies <code><i>explicitly-convertible-to</i>&lt;T&gt;</code></ins>.
</p></li>
</ol>
[&hellip;]
</blockquote>
<pre>
template&lt;class R, class... Flags&gt;
  constexpr basic_vec(R&amp;&amp; r, flags&lt;Flags...&gt; = {});
template&lt;class R, class... Flags&gt;
  constexpr basic_vec(R&amp;&amp; r, const mask_type&amp; mask, flags&lt;Flags...&gt; = {});
</pre>
<blockquote>
<p>
-12- Let <code class='backtick'>mask</code> be <code class='backtick'>mask_type(true)</code> for the overload with no <code class='backtick'>mask</code> parameter.
<p/>
-13- <i>Constraints</i>:
</p>
<ol style="list-style-type: none">
<li><p>
(13.1) &mdash; <code class='backtick'>R</code> models <code class='backtick'>ranges::contiguous_range</code> and <code class='backtick'>ranges::sized_range</code>,
</p></li>
<li><p>
(13.2) &mdash; <code class='backtick'>ranges::size(r)</code> is a constant expression, <del>and</del>
</p></li>
<li><p>
(13.3) &mdash; <code class='backtick'>ranges::size(r)</code> is equal to <code class='backtick'>size()</code><ins>, and</ins>
</p></li>
<li><p>
<ins>(13.?) &mdash; <code>ranges::range_value_t&lt;R&gt;</code> is a vectorizable type and satisfies
<code><i>explicitly-convertible-to</i>&lt;T&gt;</code></ins>.
</p></li>
</ol>
<p>
-14- <i>Mandates</i>:
</p>
<ol style="list-style-type: none">
<li><p>
<del>(14.1) &mdash; <code>ranges::range_value_t&lt;R&gt;</code> is a vectorizable type, and</del>
</p></li>
<li><p>
<del>(14.2) &mdash; if</del><ins>If</ins> the template parameter pack <code class='backtick'>Flags</code> does not contain 
<code><i>convert-flag</i></code>, then the conversion from <code>ranges::range_value_t&lt;R&gt;</code> 
to <code class='backtick'>value_type</code> is value-preserving.
</p></li>
</ol>
</blockquote>
</blockquote>
</li>

<li><p>Modify 29.10.8.7 <a href="https://wg21.link/simd.loadstore">[simd.loadstore]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class V = see below , ranges::contiguous_range R, class... Flags&gt;
  requires ranges::sized_range&lt;R&gt;
  constexpr V partial_load(R&amp;&amp; r, flags&lt;Flags...&gt; f = {});
template&lt;class V = see below , ranges::contiguous_range R, class... Flags&gt;
  requires ranges::sized_range&lt;R&gt;
  constexpr V partial_load(R&amp;&amp; r, const typename V::mask_type&amp; mask, flags&lt;Flags...&gt; f = {});
template&lt;class V = see below , contiguous_iterator I, class... Flags&gt;
  constexpr V partial_load(I first, iter_difference_t&lt;I&gt; n, flags&lt;Flags...&gt; f = {});
template&lt;class V = see below , contiguous_iterator I, class... Flags&gt;
  constexpr V partial_load(I first, iter_difference_t&lt;I&gt; n, const typename V::mask_type&amp; mask,
                           flags&lt;Flags...&gt; f = {});
template&lt;class V = see below , contiguous_iterator I, sized_sentinel_for&lt;I&gt; S, class... Flags&gt;
  constexpr V partial_load(I first, S last, flags&lt;Flags...&gt; f = {});
template&lt;class V = see below , contiguous_iterator I, sized_sentinel_for&lt;I&gt; S, class... Flags&gt;
  constexpr V partial_load(I first, S last, const typename V::mask_type&amp; mask,
                           flags&lt;Flags...&gt; f = {});
</pre>
<blockquote>
<p>
-6- Let
</p>
<ol style="list-style-type: none">
<li><p>
(6.1) &mdash; <code>mask</code> be <code>V::mask_type(true)</code> for the overloads with no <code>mask</code> parameter;
</p></li>
<li><p>
(6.2) &mdash; <code>R</code> be <code>span&lt;const iter_value_t&lt;I&gt;&gt;</code> for the overloads with no template parameter <code>R</code>;
</p></li>
<li><p>
(6.3) &mdash; <code>r</code> be <code>R(first, n)</code> for the overloads with an <code>n</code> parameter and <code>R(first, last)</code> for the overloads with a <code>last</code> parameter<del>.</del><ins>;</ins>
</p></li>
<li><p>
<ins>(6.?) &mdash; <code>T</code> be <code>typename V::value_type</code>.</ins>
</p></li>
</ol>
<p>
-7- <i>Mandates</i>:
</p>
<ol style="list-style-type: none">
<li><p>
(7.1) &mdash; <code>ranges::range_value_t&lt;R&gt;</code> is a vectorizable type <ins>and satisfies
<code><i>explicitly-convertible-to</i>&lt;T&gt;</code></ins>,
</p></li>
<li><p>
(7.2) &mdash; <code>same_as&lt;remove_cvref_t&lt;V&gt;, V&gt;</code> is <code class='backtick'>true</code>,
</p></li>
<li><p>
(7.3) &mdash; <code class='backtick'>V</code> is an enabled specialization of <code class='backtick'>basic_vec</code>, and
</p></li>
<li><p>
(7.4) &mdash; if the template parameter pack <code class='backtick'>Flags</code> does not contain <code><i>convert-flag</i></code>, 
then the conversion from <code>ranges::range_value_t&lt;R&gt;</code> to <code class='backtick'>V::value_type</code> is value-preserving.
</p></li>
</ol>
</blockquote>
<pre>
template&lt;class T, class Abi, ranges::contiguous_range R, class... Flags&gt;
  requires ranges::sized_range&lt;R&gt; <del>&amp;&amp; indirectly_writable&lt;ranges::iterator_t&lt;R&gt;, T&gt;</del>
  constexpr void unchecked_store(const basic_vec&lt;T, Abi&gt;&amp; v, R&amp;&amp; r,
                                 flags&lt;Flags...&gt; f = {});
template&lt;class T, class Abi, ranges::contiguous_range R, class... Flags&gt;
  requires ranges::sized_range&lt;R&gt; <del>&amp;&amp; indirectly_writable&lt;ranges::iterator_t&lt;R&gt;, T&gt;</del>
  constexpr void unchecked_store(const basic_vec&lt;T, Abi&gt;&amp; v, R&amp;&amp; r,
                                 const typename basic_vec&lt;T, Abi&gt;::mask_type&amp; mask, flags&lt;Flags...&gt; f = {});
template&lt;class T, class Abi, contiguous_iterator I, class... Flags&gt;
  <del>requires indirectly_writable&lt;I, T&gt;</del>
  constexpr void unchecked_store(const basic_vec&lt;T, Abi&gt;&amp; v, I first,
                                 iter_difference_t&lt;I&gt; n, flags&lt;Flags...&gt; f = {});
template&lt;class T, class Abi, contiguous_iterator I, class... Flags&gt;
  <del>requires indirectly_writable&lt;I, T&gt;</del>
  constexpr void unchecked_store(const basic_vec&lt;T, Abi&gt;&amp; v, I first,
                                 iter_difference_t&lt;I&gt; n, const typename basic_vec&lt;T, Abi&gt;::mask_type&amp; mask,
                                 flags&lt;Flags...&gt; f = {});
template&lt;class T, class Abi, contiguous_iterator I, sized_sentinel_for&lt;I&gt; S, class... Flags&gt;
  <del>requires indirectly_writable&lt;I, T&gt;</del>
  constexpr void unchecked_store(const basic_vec&lt;T, Abi&gt;&amp; v, I first, S last,
                                 flags&lt;Flags...&gt; f = {});
template&lt;class T, class Abi, contiguous_iterator I, sized_sentinel_for&lt;I&gt; S, class... Flags&gt;
  <del>requires indirectly_writable&lt;I, T&gt;</del>
  constexpr void unchecked_store(const basic_vec&lt;T, Abi&gt;&amp; v, I first, S last,
                                 const typename basic_vec&lt;T, Abi&gt;::mask_type&amp; mask, flags&lt;Flags...&gt; f = {});
</pre>
<blockquote>
<p>
-11- Let [&hellip;]
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
template&lt;class T, class Abi, ranges::contiguous_range R, class... Flags&gt;
  requires ranges::sized_range&lt;R&gt; <del>&amp;&amp; indirectly_writable&lt;ranges::iterator_t&lt;R&gt;, T&gt;</del>
  constexpr void partial_store(const basic_vec&lt;T, Abi&gt;&amp; v, R&amp;&amp; r,
                               flags&lt;Flags...&gt; f = {});
template&lt;class T, class Abi, ranges::contiguous_range R, class... Flags&gt;
  requires ranges::sized_range&lt;R&gt; <del>&amp;&amp; indirectly_writable&lt;ranges::iterator_t&lt;R&gt;, T&gt;</del>
  constexpr void partial_store(const basic_vec&lt;T, Abi&gt;&amp; v, R&amp;&amp; r,
    const typename basic_vec&lt;T, Abi&gt;::mask_type&amp; mask, flags&lt;Flags...&gt; f = {});
template&lt;class T, class Abi, contiguous_iterator I, class... Flags&gt;
  <del>requires indirectly_writable&lt;I, T&gt;</del>
  constexpr void partial_store(
    const basic_vec&lt;T, Abi&gt;&amp; v, I first, iter_difference_t&lt;I&gt; n, flags&lt;Flags...&gt; f = {});
template&lt;class T, class Abi, contiguous_iterator I, class... Flags&gt;
  <del>requires indirectly_writable&lt;I, T&gt;</del>
  constexpr void partial_store(
    const basic_vec&lt;T, Abi&gt;&amp; v, I first, iter_difference_t&lt;I&gt; n,
    const typename basic_vec&lt;T, Abi&gt;::mask_type&amp; mask, flags&lt;Flags...&gt; f = {});
template&lt;class T, class Abi, contiguous_iterator I, sized_sentinel_for&lt;I&gt; S, class... Flags&gt;
  <del>requires indirectly_writable&lt;I, T&gt;</del>
  constexpr void partial_store(const basic_vec&lt;T, Abi&gt;&amp; v, I first, S last,
                               flags&lt;Flags...&gt; f = {});
template&lt;class T, class Abi, contiguous_iterator I, sized_sentinel_for&lt;I&gt; S, class... Flags&gt;
  <del>requires indirectly_writable&lt;I, T&gt;</del>
  constexpr void partial_store(const basic_vec&lt;T, Abi&gt;&amp; v, I first, S last,
    const typename basic_vec&lt;T, Abi&gt;::mask_type&amp; mask, flags&lt;Flags...&gt; f = {});
</pre>
<blockquote>
<p>
-15- Let [&hellip;]
<p/>
<ins>-?- <i>Constraints</i>:</ins>
</p>
<ol style="list-style-type: none">
<li><p>
<ins>(?.1) &mdash; <code>ranges::iterator_t&lt;R&gt;</code> models
<code>indirectly_writable&lt;ranges::range_value_t&lt;R&gt;&gt;</code>, and</ins>
</p></li>
<li><p>
<ins>(?.2) &mdash; <code class='backtick'>T</code> satisfies <code><i>explicitly-convertible-to</i>&lt;ranges::range_value_t&lt;R&gt;&gt;</code></ins>
</p></li>
</ol>
<p>
-16- <i>Mandates</i>: [&hellip;]
<p/>
-17- <i>Preconditions</i>: [&hellip;]
<p/>
-18- <i>Effects</i>: For all <code><i>i</i></code> in the range of <code>[0, basic_vec&lt;T, Abi&gt;::size())</code>, 
if <code>mask[<i>i</i>] &amp;&amp; <i>i</i> &lt; ranges::size(r)</code> is <code class='backtick'>true</code>, evaluates 
<code>ranges::data(r)[<i>i</i>] = <ins>static_cast&lt;ranges::range_value_t&lt;R&gt;&gt;(</ins>v[<i>i</i>]<ins>)</ins></code>.
</p>
</blockquote>
</blockquote>
</li>

<li><p>Modify 29.10.8.11 <a href="https://wg21.link/simd.permute.memory">[simd.permute.memory]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;class V = <i>see below</i>, ranges::contiguous_range R, <i>simd-integral</i> I, class... Flags&gt;
  requires ranges::sized_range&lt;R&gt;
  constexpr V partial_gather_from(R&amp;&amp; in, const I&amp; indices, flags&lt;Flags...&gt; f = {});
template&lt;class V = <i>see below</i>, ranges::contiguous_range R, <i>simd-integral</i> I, class... Flags&gt;
  requires ranges::sized_range&lt;R&gt;
  constexpr V partial_gather_from(R&amp;&amp; in, const typename I::mask_type&amp; mask,
                                  const I&amp; indices, flags&lt;Flags...&gt; f = {});
</pre>
<blockquote>
<p>
-5- Let: [&hellip;] 
<p/>
<ins>-?- <i>Constraints:</i> <code>ranges::range_value_t&lt;R&gt;</code> is a vectorizable type and
satisfies <code><i>explicitly-convertible-to</i>&lt;T&gt;</code>.</ins>
</p>
<p>
-6- <i>Mandates</i>: [&hellip;] 
<p/>
[&hellip;]
</p>
</blockquote>
<pre>
template&lt;<i>simd-vec-type</i> V, ranges::contiguous_range R, <i>simd-integral</i> I, class... Flags&gt;
  requires ranges::sized_range&lt;R&gt;
  constexpr void
  partial_scatter_to(const V&amp; v, R&amp;&amp; out, const I&amp; indices, flags&lt;Flags...&gt; f = {});
template&lt;<i>simd-vec-type</i> V, ranges::contiguous_range R, <i>simd-integral</i> I, class... Flags&gt;
  requires ranges::sized_range&lt;R&gt;
  constexpr void partial_scatter_to(const V&amp; v, R&amp;&amp; out, const typename I::mask_type&amp; mask,
                                    const I&amp; indices, flags&lt;Flags...&gt; f = {});
</pre>
<blockquote>
<p>
-13- Let <code class='backtick'>mask</code> be <code class='backtick'>I::mask_type(true)</code> for the overload with no <code class='backtick'>mask</code> parameter.
<p/>
-14- <i>Constraints</i>:
</p>
<ol style="list-style-type: none">
<li><p>
<ins>(14.1) &mdash;</ins> <code class='backtick'>V::size() == I::size()</code> is <code class='backtick'>true</code><ins>,</ins>
</p></li>
<li><p>
<ins>(14.2) &mdash; <code>ranges::iterator_t&lt;R&gt;</code> models
<code>indirectly_writable&lt;ranges::range_value_t&lt;R&gt;&gt;</code>, and</ins> 
</p></li>
<li><p>
<ins>(14.3) &mdash; <code class='backtick'>typename V::value_type</code> satisfies 
<code><i>explicitly-convertible-to</i>&lt;ranges::range_value_t&lt;R&gt;&gt;</code></ins>.
</p></li>
</ol>
[&hellip;]
<p>
-17- <i>Effects</i>: For all <i>i</i> in the range [<code>0</code>, <code>I::size()</code>), if <code>mask[<i>i</i>] 
&amp;&amp; (indices[<i>i</i>] &lt; ranges::size(out))</code> is <code>true</code>, evaluates 
<code>ranges::data(out)[indices[<i>i</i>]] = <ins>static_cast&lt;ranges::range_value_t&lt;R&gt;&gt;(</ins>v[<i>i</i>]<ins>)</ins></code>.
</p>
</blockquote>
</blockquote>
</li>
</ol>






<hr>
<h3 id="4424"><a href="#4424">4424</a><sup><a href="https://cplusplus.github.io/LWG/issue4424">(i)</a></sup>. <code class='backtick'>meta::define_aggregate</code> should require a class type</h3>
<p><b>Section:</b> 21.4.16 <a href="https://wg21.link/meta.reflection.define.aggregate">[meta.reflection.define.aggregate]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Jakub Jelinek <b>Opened:</b> 2025-10-20 <b>Last modified:</b> 2025-11-04</p>
<p><b>Priority: </b>1
</p>
<p><b>View other</b> <a href="lwg-index-open.html#meta.reflection.define.aggregate">active issues</a> in [meta.reflection.define.aggregate].</p>
<p><b>View all other</b> <a href="lwg-index.html#meta.reflection.define.aggregate">issues</a> in [meta.reflection.define.aggregate].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<b>Addresses <a href="https://github.com/cplusplus/nbballot/issues/757">US 125-188</a></b>
<p>
The <code class='backtick'>meta::define_aggregate</code> function doesn't say what happens if <i>C</i>
does not represent a class type.
</p>
<p>It's also unclear whether it should work
with aliases to class types, e.g.
<pre>struct S; using A = S; ... meta::define_aggregate(^^A, {});</pre>
</p>
<p>
And what happens if you try to define a cv-qualified type:
<pre>struct S; meta::define_aggregate(^^const S, {});</pre>
Should this be an error, or inject a definition of the unqualified type?
</p>

<p><i>[2025-10-23; Reflector poll.]</i></p>

<p>
Set priority to 1 after reflector poll.
</p>

<p><i>[Kona 2025-11-03; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>


<p><strong>Previous resolution [SUPERSEDED]:</strong></p>
<blockquote class="note">

	
<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<ol>

<li><p>Modify 21.4.16 <a href="https://wg21.link/meta.reflection.define.aggregate">[meta.reflection.define.aggregate]</a> as indicated:</p>

<blockquote>
<p>-7-
Let <i>C</i> be the class represented by 
<code><ins>dealias(</ins>class_type<ins>)</ins></code>
and <i>r<sub>K</sub></i> be the <i>K</i><sup>th</sup> reflection value
in <code class='backtick'>mdescrs</code>.
For every <i>r<sub>K</sub></i> in <code class='backtick'>mdescrs</code>,
let (<i>T<sub>K</sub></i>, <i>N<sub>K</sub></i>, <i>A<sub>K</sub></i>,
<i>W<sub>K</sub></i>, <i>NUA<sub>K</sub></i>)
be the corresponding data member description represented by
<i>r<sub>K</sub></i>.
</p>
<p>-8- <i>Constant when</i>:
<ul style="list-style-type: none">
<li><ins>(8.?) &mdash;
<code class='backtick'>dealias(class_type)</code> represents a class type;
</ins>
</li>
<li>(8.1) &mdash;
<i>C</i> is incomplete from every point in the evaluation context;
</li>
</ul>
</p>
</blockquote>
</li>
</ol>
</blockquote>

<p><i>[2025-10-24; LWG telecon. Jonathan updates wording]</i></p>

<p>Make a minimal change for now, can add support for aliases later.</p>



<p id="res-4424"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<ol>

<li><p>Modify 21.4.16 <a href="https://wg21.link/meta.reflection.define.aggregate">[meta.reflection.define.aggregate]</a> as indicated:</p>

<blockquote>
<p>-7-
Let <i>C</i> be the <del>class</del> <ins>type</ins> represented by
<code>class_type</code>
and <i>r<sub>K</sub></i> be the <i>K</i><sup>th</sup> reflection value
in <code class='backtick'>mdescrs</code>.
For every <i>r<sub>K</sub></i> in <code class='backtick'>mdescrs</code>,
let (<i>T<sub>K</sub></i>, <i>N<sub>K</sub></i>, <i>A<sub>K</sub></i>,
<i>W<sub>K</sub></i>, <i>NUA<sub>K</sub></i>)
be the corresponding data member description represented by
<i>r<sub>K</sub></i>.
</p>
<p>-8- <i>Constant when</i>:
<ul style="list-style-type: none">
<li><ins>(8.?) &mdash;
<code class='backtick'>class_type</code> represents a cv-unqualified class type;
</ins>
</li>
<li>(8.1) &mdash;
<i>C</i> is incomplete from every point in the evaluation context;
</li>
</ul>
</p>
</blockquote>
</li>
</ol>





<hr>
<h3 id="4427"><a href="#4427">4427</a><sup><a href="https://cplusplus.github.io/LWG/issue4427">(i)</a></sup>. <code class='backtick'>meta::dealias</code> needs to work with things that aren't entities</h3>
<p><b>Section:</b> 21.4.7 <a href="https://wg21.link/meta.reflection.queries">[meta.reflection.queries]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Jonathan Wakely <b>Opened:</b> 2025-10-24 <b>Last modified:</b> 2025-11-04</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View other</b> <a href="lwg-index-open.html#meta.reflection.queries">active issues</a> in [meta.reflection.queries].</p>
<p><b>View all other</b> <a href="lwg-index.html#meta.reflection.queries">issues</a> in [meta.reflection.queries].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<b>Addresses US 99-205</b>
<p>
Several uses of <code class='backtick'>dealias</code> assume that it can be used with reflections that
represent direct base class relationships, which are not entities.
The spec for <code class='backtick'>dealias</code> says that such uses should fail with an exception.
</p>
<p>
In the 2025-10-24 LWG telecon it was agreed that <code class='backtick'>dealias</code> should just
be the identity function for non-entities.
</p>

<p><i>[Kona 2025-11-03; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>



<p id="res-4427"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<ol>

<li><p>Modify 21.4.7 <a href="https://wg21.link/meta.reflection.queries">[meta.reflection.queries]</a> as indicated:</p>

<blockquote>
<pre>consteval info dealias(info r);</pre>
<blockquote>
<p>-49- <i>Returns</i>:
<ins>If <code class='backtick'>r</code> represents an entity, then a</ins>
<del>A</del>
reflection representing the underlying entity of what <code class='backtick'>r</code> represents.
<ins>Otherwise, <code class='backtick'>r</code>.</ins>
</p>
<p>[<i>Example 5</i>: <br/>
... <br/>
<i>&mdash; end example</i>]
</p>
<p><del>-50- <i>Throws</i>:
<code class='backtick'>meta::exception</code> unless <code class='backtick'>r</code> represents an entity.
</del>
</p>
</blockquote>
</blockquote>
</li>
</ol>






<hr>
<h3 id="4429"><a href="#4429">4429</a><sup><a href="https://cplusplus.github.io/LWG/issue4429">(i)</a></sup>. <code>meta::alignment_of</code> should exclude data member description of bit-field</h3>
<p><b>Section:</b> 21.4.11 <a href="https://wg21.link/meta.reflection.layout">[meta.reflection.layout]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Tomasz Kamiński <b>Opened:</b> 2025-10-24 <b>Last modified:</b> 2025-11-04</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<b>Addresses <a href="https://github.com/cplusplus/nbballot/issues/988">US 109-170</a></b>
<p>
21.4.11 <a href="https://wg21.link/meta.reflection.layout">[meta.reflection.layout]</a> p#8
This should similarly disallow data member descriptions of bit-fields.
</p>
<p><i>[Kona 2025-11-03; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>



<p id="res-4429"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<ol>

<li><p>Modify 21.4.11 <a href="https://wg21.link/meta.reflection.layout">[meta.reflection.layout]</a> as indicated:</p>

<pre>
consteval size_t alignment_of(info r);	
</pre>
<blockquote>
<p>-7- <i>Returns</i>: [&hellip;]
</p>
<p>-8- <i>Throws</i>: <code class='backtick'>meta::exception</code> unless all of the following conditions are met:
<ul style="list-style-type: none">
<li>(8.1) &mdash;
<code class='backtick'>dealias(r)</code> is a reflection of a type, object, variable of non-reference type,
non-static data member that is not a bit-field, direct base class relationship,
or data member description <ins><i>(T,N,A,W,NUA)</i> (11.4.1 <a href="https://wg21.link/class.mem.general">[class.mem.general]</a>)
where <i>W</i> is ⊥.</ins>.
</li>
<li>(8.2) &mdash;
If <code class='backtick'>dealias(r)</code> represents a type, then <code class='backtick'>is_complete_type(r)</code> is true.
</li>
</ul>
</p>
</blockquote>
</li>
</ol>






<hr>
<h3 id="4432"><a href="#4432">4432</a><sup><a href="https://cplusplus.github.io/LWG/issue4432">(i)</a></sup>. Clarify element initialization for <code>meta::reflect_constant_array</code></h3>
<p><b>Section:</b> 21.4.3 <a href="https://wg21.link/meta.define.static">[meta.define.static]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Tomasz Kamiński <b>Opened:</b> 2025-10-27 <b>Last modified:</b> 2025-11-04</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<b>Addresses <a href="https://github.com/cplusplus/nbballot/issues/750">US 120-181</a> and <a href="https://github.com/cplusplus/nbballot/issues/751">US 121-182</a></b>
<p>
21.4.15 <a href="https://wg21.link/meta.reflection.array">[meta.reflection.array]</a> p10 Clarify <i>e<sub>i</sub></i> type.
It is not clear what <i>e<sub>i</sub></i> is when proxy references are involved.
</p>
<p>
21.4.15 <a href="https://wg21.link/meta.reflection.array">[meta.reflection.array]</a> Clarify copy-initialization vs. direct-initialization use
The initialization of <code>P</code> uses copy-initialization but the Mandates clause uses direct-initialization.
</p>

<p><strong>Previous resolution [SUPERSEDED]:</strong></p>
<blockquote class="note">

<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<ol>

<li><p>Modify 21.4.3 <a href="https://wg21.link/meta.define.static">[meta.define.static]</a> as indicated:</p>

<pre>
template&lt;ranges::input_range R&gt;
  consteval info reflect_constant_array(R&amp;&amp; r);
</pre>
<blockquote>
<p>-8- Let <code>T</code> be <code>ranges::range_value_t&lt;R&gt;</code>.</p>
<p>-9- <i>Mandates</i>:
  <code>T</code> is a structural type (13.2 <a href="https://wg21.link/temp.param">[temp.param]</a>),
  <code>is_constructible_v&lt;T, ranges::range_reference_t&lt;R&gt;&gt;</code> is <code>true</code>, and
  <del><code>is_copy_constructible_v&lt;T&gt;</code> is <code>true</code></del>
  <ins><code>T</code> satisfies <code>copy_constructible</code></ins>.</p>
<p>-10- Let <code>V</code> be the pack of values of type info of the same size as <code>r</code>,
where the <i>i<sup>th</sup></i> element is
<code>reflect_constant(<del><i>e<sub>i</sub></i></del><ins>static_cast&lt;T&gt;(*<i>it<sub>i</sub></i>)</ins>)</code>,
where <i><del>e<sub>i</sub></del><ins>it<sub>i</sub></ins></i> is <ins>an iterator to</ins> the <i>i<sup>th</sup></i> element of <code>r</code>.
</p>
<p>[&hellip;]</p>
</blockquote>
</li>
</ol>

</blockquote>

<p><i>[Kona 2025-11-04; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>



<p id="res-4432"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<ol>

<li><p>Modify 21.4.3 <a href="https://wg21.link/meta.define.static">[meta.define.static]</a> as indicated:</p>

<pre>
template&lt;ranges::input_range R&gt;
  consteval info reflect_constant_array(R&amp;&amp; r);
</pre>
<blockquote>
<p>-8- Let <code>T</code> be <code>ranges::range_value_t&lt;R&gt;</code>
<ins>and <i>e<sub>i</sub></i> be <code>static_cast&lt;T&gt;(*<i>it<sub>i</sub></i>)</code>,
where <i>it<sub>i</sub></i> is an iterator to the <i>i<sup>th</sup></i> element of <code class='backtick'>r</code></ins>.
</p>
<p>-9- <i>Mandates</i>:
  <code>T</code> is a structural type (13.2 <a href="https://wg21.link/temp.param">[temp.param]</a>),
  <code>is_constructible_v&lt;T, ranges::range_reference_t&lt;R&gt;&gt;</code> is <code>true</code>, and
  <del><code>is_copy_constructible_v&lt;T&gt;</code> is <code>true</code></del>
  <ins><code>T</code> satisfies <code>copy_constructible</code></ins>.</p>
<p>-10- Let <code>V</code> be the pack of values of type <code class='backtick'>info</code> of the same size as <code>r</code>,
where the <i>i<sup>th</sup></i> element is <code>reflect_constant(<i>e<sub>i</sub></i>)</code><del>,
where <i>e<sub>i</sub></i> is an iterator to the <i>i<sup>th</sup></i> element of <code>r</code></del>.
</p>
<p>[&hellip;]</p>
<p>-13- Throws: <ins>Any exception thrown by the evaluation of any <i>e<sub>i</sub></i>, or</ins>
<code class='backtick'>meta::exception</code> <del>unless</del><ins>if evaluation of any</ins> <code>reflect_constant(<del>e</del><ins><i>e<sub>i</sub></i></ins>)</code>
<ins>would exit via an exception</ins>
<del>is a constant subexpression for every element <code class='backtick'>e</code> of <code class='backtick'>r</code></del>.</p>
</blockquote>
</li>
</ol>








<hr>
<h3 id="4433"><a href="#4433">4433</a><sup><a href="https://cplusplus.github.io/LWG/issue4433">(i)</a></sup>. Incorrect query for C language linkage</h3>
<p><b>Section:</b> 21.4.7 <a href="https://wg21.link/meta.reflection.queries">[meta.reflection.queries]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Tomasz Kamiński <b>Opened:</b> 2025-10-27 <b>Last modified:</b> 2025-11-04</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View other</b> <a href="lwg-index-open.html#meta.reflection.queries">active issues</a> in [meta.reflection.queries].</p>
<p><b>View all other</b> <a href="lwg-index.html#meta.reflection.queries">issues</a> in [meta.reflection.queries].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<b>Addresses US <a href="https://github.com/cplusplus/nbballot/issues/772">97-203</a></b>
<p>
21.4.7 <a href="https://wg21.link/meta.reflection.queries">[meta.reflection.queries]</a>
Language linkage is a property of functions, variables, and function types (6.7 <a href="https://wg21.link/basic.link">[basic.link]</a>),
not of names.
</p>
<p><i>[
The wording below contains a drive-by fix for a misapplication of <a href="https://wg21.link/P2996R13" title=" Reflection for C++26">P2996R13</a>
]</i></p>


<p><i>[Kona 2025-11-04; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>



<p id="res-4433"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<ol>

<li><p>Modify 21.4.7 <a href="https://wg21.link/meta.reflection.queries">[meta.reflection.queries]</a> as indicated:</p>

<pre>
consteval bool has_internal_linkage(info r);
consteval bool has_module_linkage(info r);
consteval bool has_external_linkage(info r);
<del>consteval bool has_c_language_linkage(info r);</del>
consteval bool has_linkage(info r);
</pre>
<blockquote>
<p>-25- <i>Returns</i>: <code class='backtick'>true</code> if <code class='backtick'>r</code> represents a variable, function, type, template, or namespace
whose name has internal linkage, module linkage, <del>C language</del><ins>external</ins> linkage, or any linkage,
respectively (6.7 <a href="https://wg21.link/basic.link">[basic.link]</a>). Otherwise, <code class='backtick'>false</code>.</p>
</blockquote>

<pre>
<ins>consteval bool has_c_language_linkage(info r);</ins>
</pre>
<blockquote>
<p><ins>-??- <i>Returns</i>: <code class='backtick'>true</code> if <code class='backtick'>r</code> represents a variable, function, or function type with C language
linkage. Otherwise, <code class='backtick'>false</code>.</ins></p>
</blockquote>

</li>
</ol>






<hr>
<h3 id="4438"><a href="#4438">4438</a><sup><a href="https://cplusplus.github.io/LWG/issue4438">(i)</a></sup>. Bad expression in [exec.when.all]</h3>
<p><b>Section:</b> 33.9.12.12 <a href="https://wg21.link/exec.when.all">[exec.when.all]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Eric Niebler <b>Opened:</b> 2025-10-30 <b>Last modified:</b> 2025-11-06</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all other</b> <a href="lwg-index.html#exec.when.all">issues</a> in [exec.when.all].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<b>
Addresses <a href="https://github.com/cplusplus/nbballot/issues/919">US 220-344</a>
and <a href="https://github.com/cplusplus/nbballot/issues/917">US 224-342</a>
</b>
<p>
33.9.12.12 <a href="https://wg21.link/exec.when.all">[exec.when.all]</a> p5 reads as follows:
</p>
<blockquote style="border-left: 3px solid #ccc;padding-left: 15px;">
<p>
-5- Let <code><i>make-when-all-env</i></code> be the following exposition-only function template:
</p>
<blockquote>
<pre>
template&lt;class Env&gt;
  constexpr auto <i>make-when-all-env</i>(inplace_stop_source&amp; stop_src,        <i>// exposition only</i>
                                   Env&amp;&amp; env) noexcept {
  return <i>see below</i>;
}
</pre>
</blockquote>
<p>
Returns an object <code class='backtick'>e</code> such that
</p>
<ul style="list-style-type: none">
<li>(5.1) &mdash; <code class='backtick'>decltype(e)</code> models <code><i>queryable</i></code>, and
</li>
<li>(5.2) &mdash; <code class='backtick'>e.query(get_stop_token)</code> is expression-equivalent to <code>state.<i>stop-src</i>.get_token()</code>, 
and
</li>
<li>(5.3) &mdash; given a query object <code class='backtick'>q</code> with type other than <i>cv</i> <code class='backtick'>stop_token_t</code> and whose type 
satisfies <code><i>forwarding-query</i></code>, <code class='backtick'>e.query(q)</code> is expression-equivalent to <code class='backtick'>get_env(rcvr).query(q)</code>.
</li>
</ul>

</blockquote>
<p>
The problem is with "<code>state.<i>stop-src</i>.get_token()</code>" in bullet (5.2). There is no <code class='backtick'>state</code> 
object here. This expression should be <code class='backtick'>stop_src.get_token()</code>.
</p>

<p><i>[Kona 2025-11-04; add edits to address NB comments.]</i></p>


<p><i>[Kona 2025-11-06; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>



<p id="res-4438"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<ol>

<li><p>Modify 33.9.12.12 <a href="https://wg21.link/exec.when.all">[exec.when.all]</a> as indicated:</p>

<blockquote>
<p>
-5- Let <code><i>make-when-all-env</i></code> be the following exposition-only function template:
</p>
<blockquote>
<pre>
template&lt;class Env&gt;
  constexpr auto <i>make-when-all-env</i>(inplace_stop_source&amp; stop_src,        <i>// exposition only</i>
                                   Env&amp;&amp; env) noexcept<ins>;</ins><del> {
  return <i>see below</i>;
}</del>
</pre>
</blockquote>
<p>
<ins>-?- <i>Returns</i>: An</ins>
<del>Returns and</del> object <code class='backtick'>e</code> such that
</p>
<ul style="list-style-type: none">
<li>(5.1) &mdash; <code class='backtick'>decltype(e)</code> models <code><i>queryable</i></code>, and
</li>
<li>(5.2) &mdash; <code class='backtick'>e.query(get_stop_token)</code> is expression-equivalent to <code><del>state.<i>stop-src</i></del><ins>stop_src</ins>.get_token()</code>, 
and
</li>
<li>(5.3) &mdash;
given a query object <code class='backtick'>q</code> with type other than <i>cv</i> <code class='backtick'>get_stop_token_t</code>
<del>and whose type satisfies <code><i>forwarding-query</i></code></del>,
<code class='backtick'>e.query(q)</code> is expression-equivalent to <del><code class='backtick'>get_env(rcvr)</code></del><ins><code class='backtick'>env</code></ins><code class='backtick'>.query(q)</code>
<ins>if the type of <code class='backtick'>q</code> satisfies <i><code class='backtick'>forwarding-query</code></i>, and ill-formed otherwise</ins>.
</li>

</ul>
</blockquote>
</li>
</ol>






<hr>
<h3 id="4440"><a href="#4440">4440</a><sup><a href="https://cplusplus.github.io/LWG/issue4440">(i)</a></sup>. Forward declarations of entities need also in entries</h3>
<p><b>Section:</b> 17.3.2 <a href="https://wg21.link/version.syn">[version.syn]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Tomasz Kamiński <b>Opened:</b> 2025-11-03 <b>Last modified:</b> 2025-11-04</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View other</b> <a href="lwg-index-open.html#version.syn">active issues</a> in [version.syn].</p>
<p><b>View all other</b> <a href="lwg-index.html#version.syn">issues</a> in [version.syn].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<b>Addresses US 65-116</b>
<p>
There are forward declarations of entities from <code>&lt;spanstream&gt;</code> and
<code>&lt;syncstream&gt;</code> in <code>&lt;iosfwd&gt;</code> so their feature macros
should be added to that header too. Proposed change: Add <code>&lt;iosfwd&gt;</code>
to the "also in" entries for <code class='backtick'>__cpp_lib_char8_t</code>, <code class='backtick'>__cpp_lib_spanstream</code>, and
<code class='backtick'>__cpp_lib_syncbuf</code>.
</p>

<p><i>[Kona 2025-11-04; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>



<p id="res-4440"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<ol>

<li><p>Modify 17.3.2 <a href="https://wg21.link/version.syn">[version.syn]</a> as indicated:</p>

<blockquote>
<pre>
#define __cpp_lib_char8_t                           201907L
  // freestanding, also in &lt;atomic&gt;, &lt;filesystem&gt;, <ins>&lt;iosfwd&gt;,</ins> &lt;istream&gt;, &lt;limits&gt;, &lt;locale&gt;, &lt;ostream&gt;, &lt;string&gt;,
  // &lt;string_view&gt;
[&hellip;]
#define __cpp_lib_spanstream                        202106L // also in <ins>&lt;iosfwd&gt;,</ins> &lt;spanstream&gt;
[&hellip;]
#define __cpp_lib_syncbuf                           201803L // also in <ins>&lt;iosfwd&gt;,</ins> &lt;syncstream&gt;
</pre>
</blockquote>
</li>

</ol>






<hr>
<h3 id="4441"><a href="#4441">4441</a><sup><a href="https://cplusplus.github.io/LWG/issue4441">(i)</a></sup>. <code>ranges::rotate</code> do not handle sized-but-not-sized-sentinel ranges correctly</h3>
<p><b>Section:</b> 26.7.11 <a href="https://wg21.link/alg.rotate">[alg.rotate]</a>, 26.8.2.3 <a href="https://wg21.link/partial.sort">[partial.sort]</a>, 26.8.3 <a href="https://wg21.link/alg.nth.element">[alg.nth.element]</a>, 26.8.6 <a href="https://wg21.link/alg.merge">[alg.merge]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Tomasz Kamiński <b>Opened:</b> 2025-11-03 <b>Last modified:</b> 2025-11-04</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all other</b> <a href="lwg-index.html#alg.rotate">issues</a> in [alg.rotate].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<b>Addresses US 161-258</b>
<p>These do not handle sized-but-not-sized-sentinel ranges correctly.</p>

<p><i>[Kona 2025-11-03; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>



<p id="res-4441"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<ol>

<li><p>Modify 26.7.11 <a href="https://wg21.link/alg.rotate">[alg.rotate]</a> as indicated:</p>

<pre>
template&lt;execution-policy Ep, <i>sized-random-access-range</i> R&gt;
  requires permutable&lt;iterator_t&lt;R&gt;&gt;
  borrowed_subrange_t&lt;R&gt; ranges::rotate(Ep&amp;&amp; exec, R&amp;&amp; r, iterator_t&lt;R&gt; middle);

</pre>
<blockquote>
<p>-6- <i>Effects</i> Equivalent to:
<code>return ranges::rotate(std::forward&lt;Ep&gt;(exec), ranges::begin(r), middle,
<del>ranges::end(r)</del><ins>ranges::begin(r) + ranges::distance(r)</ins>);</code>
</p>
</blockquote>

[&hellip;]

<pre>
template&lt;execution-policy Ep, <i>sized-random-access-range</i> R, <i>sized-random-access-range</i> OutR&gt;
  requires indirectly_copyable&lt;iterator_t&lt;R&gt;, iterator_t&lt;OutR&gt;&gt;
  ranges::rotate_copy_truncated_result&lt;borrowed_iterator_t&lt;R&gt;, borrowed_iterator_t&lt;OutR&gt;&gt;
	  ranges::rotate_copy(Ep&amp;&amp; exec, R&amp;&amp; r, iterator_t&lt;R&gt; middle, OutR&amp;&amp; result_r);
</pre>
<blockquote>
<p>-18- <i>Effects</i> Equivalent to:
<code>return ranges::rotate(std::forward&lt;Ep&gt;(exec), ranges::begin(r), middle,
<del>ranges::end(r)</del><ins>ranges::begin(r) + ranges::distance(r)</ins>,
ranges::begin(result_r), <del>ranges::end(result_r)</del><ins>ranges::begin(result_r) + ranges::distance(result_r)</ins>);</code>
</p>
</blockquote>

</li>

<li><p>Modify 26.8.2.3 <a href="https://wg21.link/partial.sort">[partial.sort]</a> as indicated:</p>

<pre>
template&lt;execution-policy Ep, <i>sized-random-access-range</i> R,
         class Comp = ranges::less, class Proj = identity&gt;
  requires sortable&lt;iterator_t&lt;R&gt;, Comp, Proj&gt;
  borrowed_iterator_t&lt;R&gt;
    ranges::partial_sort(Ep&amp;&amp; exec, R&amp;&amp; r, iterator_t&lt;R&gt; middle, Comp comp = {},
                         Proj proj = {});
</pre>
<blockquote>
<p>-7- <i>Effects</i> Equivalent to:
<code>return ranges::partial_sort(std::forward&lt;Ep&gt;(exec), ranges::begin(r), middle,
<del>ranges::end(r)</del><ins>ranges::begin(r) + ranges::distance(r)</ins>, comp, proj);</code>
</p>
</blockquote>

</li>

<li><p>Modify 26.8.3 <a href="https://wg21.link/alg.nth.element">[alg.nth.element]</a> as indicated:</p>

<pre>
template&lt;execution-policy Ep, <i>sized-random-access-range</i> R, class Comp = ranges::less,
         class Proj = identity&gt;
  requires sortable&lt;iterator_t&lt;R&gt;, Comp, Proj&gt;
  borrowed_iterator_t&lt;R&gt;
    ranges::nth_element(Ep&amp;&amp; exec, R&amp;&amp; r, iterator_t&lt;R&gt; nth, Comp comp = {}, Proj proj = {});
</pre>
<blockquote>
<p>-7- <i>Effects</i> Equivalent to:
<code>return ranges::nth_element(std::forward&lt;Ep&gt;(exec), ranges::begin(r), nth,
<del>ranges::end(r)</del><ins>ranges::begin(r) + ranges::distance(r)</ins>, comp, proj);</code>
</p>
</blockquote>

</li>

<li><p>Modify 26.8.6 <a href="https://wg21.link/alg.merge">[alg.merge]</a> as indicated:</p>

<pre>
template&lt;execution-policy Ep, <i>sized-random-access-range</i> R, class Comp = ranges::less,
         class Proj = identity&gt;
  requires sortable&lt;iterator_t&lt;R&gt;, Comp, Proj&gt;
  borrowed_iterator_t&lt;R&gt;
    ranges::inplace_merge(Ep&amp;&amp; exec, R&amp;&amp; r, iterator_t&lt;R&gt; middle, Comp comp = {},
                          Proj proj = {});
</pre>
<blockquote>
<p>-14- <i>Effects</i> Equivalent to:
<code>return ranges::inplace_merge(std::forward&lt;Ep&gt;(exec), ranges::begin(r), middle,
<del>ranges::end(r)</del><ins>ranges::begin(r) + ranges::distance(r)</ins>, comp, proj);</code>
</p>
</blockquote>

</li>


</ol>






<hr>
<h3 id="4442"><a href="#4442">4442</a><sup><a href="https://cplusplus.github.io/LWG/issue4442">(i)</a></sup>. Clarify <code class='backtick'>expr</code> and <code class='backtick'>fn</code> for <code class='backtick'>meta::reflect_object</code> and <code class='backtick'>meta::reflect_function</code></h3>
<p><b>Section:</b> 21.4.14 <a href="https://wg21.link/meta.reflection.result">[meta.reflection.result]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Tomasz Kamiński <b>Opened:</b> 2025-11-04 <b>Last modified:</b> 2025-11-04</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<b>Addresses <a href="https://github.com/cplusplus/nbballot/issues/748">US 118-179</a></b>
<p>This should talk about the object/function designated by <code class='backtick'>expr</code>/<code class='backtick'>fn</code>, rather than <code class='backtick'>expr</code>/<code class='backtick'>fn</code>.</p>

<p><i>[Kona 2025-11-04; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>



<p id="res-4442"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<ol>

<li><p>Modify 21.4.14 <a href="https://wg21.link/meta.reflection.result">[meta.reflection.result]</a> as indicated:</p>

<pre>
template&lt;class T&gt;
  consteval info reflect_object(T&amp; expr);
</pre>
<blockquote>
<p>-7- <i>Mandates</i>: <code class='backtick'>T</code> is an object type.</p>
<p>-8- <i>Returns</i>: A reflection of the object designated by <code class='backtick'>expr</code>.</p>
<p>-9- <i>Throws</i>: <code class='backtick'>meta::exception</code>
<del>unless <code class='backtick'>expr</code> is</del>
<ins>if <code class='backtick'>E</code> is not</ins>
suitable for use as a constant template argument
for a constant template parameter of type <code>T&amp;</code> (13.4.3 <a href="https://wg21.link/temp.arg.nontype">[temp.arg.nontype]</a>)
<ins>, where <code class='backtick'>E</code> is an lvalue constant expression that computes the object that <code class='backtick'>expr</code> refers to</ins>.</p>
</blockquote>

<pre>
template&lt;class T&gt;
  consteval info reflect_function(T&amp; fn);
</pre>
<blockquote>
<p>-10- <i>Mandates</i>: <code class='backtick'>T</code> is an function type.</p>
<p>-11- <i>Returns</i>: A reflection of the function designated by <code class='backtick'>fn</code>.</p>
<p>-12- <i>Throws</i>: <code class='backtick'>meta::exception</code>
<del>unless <code class='backtick'>fn</code> is</del>
<ins>if <code class='backtick'>F</code> is not</ins>
suitable for use as a constant template argument
for a constant template parameter of type <code>T&amp;</code> (13.4.3 <a href="https://wg21.link/temp.arg.nontype">[temp.arg.nontype]</a>)
<ins>, where <code class='backtick'>F</code> is an lvalue constant expression that computes the function that <code class='backtick'>fn</code> refers to</ins>.</p>
</blockquote>

</li>

</ol>






<hr>
<h3 id="4443"><a href="#4443">4443</a><sup><a href="https://cplusplus.github.io/LWG/issue4443">(i)</a></sup>. Clean up identifier comparisons in <code class='backtick'>meta::define_aggregate</code></h3>
<p><b>Section:</b> 21.4.16 <a href="https://wg21.link/meta.reflection.define.aggregate">[meta.reflection.define.aggregate]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Tomasz Kamiński <b>Opened:</b> 2025-11-04 <b>Last modified:</b> 2025-11-04</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View other</b> <a href="lwg-index-open.html#meta.reflection.define.aggregate">active issues</a> in [meta.reflection.define.aggregate].</p>
<p><b>View all other</b> <a href="lwg-index.html#meta.reflection.define.aggregate">issues</a> in [meta.reflection.define.aggregate].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<b>Addresses <a href="https://github.com/cplusplus/nbballot/issues/759">US 127-190</a></b>
<p><i>N<sub>K</sub></i> is defined as an identifier (see 11.4.1) and should not be compared with
code or with string literals in bullet 8.4. Similarly, 9.5.1 should not talk about
“character sequence encoded by <i>N<sub>K</sub></i>”</p>

<p><i>[Kona 2025-11-04; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>



<p id="res-4443"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<ol>

<li><p>Modify 21.4.16 <a href="https://wg21.link/meta.reflection.define.aggregate">[meta.reflection.define.aggregate]</a> as indicated:</p>

<pre>
template&lt;reflection_range R = initializer_list&lt;info&gt;&gt;
  consteval info define_aggregate(info class_type, R&amp;&amp; mdescrs);
</pre>
<blockquote>
<p>-7- [&hellip;]</p>
<p>-8- <i>Constant When</i>:<ul>
<li>-8.1- [&hellip;]</li>
<li>-8.2- [&hellip;]</li>
<li>-8.3- [&hellip;]</li>
<li>-8.4- for every pair (<i>r<sub>K</sub></i>, <i>r<sub>L</sub></i>) where
<i>K&lt;L</i>, if <i>N<sub>K</sub></i> is not ⊥ and N<sub>L</sub> is not ⊥, then either:
<ul>
  <li>-8.4.1- <del><i>N<sub>K</sub></i><code> != </code><i>N<sub>L</sub></i> is <code class='backtick'>true</code></del>
  <ins><i>N<sub>K</sub></i> is not the same identifier as <i>N<sub>L</sub></i></ins> or</li>
  <li>-8.4.2- <del><i>N<sub>K</sub></i><code> == u8"_" </code> is <code class='backtick'>true</code></del>
  <ins><i>N<sub>K</sub></i> is the identifier <code class='backtick'>_</code> (<span style="font-variant: small-caps">u+005f low line</span>)</ins>.
  </li>
</ul></li>
</ul></p>
<p>-9- <i>Effects</i>: Produces an injected declaration <i>D</i> (7.7 <a href="https://wg21.link/expr.const">[expr.const]</a>)
that defines <i>C</i> and has properties as follows: <ul>
<li>-9.1- [&hellip;]</li>
<li>-9.2- [&hellip;]</li>
<li>-9.3- [&hellip;]</li>
<li>-9.4- [&hellip;]</li>
<li>-9.5- for every <i>r<sub>K</sub></i>, there is corresponding entity <i>M<sub>K</sub></i>
belonging to the class scope of <i>D</i> with the following properties:
<i>K&lt;L</i>, if <i>N<sub>K</sub></i> is not ⊥ and N<sub>L</sub> is not ⊥, then either:
<ul>
  <li>-9.5.1- if <i>N<sub>K</sub></i> is ⊥, <i>M<sub>K</sub></i> is an unnamed bit-field.
  Otherwise, <i>M<sub>K</sub></i> is a non-static data member whose name is the identifier
  <del>determined by the character sequence encoded by</del> <i>N<sub>K</sub></i><del> in UTF-8</del>.</li>
  <li>-9.5.2- [&hellip;]</li>
  <li>-9.5.3- [&hellip;]</li>
  <li>-9.5.4- [&hellip;]</li>
  <li>-9.5.5- [&hellip;]</li>
</ul></li>
<li>-9.6- [&hellip;]</li>
</ul></p>
</blockquote>

</li>

</ol>






<hr>
<h3 id="4444"><a href="#4444">4444</a><sup><a href="https://cplusplus.github.io/LWG/issue4444">(i)</a></sup>. Fix default template arguments for <code class='backtick'>ranges::replace</code> and <code class='backtick'>ranges::replace_if</code></h3>
<p><b>Section:</b> 26.7.5 <a href="https://wg21.link/alg.replace">[alg.replace]</a>, 26.4 <a href="https://wg21.link/algorithm.syn">[algorithm.syn]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Tim Song <b>Opened:</b> 2025-11-04 <b>Last modified:</b> 2025-11-04</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View other</b> <a href="lwg-index-open.html#alg.replace">active issues</a> in [alg.replace].</p>
<p><b>View all other</b> <a href="lwg-index.html#alg.replace">issues</a> in [alg.replace].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<b>Addresses <a href="https://github.com/cplusplus/nbballot/issues/834">US 159-259</a></b>
<p>The default template argument for the type of the new value in 
<code class='backtick'>ranges::replace</code> and <code class='backtick'>ranges::replace_if</code> should not have projections applied.</p>

<p><i>[Kona 2025-11-04; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>



<p id="res-4444"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<ol>

<li><p>Modify 26.4 <a href="https://wg21.link/algorithm.syn">[algorithm.syn]</a>, header <code>&lt;algorithm&gt;</code> synopsis, as indicated:</p>

<blockquote>
<pre>
[&hellip;]
  namespace ranges {
    template&lt;input_iterator I, sentinel_for&lt;I&gt; S, class Proj = identity,
             class T1 = projected_value_t&lt;I, Proj&gt;, class T2 = <del>T1</del><ins>iter_value_t&lt;I&gt;</ins>&gt;
      requires indirectly_writable&lt;I, const T2&amp;&gt; &amp;&amp;
               indirect_binary_predicate&lt;ranges::equal_to, projected&lt;I, Proj&gt;, const T1*&gt;
      constexpr I
        replace(I first, S last, const T1&amp; old_value, const T2&amp; new_value, Proj proj = {});
    template&lt;input_range R, class Proj = identity,
             class T1 = projected_value_t&lt;iterator_t&lt;R&gt;, Proj&gt;, class T2 = <del>T1</del><ins>range_value_t&lt;R&gt;</ins>&gt;
      requires indirectly_writable&lt;iterator_t&lt;R&gt;, const T2&amp;&gt; &amp;&amp;
               indirect_binary_predicate&lt;ranges::equal_to,
                                         projected&lt;iterator_t&lt;R&gt;, Proj&gt;, const T1*&gt;
      constexpr borrowed_iterator_t&lt;R&gt;
        replace(R&amp;&amp; r, const T1&amp; old_value, const T2&amp; new_value, Proj proj = {});

    template&lt;<i>execution-policy</i> Ep, random_access_iterator I, sized_sentinel_for&lt;I&gt; S,
             class Proj = identity, class T1 = projected_value_t&lt;I, Proj&gt;, class T2 = <del>T1</del><ins>iter_value_t&lt;I&gt;</ins>&gt;
      requires indirectly_writable&lt;I, const T2&amp;&gt; &amp;&amp;
               indirect_binary_predicate&lt;ranges::equal_to, projected&lt;I, Proj&gt;, const T1*&gt;
      I replace(Ep&amp;&amp; exec, I first, S last,
                const T1&amp; old_value, const T2&amp; new_value, Proj proj = {});  // <i>freestanding-deleted</i>
    template&lt;<i>execution-policy</i> Ep, <i>sized-random-access-range</i> R, class Proj = identity,
             class T1 = projected_value_t&lt;iterator_t&lt;R&gt;, Proj&gt;, class T2 = <del>T1</del><ins>range_value_t&lt;R&gt;</ins>&gt;
      requires indirectly_writable&lt;iterator_t&lt;R&gt;, const T2&amp;&gt; &amp;&amp;
               indirect_binary_predicate&lt;ranges::equal_to,
                                         projected&lt;iterator_t&lt;R&gt;, Proj&gt;, const T1*&gt;
      borrowed_iterator_t&lt;R&gt;
        replace(Ep&amp;&amp; exec, R&amp;&amp; r, const T1&amp; old_value, const T2&amp; new_value,
                Proj proj = {});                                            // <i>freestanding-deleted</i>

    template&lt;input_iterator I, sentinel_for&lt;I&gt; S, class Proj = identity,
             class T = <del>projected</del><ins>iter</ins>_value_t&lt;I<del>, Proj</del>&gt;,
             indirect_unary_predicate&lt;projected&lt;I, Proj&gt;&gt; Pred&gt;
      requires indirectly_writable&lt;I, const T&amp;&gt;
      constexpr I replace_if(I first, S last, Pred pred, const T&amp; new_value, Proj proj = {});
    template&lt;input_range R, class Proj = identity, class T = <del>projected_value_t&lt;I</del><ins>range_value_t&lt;R</ins><del>, Proj</del>&gt;,
             indirect_unary_predicate&lt;projected&lt;iterator_t&lt;R&gt;, Proj&gt;&gt; Pred&gt;
      requires indirectly_writable&lt;iterator_t&lt;R&gt;, const T&amp;&gt;
      constexpr borrowed_iterator_t&lt;R&gt;
        replace_if(R&amp;&amp; r, Pred pred, const T&amp; new_value, Proj proj = {});

    template&lt;<i>execution-policy</i> Ep, random_access_iterator I, sized_sentinel_for&lt;I&gt; S,
             class Proj = identity, class T = <del>projected</del><ins>iter</ins>_value_t&lt;I<del>, Proj</del>&gt;,
             indirect_unary_predicate&lt;projected&lt;I, Proj&gt;&gt; Pred&gt;
      requires indirectly_writable&lt;I, const T&amp;&gt;
      I replace_if(Ep&amp;&amp; exec, I first, S last, Pred pred,
                   const T&amp; new_value, Proj proj = {});         // <i>freestanding-deleted</i>
    template&lt;<i>execution-policy</i> Ep, <i>sized-random-access-range</i> R, class Proj = identity,
             class T = <del>projected_value_t&lt;iterator_t&lt;R&gt;</del><ins>range_value_t&lt;R</ins><del>, Proj</del>&gt;,
             indirect_unary_predicate&lt;projected&lt;iterator_t&lt;R&gt;, Proj&gt;&gt; Pred&gt;
      requires indirectly_writable&lt;iterator_t&lt;R&gt;, const T&amp;&gt;
      borrowed_iterator_t&lt;R&gt;
        replace_if(Ep&amp;&amp; exec, R&amp;&amp; r, Pred pred, const T&amp; new_value,
                   Proj proj = {});                             // <i>freestanding-deleted</i>
  }
[&hellip;]
</pre>
</blockquote>
</li>
<li><p>Modify 26.7.5 <a href="https://wg21.link/alg.replace">[alg.replace]</a> as indicated:</p>

<blockquote>
<pre>
[&hellip;]
template&lt;input_iterator I, sentinel_for&lt;I&gt; S, class Proj = identity,
         class T1 = projected_value_t&lt;I, Proj&gt;, class T2 = <del>T1</del><ins>iter_value_t&lt;I&gt;</ins>&gt;
  requires indirectly_writable&lt;I, const T2&amp;&gt; &amp;&amp;
           indirect_binary_predicate&lt;ranges::equal_to, projected&lt;I, Proj&gt;, const T1*&gt;
  constexpr I
    ranges::replace(I first, S last, const T1&amp; old_value, const T2&amp; new_value, Proj proj = {});
template&lt;input_range R, class Proj = identity,
         class T1 = projected_value_t&lt;iterator_t&lt;R&gt;, Proj&gt;, class T2 = <del>T1</del><ins>range_value_t&lt;R&gt;</ins>&gt;
  requires indirectly_writable&lt;iterator_t&lt;R&gt;, const T2&amp;&gt; &amp;&amp;
           indirect_binary_predicate&lt;ranges::equal_to,
                                     projected&lt;iterator_t&lt;R&gt;, Proj&gt;, const T1*&gt;
  constexpr borrowed_iterator_t&lt;R&gt;
    ranges::replace(R&amp;&amp; r, const T1&amp; old_value, const T2&amp; new_value, Proj proj = {});

template&lt;<i>execution-policy</i> Ep, random_access_iterator I, sized_sentinel_for&lt;I&gt; S,
         class Proj = identity, class T1 = projected_value_t&lt;I, Proj&gt;, class T2 = <del>T1</del><ins>iter_value_t&lt;I&gt;</ins>&gt;
  requires indirectly_writable&lt;I, const T2&amp;&gt; &amp;&amp;
           indirect_binary_predicate&lt;ranges::equal_to, projected&lt;I, Proj&gt;, const T1*&gt;
  I ranges::replace(Ep&amp;&amp; exec, I first, S last,
                    const T1&amp; old_value, const T2&amp; new_value, Proj proj = {});
template&lt;<i>execution-policy</i> Ep, <i>sized-random-access-range</i> R, class Proj = identity,
         class T1 = projected_value_t&lt;iterator_t&lt;R&gt;, Proj&gt;, class T2 = <del>T1</del><ins>range_value_t&lt;R&gt;</ins>&gt;
  requires indirectly_writable&lt;iterator_t&lt;R&gt;, const T2&amp;&gt; &amp;&amp;
           indirect_binary_predicate&lt;ranges::equal_to,
                                     projected&lt;iterator_t&lt;R&gt;, Proj&gt;, const T1*&gt;
  borrowed_iterator_t&lt;R&gt;
    ranges::replace(Ep&amp;&amp; exec, R&amp;&amp; r, const T1&amp; old_value, const T2&amp; new_value,
                    Proj proj = {});

template&lt;input_iterator I, sentinel_for&lt;I&gt; S, class Proj = identity,
         class T = <del>projected</del><ins>iter</ins>_value_t&lt;I<del>, Proj</del>&gt;,
         indirect_unary_predicate&lt;projected&lt;I, Proj&gt;&gt; Pred&gt;
  requires indirectly_writable&lt;I, const T&amp;&gt;
  constexpr I ranges::replace_if(I first, S last, Pred pred, const T&amp; new_value, Proj proj = {});
template&lt;input_range R, class Proj = identity, class T = <del>projected_value_t&lt;I</del><ins>range_value_t&lt;R</ins><del>, Proj</del>&gt;,
         indirect_unary_predicate&lt;projected&lt;iterator_t&lt;R&gt;, Proj&gt;&gt; Pred&gt;
  requires indirectly_writable&lt;iterator_t&lt;R&gt;, const T&amp;&gt;
  constexpr borrowed_iterator_t&lt;R&gt;
    ranges::replace_if(R&amp;&amp; r, Pred pred, const T&amp; new_value, Proj proj = {});

template&lt;<i>execution-policy</i> Ep, random_access_iterator I, sized_sentinel_for&lt;I&gt; S,
         class Proj = identity, class T = <del>projected</del><ins>iter</ins>_value_t&lt;I<del>, Proj</del>&gt;,
         indirect_unary_predicate&lt;projected&lt;I, Proj&gt;&gt; Pred&gt;
  requires indirectly_writable&lt;I, const T&amp;&gt;
  I ranges::replace_if(Ep&amp;&amp; exec, I first, S last, Pred pred,
                       const T&amp; new_value, Proj proj = {});
template&lt;<i>execution-policy</i> Ep, <i>sized-random-access-range</i> R, class Proj = identity,
         class T = <del>projected_value_t&lt;iterator_t&lt;R&gt;</del><ins>range_value_t&lt;R</ins><del>, Proj</del>&gt;,
         indirect_unary_predicate&lt;projected&lt;iterator_t&lt;R&gt;, Proj&gt;&gt; Pred&gt;
  requires indirectly_writable&lt;iterator_t&lt;R&gt;, const T&amp;&gt;
  borrowed_iterator_t&lt;R&gt;
    ranges::replace_if(Ep&amp;&amp; exec, R&amp;&amp; r, Pred pred, const T&amp; new_value,
                       Proj proj = {});
</pre>
<blockquote>
<p>
-1- [&hellip;]
</p>
</blockquote>
</blockquote>
</li>
</ol>






<hr>
<h3 id="4445"><a href="#4445">4445</a><sup><a href="https://cplusplus.github.io/LWG/issue4445">(i)</a></sup>. <code class='backtick'>sch_</code> must not be in moved-from state</h3>
<p><b>Section:</b> 33.13.5 <a href="https://wg21.link/exec.task.scheduler">[exec.task.scheduler]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Tomasz Kamiński <b>Opened:</b> 2025-11-05 <b>Last modified:</b> 2025-11-05</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View other</b> <a href="lwg-index-open.html#exec.task.scheduler">active issues</a> in [exec.task.scheduler].</p>
<p><b>View all other</b> <a href="lwg-index.html#exec.task.scheduler">issues</a> in [exec.task.scheduler].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<b>Addresses <a href="https://github.com/cplusplus/nbballot/issues/942">US 239-367</a></b>
<p>As specified, there is an implicit precondition that <code class='backtick'>sch_</code> is not moved from on all the
member functions. If that is intended, the precondition should be made explicit.</p>

<p><i>[Kona 2025-11-05; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>



<p id="res-4445"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<ol>

<li><p>Modify 33.13.5 <a href="https://wg21.link/exec.task.scheduler">[exec.task.scheduler]</a> as indicated:</p>

<pre>
namespace std::execution {
  class task_scheduler {
    class <i>ts-sender</i>;                    // exposition only

    template&lt;receiver R&gt;
      class state;                      // exposition only

  public:
    using scheduler_concept = scheduler_t;

    template&lt;class Sch, class Allocator = allocator&lt;void&gt;&gt;
      requires (!same_as&lt;task_scheduler, remove_cvref_t&lt;Sch&gt;&gt;)
        &amp;&amp; scheduler&lt;Sch&gt;
    explicit task_scheduler(Sch&amp;&amp; sch, Allocator alloc = {});

    <ins>task_scheduler(const task_scheduler&amp;) = default;</ins>
    <ins>task_scheduler&amp; operator=(const task_scheduler&amp;) = default;</ins>

    <i>ts-sender</i> schedule();

    friend bool operator==(const task_scheduler&amp; lhs, const task_scheduler&amp; rhs)
        noexcept;
    template&lt;class Sch&gt;
      requires (!same_as&lt;task_scheduler, Sch&gt;)
      &amp;&amp; scheduler&lt;Sch&gt;
    friend bool operator==(const task_scheduler&amp; lhs, const Sch&amp; rhs) noexcept;

  private:
    shared_ptr&lt;void&gt; <i>sch_</i>; // exposition only
  };
}
</pre>
</li>
</ol>






<hr>
<h3 id="4446"><a href="#4446">4446</a><sup><a href="https://cplusplus.github.io/LWG/issue4446">(i)</a></sup>. Bad phrasing for <code><i>SCHED</i>(s)</code></h3>
<p><b>Section:</b> 33.13.5 <a href="https://wg21.link/exec.task.scheduler">[exec.task.scheduler]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Tomasz Kamiński <b>Opened:</b> 2025-11-05 <b>Last modified:</b> 2025-11-05</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View other</b> <a href="lwg-index-open.html#exec.task.scheduler">active issues</a> in [exec.task.scheduler].</p>
<p><b>View all other</b> <a href="lwg-index.html#exec.task.scheduler">issues</a> in [exec.task.scheduler].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<b>Addresses <a href="https://github.com/cplusplus/nbballot/issues/945">US 240-370</a></b>
<p><code class='backtick'>shared_ptr</code> owns a pointer (or <code class='backtick'>nullptr_t</code>), not the pointee, but <code><i>SCHED</i></code> wants the pointee.</p>

<p><i>[Kona 2025-11-05; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>



<p id="res-4446"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<ol>

<li><p>Modify 33.13.5 <a href="https://wg21.link/exec.task.scheduler">[exec.task.scheduler]</a> as indicated:</p>

<blockquote>
<p>
-1- <code class='backtick'>task_scheduler</code> is a class that models <code class='backtick'>scheduler</code> (33.6 <a href="https://wg21.link/exec.sched">[exec.sched]</a>).
Given an object <code class='backtick'>s</code> of type <code class='backtick'>task_scheduler</code>, let <code><i>SCHED</i></code> be the object
<ins>pointed to by the pointer</ins> owned by <code class='backtick'>s.sch_</code>.
</p>
</blockquote>
</li>
</ol>






<hr>
<h3 id="4447"><a href="#4447">4447</a><sup><a href="https://cplusplus.github.io/LWG/issue4447">(i)</a></sup>. Remove unnecessary <code>sizeof…(Env) &gt; 1</code> condition</h3>
<p><b>Section:</b> 33.4 <a href="https://wg21.link/execution.syn">[execution.syn]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Tomasz Kamiński <b>Opened:</b> 2025-11-05 <b>Last modified:</b> 2025-11-05</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<b>Addresses <a href="https://github.com/cplusplus/nbballot/issues/900">US 206-325</a></b>
<p>The “<code class='backtick'>sizeof…(Env) &amp;gt; 1</code> is <code class='backtick'>true</code>” part seems unreachable because <code class='backtick'>CS</code> is ill-formed in that case.</p>

<p><i>[Kona 2025-11-05; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>



<p id="res-4447"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<ol>

<li><p>Modify 33.4 <a href="https://wg21.link/execution.syn">[execution.syn]</a> as indicated:</p>

<blockquote>
<p>
-2- For type <code class='backtick'>Sndr</code> and pack of types <code class='backtick'>Env</code>, let <code class='backtick'>CS</code> be <code class='backtick'>completion_signatures_of_t&amp;lt;Sndr, Env...&amp;gt;</code>.
Then <code class='backtick'>single-sender-value-type&amp;lt;Sndr, Env...&amp;gt;</code> is ill-formed if <code class='backtick'>CS</code> is ill-formed
<del>or if <code>sizeof...(Env) &gt; 1</code> is <code class='backtick'>true</code></del>; otherwise, it is an alias for:
[&hellip;]
</p>
</blockquote>
</li>
</ol>






<hr>
<h3 id="4448"><a href="#4448">4448</a><sup><a href="https://cplusplus.github.io/LWG/issue4448">(i)</a></sup>. Do not forward <code class='backtick'>fn</code> in <code class='backtick'>completion_signatures</code></h3>
<p><b>Section:</b> 33.10 <a href="https://wg21.link/exec.cmplsig">[exec.cmplsig]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Tomasz Kamiński <b>Opened:</b> 2025-11-05 <b>Last modified:</b> 2025-11-05</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<b>Addresses <a href="https://github.com/cplusplus/nbballot/issues/935">US 230-360</a></b>
<p><code class='backtick'>fn</code> can be called multiple times and therefore should not be forwarded.</p>

<p><i>[Kona 2025-11-05; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>



<p id="res-4448"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<ol>

<li><p>Modify 33.10 <a href="https://wg21.link/exec.cmplsig">[exec.cmplsig]</a> as indicated:</p>

<p>-8-</p>
<pre>
namespace std::execution {
  template&lt;<i>completion-signature</i>... Fns&gt;
    struct completion_signatures {
      template&lt;class Tag&gt;
        static constexpr size_t <i>count-of</i>(Tag) { return <i>see below</i>; }

      template&lt;class Fn&gt;
        static constexpr void <i>for-each</i>(Fn&amp;&amp; fn) {               <i>// exposition only</i>
          (<del>std::forward&lt;Fn&gt;(fn)</del><ins>fn</ins>(static_cast&lt;Fns*&gt;(nullptr)), ...);
        }
    };

  [&hellip;]
}
</pre>
</li>
</ol>






<hr>
<h3 id="4449"><a href="#4449">4449</a><sup><a href="https://cplusplus.github.io/LWG/issue4449">(i)</a></sup>. <code class='backtick'>define_aggregate</code> members must be public</h3>
<p><b>Section:</b> 21.4.16 <a href="https://wg21.link/meta.reflection.define.aggregate">[meta.reflection.define.aggregate]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Daniel Katz <b>Opened:</b> 2025-11-05 <b>Last modified:</b> 2025-11-05</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View other</b> <a href="lwg-index-open.html#meta.reflection.define.aggregate">active issues</a> in [meta.reflection.define.aggregate].</p>
<p><b>View all other</b> <a href="lwg-index.html#meta.reflection.define.aggregate">issues</a> in [meta.reflection.define.aggregate].</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<p>
The access of members of classes defined by injected declarations produced by evaluations of 
<code class='backtick'>std::meta::define_aggregate</code> is unspecified.
</p>

<p><i>[Kona 2025-11-05; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>



<p id="res-4449"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<ol>

<li><p>Modify 21.4.16 <a href="https://wg21.link/meta.reflection.define.aggregate">[meta.reflection.define.aggregate]</a> as indicated:</p>

<blockquote>
<pre>
template&lt;reflection_range R = initializer_list&lt;info&gt;&gt;
  consteval info define_aggregate(info class_type, R&amp;&amp; mdescrs);
</pre>
<blockquote>
<p>
-7- Let <code><i>C</i></code> be the class represented by <code class='backtick'>class_type</code> and <code><i>r<sub>K</sub></i></code> 
be the <code><i>K</i></code><sup>th</sup> reflection value in <code class='backtick'>mdescrs</code>. [&hellip;]
<p/>
-8- <i>Constant When</i>: [&hellip;]
<p/>
-9- <i>Effects</i>: Produces an injected declaration <code><i>D</i></code> (7.7 <a href="https://wg21.link/expr.const">[expr.const]</a>) 
that defines <code><i>C</i></code> and has properties as follows:
</p>
<ul style="list-style-type: none">
<li>(9.1) &mdash; [&hellip;]
</li>
<li>(9.2) &mdash; [&hellip;]
</li>
<li>(9.3) &mdash; [&hellip;]
</li>
<li>(9.4) &mdash; [&hellip;]
</li>
<li>(9.5) &mdash; For each <code><i>r<sub>K</sub></i></code>, there is a corresponding entity 
<code><i>M<sub>K</sub></i></code> <ins>with public access</ins> belonging to the class scope 
of <code><i>D</i></code> with the following properties: [&hellip;]
</li>
<li>(9.6) &mdash; [&hellip;]
</li>
</ul>
</blockquote>
</blockquote>
</li>
</ol>






<hr>
<h3 id="4450"><a href="#4450">4450</a><sup><a href="https://cplusplus.github.io/LWG/issue4450">(i)</a></sup>. <code>std::atomic_ref&lt;T&gt;::store_<i>key</i></code> should be disabled for const <code class='backtick'>T</code></h3>
<p><b>Section:</b> 32.5.7.3 <a href="https://wg21.link/atomics.ref.int">[atomics.ref.int]</a> <b>Status:</b> <a href="lwg-active.html#Immediate">Immediate</a>
 <b>Submitter:</b> Jonathan Wakely <b>Opened:</b> 2025-11-05 <b>Last modified:</b> 2025-11-05</p>
<p><b>Priority: </b>Not Prioritized
</p>
<p><b>View all issues with</b> <a href="lwg-status.html#Immediate">Immediate</a> status.</p>
<p><b>Discussion:</b></p>
<b>Addresses <a href="https://github.com/cplusplus/nbballot/issues/886">US 193-311</a></b>
<p>
The new <code>store_<i>key</i></code> functions modify the object,
so it can't be const.
</p>

<p><i>[Kona 2025-11-05; approved by LWG. Status changed: New &rarr; Immediate.]</i></p>



<p id="res-4450"><b>Proposed resolution:</b></p>
<p>
This wording is relative to <a href="https://wg21.link/N5014">N5014</a>.
</p>

<ol>
<li><p>Modify 32.5.7.3 <a href="https://wg21.link/atomics.ref.int">[atomics.ref.int]</a>, as indicated:</p>

<blockquote>
<pre>
constexpr void store_<i>key</i>(value_type operand,
                         memory_order order = memory_order::seq_cst) const noexcept;
</pre>
<blockquote>
<p><ins>-?- <i>Constraints</i>:
<code>is_const_v&lt;<i>integral-type</i>&gt;</code> is <code class='backtick'>false</code>.</ins>
</p>
<p>-10- <i>Preconditions</i>:
<code class='backtick'>order</code> is <code class='backtick'>memory_order::relaxed</code>, <code class='backtick'>memory_order::release</code>,
or <code class='backtick'>memory_order::seq_cst</code>.
</p>
<p>-11- <i>Effects</i>:
Atomically replaces the value referenced by <code class='backtick'>*ptr</code> with the result of
the computation applied to the value referenced by <code class='backtick'>*ptr</code>
and the given <code class='backtick'>operand</code>.
Memory is affected according to the value of <code class='backtick'>order</code>.
These operations are atomic modify-write operations
(32.5.4 <a href="https://wg21.link/atomics.order">[atomics.order]</a>).
</p>
</blockquote>
</blockquote>
</li>

<li><p>Modify 32.5.7.4 <a href="https://wg21.link/atomics.ref.float">[atomics.ref.float]</a>, as indicated:</p>

<blockquote>
<pre>
constexpr void store_<i>key</i>(value_type operand,
                         memory_order order = memory_order::seq_cst) const noexcept;
</pre>
<blockquote>
<p><ins>-?- <i>Constraints</i>:
<code>is_const_v&lt;<i>floating-point-type</i>&gt;</code> is <code class='backtick'>false</code>.</ins>
</p>
<p>-10- <i>Preconditions</i>:
<code class='backtick'>order</code> is <code class='backtick'>memory_order::relaxed</code>, <code class='backtick'>memory_order::release</code>,
or <code class='backtick'>memory_order::seq_cst</code>.
</p>
<p>-11- <i>Effects</i>:
Atomically replaces the value referenced by <code class='backtick'>*ptr</code> with the result of
the computation applied to the value referenced by <code class='backtick'>*ptr</code>
and the given <code class='backtick'>operand</code>.
Memory is affected according to the value of <code class='backtick'>order</code>.
These operations are atomic modify-write operations
(32.5.4 <a href="https://wg21.link/atomics.order">[atomics.order]</a>).
</p>
</blockquote>
</blockquote>
</li>

<li><p>Modify 32.5.7.5 <a href="https://wg21.link/atomics.ref.pointer">[atomics.ref.pointer]</a>, as indicated:</p>

<blockquote>
<pre>
constexpr void store_<i>key</i>(<i>see above</i> operand,
                         memory_order order = memory_order::seq_cst) const noexcept;
</pre>
<blockquote>
<p><ins>-?- <i>Constraints</i>:
<code>is_const_v&lt;<i>pointer-type</i>&gt;</code> is <code class='backtick'>false</code>.</ins>
</p>
<p>-11- <i>Mandates</i>:
<code class='backtick'>T</code> is a complete object type.
</p>
<p>-12- <i>Preconditions</i>:
<code class='backtick'>order</code> is <code class='backtick'>memory_order::relaxed</code>, <code class='backtick'>memory_order::release</code>,
or <code class='backtick'>memory_order::seq_cst</code>.
</p>
<p>-13- <i>Effects</i>:
Atomically replaces the value referenced by <code class='backtick'>*ptr</code> with the result of
the computation applied to the value referenced by <code class='backtick'>*ptr</code>
and the given <code class='backtick'>operand</code>.
Memory is affected according to the value of <code class='backtick'>order</code>.
These operations are atomic modify-write operations
(32.5.4 <a href="https://wg21.link/atomics.order">[atomics.order]</a>).
</p>
</blockquote>
</blockquote>
</li>
</ol>






</body>
</html>
