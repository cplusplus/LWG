<?xml version='1.0' encoding='utf-8' standalone='no'?>
<!DOCTYPE issue SYSTEM "lwg-issue.dtd">

<issue num="4494" status="New">
<title>Add `consteval` to `std::meta::exception` defaulted member functions</title>
<section><sref ref="[meta.reflection.exception]"/></section>
<submitter>Marek Polacek</submitter>
<date>16 Dec 2025</date>
<priority>99</priority>

<discussion>
<p>
<a href="https://wg21.link/cwg3115">CWG 3115</a> states that every function of consteval-only type shall be an
immediate function.  This caused a problem for `std::meta::exception::what()` which was marked `constexpr` 
but not `consteval`. To be able to mark it `consteval`, we had to tweak the rules about overriding by a consteval
virtual function (<a href="https://wg21.link/cwg3117">CWG 3117</a> ).
<p/>
But <sref ref="[meta.reflection.exception]"/> still defines `std::meta::exception` such that it contains these 
defaulted special member functions:
</p>
<blockquote><pre>
exception(const exception&amp;) = default;
exception(exception&amp;&amp;) = default;

exception&amp; operator=(const exception&amp;) = default;
exception&amp; operator=(exception&amp;&amp;) = default;
</pre></blockquote>
<p>
which aren't `consteval` (and since they're not templates, they won't be
promoted to `consteval` as per <paper num="P2564"/>). I propose to make the four functions
`consteval`:
</p>
<blockquote><pre>
<ins>consteval</ins> exception(const exception&amp;) = default;
<ins>consteval</ins> exception(exception&amp;&amp;) = default;

<ins>consteval</ins> exception&amp; operator=(const exception&amp;) = default;
<ins>consteval</ins> exception&amp; operator=(exception&amp;&amp;) = default;
</pre></blockquote>
</discussion>

<resolution>
<p>
This wording is relative to <paper num="N5032"/>.
</p>

<ol>
<li><p>Modify <sref ref="[meta.reflection.exception]"/> as indicated:</p>

<blockquote>
<pre>
namespace std::meta {
  class exception : public std::exception {
  private:
    optional&lt;string&gt; <i>what_</i>;  <i>// exposition only</i>
    u8string <i>u8what_</i>;        <i>// exposition only</i>
    info <i>from_</i>;              <i>// exposition only</i>
    source_location <i>where_</i>;  <i>// exposition only</i>
  public:
    consteval exception(u8string_view what, info from,
                        source_location where = source_location::current()) noexcept;
                        
    consteval exception(string_view what, info from,
                        source_location where = source_location::current()) noexcept;
                        
    <ins>consteval</ins> exception(const exception&amp;) = default;
    <ins>consteval</ins> exception(exception&amp;&amp;) = default;
    
    <ins>consteval</ins> exception&amp; operator=(const exception&amp;) = default;
    <ins>consteval</ins> exception&amp; operator=(exception&amp;&amp;) = default;
    
    constexpr const char* what() const noexcept override;
    consteval u8string_view u8what() const noexcept;
    consteval info from() const noexcept;
    consteval source_location where() const noexcept;
  };
}
</pre>
</blockquote>
</li>

</ol>

</resolution>

</issue>
